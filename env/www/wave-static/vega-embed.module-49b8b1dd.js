import{g as Hr}from"./index-f13f89f0.js";import{h as Yn,i as fe,a as z,w as zo,s as yi,$ as B,b as X,c as bi,d as I,e as le,l as Jp,W as Qp,f as Zp,m as qr,g as vi,j as eg,p as tg,v as ng}from"./vega.module-581d8f44.js";import"./timer-4c6100d9.js";/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */var ig=globalThis&&globalThis.__extends||function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(i,r){i.__proto__=r}||function(i,r){for(var s in r)r.hasOwnProperty(s)&&(i[s]=r[s])},e(t,n)};return function(t,n){e(t,n);function i(){this.constructor=t}t.prototype=n===null?Object.create(n):(i.prototype=n.prototype,new i)}}(),rg=Object.prototype.hasOwnProperty;function so(e,t){return rg.call(e,t)}function oo(e){if(Array.isArray(e)){for(var t=new Array(e.length),n=0;n<t.length;n++)t[n]=""+n;return t}if(Object.keys)return Object.keys(e);var i=[];for(var r in e)so(e,r)&&i.push(r);return i}function De(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function ao(e){for(var t=0,n=e.length,i;t<n;){if(i=e.charCodeAt(t),i>=48&&i<=57){t++;continue}return!1}return!0}function yn(e){return e.indexOf("/")===-1&&e.indexOf("~")===-1?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function hu(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function co(e){if(e===void 0)return!0;if(e){if(Array.isArray(e)){for(var t=0,n=e.length;t<n;t++)if(co(e[t]))return!0}else if(typeof e=="object"){for(var i=oo(e),r=i.length,s=0;s<r;s++)if(co(e[i[s]]))return!0}}return!1}function Oc(e,t){var n=[e];for(var i in t){var r=typeof t[i]=="object"?JSON.stringify(t[i],null,2):t[i];typeof r<"u"&&n.push(i+": "+r)}return n.join("\n")}var mu=function(e){ig(t,e);function t(n,i,r,s,o){var a=this.constructor,c=e.call(this,Oc(n,{name:i,index:r,operation:s,tree:o}))||this;return c.name=i,c.index=r,c.operation=s,c.tree=o,Object.setPrototypeOf(c,a.prototype),c.message=Oc(n,{name:i,index:r,operation:s,tree:o}),c}return t}(Error),ae=mu,sg=De,Kn={add:function(e,t,n){return e[t]=this.value,{newDocument:n}},remove:function(e,t,n){var i=e[t];return delete e[t],{newDocument:n,removed:i}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:function(e,t,n){var i=Or(n,this.path);i&&(i=De(i));var r=xn(n,{op:"remove",path:this.from}).removed;return xn(n,{op:"add",path:this.path,value:r}),{newDocument:n,removed:i}},copy:function(e,t,n){var i=Or(n,this.from);return xn(n,{op:"add",path:this.path,value:De(i)}),{newDocument:n}},test:function(e,t,n){return{newDocument:n,test:Wi(e[t],this.value)}},_get:function(e,t,n){return this.value=e[t],{newDocument:n}}},og={add:function(e,t,n){return ao(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:n,index:t}},remove:function(e,t,n){var i=e.splice(t,1);return{newDocument:n,removed:i[0]}},replace:function(e,t,n){var i=e[t];return e[t]=this.value,{newDocument:n,removed:i}},move:Kn.move,copy:Kn.copy,test:Kn.test,_get:Kn._get};function Or(e,t){if(t=="")return e;var n={op:"_get",path:t};return xn(e,n),n.value}function xn(e,t,n,i,r,s){if(n===void 0&&(n=!1),i===void 0&&(i=!0),r===void 0&&(r=!0),s===void 0&&(s=0),n&&(typeof n=="function"?n(t,0,e,t.path):Cr(t,0)),t.path===""){var o={newDocument:e};if(t.op==="add")return o.newDocument=t.value,o;if(t.op==="replace")return o.newDocument=t.value,o.removed=e,o;if(t.op==="move"||t.op==="copy")return o.newDocument=Or(e,t.from),t.op==="move"&&(o.removed=e),o;if(t.op==="test"){if(o.test=Wi(e,t.value),o.test===!1)throw new ae("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o.newDocument=e,o}else{if(t.op==="remove")return o.removed=e,o.newDocument=null,o;if(t.op==="_get")return t.value=e,o;if(n)throw new ae("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e);return o}}else{i||(e=De(e));var a=t.path||"",c=a.split("/"),l=e,u=1,f=c.length,d=void 0,p=void 0,g=void 0;for(typeof n=="function"?g=n:g=Cr;;){if(p=c[u],p&&p.indexOf("~")!=-1&&(p=hu(p)),r&&(p=="__proto__"||p=="prototype"&&u>0&&c[u-1]=="constructor"))throw new TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(n&&d===void 0&&(l[p]===void 0?d=c.slice(0,u).join("/"):u==f-1&&(d=t.path),d!==void 0&&g(t,0,e,d)),u++,Array.isArray(l)){if(p==="-")p=l.length;else{if(n&&!ao(p))throw new ae("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);ao(p)&&(p=~~p)}if(u>=f){if(n&&t.op==="add"&&p>l.length)throw new ae("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);var o=og[t.op].call(t,l,p,e);if(o.test===!1)throw new ae("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}}else if(u>=f){var o=Kn[t.op].call(t,l,p,e);if(o.test===!1)throw new ae("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return o}if(l=l[p],n&&u<f&&(!l||typeof l!="object"))throw new ae("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function Xr(e,t,n,i,r){if(i===void 0&&(i=!0),r===void 0&&(r=!0),n&&!Array.isArray(t))throw new ae("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");i||(e=De(e));for(var s=new Array(t.length),o=0,a=t.length;o<a;o++)s[o]=xn(e,t[o],n,!0,r,o),e=s[o].newDocument;return s.newDocument=e,s}function ag(e,t,n){var i=xn(e,t);if(i.test===!1)throw new ae("Test operation failed","TEST_OPERATION_FAILED",n,t,e);return i.newDocument}function Cr(e,t,n,i){if(typeof e!="object"||e===null||Array.isArray(e))throw new ae("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,n);if(Kn[e.op]){if(typeof e.path!="string")throw new ae("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,n);if(e.path.indexOf("/")!==0&&e.path.length>0)throw new ae('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,n);if((e.op==="move"||e.op==="copy")&&typeof e.from!="string")throw new ae("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&e.value===void 0)throw new ae("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,n);if((e.op==="add"||e.op==="replace"||e.op==="test")&&co(e.value))throw new ae("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,n);if(n){if(e.op=="add"){var r=e.path.split("/").length,s=i.split("/").length;if(r!==s+1&&r!==s)throw new ae("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,n)}else if(e.op==="replace"||e.op==="remove"||e.op==="_get"){if(e.path!==i)throw new ae("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,n)}else if(e.op==="move"||e.op==="copy"){var o={op:"_get",path:e.from,value:void 0},a=yu([o],n);if(a&&a.name==="OPERATION_PATH_UNRESOLVABLE")throw new ae("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,n)}}}else throw new ae("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,n)}function yu(e,t,n){try{if(!Array.isArray(e))throw new ae("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)Xr(De(t),De(e),n||!0);else{n=n||Cr;for(var i=0;i<e.length;i++)n(e[i],i,t,void 0)}}catch(r){if(r instanceof ae)return r;throw r}}function Wi(e,t){if(e===t)return!0;if(e&&t&&typeof e=="object"&&typeof t=="object"){var n=Array.isArray(e),i=Array.isArray(t),r,s,o;if(n&&i){if(s=e.length,s!=t.length)return!1;for(r=s;r--!==0;)if(!Wi(e[r],t[r]))return!1;return!0}if(n!=i)return!1;var a=Object.keys(e);if(s=a.length,s!==Object.keys(t).length)return!1;for(r=s;r--!==0;)if(!t.hasOwnProperty(a[r]))return!1;for(r=s;r--!==0;)if(o=a[r],!Wi(e[o],t[o]))return!1;return!0}return e!==e&&t!==t}const cg=Object.freeze(Object.defineProperty({__proto__:null,JsonPatchError:ae,_areEquals:Wi,applyOperation:xn,applyPatch:Xr,applyReducer:ag,deepClone:sg,getValueByPointer:Or,validate:yu,validator:Cr},Symbol.toStringTag,{value:"Module"}));/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2021 Joachim Wester
 * MIT license
 */var Do=new WeakMap,lg=function(){function e(t){this.observers=new Map,this.obj=t}return e}(),ug=function(){function e(t,n){this.callback=t,this.observer=n}return e}();function fg(e){return Do.get(e)}function dg(e,t){return e.observers.get(t)}function pg(e,t){e.observers.delete(t.callback)}function gg(e,t){t.unobserve()}function hg(e,t){var n=[],i,r=fg(e);if(!r)r=new lg(e),Do.set(e,r);else{var s=dg(r,t);i=s&&s.observer}if(i)return i;if(i={},r.value=De(e),t){i.callback=t,i.next=null;var o=function(){lo(i)},a=function(){clearTimeout(i.next),i.next=setTimeout(o)};typeof window<"u"&&(window.addEventListener("mouseup",a),window.addEventListener("keyup",a),window.addEventListener("mousedown",a),window.addEventListener("keydown",a),window.addEventListener("change",a))}return i.patches=n,i.object=e,i.unobserve=function(){lo(i),clearTimeout(i.next),pg(r,i),typeof window<"u"&&(window.removeEventListener("mouseup",a),window.removeEventListener("keyup",a),window.removeEventListener("mousedown",a),window.removeEventListener("keydown",a),window.removeEventListener("change",a))},r.observers.set(t,new ug(t,i)),i}function lo(e,t){t===void 0&&(t=!1);var n=Do.get(e.object);jo(n.value,e.object,e.patches,"",t),e.patches.length&&Xr(n.value,e.patches);var i=e.patches;return i.length>0&&(e.patches=[],e.callback&&e.callback(i)),i}function jo(e,t,n,i,r){if(t!==e){typeof t.toJSON=="function"&&(t=t.toJSON());for(var s=oo(t),o=oo(e),a=!1,c=o.length-1;c>=0;c--){var l=o[c],u=e[l];if(so(t,l)&&!(t[l]===void 0&&u!==void 0&&Array.isArray(t)===!1)){var f=t[l];typeof u=="object"&&u!=null&&typeof f=="object"&&f!=null&&Array.isArray(u)===Array.isArray(f)?jo(u,f,n,i+"/"+yn(l),r):u!==f&&(r&&n.push({op:"test",path:i+"/"+yn(l),value:De(u)}),n.push({op:"replace",path:i+"/"+yn(l),value:De(f)}))}else Array.isArray(e)===Array.isArray(t)?(r&&n.push({op:"test",path:i+"/"+yn(l),value:De(u)}),n.push({op:"remove",path:i+"/"+yn(l)}),a=!0):(r&&n.push({op:"test",path:i,value:e}),n.push({op:"replace",path:i,value:t}))}if(!(!a&&s.length==o.length))for(var c=0;c<s.length;c++){var l=s[c];!so(e,l)&&t[l]!==void 0&&n.push({op:"add",path:i+"/"+yn(l),value:De(t[l])})}}}function mg(e,t,n){n===void 0&&(n=!1);var i=[];return jo(e,t,i,"",n),i}const yg=Object.freeze(Object.defineProperty({__proto__:null,compare:mg,generate:lo,observe:hg,unobserve:gg},Symbol.toStringTag,{value:"Module"}));Object.assign({},cg,yg,{JsonPatchError:mu,deepClone:De,escapePathComponent:yn,unescapePathComponent:hu});var bg=/("(?:[^\\"]|\\.)*")|[:,]/g,vg=function(t,n){var i,r,s;return n=n||{},i=JSON.stringify([1],void 0,n.indent===void 0?2:n.indent).slice(2,-3),r=i===""?1/0:n.maxLength===void 0?80:n.maxLength,s=n.replacer,function o(a,c,l){var u,f,d,p,g,h,m,y,b,N,_,$;if(a&&typeof a.toJSON=="function"&&(a=a.toJSON()),_=JSON.stringify(a,s),_===void 0)return _;if(m=r-c.length-l,_.length<=m&&(b=_.replace(bg,function(P,F){return F||P+" "}),b.length<=m))return b;if(s!=null&&(a=JSON.parse(_),s=void 0),typeof a=="object"&&a!==null){if(y=c+i,d=[],f=0,Array.isArray(a))for(N="[",u="]",m=a.length;f<m;f++)d.push(o(a[f],y,f===m-1?0:1)||"null");else for(N="{",u="}",h=Object.keys(a),m=h.length;f<m;f++)p=h[f],g=JSON.stringify(p)+": ",$=o(a[p],y,g.length+(f===m-1?0:1)),$!==void 0&&d.push(g+$);if(d.length>0)return[N,i+d.join(",\n"+y),u].join("\n"+c)}return _}(t,"",0)};const Ds=Hr(vg);function xg(e,t,n){let i;t.x2&&(t.x?(n&&e.x>e.x2&&(i=e.x,e.x=e.x2,e.x2=i),e.width=e.x2-e.x):e.x=e.x2-(e.width||0)),t.xc&&(e.x=e.xc-(e.width||0)/2),t.y2&&(t.y?(n&&e.y>e.y2&&(i=e.y,e.y=e.y2,e.y2=i),e.height=e.y2-e.y):e.y=e.y2-(e.height||0)),t.yc&&(e.y=e.yc-(e.height||0)/2)}var Sg={NaN:NaN,E:Math.E,LN2:Math.LN2,LN10:Math.LN10,LOG2E:Math.LOG2E,LOG10E:Math.LOG10E,PI:Math.PI,SQRT1_2:Math.SQRT1_2,SQRT2:Math.SQRT2,MIN_VALUE:Number.MIN_VALUE,MAX_VALUE:Number.MAX_VALUE},Eg={"*":(e,t)=>e*t,"+":(e,t)=>e+t,"-":(e,t)=>e-t,"/":(e,t)=>e/t,"%":(e,t)=>e%t,">":(e,t)=>e>t,"<":(e,t)=>e<t,"<=":(e,t)=>e<=t,">=":(e,t)=>e>=t,"==":(e,t)=>e==t,"!=":(e,t)=>e!=t,"===":(e,t)=>e===t,"!==":(e,t)=>e!==t,"&":(e,t)=>e&t,"|":(e,t)=>e|t,"^":(e,t)=>e^t,"<<":(e,t)=>e<<t,">>":(e,t)=>e>>t,">>>":(e,t)=>e>>>t},wg={"+":e=>+e,"-":e=>-e,"~":e=>~e,"!":e=>!e};const $g=Array.prototype.slice,ln=(e,t,n)=>{const i=n?n(t[0]):t[0];return i[e].apply(i,$g.call(t,1))},Og=(e,t,n,i,r,s,o)=>new Date(e,t||0,n!=null?n:1,i||0,r||0,s||0,o||0);var Cg={isNaN:Number.isNaN,isFinite:Number.isFinite,abs:Math.abs,acos:Math.acos,asin:Math.asin,atan:Math.atan,atan2:Math.atan2,ceil:Math.ceil,cos:Math.cos,exp:Math.exp,floor:Math.floor,log:Math.log,max:Math.max,min:Math.min,pow:Math.pow,random:Math.random,round:Math.round,sin:Math.sin,sqrt:Math.sqrt,tan:Math.tan,clamp:(e,t,n)=>Math.max(t,Math.min(n,e)),now:Date.now,utc:Date.UTC,datetime:Og,date:e=>new Date(e).getDate(),day:e=>new Date(e).getDay(),year:e=>new Date(e).getFullYear(),month:e=>new Date(e).getMonth(),hours:e=>new Date(e).getHours(),minutes:e=>new Date(e).getMinutes(),seconds:e=>new Date(e).getSeconds(),milliseconds:e=>new Date(e).getMilliseconds(),time:e=>new Date(e).getTime(),timezoneoffset:e=>new Date(e).getTimezoneOffset(),utcdate:e=>new Date(e).getUTCDate(),utcday:e=>new Date(e).getUTCDay(),utcyear:e=>new Date(e).getUTCFullYear(),utcmonth:e=>new Date(e).getUTCMonth(),utchours:e=>new Date(e).getUTCHours(),utcminutes:e=>new Date(e).getUTCMinutes(),utcseconds:e=>new Date(e).getUTCSeconds(),utcmilliseconds:e=>new Date(e).getUTCMilliseconds(),length:e=>e.length,join:function(){return ln("join",arguments)},indexof:function(){return ln("indexOf",arguments)},lastindexof:function(){return ln("lastIndexOf",arguments)},slice:function(){return ln("slice",arguments)},reverse:e=>e.slice().reverse(),parseFloat,parseInt,upper:e=>String(e).toUpperCase(),lower:e=>String(e).toLowerCase(),substring:function(){return ln("substring",arguments,String)},split:function(){return ln("split",arguments,String)},replace:function(){return ln("replace",arguments,String)},trim:e=>String(e).trim(),regexp:RegExp,test:(e,t)=>RegExp(e).test(t)};const Ng=["view","item","group","xy","x","y"],uo=new Set([Function,eval,setTimeout,setInterval]);typeof setImmediate=="function"&&uo.add(setImmediate);const _g={Literal:(e,t)=>t.value,Identifier:(e,t)=>{const n=t.name;return e.memberDepth>0?n:n==="datum"?e.datum:n==="event"?e.event:n==="item"?e.item:Sg[n]||e.params["$"+n]},MemberExpression:(e,t)=>{const n=!t.computed,i=e(t.object);n&&(e.memberDepth+=1);const r=e(t.property);if(n&&(e.memberDepth-=1),uo.has(i[r])){console.error('Prevented interpretation of member "'.concat(r,'" which could lead to insecure code execution'));return}return i[r]},CallExpression:(e,t)=>{const n=t.arguments;let i=t.callee.name;return i.startsWith("_")&&(i=i.slice(1)),i==="if"?e(n[0])?e(n[1]):e(n[2]):(e.fn[i]||Cg[i]).apply(e.fn,n.map(e))},ArrayExpression:(e,t)=>t.elements.map(e),BinaryExpression:(e,t)=>Eg[t.operator](e(t.left),e(t.right)),UnaryExpression:(e,t)=>wg[t.operator](e(t.argument)),ConditionalExpression:(e,t)=>e(t.test)?e(t.consequent):e(t.alternate),LogicalExpression:(e,t)=>t.operator==="&&"?e(t.left)&&e(t.right):e(t.left)||e(t.right),ObjectExpression:(e,t)=>t.properties.reduce((n,i)=>{e.memberDepth+=1;const r=e(i.key);return e.memberDepth-=1,uo.has(e(i.value))?console.error('Prevented interpretation of property "'.concat(r,'" which could lead to insecure code execution')):n[r]=e(i.value),n},{})};function Ti(e,t,n,i,r,s){const o=a=>_g[a.type](o,a);return o.memberDepth=0,o.fn=Object.create(t),o.params=n,o.datum=i,o.event=r,o.item=s,Ng.forEach(a=>o.fn[a]=function(){return r.vega[a](...arguments)}),o(e)}var Tg={operator(e,t){const n=t.ast,i=e.functions;return r=>Ti(n,i,r)},parameter(e,t){const n=t.ast,i=e.functions;return(r,s)=>Ti(n,i,s,r)},event(e,t){const n=t.ast,i=e.functions;return r=>Ti(n,i,void 0,void 0,r)},handler(e,t){const n=t.ast,i=e.functions;return(r,s)=>{const o=s.item&&s.item.datum;return Ti(n,i,r,o,s)}},encode(e,t){const{marktype:n,channels:i}=t,r=e.functions,s=n==="group"||n==="image"||n==="rect";return(o,a)=>{const c=o.datum;let l=0,u;for(const f in i)u=Ti(i[f].ast,r,a,c,void 0,o),o[f]!==u&&(o[f]=u,l=1);return n!=="rule"&&xg(o,i,s),l}}};const Ag="vega-lite",Fg='Dominik Moritz, Kanit "Ham" Wongsuphasawat, Arvind Satyanarayan, Jeffrey Heer',kg="5.14.1",Ig=["Kanit Wongsuphasawat (http://kanitw.yellowpigz.com)","Dominik Moritz (https://www.domoritz.de)","Arvind Satyanarayan (https://arvindsatya.com)","Jeffrey Heer (https://jheer.org)"],Rg="https://vega.github.io/vega-lite/",Lg="Vega-Lite is a concise high-level language for interactive visualization.",Pg=["vega","chart","visualization"],zg="build/vega-lite.js",Dg="build/vega-lite.min.js",jg="build/vega-lite.min.js",Mg="build/src/index",Ug="build/src/index.d.ts",Bg={vl2pdf:"./bin/vl2pdf",vl2png:"./bin/vl2png",vl2svg:"./bin/vl2svg",vl2vg:"./bin/vl2vg"},Wg=["bin","build","src","vega-lite*","tsconfig.json"],Gg={changelog:"conventional-changelog -p angular -r 2",prebuild:"yarn clean:build",build:"yarn build:only","build:only":"tsc -p tsconfig.build.json && rollup -c","prebuild:examples":"yarn build:only","build:examples":"yarn data && TZ=America/Los_Angeles scripts/build-examples.sh","prebuild:examples-full":"yarn build:only","build:examples-full":"TZ=America/Los_Angeles scripts/build-examples.sh 1","build:example":"TZ=America/Los_Angeles scripts/build-example.sh","build:toc":"yarn build:jekyll && scripts/generate-toc","build:site":"rollup -c site/rollup.config.mjs","build:jekyll":"pushd site && bundle exec jekyll build -q && popd","build:versions":"scripts/update-version.sh",clean:"yarn clean:build && del-cli 'site/data/*' 'examples/compiled/*.png' && find site/examples ! -name 'index.md' ! -name 'data' -type f -delete","clean:build":"del-cli 'build/*' !build/vega-lite-schema.json",data:"rsync -r node_modules/vega-datasets/data/* site/data",schema:"mkdir -p build && ts-json-schema-generator -f tsconfig.json -p src/index.ts -t TopLevelSpec --no-type-check --no-ref-encode > build/vega-lite-schema.json && yarn renameschema && cp build/vega-lite-schema.json site/_data/",renameschema:"scripts/rename-schema.sh",presite:"yarn data && yarn schema && yarn build:site && yarn build:versions && scripts/create-example-pages.sh",site:"yarn site:only","site:only":"pushd site && bundle exec jekyll serve -I -l && popd",prettierbase:"prettier '**/*.{md,css,yml}'",format:"eslint . --fix && yarn prettierbase --write",lint:"eslint . && yarn prettierbase --check",jest:"NODE_OPTIONS=--experimental-vm-modules npx jest",test:"yarn jest test/ && yarn lint && yarn schema && yarn jest examples/ && yarn test:runtime","test:cover":"yarn jest --collectCoverage test/","test:inspect":"node --inspect-brk --experimental-vm-modules ./node_modules/.bin/jest --runInBand test","test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest test-runtime/ --config test-runtime/jest-config.json","test:runtime:generate":"yarn build:only && del-cli test-runtime/resources && VL_GENERATE_TESTS=true yarn test:runtime",watch:"tsc -p tsconfig.build.json -w","watch:site":"yarn build:site -w","watch:test":"yarn jest --watch test/","watch:test:runtime":"NODE_OPTIONS=--experimental-vm-modules TZ=America/Los_Angeles npx jest --watch test-runtime/ --config test-runtime/jest-config.json",release:"release-it"},Hg={type:"git",url:"https://github.com/vega/vega-lite.git"},qg="BSD-3-Clause",Xg={url:"https://github.com/vega/vega-lite/issues"},Vg={"@babel/core":"^7.21.8","@babel/plugin-proposal-class-properties":"^7.18.6","@babel/preset-env":"^7.21.5","@babel/preset-typescript":"^7.21.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-alias":"^5.0.0","@rollup/plugin-babel":"^6.0.3","@rollup/plugin-commonjs":"^25.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.0.2","@rollup/plugin-terser":"^0.4.1","@types/chai":"^4.3.5","@types/d3":"^7.4.0","@types/jest":"^27.4.1","@types/pako":"^2.0.0","@typescript-eslint/eslint-plugin":"^5.59.5","@typescript-eslint/parser":"^5.59.5",ajv:"^8.12.0","ajv-formats":"^2.1.1",chai:"^4.3.7",cheerio:"^1.0.0-rc.12","conventional-changelog-cli":"^3.0.0",d3:"^7.8.4","del-cli":"^5.0.0",eslint:"^8.40.0","eslint-config-prettier":"^8.8.0","eslint-plugin-jest":"^27.2.1","eslint-plugin-prettier":"^4.2.1","highlight.js":"^11.8.0",jest:"^27.5.1","jest-dev-server":"^6.1.1",mkdirp:"^3.0.1",pako:"^2.1.0",prettier:"^2.8.8",puppeteer:"^15.0.0","release-it":"^16.1.2",rollup:"^3.21.6","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-sourcemaps":"^0.6.3",serve:"^14.2.0",terser:"^5.17.3","ts-jest":"^29.1.0","ts-json-schema-generator":"^1.2.0",typescript:"~4.9.5","vega-cli":"^5.25.0","vega-datasets":"^2.7.0","vega-embed":"^6.22.1","vega-tooltip":"^0.32.0","yaml-front-matter":"^4.1.1"},Yg={"@types/clone":"~2.1.1",clone:"~2.1.2","fast-deep-equal":"~3.1.3","fast-json-stable-stringify":"~2.1.0","json-stringify-pretty-compact":"~3.0.0",tslib:"~2.5.0","vega-event-selector":"~3.0.1","vega-expression":"~5.1.0","vega-util":"~1.17.2",yargs:"~17.7.2"},Kg={vega:"^5.24.0"},Jg={node:">=16"},Qg={name:Ag,author:Fg,version:kg,collaborators:Ig,homepage:Rg,description:Lg,keywords:Pg,main:zg,unpkg:Dg,jsdelivr:jg,module:Mg,types:Ug,bin:Bg,files:Wg,scripts:Gg,repository:Hg,license:qg,bugs:Xg,devDependencies:Vg,dependencies:Yg,peerDependencies:Kg,engines:Jg};var bu={exports:{}};(function(e){var t=function(){function n(d,p){return p!=null&&d instanceof p}var i;try{i=Map}catch(d){i=function(){}}var r;try{r=Set}catch(d){r=function(){}}var s;try{s=Promise}catch(d){s=function(){}}function o(d,p,g,h,m){typeof p=="object"&&(g=p.depth,h=p.prototype,m=p.includeNonEnumerable,p=p.circular);var y=[],b=[],N=typeof Buffer<"u";typeof p>"u"&&(p=!0),typeof g>"u"&&(g=1/0);function _($,P){if($===null)return null;if(P===0)return $;var F,L;if(typeof $!="object")return $;if(n($,i))F=new i;else if(n($,r))F=new r;else if(n($,s))F=new s(function(A,k){$.then(function(D){A(_(D,P-1))},function(D){k(_(D,P-1))})});else if(o.__isArray($))F=[];else if(o.__isRegExp($))F=new RegExp($.source,f($)),$.lastIndex&&(F.lastIndex=$.lastIndex);else if(o.__isDate($))F=new Date($.getTime());else{if(N&&Buffer.isBuffer($))return Buffer.allocUnsafe?F=Buffer.allocUnsafe($.length):F=new Buffer($.length),$.copy(F),F;n($,Error)?F=Object.create($):typeof h>"u"?(L=Object.getPrototypeOf($),F=Object.create(L)):(F=Object.create(h),L=h)}if(p){var H=y.indexOf($);if(H!=-1)return b[H];y.push($),b.push(F)}n($,i)&&$.forEach(function(A,k){var D=_(k,P-1),q=_(A,P-1);F.set(D,q)}),n($,r)&&$.forEach(function(A){var k=_(A,P-1);F.add(k)});for(var Y in $){var ue;L&&(ue=Object.getOwnPropertyDescriptor(L,Y)),!(ue&&ue.set==null)&&(F[Y]=_($[Y],P-1))}if(Object.getOwnPropertySymbols)for(var _e=Object.getOwnPropertySymbols($),Y=0;Y<_e.length;Y++){var E=_e[Y],v=Object.getOwnPropertyDescriptor($,E);v&&!v.enumerable&&!m||(F[E]=_($[E],P-1),v.enumerable||Object.defineProperty(F,E,{enumerable:!1}))}if(m)for(var O=Object.getOwnPropertyNames($),Y=0;Y<O.length;Y++){var T=O[Y],v=Object.getOwnPropertyDescriptor($,T);v&&v.enumerable||(F[T]=_($[T],P-1),Object.defineProperty(F,T,{enumerable:!1}))}return F}return _(d,g)}o.clonePrototype=function(p){if(p===null)return null;var g=function(){};return g.prototype=p,new g};function a(d){return Object.prototype.toString.call(d)}o.__objToStr=a;function c(d){return typeof d=="object"&&a(d)==="[object Date]"}o.__isDate=c;function l(d){return typeof d=="object"&&a(d)==="[object Array]"}o.__isArray=l;function u(d){return typeof d=="object"&&a(d)==="[object RegExp]"}o.__isRegExp=u;function f(d){var p="";return d.global&&(p+="g"),d.ignoreCase&&(p+="i"),d.multiline&&(p+="m"),p}return o.__getRegExpFlags=f,o}();e.exports&&(e.exports=t)})(bu);var Zg=bu.exports;const eh=Hr(Zg);var th=function e(t,n){if(t===n)return!0;if(t&&n&&typeof t=="object"&&typeof n=="object"){if(t.constructor!==n.constructor)return!1;var i,r,s;if(Array.isArray(t)){if(i=t.length,i!=n.length)return!1;for(r=i;r--!==0;)if(!e(t[r],n[r]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if(s=Object.keys(t),i=s.length,i!==Object.keys(n).length)return!1;for(r=i;r--!==0;)if(!Object.prototype.hasOwnProperty.call(n,s[r]))return!1;for(r=i;r--!==0;){var o=s[r];if(!e(t[o],n[o]))return!1}return!0}return t!==t&&n!==n};const nh=Hr(th);var ih=function(e,t){t||(t={}),typeof t=="function"&&(t={cmp:t});var n=typeof t.cycles=="boolean"?t.cycles:!1,i=t.cmp&&function(s){return function(o){return function(a,c){var l={key:a,value:o[a]},u={key:c,value:o[c]};return s(l,u)}}}(t.cmp),r=[];return function s(o){if(o&&o.toJSON&&typeof o.toJSON=="function"&&(o=o.toJSON()),o!==void 0){if(typeof o=="number")return isFinite(o)?""+o:"null";if(typeof o!="object")return JSON.stringify(o);var a,c;if(Array.isArray(o)){for(c="[",a=0;a<o.length;a++)a&&(c+=","),c+=s(o[a])||"null";return c+"]"}if(o===null)return"null";if(r.indexOf(o)!==-1){if(n)return JSON.stringify("__cycle__");throw new TypeError("Converting circular structure to JSON")}var l=r.push(o)-1,u=Object.keys(o).sort(i&&i(o));for(c="",a=0;a<u.length;a++){var f=u[a],d=s(o[f]);d&&(c&&(c+=","),c+=JSON.stringify(f)+":"+d)}return r.splice(l,1),"{"+c+"}"}}(e)};const Mo=Hr(ih);function Uo(e){return!!e.or}function Bo(e){return!!e.and}function Wo(e){return!!e.not}function $r(e,t){if(Wo(e))$r(e.not,t);else if(Bo(e))for(const n of e.and)$r(n,t);else if(Uo(e))for(const n of e.or)$r(n,t);else t(e)}function Jn(e,t){return Wo(e)?{not:Jn(e.not,t)}:Bo(e)?{and:e.and.map(n=>Jn(n,t))}:Uo(e)?{or:e.or.map(n=>Jn(n,t))}:t(e)}const ft=nh,j=eh;function vu(e){throw new Error(e)}function ii(e,t){const n={};for(const i of t)Yn(e,i)&&(n[i]=e[i]);return n}function Ae(e,t){const n={...e};for(const i of t)delete n[i];return n}Set.prototype.toJSON=function(){return"Set(".concat([...this].map(e=>Mo(e)).join(","),")")};const te=Mo;function W(e){if(fe(e))return e;const t=z(e)?e:Mo(e);if(t.length<250)return t;let n=0;for(let i=0;i<t.length;i++){const r=t.charCodeAt(i);n=(n<<5)-n+r,n=n&n}return n}function fo(e){return e===!1||e===null}function G(e,t){return e.includes(t)}function On(e,t){let n=0;for(const[i,r]of e.entries())if(t(r,i,n++))return!0;return!1}function Go(e,t){let n=0;for(const[i,r]of e.entries())if(!t(r,i,n++))return!1;return!0}function xu(e,...t){for(const n of t)rh(e,n!=null?n:{});return e}function rh(e,t){for(const n of x(t))zo(e,n,t[n],!0)}function dt(e,t){const n=[],i={};let r;for(const s of e)r=t(s),!(r in i)&&(i[r]=1,n.push(s));return n}function sh(e,t){const n=x(e),i=x(t);if(n.length!==i.length)return!1;for(const r of n)if(e[r]!==t[r])return!1;return!0}function Su(e,t){if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0}function Ho(e,t){for(const n of e)if(t.has(n))return!0;return!1}function po(e){const t=new Set;for(const n of e){const r=yi(n).map((o,a)=>a===0?o:"[".concat(o,"]")),s=r.map((o,a)=>r.slice(0,a+1).join(""));for(const o of s)t.add(o)}return t}function qo(e,t){return e===void 0||t===void 0?!0:Ho(po(e),po(t))}function Q(e){return x(e).length===0}const x=Object.keys,Se=Object.values,Xt=Object.entries;function Gi(e){return e===!0||e===!1}function se(e){const t=e.replace(/\W/g,"_");return(e.match(/^\d+/)?"_":"")+t}function ji(e,t){return Wo(e)?"!(".concat(ji(e.not,t),")"):Bo(e)?"(".concat(e.and.map(n=>ji(n,t)).join(") && ("),")"):Uo(e)?"(".concat(e.or.map(n=>ji(n,t)).join(") || ("),")"):t(e)}function Nr(e,t){if(t.length===0)return!0;const n=t.shift();return n in e&&Nr(e[n],t)&&delete e[n],Q(e)}function Zi(e){return e.charAt(0).toUpperCase()+e.substr(1)}function Xo(e,t="datum"){const n=yi(e),i=[];for(let r=1;r<=n.length;r++){const s="[".concat(n.slice(0,r).map(B).join("]["),"]");i.push("".concat(t).concat(s))}return i.join(" && ")}function Eu(e,t="datum"){return"".concat(t,"[").concat(B(yi(e).join(".")),"]")}function oh(e){return e.replace(/(\[|\]|\.|'|")/g,"\\$1")}function Be(e){return"".concat(yi(e).map(oh).join("\\."))}function Cn(e,t,n){return e.replace(new RegExp(t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),"g"),n)}function Vo(e){return"".concat(yi(e).join("."))}function ri(e){return e?yi(e).length:0}function de(...e){for(const t of e)if(t!==void 0)return t}let wu=42;function $u(e){const t=++wu;return e?String(e)+t:t}function ah(){wu=42}function Ou(e){return Cu(e)?e:"__".concat(e)}function Cu(e){return e.startsWith("__")}function Hi(e){if(e!==void 0)return(e%360+360)%360}function Vr(e){return fe(e)?!0:!isNaN(e)&&!isNaN(parseFloat(e))}const Tt="row",At="column",Yr="facet",oe="x",ye="y",nt="x2",vt="y2",Zt="xOffset",xi="yOffset",it="radius",Lt="radius2",Ge="theta",Pt="theta2",rt="latitude",st="longitude",ot="latitude2",We="longitude2",Ie="color",xt="fill",St="stroke",Re="shape",zt="size",Pn="angle",Dt="opacity",en="fillOpacity",tn="strokeOpacity",nn="strokeWidth",rn="strokeDash",er="text",si="order",tr="detail",Kr="key",Nn="tooltip",Jr="href",Qr="url",Zr="description",ch={x:1,y:1,x2:1,y2:1},Nu={theta:1,theta2:1,radius:1,radius2:1};function _u(e){return e in Nu}const Yo={longitude:1,longitude2:1,latitude:1,latitude2:1};function Tu(e){switch(e){case rt:return"y";case ot:return"y2";case st:return"x";case We:return"x2"}}function Au(e){return e in Yo}const lh=x(Yo),Ko={...ch,...Nu,...Yo,xOffset:1,yOffset:1,color:1,fill:1,stroke:1,opacity:1,fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeDash:1,size:1,angle:1,shape:1,order:1,text:1,detail:1,key:1,tooltip:1,href:1,url:1,description:1};function Qn(e){return e===Ie||e===xt||e===St}const Fu={row:1,column:1,facet:1},Ue=x(Fu),Jo={...Ko,...Fu},uh=x(Jo),{order:I0,detail:R0,tooltip:L0,...fh}=Jo,{row:P0,column:z0,facet:D0,...dh}=fh;function ph(e){return!!dh[e]}function ku(e){return!!Jo[e]}const gh=[nt,vt,ot,We,Pt,Lt];function Iu(e){return zn(e)!==e}function zn(e){switch(e){case nt:return oe;case vt:return ye;case ot:return rt;case We:return st;case Pt:return Ge;case Lt:return it}return e}function Vt(e){if(_u(e))switch(e){case Ge:return"startAngle";case Pt:return"endAngle";case it:return"outerRadius";case Lt:return"innerRadius"}return e}function Et(e){switch(e){case oe:return nt;case ye:return vt;case rt:return ot;case st:return We;case Ge:return Pt;case it:return Lt}}function Le(e){switch(e){case oe:case nt:return"width";case ye:case vt:return"height"}}function Ru(e){switch(e){case oe:return"xOffset";case ye:return"yOffset";case nt:return"x2Offset";case vt:return"y2Offset";case Ge:return"thetaOffset";case it:return"radiusOffset";case Pt:return"theta2Offset";case Lt:return"radius2Offset"}}function Qo(e){switch(e){case oe:return"xOffset";case ye:return"yOffset"}}function Lu(e){switch(e){case"xOffset":return"x";case"yOffset":return"y"}}const hh=x(Ko),{x:j0,y:M0,x2:U0,y2:B0,xOffset:W0,yOffset:G0,latitude:H0,longitude:q0,latitude2:X0,longitude2:V0,theta:Y0,theta2:K0,radius:J0,radius2:Q0,...Zo}=Ko,mh=x(Zo),ea={x:1,y:1},wt=x(ea);function be(e){return e in ea}const ta={theta:1,radius:1},yh=x(ta);function es(e){return e==="width"?oe:ye}const Pu={xOffset:1,yOffset:1};function Si(e){return e in Pu}const{text:Z0,tooltip:eO,href:tO,url:nO,description:iO,detail:rO,key:sO,order:oO,...zu}=Zo,bh=x(zu);function vh(e){return!!Zo[e]}function xh(e){switch(e){case Ie:case xt:case St:case zt:case Re:case Dt:case nn:case rn:return!0;case en:case tn:case Pn:return!1}}const Du={...ea,...ta,...Pu,...zu},ts=x(Du);function jt(e){return!!Du[e]}function Sh(e,t){return wh(e)[t]}const ju={arc:"always",area:"always",bar:"always",circle:"always",geoshape:"always",image:"always",line:"always",rule:"always",point:"always",rect:"always",square:"always",trail:"always",text:"always",tick:"always"},{geoshape:aO,...Eh}=ju;function wh(e){switch(e){case Ie:case xt:case St:case Zr:case tr:case Kr:case Nn:case Jr:case si:case Dt:case en:case tn:case nn:case Yr:case Tt:case At:return ju;case oe:case ye:case Zt:case xi:case rt:case st:return Eh;case nt:case vt:case ot:case We:return{area:"always",bar:"always",image:"always",rect:"always",rule:"always",circle:"binned",point:"binned",square:"binned",tick:"binned",line:"binned",trail:"binned"};case zt:return{point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",text:"always",line:"always",trail:"always"};case rn:return{line:"always",point:"always",tick:"always",rule:"always",circle:"always",square:"always",bar:"always",geoshape:"always"};case Re:return{point:"always",geoshape:"always"};case er:return{text:"always"};case Pn:return{point:"always",square:"always",text:"always"};case Qr:return{image:"always"};case Ge:return{text:"always",arc:"always"};case it:return{text:"always",arc:"always"};case Pt:case Lt:return{arc:"always"}}}function js(e){switch(e){case oe:case ye:case Ge:case it:case Zt:case xi:case zt:case Pn:case nn:case Dt:case en:case tn:case nt:case vt:case Pt:case Lt:return;case Yr:case Tt:case At:case Re:case rn:case er:case Nn:case Jr:case Qr:case Zr:return"discrete";case Ie:case xt:case St:return"flexible";case rt:case st:case ot:case We:case tr:case Kr:case si:return}}const $h={argmax:1,argmin:1,average:1,count:1,distinct:1,product:1,max:1,mean:1,median:1,min:1,missing:1,q1:1,q3:1,ci0:1,ci1:1,stderr:1,stdev:1,stdevp:1,sum:1,valid:1,values:1,variance:1,variancep:1},Oh={count:1,min:1,max:1};function It(e){return!!e&&!!e.argmin}function sn(e){return!!e&&!!e.argmax}function na(e){return z(e)&&!!$h[e]}const Ch=new Set(["count","valid","missing","distinct"]);function Mu(e){return z(e)&&Ch.has(e)}function Nh(e){return z(e)&&G(["min","max"],e)}const _h=new Set(["count","sum","distinct","valid","missing"]),Th=new Set(["mean","average","median","q1","q3","min","max"]);function Uu(e){return bi(e)&&(e=ps(e,void 0)),"bin"+x(e).map(t=>ns(e[t])?se("_".concat(t,"_").concat(Xt(e[t]))):se("_".concat(t,"_").concat(e[t]))).join("")}function ne(e){return e===!0||Dn(e)&&!e.binned}function xe(e){return e==="binned"||Dn(e)&&e.binned===!0}function Dn(e){return X(e)}function ns(e){return e==null?void 0:e.param}function Cc(e){switch(e){case Tt:case At:case zt:case Ie:case xt:case St:case nn:case Dt:case en:case tn:case Re:return 6;case rn:return 4;default:return 10}}function nr(e){return!!(e!=null&&e.expr)}function Te(e){const t=x(e||{}),n={};for(const i of t)n[i]=ze(e[i]);return n}function Bu(e){const{anchor:t,frame:n,offset:i,orient:r,angle:s,limit:o,color:a,subtitleColor:c,subtitleFont:l,subtitleFontSize:u,subtitleFontStyle:f,subtitleFontWeight:d,subtitleLineHeight:p,subtitlePadding:g,...h}=e,m={...h,...a?{fill:a}:{}},y={...t?{anchor:t}:{},...n?{frame:n}:{},...i?{offset:i}:{},...r?{orient:r}:{},...s!==void 0?{angle:s}:{},...o!==void 0?{limit:o}:{}},b={...c?{subtitleColor:c}:{},...l?{subtitleFont:l}:{},...u?{subtitleFontSize:u}:{},...f?{subtitleFontStyle:f}:{},...d?{subtitleFontWeight:d}:{},...p?{subtitleLineHeight:p}:{},...g?{subtitlePadding:g}:{}},N=ii(e,["align","baseline","dx","dy","limit"]);return{titleMarkConfig:m,subtitleMarkConfig:N,nonMarkTitleProperties:y,subtitle:b}}function Wt(e){return z(e)||I(e)&&z(e[0])}function R(e){return!!(e!=null&&e.signal)}function on(e){return!!e.step}function Ah(e){return I(e)?!1:"fields"in e&&!("data"in e)}function Fh(e){return I(e)?!1:"fields"in e&&"data"in e}function _t(e){return I(e)?!1:"field"in e&&"data"in e}const kh={aria:1,description:1,ariaRole:1,ariaRoleDescription:1,blend:1,opacity:1,fill:1,fillOpacity:1,stroke:1,strokeCap:1,strokeWidth:1,strokeOpacity:1,strokeDash:1,strokeDashOffset:1,strokeJoin:1,strokeOffset:1,strokeMiterLimit:1,startAngle:1,endAngle:1,padAngle:1,innerRadius:1,outerRadius:1,size:1,shape:1,interpolate:1,tension:1,orient:1,align:1,baseline:1,text:1,dir:1,dx:1,dy:1,ellipsis:1,limit:1,radius:1,theta:1,angle:1,font:1,fontSize:1,fontWeight:1,fontStyle:1,lineBreak:1,lineHeight:1,cursor:1,href:1,tooltip:1,cornerRadius:1,cornerRadiusTopLeft:1,cornerRadiusTopRight:1,cornerRadiusBottomLeft:1,cornerRadiusBottomRight:1,aspect:1,width:1,height:1,url:1,smooth:1},Ih=x(kh),Rh={arc:1,area:1,group:1,image:1,line:1,path:1,rect:1,rule:1,shape:1,symbol:1,text:1,trail:1},go=["cornerRadius","cornerRadiusTopLeft","cornerRadiusTopRight","cornerRadiusBottomLeft","cornerRadiusBottomRight"];function Wu(e){const t=I(e.condition)?e.condition.map(Nc):Nc(e.condition);return{...ze(e),condition:t}}function ze(e){if(nr(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function Nc(e){if(nr(e)){const{expr:t,...n}=e;return{signal:t,...n}}return e}function re(e){if(nr(e)){const{expr:t,...n}=e;return{signal:t,...n}}return R(e)?e:e!==void 0?{value:e}:void 0}function Lh(e){return R(e)?e.signal:B(e)}function _c(e){return R(e)?e.signal:B(e.value)}function Ye(e){return R(e)?e.signal:e==null?null:B(e)}function Ph(e,t,n){for(const i of n){const r=Rt(i,t.markDef,t.config);r!==void 0&&(e[i]=re(r))}return e}function Gu(e){var t;return[].concat(e.type,(t=e.style)!=null?t:[])}function K(e,t,n,i={}){const{vgChannel:r,ignoreVgConfig:s}=i;return r&&t[r]!==void 0?t[r]:t[e]!==void 0?t[e]:s&&(!r||r===e)?void 0:Rt(e,t,n,i)}function Rt(e,t,n,{vgChannel:i}={}){return de(i?_r(e,t,n.style):void 0,_r(e,t,n.style),i?n[t.type][i]:void 0,n[t.type][e],i?n.mark[i]:n.mark[e])}function _r(e,t,n){return Hu(e,Gu(t),n)}function Hu(e,t,n){t=le(t);let i;for(const r of t){const s=n[r];s&&s[e]!==void 0&&(i=s[e])}return i}function qu(e,t){return le(e).reduce((n,i)=>{var r;return n.field.push(C(i,t)),n.order.push((r=i.sort)!=null?r:"ascending"),n},{field:[],order:[]})}function Xu(e,t){const n=[...e];return t.forEach(i=>{for(const r of n)if(ft(r,i))return;n.push(i)}),n}function Vu(e,t){return ft(e,t)||!t?e:e?[...le(e),...le(t)].join(", "):t}function Yu(e,t){const n=e.value,i=t.value;if(n==null||i===null)return{explicit:e.explicit,value:null};if((Wt(n)||R(n))&&(Wt(i)||R(i)))return{explicit:e.explicit,value:Vu(n,i)};if(Wt(n)||R(n))return{explicit:e.explicit,value:n};if(Wt(i)||R(i))return{explicit:e.explicit,value:i};if(!Wt(n)&&!R(n)&&!Wt(i)&&!R(i))return{explicit:e.explicit,value:Xu(n,i)};throw new Error("It should never reach here")}function ia(e){return"Invalid specification ".concat(te(e),'. Make sure the specification includes at least one of the following properties: "mark", "layer", "facet", "hconcat", "vconcat", "concat", or "repeat".')}const zh='Autosize "fit" only works for single views and layered views.';function Tc(e){const t=e=="width"?"Width":"Height";return"".concat(t,' "container" only works for single views and layered views.')}function Ac(e){const t=e=="width"?"Width":"Height",n=e=="width"?"x":"y";return"".concat(t,' "container" only works well with autosize "fit" or "fit-').concat(n,'".')}function Fc(e){return e?'Dropping "fit-'.concat(e,'" because spec has discrete ').concat(Le(e),"."):'Dropping "fit" because spec has discrete size.'}function ra(e){return"Unknown field for ".concat(e,". Cannot calculate view size.")}function kc(e){return'Cannot project a selection on encoding channel "'.concat(e,'", which has no field.')}function Dh(e,t){return'Cannot project a selection on encoding channel "'.concat(e,'" as it uses an aggregate function ("').concat(t,'").')}function jh(e){return'The "nearest" transform is not supported for '.concat(e," marks.")}function Ku(e){return"Selection not supported for ".concat(e," yet.")}function Mh(e){return'Cannot find a selection named "'.concat(e,'".')}const Uh="Scale bindings are currently only supported for scales with unbinned, continuous domains.",Bh="Legend bindings are only supported for selections over an individual field or encoding channel.";function Wh(e){return'Lookups can only be performed on selection parameters. "'.concat(e,'" is a variable parameter.')}function Gh(e){return'Cannot define and lookup the "'.concat(e,'" selection in the same view. ')+"Try moving the lookup into a second, layered view?"}const Hh="The same selection must be used to override scale domains in a layered view.",qh='Interval selections should be initialized using "x", "y", "longitude", or "latitude" keys.';function Xh(e){return'Unknown repeated value "'.concat(e,'".')}function Ic(e){return'The "columns" property cannot be used when "'.concat(e,'" has nested row/column.')}const Vh="Axes cannot be shared in concatenated or repeated views yet (https://github.com/vega/vega-lite/issues/2415).";function Yh(e){return'Unrecognized parse "'.concat(e,'".')}function Rc(e,t,n){return'An ancestor parsed field "'.concat(e,'" as ').concat(n," but a child wants to parse the field as ").concat(t,".")}const Kh="Attempt to add the same child twice.";function Jh(e){return"Ignoring an invalid transform: ".concat(te(e),".")}const Qh='If "from.fields" is not specified, "as" has to be a string that specifies the key to be used for the data from the secondary source.';function Lc(e){return"Config.customFormatTypes is not true, thus custom format type and format for channel ".concat(e," are dropped.")}function Zh(e){const{parentProjection:t,projection:n}=e;return"Layer's shared projection ".concat(te(t)," is overridden by a child projection ").concat(te(n),".")}const em="Arc marks uses theta channel rather than angle, replacing angle with theta.";function tm(e){return"".concat(e,"Offset dropped because ").concat(e," is continuous")}function nm(e){return"There is no ".concat(e," encoding. Replacing ").concat(e,"Offset encoding as ").concat(e,".")}function im(e,t,n){return"Channel ".concat(e," is a ").concat(t,". Converted to {value: ").concat(te(n),"}.")}function Ju(e){return'Invalid field type "'.concat(e,'".')}function rm(e,t){return'Invalid field type "'.concat(e,'" for aggregate: "').concat(t,'", using "quantitative" instead.')}function sm(e){return'Invalid aggregation operator "'.concat(e,'".')}function Qu(e,t){const{fill:n,stroke:i}=t;return"Dropping color ".concat(e," as the plot also has ").concat(n&&i?"fill and stroke":n?"fill":"stroke",".")}function om(e){return"Position range does not support relative band size for ".concat(e,".")}function ho(e,t){return"Dropping ".concat(te(e),' from channel "').concat(t,'" since it does not contain any data field, datum, value, or signal.')}const am="Line marks cannot encode size with a non-groupby field. You may want to use trail marks instead.";function is(e,t,n){return"".concat(e,' dropped as it is incompatible with "').concat(t,'"').concat(n?" when ".concat(n):"",".")}function cm(e){return"".concat(e," encoding has no scale, so specified scale is ignored.")}function lm(e){return"".concat(e,"-encoding is dropped as ").concat(e," is not a valid encoding channel.")}function um(e){return"".concat(e," encoding should be discrete (ordinal / nominal / binned).")}function fm(e){return"".concat(e," encoding should be discrete (ordinal / nominal / binned) or use a discretizing scale (e.g. threshold).")}function dm(e){return"Facet encoding dropped as ".concat(e.join(" and ")," ").concat(e.length>1?"are":"is"," also specified.")}function Ms(e,t){return'Using discrete channel "'.concat(e,'" to encode "').concat(t,'" field can be misleading as it does not encode ').concat(t==="ordinal"?"order":"magnitude",".")}function pm(e){return"The ".concat(e," for range marks cannot be an expression")}function gm(e,t){const n=e&&t?"x2 and y2":e?"x2":"y2";return"Line mark is for continuous lines and thus cannot be used with ".concat(n,". We will use the rule mark (line segments) instead.")}function hm(e,t){return'Specified orient "'.concat(e,'" overridden with "').concat(t,'".')}function mm(e){return'Cannot use the scale property "'.concat(e,'" with non-color channel.')}function ym(e){return"Cannot use the relative band size with ".concat(e," scale.")}function bm(e){return"Using unaggregated domain with raw field has no effect (".concat(te(e),").")}function vm(e){return'Unaggregated domain not applicable for "'.concat(e,'" since it produces values outside the origin domain of the source data.')}function xm(e){return"Unaggregated domain is currently unsupported for log scale (".concat(te(e),").")}function Sm(e){return'Cannot apply size to non-oriented mark "'.concat(e,'".')}function Em(e,t,n){return'Channel "'.concat(e,'" does not work with "').concat(t,'" scale. We are using "').concat(n,'" scale instead.')}function wm(e,t){return'FieldDef does not work with "'.concat(e,'" scale. We are using "').concat(t,'" scale instead.')}function Zu(e,t,n){return"".concat(n,"-scale's \"").concat(t,'" is dropped as it does not work with ').concat(e," scale.")}function ef(e){return'The step for "'.concat(e,'" is dropped because the ').concat(e==="width"?"x":"y"," is continuous.")}function $m(e,t,n,i){return"Conflicting ".concat(t.toString(),' property "').concat(e.toString(),'" (').concat(te(n)," and ").concat(te(i),"). Using ").concat(te(n),".")}function Om(e,t,n,i){return"Conflicting ".concat(t.toString(),' property "').concat(e.toString(),'" (').concat(te(n)," and ").concat(te(i),"). Using the union of the two domains.")}function Cm(e){return'Setting the scale to be independent for "'.concat(e,'" means we also have to set the guide (axis or legend) to be independent.')}function Nm(e){return"Dropping sort property ".concat(te(e),' as unioned domains only support boolean or op "count", "min", and "max".')}const Pc="Domains that should be unioned has conflicting sort properties. Sort will be set to true.",_m="Detected faceted independent scales that union domain of multiple fields from different data sources. We will use the first field. The result view size may be incorrect.",Tm="Detected faceted independent scales that union domain of the same fields from different source. We will assume that this is the same field from a different fork of the same data source. However, if this is not the case, the result view size may be incorrect.",Am="Detected faceted independent scales that union domain of multiple fields from the same data source. We will use the first field. The result view size may be incorrect.";function Fm(e){return'Cannot stack "'.concat(e,'" if there is already "').concat(e,'2".')}function km(e){return"Cannot stack non-linear scale (".concat(e,").")}function Im(e){return'Stacking is applied even though the aggregate function is non-summative ("'.concat(e,'").')}function Tr(e,t){return"Invalid ".concat(e,": ").concat(te(t),".")}function Rm(e){return"Dropping day from datetime ".concat(te(e)," as day cannot be combined with other units.")}function Lm(e,t){return"".concat(t?"extent ":"").concat(t&&e?"and ":"").concat(e?"center ":"").concat(t&&e?"are ":"is ","not needed when data are aggregated.")}function Pm(e,t,n){return"".concat(e," is not usually used with ").concat(t," for ").concat(n,".")}function zm(e,t){return"Continuous axis should not have customized aggregation function ".concat(e,"; ").concat(t," already agregates the axis.")}function zc(e){return"1D error band does not support ".concat(e,".")}function tf(e){return"Channel ".concat(e,' is required for "binned" bin.')}function Dm(e){return"Channel ".concat(e,' should not be used with "binned" bin.')}function jm(e){return"Domain for ".concat(e," is required for threshold scale.")}globalThis&&globalThis.__classPrivateFieldSet;globalThis&&globalThis.__classPrivateFieldGet;const nf=Jp(Qp);let oi=nf;function Mm(e){return oi=e,oi}function Um(){return oi=nf,oi}function S(...e){oi.warn(...e)}function Bm(...e){oi.debug(...e)}function jn(e){if(e&&X(e)){for(const t of oa)if(t in e)return!0}return!1}const rf=["january","february","march","april","may","june","july","august","september","october","november","december"],Wm=rf.map(e=>e.substr(0,3)),sf=["sunday","monday","tuesday","wednesday","thursday","friday","saturday"],Gm=sf.map(e=>e.substr(0,3));function Hm(e){if(Vr(e)&&(e=+e),fe(e))return e>4&&S(Tr("quarter",e)),e-1;throw new Error(Tr("quarter",e))}function qm(e){if(Vr(e)&&(e=+e),fe(e))return e-1;{const t=e.toLowerCase(),n=rf.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Wm.indexOf(i);if(r!==-1)return r;throw new Error(Tr("month",e))}}function Xm(e){if(Vr(e)&&(e=+e),fe(e))return e%7;{const t=e.toLowerCase(),n=sf.indexOf(t);if(n!==-1)return n;const i=t.substr(0,3),r=Gm.indexOf(i);if(r!==-1)return r;throw new Error(Tr("day",e))}}function sa(e,t){const n=[];if(t&&e.day!==void 0&&x(e).length>1&&(S(Rm(e)),e=j(e),delete e.day),e.year!==void 0?n.push(e.year):n.push(2012),e.month!==void 0){const i=t?qm(e.month):e.month;n.push(i)}else if(e.quarter!==void 0){const i=t?Hm(e.quarter):e.quarter;n.push(fe(i)?i*3:"".concat(i,"*3"))}else n.push(0);if(e.date!==void 0)n.push(e.date);else if(e.day!==void 0){const i=t?Xm(e.day):e.day;n.push(fe(i)?i+1:"".concat(i,"+1"))}else n.push(1);for(const i of["hours","minutes","seconds","milliseconds"]){const r=e[i];n.push(typeof r>"u"?0:r)}return n}function _n(e){const n=sa(e,!0).join(", ");return e.utc?"utc(".concat(n,")"):"datetime(".concat(n,")")}function Vm(e){const n=sa(e,!1).join(", ");return e.utc?"utc(".concat(n,")"):"datetime(".concat(n,")")}function Ym(e){const t=sa(e,!0);return e.utc?+new Date(Date.UTC(...t)):+new Date(...t)}const of={year:1,quarter:1,month:1,week:1,day:1,dayofyear:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1},oa=x(of);function Km(e){return!!of[e]}function Mn(e){return X(e)?e.binned:af(e)}function af(e){return e&&e.startsWith("binned")}function aa(e){return e.startsWith("utc")}function Jm(e){return e.substring(3)}const Qm={"year-month":"%b %Y ","year-month-date":"%b %d, %Y "};function rs(e){return oa.filter(t=>lf(e,t))}function cf(e){const t=rs(e);return t[t.length-1]}function lf(e,t){const n=e.indexOf(t);return!(n<0||n>0&&t==="seconds"&&e.charAt(n-1)==="i"||e.length>n+3&&t==="day"&&e.charAt(n+3)==="o"||n>0&&t==="year"&&e.charAt(n-1)==="f")}function Zm(e,t,{end:n}={end:!1}){const i=Xo(t),r=aa(e)?"utc":"";function s(c){return c==="quarter"?"(".concat(r,"quarter(").concat(i,")-1)"):"".concat(r).concat(c,"(").concat(i,")")}let o;const a={};for(const c of oa)lf(e,c)&&(a[c]=s(c),o=c);return n&&(a[o]+="+1"),Vm(a)}function uf(e){if(!e)return;const t=rs(e);return"timeUnitSpecifier(".concat(te(t),", ").concat(te(Qm),")")}function ey(e,t,n){if(!e)return;const i=uf(e),r=n||aa(e);return"".concat(r?"utc":"time","Format(").concat(t,", ").concat(i,")")}function me(e){if(!e)return;let t;return z(e)?af(e)?t={unit:e.substring(6),binned:!0}:t={unit:e}:X(e)&&(t={...e,...e.unit?{unit:e.unit}:{}}),aa(t.unit)&&(t.utc=!0,t.unit=Jm(t.unit)),t}function ty(e){const{utc:t,...n}=me(e);return n.unit?(t?"utc":"")+x(n).map(i=>se("".concat(i==="unit"?"":"_".concat(i,"_")).concat(n[i]))).join(""):(t?"utc":"")+"timeunit"+x(n).map(i=>se("_".concat(i,"_").concat(n[i]))).join("")}function ff(e,t=n=>n){const n=me(e),i=cf(n.unit);if(i&&i!=="day"){const r={year:2001,month:1,date:1,hours:0,minutes:0,seconds:0,milliseconds:0},{step:s,part:o}=df(i,n.step),a={...r,[o]:+r[o]+s};return"".concat(t(_n(a))," - ").concat(t(_n(r)))}}const ny={year:1,month:1,date:1,hours:1,minutes:1,seconds:1,milliseconds:1};function iy(e){return!!ny[e]}function df(e,t=1){if(iy(e))return{part:e,step:t};switch(e){case"day":case"dayofyear":return{part:"date",step:t};case"quarter":return{part:"month",step:t*3};case"week":return{part:"date",step:t*7}}}function ry(e){return e==null?void 0:e.param}function ca(e){return!!(e!=null&&e.field)&&e.equal!==void 0}function la(e){return!!(e!=null&&e.field)&&e.lt!==void 0}function ua(e){return!!(e!=null&&e.field)&&e.lte!==void 0}function fa(e){return!!(e!=null&&e.field)&&e.gt!==void 0}function da(e){return!!(e!=null&&e.field)&&e.gte!==void 0}function pa(e){if(e!=null&&e.field){if(I(e.range)&&e.range.length===2)return!0;if(R(e.range))return!0}return!1}function ga(e){return!!(e!=null&&e.field)&&(I(e.oneOf)||I(e.in))}function sy(e){return!!(e!=null&&e.field)&&e.valid!==void 0}function pf(e){return ga(e)||ca(e)||pa(e)||la(e)||fa(e)||ua(e)||da(e)}function at(e,t){return gs(e,{timeUnit:t,wrapTime:!0})}function oy(e,t){return e.map(n=>at(n,t))}function gf(e,t=!0){const{field:n}=e,i=me(e.timeUnit),{unit:r,binned:s}=i||{},o=C(e,{expr:"datum"}),a=r?"time(".concat(s?o:Zm(r,n),")"):o;if(ca(e))return"".concat(a,"===").concat(at(e.equal,r));if(la(e)){const c=e.lt;return"".concat(a,"<").concat(at(c,r))}else if(fa(e)){const c=e.gt;return"".concat(a,">").concat(at(c,r))}else if(ua(e)){const c=e.lte;return"".concat(a,"<=").concat(at(c,r))}else if(da(e)){const c=e.gte;return"".concat(a,">=").concat(at(c,r))}else{if(ga(e))return"indexof([".concat(oy(e.oneOf,r).join(","),"], ").concat(a,") !== -1");if(sy(e))return ha(a,e.valid);if(pa(e)){const{range:c}=e,l=R(c)?{signal:"".concat(c.signal,"[0]")}:c[0],u=R(c)?{signal:"".concat(c.signal,"[1]")}:c[1];if(l!==null&&u!==null&&t)return"inrange("+a+", ["+at(l,r)+", "+at(u,r)+"])";const f=[];return l!==null&&f.push("".concat(a," >= ").concat(at(l,r))),u!==null&&f.push("".concat(a," <= ").concat(at(u,r))),f.length>0?f.join(" && "):"true"}}throw new Error("Invalid field predicate: ".concat(te(e)))}function ha(e,t=!0){return t?"isValid(".concat(e,") && isFinite(+").concat(e,")"):"!isValid(".concat(e,") || !isFinite(+").concat(e,")")}function ay(e){return pf(e)&&e.timeUnit?{...e,timeUnit:me(e.timeUnit)}:e}const ir={quantitative:"quantitative",ordinal:"ordinal",temporal:"temporal",nominal:"nominal",geojson:"geojson"};function cy(e){return e==="quantitative"||e==="temporal"}function hf(e){return e==="ordinal"||e==="nominal"}const Tn=ir.quantitative,ma=ir.ordinal,ai=ir.temporal,ya=ir.nominal,Ei=ir.geojson;function ly(e){if(e)switch(e=e.toLowerCase(),e){case"q":case Tn:return"quantitative";case"t":case ai:return"temporal";case"o":case ma:return"ordinal";case"n":case ya:return"nominal";case Ei:return"geojson"}}const Fe={LINEAR:"linear",LOG:"log",POW:"pow",SQRT:"sqrt",SYMLOG:"symlog",IDENTITY:"identity",SEQUENTIAL:"sequential",TIME:"time",UTC:"utc",QUANTILE:"quantile",QUANTIZE:"quantize",THRESHOLD:"threshold",BIN_ORDINAL:"bin-ordinal",ORDINAL:"ordinal",POINT:"point",BAND:"band"},mo={linear:"numeric",log:"numeric",pow:"numeric",sqrt:"numeric",symlog:"numeric",identity:"numeric",sequential:"numeric",time:"time",utc:"time",ordinal:"ordinal","bin-ordinal":"bin-ordinal",point:"ordinal-position",band:"ordinal-position",quantile:"discretizing",quantize:"discretizing",threshold:"discretizing"};function uy(e,t){const n=mo[e],i=mo[t];return n===i||n==="ordinal-position"&&i==="time"||i==="ordinal-position"&&n==="time"}const fy={linear:0,log:1,pow:1,sqrt:1,symlog:1,identity:1,sequential:1,time:0,utc:0,point:10,band:11,ordinal:0,"bin-ordinal":0,quantile:0,quantize:0,threshold:0};function Dc(e){return fy[e]}const mf=new Set(["linear","log","pow","sqrt","symlog"]),yf=new Set([...mf,"time","utc"]);function bf(e){return mf.has(e)}const vf=new Set(["quantile","quantize","threshold"]),dy=new Set([...yf,...vf,"sequential","identity"]),py=new Set(["ordinal","bin-ordinal","point","band"]);function ve(e){return py.has(e)}function je(e){return dy.has(e)}function Ke(e){return yf.has(e)}function ci(e){return vf.has(e)}const gy={pointPadding:.5,barBandPaddingInner:.1,rectBandPaddingInner:0,bandWithNestedOffsetPaddingInner:.2,bandWithNestedOffsetPaddingOuter:.2,minBandSize:2,minFontSize:8,maxFontSize:40,minOpacity:.3,maxOpacity:.8,minSize:9,minStrokeWidth:1,maxStrokeWidth:4,quantileCount:4,quantizeCount:4,zero:!0};function hy(e){return!z(e)&&!!e.name}function xf(e){return e==null?void 0:e.param}function my(e){return e==null?void 0:e.unionWith}function yy(e){return X(e)&&"field"in e}const by={type:1,domain:1,domainMax:1,domainMin:1,domainMid:1,domainRaw:1,align:1,range:1,rangeMax:1,rangeMin:1,scheme:1,bins:1,reverse:1,round:1,clamp:1,nice:1,base:1,exponent:1,constant:1,interpolate:1,zero:1,padding:1,paddingInner:1,paddingOuter:1},{type:cO,domain:lO,range:uO,rangeMax:fO,rangeMin:dO,scheme:pO,...vy}=by,xy=x(vy);function yo(e,t){switch(t){case"type":case"domain":case"reverse":case"range":return!0;case"scheme":case"interpolate":return!["point","band","identity"].includes(e);case"bins":return!["point","band","identity","ordinal"].includes(e);case"round":return Ke(e)||e==="band"||e==="point";case"padding":case"rangeMin":case"rangeMax":return Ke(e)||["point","band"].includes(e);case"paddingOuter":case"align":return["point","band"].includes(e);case"paddingInner":return e==="band";case"domainMax":case"domainMid":case"domainMin":case"domainRaw":case"clamp":return Ke(e);case"nice":return Ke(e)||e==="quantize"||e==="threshold";case"exponent":return e==="pow";case"base":return e==="log";case"constant":return e==="symlog";case"zero":return je(e)&&!G(["log","time","utc","threshold","quantile"],e)}}function Sf(e,t){switch(t){case"interpolate":case"scheme":case"domainMid":return Qn(e)?void 0:mm(t);case"align":case"type":case"bins":case"domain":case"domainMax":case"domainMin":case"domainRaw":case"range":case"base":case"exponent":case"constant":case"nice":case"padding":case"paddingInner":case"paddingOuter":case"rangeMax":case"rangeMin":case"reverse":case"round":case"clamp":case"zero":return}}function Sy(e,t){return G([ma,ya],t)?e===void 0||ve(e):t===ai?G([Fe.TIME,Fe.UTC,void 0],e):t===Tn?bf(e)||ci(e)||e===void 0:!0}function Ey(e,t,n=!1){if(!jt(e))return!1;switch(e){case oe:case ye:case Zt:case xi:case Ge:case it:return Ke(t)||t==="band"?!0:t==="point"?!n:!1;case zt:case nn:case Dt:case en:case tn:case Pn:return Ke(t)||ci(t)||G(["band","point","ordinal"],t);case Ie:case xt:case St:return t!=="band";case rn:case Re:return t==="ordinal"||ci(t)}}const Ne={arc:"arc",area:"area",bar:"bar",image:"image",line:"line",point:"point",rect:"rect",rule:"rule",text:"text",tick:"tick",trail:"trail",circle:"circle",square:"square",geoshape:"geoshape"},Ef=Ne.arc,ss=Ne.area,os=Ne.bar,wy=Ne.image,as=Ne.line,cs=Ne.point,$y=Ne.rect,Ar=Ne.rule,wf=Ne.text,ba=Ne.tick,Oy=Ne.trail,va=Ne.circle,xa=Ne.square,$f=Ne.geoshape;function an(e){return["line","area","trail"].includes(e)}function Sa(e){return["rect","bar","image","arc"].includes(e)}const Cy=new Set(x(Ne));function mt(e){return e.type}const Ny=["stroke","strokeWidth","strokeDash","strokeDashOffset","strokeOpacity","strokeJoin","strokeMiterLimit"],_y=["fill","fillOpacity"],Ty=[...Ny,..._y],Ay={color:1,filled:1,invalid:1,order:1,radius2:1,theta2:1,timeUnitBandSize:1,timeUnitBandPosition:1},jc=x(Ay),Fy={area:["line","point"],bar:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],rect:["binSpacing","continuousBandSize","discreteBandSize","minBandSize"],line:["point"],tick:["bandSize","thickness"]},ky={color:"#4c78a8",invalid:"filter",timeUnitBandSize:1},Iy={mark:1,arc:1,area:1,bar:1,circle:1,image:1,line:1,point:1,rect:1,rule:1,square:1,text:1,tick:1,trail:1,geoshape:1},Of=x(Iy);function An(e){return e&&e.band!=null}const Ry={horizontal:["cornerRadiusTopRight","cornerRadiusBottomRight"],vertical:["cornerRadiusTopLeft","cornerRadiusTopRight"]},Cf=5,Ly={binSpacing:1,continuousBandSize:Cf,minBandSize:.25,timeUnitBandPosition:.5},Py={binSpacing:0,continuousBandSize:Cf,minBandSize:.25,timeUnitBandPosition:.5},zy={thickness:1};function Dy(e){return mt(e)?e.type:e}function Ea(e){const{channel:t,channelDef:n,markDef:i,scale:r,config:s}=e,o=$a(e);return w(n)&&!Mu(n.aggregate)&&r&&Ke(r.get("type"))?jy({fieldDef:n,channel:t,markDef:i,ref:o,config:s}):o}function jy({fieldDef:e,channel:t,markDef:n,ref:i,config:r}){return an(n.type)?i:K("invalid",n,r)===null?[My(e,t),i]:i}function My(e,t){const n=wa(e,!0),r=zn(t)==="y"?{field:{group:"height"}}:{value:0};return{test:n,...r}}function wa(e,t=!0){return ha(z(e)?e:C(e,{expr:"datum"}),!t)}function Uy(e){const{datum:t}=e;return jn(t)?_n(t):"".concat(te(t))}function Sn(e,t,n,i){const r={};if(t&&(r.scale=t),$t(e)){const{datum:s}=e;jn(s)?r.signal=_n(s):R(s)?r.signal=s.signal:nr(s)?r.signal=s.expr:r.value=s}else r.field=C(e,n);if(i){const{offset:s,band:o}=i;s&&(r.offset=s),o&&(r.band=o)}return r}function Fr({scaleName:e,fieldOrDatumDef:t,fieldOrDatumDef2:n,offset:i,startSuffix:r,bandPosition:s=.5}){const o=0<s&&s<1?"datum":void 0,a=C(t,{expr:o,suffix:r}),c=n!==void 0?C(n,{expr:o}):C(t,{suffix:"end",expr:o}),l={};if(s===0||s===1){l.scale=e;const u=s===0?a:c;l.field=u}else{const u=R(s)?"".concat(s.signal," * ").concat(a," + (1-").concat(s.signal,") * ").concat(c):"".concat(s," * ").concat(a," + ").concat(1-s," * ").concat(c);l.signal='scale("'.concat(e,'", ').concat(u,")")}return i&&(l.offset=i),l}function By({scaleName:e,fieldDef:t}){const n=C(t,{expr:"datum"}),i=C(t,{expr:"datum",suffix:"end"});return'abs(scale("'.concat(e,'", ').concat(i,') - scale("').concat(e,'", ').concat(n,"))")}function $a({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l,bandPosition:u}){var f;if(t){if(M(t)){const d=o==null?void 0:o.get("type");if(Ce(t)){u!=null||(u=Rf({fieldDef:t,fieldDef2:n,markDef:i,config:r}));const{bin:p,timeUnit:g,type:h}=t;if(ne(p)||u&&g&&h===ai)return a!=null&&a.impute?Sn(t,s,{binSuffix:"mid"},{offset:c}):u&&!ve(d)?Fr({scaleName:s,fieldOrDatumDef:t,bandPosition:u,offset:c}):Sn(t,s,ar(t,e)?{binSuffix:"range"}:{},{offset:c});if(xe(p)){if(w(n))return Fr({scaleName:s,fieldOrDatumDef:t,fieldOrDatumDef2:n,bandPosition:u,offset:c});S(tf(e===oe?nt:vt))}}return Sn(t,s,ve(d)?{binSuffix:"range"}:{},{offset:c,band:d==="band"?(f=u!=null?u:t.bandPosition)!=null?f:.5:void 0})}else if(et(t)){const d=t.value,p=c?{offset:c}:{};return{...Mi(e,d),...p}}}return Zp(l)&&(l=l()),l&&{...l,...c?{offset:c}:{}}}function Mi(e,t){return G(["x","x2"],e)&&t==="width"?{field:{group:"width"}}:G(["y","y2"],e)&&t==="height"?{field:{group:"height"}}:re(t)}function Fn(e){return e&&e!=="number"&&e!=="time"}function Nf(e,t,n){return"".concat(e,"(").concat(t).concat(n?", ".concat(te(n)):"",")")}const Wy="  ";function Oa({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s}){var c,l;if(Fn(n))return Je({fieldOrDatumDef:e,format:t,formatType:n,expr:i,config:s});const o=_f(e,i,r),a=li(e);if(t===void 0&&n===void 0&&s.customFormatTypes){if(a==="quantitative"){if(r&&s.normalizedNumberFormatType)return Je({fieldOrDatumDef:e,format:s.normalizedNumberFormat,formatType:s.normalizedNumberFormatType,expr:i,config:s});if(s.numberFormatType)return Je({fieldOrDatumDef:e,format:s.numberFormat,formatType:s.numberFormatType,expr:i,config:s})}if(a==="temporal"&&s.timeFormatType&&w(e)&&e.timeUnit===void 0)return Je({fieldOrDatumDef:e,format:s.timeFormat,formatType:s.timeFormatType,expr:i,config:s})}if(fi(e)){const u=Hy({field:o,timeUnit:w(e)?(c=me(e.timeUnit))==null?void 0:c.unit:void 0,format:t,formatType:s.timeFormatType,rawTimeFormat:s.timeFormat,isUTCScale:Un(e)&&((l=e.scale)==null?void 0:l.type)===Fe.UTC});return u?{signal:u}:void 0}if(t=bo({type:a,specifiedFormat:t,config:s,normalizeStack:r}),w(e)&&ne(e.bin)){const u=C(e,{expr:i,binSuffix:"end"});return{signal:rr(o,u,t,n,s)}}else return t||li(e)==="quantitative"?{signal:"".concat(Ff(o,t))}:{signal:"isValid(".concat(o,") ? ").concat(o,' : ""+').concat(o)}}function _f(e,t,n){return w(e)?n?"".concat(C(e,{expr:t,suffix:"end"}),"-").concat(C(e,{expr:t,suffix:"start"})):C(e,{expr:t}):Uy(e)}function Je({fieldOrDatumDef:e,format:t,formatType:n,expr:i,normalizeStack:r,config:s,field:o}){if(o!=null||(o=_f(e,i,r)),o!=="datum.value"&&w(e)&&ne(e.bin)){const a=C(e,{expr:i,binSuffix:"end"});return{signal:rr(o,a,t,n,s)}}return{signal:Nf(n,o,t)}}function Tf(e,t,n,i,r,s){var o;if(!(z(i)&&Fn(i))&&!(n===void 0&&i===void 0&&r.customFormatTypes&&li(e)==="quantitative"&&(r.normalizedNumberFormatType&&ui(e)&&e.stack==="normalize"||r.numberFormatType))){if(ui(e)&&e.stack==="normalize"&&r.normalizedNumberFormat)return bo({type:"quantitative",config:r,normalizeStack:!0});if(fi(e)){const a=w(e)?(o=me(e.timeUnit))==null?void 0:o.unit:void 0;return a===void 0&&r.customFormatTypes&&r.timeFormatType?void 0:Gy({specifiedFormat:n,timeUnit:a,config:r,omitTimeFormatConfig:s})}return bo({type:t,specifiedFormat:n,config:r})}}function Af(e,t,n){var i;if(e&&(R(e)||e==="number"||e==="time"))return e;if(fi(t)&&n!=="time"&&n!=="utc")return w(t)&&((i=me(t==null?void 0:t.timeUnit))!=null&&i.utc)?"utc":"time"}function bo({type:e,specifiedFormat:t,config:n,normalizeStack:i}){if(z(t))return t;if(e===Tn)return i?n.normalizedNumberFormat:n.numberFormat}function Gy({specifiedFormat:e,timeUnit:t,config:n,omitTimeFormatConfig:i}){return e||(t?{signal:uf(t)}:i?void 0:n.timeFormat)}function Ff(e,t){return"format(".concat(e,', "').concat(t||"",'")')}function Mc(e,t,n,i){var r;return Fn(n)?Nf(n,e,t):Ff(e,(r=z(t)?t:void 0)!=null?r:i.numberFormat)}function rr(e,t,n,i,r){if(n===void 0&&i===void 0&&r.customFormatTypes&&r.numberFormatType)return rr(e,t,r.numberFormat,r.numberFormatType,r);const s=Mc(e,n,i,r),o=Mc(t,n,i,r);return"".concat(ha(e,!1),' ? "null" : ').concat(s,' + "').concat(Wy,'" + ').concat(o)}function Hy({field:e,timeUnit:t,format:n,formatType:i,rawTimeFormat:r,isUTCScale:s}){return!t||n?!t&&i?"".concat(i,"(").concat(e,", '").concat(n,"')"):(n=z(n)?n:r,"".concat(s?"utc":"time","Format(").concat(e,", '").concat(n,"')")):ey(t,e,s)}const ls="min",qy={x:1,y:1,color:1,fill:1,stroke:1,strokeWidth:1,size:1,shape:1,fillOpacity:1,strokeOpacity:1,opacity:1,text:1};function Uc(e){return e in qy}function kf(e){return!!(e!=null&&e.encoding)}function pt(e){return e&&(e.op==="count"||!!e.field)}function If(e){return e&&I(e)}function sr(e){return"row"in e||"column"in e}function Ca(e){return!!e&&"header"in e}function us(e){return"facet"in e}function Xy(e){return e.param}function Vy(e){return e&&!z(e)&&"repeat"in e}function Bc(e){const{field:t,timeUnit:n,bin:i,aggregate:r}=e;return{...n?{timeUnit:n}:{},...i?{bin:i}:{},...r?{aggregate:r}:{},field:t}}function Na(e){return"sort"in e}function Rf({fieldDef:e,fieldDef2:t,markDef:n,config:i}){if(M(e)&&e.bandPosition!==void 0)return e.bandPosition;if(w(e)){const{timeUnit:r,bin:s}=e;if(r&&!t)return Sa(n.type)?0:Rt("timeUnitBandPosition",n,i);if(ne(s))return .5}}function Lf({channel:e,fieldDef:t,fieldDef2:n,markDef:i,config:r,scaleType:s,useVlSizeChannel:o}){var l,u,f;const a=Le(e),c=K(o?"size":a,i,r,{vgChannel:a});if(c!==void 0)return c;if(w(t)){const{timeUnit:d,bin:p}=t;if(d&&!n)return{band:Rt("timeUnitBandSize",i,r)};if(ne(p)&&!ve(s))return{band:1}}if(Sa(i.type))return s?ve(s)?((l=r[i.type])==null?void 0:l.discreteBandSize)||{band:1}:(u=r[i.type])==null?void 0:u.continuousBandSize:(f=r[i.type])==null?void 0:f.discreteBandSize}function Pf(e,t,n,i){return ne(e.bin)||e.timeUnit&&Ce(e)&&e.type==="temporal"?Rf({fieldDef:e,fieldDef2:t,markDef:n,config:i})!==void 0:!1}function zf(e){return e&&!!e.sort&&!e.field}function fs(e){return e&&"condition"in e}function ds(e){const t=e==null?void 0:e.condition;return!!t&&!I(t)&&w(t)}function or(e){const t=e==null?void 0:e.condition;return!!t&&!I(t)&&M(t)}function Yy(e){const t=e==null?void 0:e.condition;return!!t&&(I(t)||et(t))}function w(e){return e&&(!!e.field||e.aggregate==="count")}function li(e){return e==null?void 0:e.type}function $t(e){return e&&"datum"in e}function Gt(e){return Ce(e)&&!Ir(e)||kr(e)}function Wc(e){return Ce(e)&&e.type==="quantitative"&&!e.bin||kr(e)}function kr(e){return $t(e)&&fe(e.datum)}function M(e){return w(e)||$t(e)}function Ce(e){return e&&("field"in e||e.aggregate==="count")&&"type"in e}function et(e){return e&&"value"in e&&"value"in e}function Un(e){return e&&("scale"in e||"sort"in e)}function ui(e){return e&&("axis"in e||"stack"in e||"impute"in e)}function Df(e){return e&&"legend"in e}function jf(e){return e&&("format"in e||"formatType"in e)}function Ky(e){return Ae(e,["legend","axis","header","scale"])}function Jy(e){return"op"in e}function C(e,t={}){var o,a,c;let n=e.field;const i=t.prefix;let r=t.suffix,s="";if(Zy(e))n=Ou("count");else{let l;if(!t.nofn)if(Jy(e))l=e.op;else{const{bin:u,aggregate:f,timeUnit:d}=e;ne(u)?(l=Uu(u),r=((o=t.binSuffix)!=null?o:"")+((a=t.suffix)!=null?a:"")):f?sn(f)?(s='["'.concat(n,'"]'),n="argmax_".concat(f.argmax)):It(f)?(s='["'.concat(n,'"]'),n="argmin_".concat(f.argmin)):l=String(f):d&&!Mn(d)&&(l=ty(d),r=(!["range","mid"].includes(t.binSuffix)&&t.binSuffix||"")+((c=t.suffix)!=null?c:""))}l&&(n=n?"".concat(l,"_").concat(n):l)}return r&&(n="".concat(n,"_").concat(r)),i&&(n="".concat(i,"_").concat(n)),t.forAs?Vo(n):t.expr?Eu(n,t.expr)+s:Be(n)+s}function Ir(e){switch(e.type){case"nominal":case"ordinal":case"geojson":return!0;case"quantitative":return w(e)&&!!e.bin;case"temporal":return!1}throw new Error(Ju(e.type))}function Qy(e){var t;return Un(e)&&ci((t=e.scale)==null?void 0:t.type)}function Zy(e){return e.aggregate==="count"}function eb(e,t){var o;const{field:n,bin:i,timeUnit:r,aggregate:s}=e;if(s==="count")return t.countTitle;if(ne(i))return"".concat(n," (binned)");if(r&&!Mn(r)){const a=(o=me(r))==null?void 0:o.unit;if(a)return"".concat(n," (").concat(rs(a).join("-"),")")}else if(s)return sn(s)?"".concat(n," for max ").concat(s.argmax):It(s)?"".concat(n," for min ").concat(s.argmin):"".concat(Zi(s)," of ").concat(n);return n}function tb(e){const{aggregate:t,bin:n,timeUnit:i,field:r}=e;if(sn(t))return"".concat(r," for argmax(").concat(t.argmax,")");if(It(t))return"".concat(r," for argmin(").concat(t.argmin,")");const s=i&&!Mn(i)?me(i):void 0,o=t||(s==null?void 0:s.unit)||(s==null?void 0:s.maxbins)&&"timeunit"||ne(n)&&"bin";return o?"".concat(o.toUpperCase(),"(").concat(r,")"):r}const Mf=(e,t)=>{switch(t.fieldTitle){case"plain":return e.field;case"functional":return tb(e);default:return eb(e,t)}};let Uf=Mf;function Bf(e){Uf=e}function nb(){Bf(Mf)}function Zn(e,t,{allowDisabling:n,includeDefault:i=!0}){var a,c;const r=(a=_a(e))==null?void 0:a.title;if(!w(e))return r!=null?r:e.title;const s=e,o=i?Ta(s,t):void 0;return n?de(r,s.title,o):(c=r!=null?r:s.title)!=null?c:o}function _a(e){if(ui(e)&&e.axis)return e.axis;if(Df(e)&&e.legend)return e.legend;if(Ca(e)&&e.header)return e.header}function Ta(e,t){return Uf(e,t)}function Rr(e){var t;if(jf(e)){const{format:n,formatType:i}=e;return{format:n,formatType:i}}else{const n=(t=_a(e))!=null?t:{},{format:i,formatType:r}=n;return{format:i,formatType:r}}}function ib(e,t){var s;switch(t){case"latitude":case"longitude":return"quantitative";case"row":case"column":case"facet":case"shape":case"strokeDash":return"nominal";case"order":return"ordinal"}if(Na(e)&&I(e.sort))return"ordinal";const{aggregate:n,bin:i,timeUnit:r}=e;if(r)return"temporal";if(i||n&&!sn(n)&&!It(n))return"quantitative";if(Un(e)&&((s=e.scale)!=null&&s.type))switch(mo[e.scale.type]){case"numeric":case"discretizing":return"quantitative";case"time":return"temporal"}return"nominal"}function yt(e){if(w(e))return e;if(ds(e))return e.condition}function pe(e){if(M(e))return e;if(or(e))return e.condition}function Wf(e,t,n,i={}){if(z(e)||fe(e)||bi(e)){const r=z(e)?"string":fe(e)?"number":"boolean";return S(im(t,r,e)),{value:e}}return M(e)?Lr(e,t,n,i):or(e)?{...e,condition:Lr(e.condition,t,n,i)}:e}function Lr(e,t,n,i){if(jf(e)){const{format:r,formatType:s,...o}=e;if(Fn(s)&&!n.customFormatTypes)return S(Lc(t)),Lr(o,t,n,i)}else{const r=ui(e)?"axis":Df(e)?"legend":Ca(e)?"header":null;if(r&&e[r]){const{format:s,formatType:o,...a}=e[r];if(Fn(o)&&!n.customFormatTypes)return S(Lc(t)),Lr({...e,[r]:a},t,n,i)}}return w(e)?Aa(e,t,i):rb(e)}function rb(e){let t=e.type;if(t)return e;const{datum:n}=e;return t=fe(n)?"quantitative":z(n)?"nominal":jn(n)?"temporal":void 0,{...e,type:t}}function Aa(e,t,{compositeMark:n=!1}={}){const{aggregate:i,timeUnit:r,bin:s,field:o}=e,a={...e};if(!n&&i&&!na(i)&&!sn(i)&&!It(i)&&(S(sm(i)),delete a.aggregate),r&&(a.timeUnit=me(r)),o&&(a.field="".concat(o)),ne(s)&&(a.bin=ps(s,t)),xe(s)&&!be(t)&&S(Dm(t)),Ce(a)){const{type:c}=a,l=ly(c);c!==l&&(a.type=l),c!=="quantitative"&&Mu(i)&&(S(rm(c,i)),a.type="quantitative")}else if(!Iu(t)){const c=ib(a,t);a.type=c}if(Ce(a)){const{compatible:c,warning:l}=sb(a,t)||{};c===!1&&S(l)}if(Na(a)&&z(a.sort)){const{sort:c}=a;if(Uc(c))return{...a,sort:{encoding:c}};const l=c.substr(1);if(c.charAt(0)==="-"&&Uc(l))return{...a,sort:{encoding:l,order:"descending"}}}if(Ca(a)){const{header:c}=a;if(c){const{orient:l,...u}=c;if(l)return{...a,header:{...u,labelOrient:c.labelOrient||l,titleOrient:c.titleOrient||l}}}}return a}function ps(e,t){return bi(e)?{maxbins:Cc(t)}:e==="binned"?{binned:!0}:!e.maxbins&&!e.step?{...e,maxbins:Cc(t)}:e}const Gn={compatible:!0};function sb(e,t){const n=e.type;if(n==="geojson"&&t!=="shape")return{compatible:!1,warning:"Channel ".concat(t," should not be used with a geojson data.")};switch(t){case Tt:case At:case Yr:return Ir(e)?Gn:{compatible:!1,warning:um(t)};case oe:case ye:case Zt:case xi:case Ie:case xt:case St:case er:case tr:case Kr:case Nn:case Jr:case Qr:case Pn:case Ge:case it:case Zr:return Gn;case st:case We:case rt:case ot:return n!==Tn?{compatible:!1,warning:"Channel ".concat(t," should be used with a quantitative field only, not ").concat(e.type," field.")}:Gn;case Dt:case en:case tn:case nn:case zt:case Pt:case Lt:case nt:case vt:return n==="nominal"&&!e.sort?{compatible:!1,warning:"Channel ".concat(t," should not be used with an unsorted discrete field.")}:Gn;case Re:case rn:return!Ir(e)&&!Qy(e)?{compatible:!1,warning:fm(t)}:Gn;case si:return e.type==="nominal"&&!("sort"in e)?{compatible:!1,warning:"Channel order is inappropriate for nominal field, which has no inherent order."}:Gn}}function fi(e){const{formatType:t}=Rr(e);return t==="time"||!t&&ob(e)}function ob(e){return e&&(e.type==="temporal"||w(e)&&!!e.timeUnit)}function gs(e,{timeUnit:t,type:n,wrapTime:i,undefinedIfExprNotRequired:r}){var c;const s=t&&((c=me(t))==null?void 0:c.unit);let o=s||n==="temporal",a;return nr(e)?a=e.expr:R(e)?a=e.signal:jn(e)?(o=!0,a=_n(e)):(z(e)||fe(e))&&o&&(a="datetime(".concat(te(e),")"),Km(s)&&(fe(e)&&e<1e4||z(e)&&isNaN(Date.parse(e)))&&(a=_n({[s]:e}))),a?i&&o?"time(".concat(a,")"):a:r?void 0:te(e)}function Gf(e,t){const{type:n}=e;return t.map(i=>{const r=w(e)&&!Mn(e.timeUnit)?e.timeUnit:void 0,s=gs(i,{timeUnit:r,type:n,undefinedIfExprNotRequired:!0});return s!==void 0?{signal:s}:i})}function ar(e,t){return ne(e.bin)?jt(t)&&["ordinal","nominal"].includes(e.type):(console.warn("Only call this method for binned field defs."),!1)}const Gc={labelAlign:{part:"labels",vgProp:"align"},labelBaseline:{part:"labels",vgProp:"baseline"},labelColor:{part:"labels",vgProp:"fill"},labelFont:{part:"labels",vgProp:"font"},labelFontSize:{part:"labels",vgProp:"fontSize"},labelFontStyle:{part:"labels",vgProp:"fontStyle"},labelFontWeight:{part:"labels",vgProp:"fontWeight"},labelOpacity:{part:"labels",vgProp:"opacity"},labelOffset:null,labelPadding:null,gridColor:{part:"grid",vgProp:"stroke"},gridDash:{part:"grid",vgProp:"strokeDash"},gridDashOffset:{part:"grid",vgProp:"strokeDashOffset"},gridOpacity:{part:"grid",vgProp:"opacity"},gridWidth:{part:"grid",vgProp:"strokeWidth"},tickColor:{part:"ticks",vgProp:"stroke"},tickDash:{part:"ticks",vgProp:"strokeDash"},tickDashOffset:{part:"ticks",vgProp:"strokeDashOffset"},tickOpacity:{part:"ticks",vgProp:"opacity"},tickSize:null,tickWidth:{part:"ticks",vgProp:"strokeWidth"}};function cr(e){return e==null?void 0:e.condition}const Hf=["domain","grid","labels","ticks","title"],ab={grid:"grid",gridCap:"grid",gridColor:"grid",gridDash:"grid",gridDashOffset:"grid",gridOpacity:"grid",gridScale:"grid",gridWidth:"grid",orient:"main",bandPosition:"both",aria:"main",description:"main",domain:"main",domainCap:"main",domainColor:"main",domainDash:"main",domainDashOffset:"main",domainOpacity:"main",domainWidth:"main",format:"main",formatType:"main",labelAlign:"main",labelAngle:"main",labelBaseline:"main",labelBound:"main",labelColor:"main",labelFlush:"main",labelFlushOffset:"main",labelFont:"main",labelFontSize:"main",labelFontStyle:"main",labelFontWeight:"main",labelLimit:"main",labelLineHeight:"main",labelOffset:"main",labelOpacity:"main",labelOverlap:"main",labelPadding:"main",labels:"main",labelSeparation:"main",maxExtent:"main",minExtent:"main",offset:"both",position:"main",tickCap:"main",tickColor:"main",tickDash:"main",tickDashOffset:"main",tickMinStep:"both",tickOffset:"both",tickOpacity:"main",tickRound:"both",ticks:"main",tickSize:"main",tickWidth:"both",title:"main",titleAlign:"main",titleAnchor:"main",titleAngle:"main",titleBaseline:"main",titleColor:"main",titleFont:"main",titleFontSize:"main",titleFontStyle:"main",titleFontWeight:"main",titleLimit:"main",titleLineHeight:"main",titleOpacity:"main",titlePadding:"main",titleX:"main",titleY:"main",encode:"both",scale:"both",tickBand:"both",tickCount:"both",tickExtra:"both",translate:"both",values:"both",zindex:"both"},qf={orient:1,aria:1,bandPosition:1,description:1,domain:1,domainCap:1,domainColor:1,domainDash:1,domainDashOffset:1,domainOpacity:1,domainWidth:1,format:1,formatType:1,grid:1,gridCap:1,gridColor:1,gridDash:1,gridDashOffset:1,gridOpacity:1,gridWidth:1,labelAlign:1,labelAngle:1,labelBaseline:1,labelBound:1,labelColor:1,labelFlush:1,labelFlushOffset:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelLineHeight:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labels:1,labelSeparation:1,maxExtent:1,minExtent:1,offset:1,position:1,tickBand:1,tickCap:1,tickColor:1,tickCount:1,tickDash:1,tickDashOffset:1,tickExtra:1,tickMinStep:1,tickOffset:1,tickOpacity:1,tickRound:1,ticks:1,tickSize:1,tickWidth:1,title:1,titleAlign:1,titleAnchor:1,titleAngle:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titlePadding:1,titleX:1,titleY:1,translate:1,values:1,zindex:1},cb={...qf,style:1,labelExpr:1,encoding:1};function Hc(e){return!!cb[e]}const lb={axis:1,axisBand:1,axisBottom:1,axisDiscrete:1,axisLeft:1,axisPoint:1,axisQuantitative:1,axisRight:1,axisTemporal:1,axisTop:1,axisX:1,axisXBand:1,axisXDiscrete:1,axisXPoint:1,axisXQuantitative:1,axisXTemporal:1,axisY:1,axisYBand:1,axisYDiscrete:1,axisYPoint:1,axisYQuantitative:1,axisYTemporal:1},Xf=x(lb);function Mt(e){return"mark"in e}class hs{constructor(t,n){this.name=t,this.run=n}hasMatchingType(t){return Mt(t)?Dy(t.mark)===this.name:!1}}function En(e,t){const n=e&&e[t];return n?I(n)?On(n,i=>!!i.field):w(n)||ds(n):!1}function Vf(e,t){const n=e&&e[t];return n?I(n)?On(n,i=>!!i.field):w(n)||$t(n)||or(n):!1}function vo(e,t){if(be(t)){const n=e[t];if((w(n)||$t(n))&&(hf(n.type)||w(n)&&n.timeUnit)){const i=Qo(t);return Vf(e,i)}}return!1}function Fa(e){return On(uh,t=>{if(En(e,t)){const n=e[t];if(I(n))return On(n,i=>!!i.aggregate);{const i=yt(n);return i&&!!i.aggregate}}return!1})}function Yf(e,t){const n=[],i=[],r=[],s=[],o={};return ka(e,(a,c)=>{if(w(a)){const{field:l,aggregate:u,bin:f,timeUnit:d,...p}=a;if(u||d||f){const g=_a(a),h=g==null?void 0:g.title;let m=C(a,{forAs:!0});const y={...h?[]:{title:Zn(a,t,{allowDisabling:!0})},...p,field:m};if(u){let b;if(sn(u)?(b="argmax",m=C({op:"argmax",field:u.argmax},{forAs:!0}),y.field="".concat(m,".").concat(l)):It(u)?(b="argmin",m=C({op:"argmin",field:u.argmin},{forAs:!0}),y.field="".concat(m,".").concat(l)):u!=="boxplot"&&u!=="errorbar"&&u!=="errorband"&&(b=u),b){const N={op:b,as:m};l&&(N.field=l),s.push(N)}}else if(n.push(m),Ce(a)&&ne(f)){if(i.push({bin:f,field:l,as:m}),n.push(C(a,{binSuffix:"end"})),ar(a,c)&&n.push(C(a,{binSuffix:"range"})),be(c)){const b={field:"".concat(m,"_end")};o["".concat(c,"2")]=b}y.bin="binned",Iu(c)||(y.type=Tn)}else if(d&&!Mn(d)){r.push({timeUnit:d,field:l,as:m});const b=Ce(a)&&a.type!==ai&&"time";b&&(c===er||c===Nn?y.formatType=b:vh(c)?y.legend={formatType:b,...y.legend}:be(c)&&(y.axis={formatType:b,...y.axis}))}o[c]=y}else n.push(l),o[c]=e[c]}else o[c]=e[c]}),{bins:i,timeUnits:r,aggregate:s,groupby:n,encoding:o}}function ub(e,t,n){const i=Sh(t,n);if(i){if(i==="binned"){const r=e[t===nt?oe:ye];return!!(w(r)&&w(e[t])&&xe(r.bin))}}else return!1;return!0}function fb(e,t,n,i){const r={};for(const s of x(e))ku(s)||S(lm(s));for(let s of hh){if(!e[s])continue;const o=e[s];if(Si(s)){const a=Lu(s),c=r[a];if(w(c)){if(cy(c.type)&&w(o)&&!c.timeUnit){S(tm(a));continue}}else s=a,S(nm(a))}if(s==="angle"&&t==="arc"&&!e.theta&&(S(em),s=Ge),!ub(e,s,t)){S(is(s,t));continue}if(s===zt&&t==="line"){const a=yt(e[s]);if(a!=null&&a.aggregate){S(am);continue}}if(s===Ie&&(n?"fill"in e:"stroke"in e)){S(Qu("encoding",{fill:"fill"in e,stroke:"stroke"in e}));continue}if(s===tr||s===si&&!I(o)&&!et(o)||s===Nn&&I(o)){if(o){if(s===si){const a=e[s];if(zf(a)){r[s]=a;continue}}r[s]=le(o).reduce((a,c)=>(w(c)?a.push(Aa(c,s)):S(ho(c,s)),a),[])}}else{if(s===Nn&&o===null)r[s]=null;else if(!w(o)&&!$t(o)&&!et(o)&&!fs(o)&&!R(o)){S(ho(o,s));continue}r[s]=Wf(o,s,i)}}return r}function ms(e,t){const n={};for(const i of x(e)){const r=Wf(e[i],i,t,{compositeMark:!0});n[i]=r}return n}function db(e){const t=[];for(const n of x(e))if(En(e,n)){const i=e[n],r=le(i);for(const s of r)w(s)?t.push(s):ds(s)&&t.push(s.condition)}return t}function ka(e,t,n){if(e)for(const i of x(e)){const r=e[i];if(I(r))for(const s of r)t.call(n,s,i);else t.call(n,r,i)}}function pb(e,t,n,i){return e?x(e).reduce((r,s)=>{const o=e[s];return I(o)?o.reduce((a,c)=>t.call(i,a,c,s),r):t.call(i,r,o,s)},n):n}function Kf(e,t){return x(t).reduce((n,i)=>{switch(i){case oe:case ye:case Jr:case Zr:case Qr:case nt:case vt:case Zt:case xi:case Ge:case Pt:case it:case Lt:case rt:case st:case ot:case We:case er:case Re:case Pn:case Nn:return n;case si:if(e==="line"||e==="trail")return n;case tr:case Kr:{const r=t[i];if(I(r)||w(r))for(const s of le(r))s.aggregate||n.push(C(s,{}));return n}case zt:if(e==="trail")return n;case Ie:case xt:case St:case Dt:case en:case tn:case rn:case nn:{const r=yt(t[i]);return r&&!r.aggregate&&n.push(C(r,{})),n}}},[])}function gb(e){const{tooltip:t,...n}=e;if(!t)return{filteredEncoding:n};let i,r;if(I(t)){for(const s of t)s.aggregate?(i||(i=[]),i.push(s)):(r||(r=[]),r.push(s));i&&(n.tooltip=i)}else t.aggregate?n.tooltip=t:r=t;return I(r)&&r.length===1&&(r=r[0]),{customTooltipWithoutAggregatedField:r,filteredEncoding:n}}function xo(e,t,n,i=!0){if("tooltip"in n)return{tooltip:n.tooltip};const r=e.map(({fieldPrefix:o,titlePrefix:a})=>{const c=i?" of ".concat(Ia(t)):"";return{field:o+t.field,type:t.type,title:R(a)?{signal:"".concat(a,'"').concat(escape(c),'"')}:a+c}}),s=db(n).map(Ky);return{tooltip:[...r,...dt(s,W)]}}function Ia(e){const{title:t,field:n}=e;return de(t,n)}function Ra(e,t,n,i,r){const{scale:s,axis:o}=n;return({partName:a,mark:c,positionPrefix:l,endPositionPrefix:u=void 0,extraEncoding:f={}})=>{const d=Ia(n);return Jf(e,a,r,{mark:c,encoding:{[t]:{field:"".concat(l,"_").concat(n.field),type:n.type,...d!==void 0?{title:d}:{},...s!==void 0?{scale:s}:{},...o!==void 0?{axis:o}:{}},...z(u)?{["".concat(t,"2")]:{field:"".concat(u,"_").concat(n.field)}}:{},...i,...f}})}}function Jf(e,t,n,i){const{clip:r,color:s,opacity:o}=e,a=e.type;return e[t]||e[t]===void 0&&n[t]?[{...i,mark:{...n[t],...r?{clip:r}:{},...s?{color:s}:{},...o?{opacity:o}:{},...mt(i.mark)?i.mark:{type:i.mark},style:"".concat(a,"-").concat(String(t)),...bi(e[t])?{}:e[t]}}]:[]}function Qf(e,t,n){const{encoding:i}=e,r=t==="vertical"?"y":"x",s=i[r],o=i["".concat(r,"2")],a=i["".concat(r,"Error")],c=i["".concat(r,"Error2")];return{continuousAxisChannelDef:pr(s,n),continuousAxisChannelDef2:pr(o,n),continuousAxisChannelDefError:pr(a,n),continuousAxisChannelDefError2:pr(c,n),continuousAxis:r}}function pr(e,t){if(e!=null&&e.aggregate){const{aggregate:n,...i}=e;return n!==t&&S(zm(n,t)),i}else return e}function Zf(e,t){const{mark:n,encoding:i}=e,{x:r,y:s}=i;if(mt(n)&&n.orient)return n.orient;if(Gt(r)){if(Gt(s)){const o=w(r)&&r.aggregate,a=w(s)&&s.aggregate;if(!o&&a===t)return"vertical";if(!a&&o===t)return"horizontal";if(o===t&&a===t)throw new Error("Both x and y cannot have aggregate");return fi(s)&&!fi(r)?"horizontal":"vertical"}return"horizontal"}else{if(Gt(s))return"vertical";throw new Error("Need a valid continuous axis for ".concat(t,"s"))}}const Pr="boxplot",hb=["box","median","outliers","rule","ticks"],mb=new hs(Pr,td);function ed(e){return fe(e)?"tukey":e}function td(e,{config:t}){var wc,$c;e={...e,encoding:ms(e.encoding,t)};const{mark:n,encoding:i,params:r,projection:s,...o}=e,a=mt(n)?n:{type:n};r&&S(Ku("boxplot"));const c=(wc=a.extent)!=null?wc:t.boxplot.extent,l=K("size",a,t),u=a.invalid,f=ed(c),{bins:d,timeUnits:p,transform:g,continuousAxisChannelDef:h,continuousAxis:m,groupby:y,aggregate:b,encodingWithoutContinuousAxis:N,ticksOrient:_,boxOrient:$,customTooltipWithoutAggregatedField:P}=yb(e,c,t),{color:F,size:L,...H}=N,Y=Kp=>Ra(a,m,h,Kp,t.boxplot),ue=Y(H),_e=Y(N),E=Y({...H,...L?{size:L}:{}}),v=xo([{fieldPrefix:f==="min-max"?"upper_whisker_":"max_",titlePrefix:"Max"},{fieldPrefix:"upper_box_",titlePrefix:"Q3"},{fieldPrefix:"mid_box_",titlePrefix:"Median"},{fieldPrefix:"lower_box_",titlePrefix:"Q1"},{fieldPrefix:f==="min-max"?"lower_whisker_":"min_",titlePrefix:"Min"}],h,N),O={type:"tick",color:"black",opacity:1,orient:_,invalid:u,aria:!1},T=f==="min-max"?v:xo([{fieldPrefix:"upper_whisker_",titlePrefix:"Upper Whisker"},{fieldPrefix:"lower_whisker_",titlePrefix:"Lower Whisker"}],h,N),A=[...ue({partName:"rule",mark:{type:"rule",invalid:u,aria:!1},positionPrefix:"lower_whisker",endPositionPrefix:"lower_box",extraEncoding:T}),...ue({partName:"rule",mark:{type:"rule",invalid:u,aria:!1},positionPrefix:"upper_box",endPositionPrefix:"upper_whisker",extraEncoding:T}),...ue({partName:"ticks",mark:O,positionPrefix:"lower_whisker",extraEncoding:T}),...ue({partName:"ticks",mark:O,positionPrefix:"upper_whisker",extraEncoding:T})],k=[...f!=="tukey"?A:[],..._e({partName:"box",mark:{type:"bar",...l?{size:l}:{},orient:$,invalid:u,ariaRoleDescription:"box"},positionPrefix:"lower_box",endPositionPrefix:"upper_box",extraEncoding:v}),...E({partName:"median",mark:{type:"tick",invalid:u,...X(t.boxplot.median)&&t.boxplot.median.color?{color:t.boxplot.median.color}:{},...l?{size:l}:{},orient:_,aria:!1},positionPrefix:"mid_box",extraEncoding:v})];if(f==="min-max")return{...o,transform:(($c=o.transform)!=null?$c:[]).concat(g),layer:k};const D='datum["lower_box_'.concat(h.field,'"]'),q='datum["upper_box_'.concat(h.field,'"]'),U="(".concat(q," - ").concat(D,")"),Z="".concat(D," - ").concat(c," * ").concat(U),Ee="".concat(q," + ").concat(c," * ").concat(U),ie='datum["'.concat(h.field,'"]'),cn={joinaggregate:nd(h.field),groupby:y},zs={transform:[{filter:"(".concat(Z," <= ").concat(ie,") && (").concat(ie," <= ").concat(Ee,")")},{aggregate:[{op:"min",field:h.field,as:"lower_whisker_".concat(h.field)},{op:"max",field:h.field,as:"upper_whisker_".concat(h.field)},{op:"min",field:"lower_box_".concat(h.field),as:"lower_box_".concat(h.field)},{op:"max",field:"upper_box_".concat(h.field),as:"upper_box_".concat(h.field)},...b],groupby:y}],layer:A},{tooltip:T0,...Vp}=H,{scale:bc,axis:Yp}=h,vc=Ia(h),xc=Ae(Yp,["title"]),Sc=Jf(a,"outliers",t.boxplot,{transform:[{filter:"(".concat(ie," < ").concat(Z,") || (").concat(ie," > ").concat(Ee,")")}],mark:"point",encoding:{[m]:{field:h.field,type:h.type,...vc!==void 0?{title:vc}:{},...bc!==void 0?{scale:bc}:{},...Q(xc)?{}:{axis:xc}},...Vp,...F?{color:F}:{},...P?{tooltip:P}:{}}})[0];let dr;const Ec=[...d,...p,cn];return Sc?dr={transform:Ec,layer:[Sc,zs]}:(dr=zs,dr.transform.unshift(...Ec)),{...o,layer:[dr,{transform:g,layer:k}]}}function nd(e){return[{op:"q1",field:e,as:"lower_box_".concat(e)},{op:"q3",field:e,as:"upper_box_".concat(e)}]}function yb(e,t,n){const i=Zf(e,Pr),{continuousAxisChannelDef:r,continuousAxis:s}=Qf(e,i,Pr),o=r.field,a=ed(t),c=[...nd(o),{op:"median",field:o,as:"mid_box_".concat(o)},{op:"min",field:o,as:(a==="min-max"?"lower_whisker_":"min_")+o},{op:"max",field:o,as:(a==="min-max"?"upper_whisker_":"max_")+o}],l=a==="min-max"||a==="tukey"?[]:[{calculate:'datum["upper_box_'.concat(o,'"] - datum["lower_box_').concat(o,'"]'),as:"iqr_".concat(o)},{calculate:'min(datum["upper_box_'.concat(o,'"] + datum["iqr_').concat(o,'"] * ').concat(t,', datum["max_').concat(o,'"])'),as:"upper_whisker_".concat(o)},{calculate:'max(datum["lower_box_'.concat(o,'"] - datum["iqr_').concat(o,'"] * ').concat(t,', datum["min_').concat(o,'"])'),as:"lower_whisker_".concat(o)}],{[s]:u,...f}=e.encoding,{customTooltipWithoutAggregatedField:d,filteredEncoding:p}=gb(f),{bins:g,timeUnits:h,aggregate:m,groupby:y,encoding:b}=Yf(p,n),N=i==="vertical"?"horizontal":"vertical",_=i,$=[...g,...h,{aggregate:[...m,...c],groupby:y},...l];return{bins:g,timeUnits:h,transform:$,groupby:y,aggregate:m,continuousAxisChannelDef:r,continuousAxis:s,encodingWithoutContinuousAxis:b,ticksOrient:N,boxOrient:_,customTooltipWithoutAggregatedField:d}}const La="errorbar",bb=["ticks","rule"],vb=new hs(La,id);function id(e,{config:t}){e={...e,encoding:ms(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,ticksOrient:o,markDef:a,outerSpec:c,tooltipEncoding:l}=rd(e,La,t);delete s.size;const u=Ra(a,r,i,s,t.errorbar),f=a.thickness,d=a.size,p={type:"tick",orient:o,aria:!1,...f!==void 0?{thickness:f}:{},...d!==void 0?{size:d}:{}},g=[...u({partName:"ticks",mark:p,positionPrefix:"lower",extraEncoding:l}),...u({partName:"ticks",mark:p,positionPrefix:"upper",extraEncoding:l}),...u({partName:"rule",mark:{type:"rule",ariaRoleDescription:"errorbar",...f!==void 0?{size:f}:{}},positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:l})];return{...c,transform:n,...g.length>1?{layer:g}:{...g[0]}}}function xb(e,t){const{encoding:n}=e;if(Sb(n))return{orient:Zf(e,t),inputType:"raw"};const i=Eb(n),r=wb(n),s=n.x,o=n.y;if(i){if(r)throw new Error("".concat(t," cannot be both type aggregated-upper-lower and aggregated-error"));const a=n.x2,c=n.y2;if(M(a)&&M(c))throw new Error("".concat(t," cannot have both x2 and y2"));if(M(a)){if(Gt(s))return{orient:"horizontal",inputType:"aggregated-upper-lower"};throw new Error("Both x and x2 have to be quantitative in ".concat(t))}else if(M(c)){if(Gt(o))return{orient:"vertical",inputType:"aggregated-upper-lower"};throw new Error("Both y and y2 have to be quantitative in ".concat(t))}throw new Error("No ranged axis")}else{const a=n.xError,c=n.xError2,l=n.yError,u=n.yError2;if(M(c)&&!M(a))throw new Error("".concat(t," cannot have xError2 without xError"));if(M(u)&&!M(l))throw new Error("".concat(t," cannot have yError2 without yError"));if(M(a)&&M(l))throw new Error("".concat(t," cannot have both xError and yError with both are quantiative"));if(M(a)){if(Gt(s))return{orient:"horizontal",inputType:"aggregated-error"};throw new Error("All x, xError, and xError2 (if exist) have to be quantitative")}else if(M(l)){if(Gt(o))return{orient:"vertical",inputType:"aggregated-error"};throw new Error("All y, yError, and yError2 (if exist) have to be quantitative")}throw new Error("No ranged axis")}}function Sb(e){return(M(e.x)||M(e.y))&&!M(e.x2)&&!M(e.y2)&&!M(e.xError)&&!M(e.xError2)&&!M(e.yError)&&!M(e.yError2)}function Eb(e){return M(e.x2)||M(e.y2)}function wb(e){return M(e.xError)||M(e.xError2)||M(e.yError)||M(e.yError2)}function rd(e,t,n){var A;const{mark:i,encoding:r,params:s,projection:o,...a}=e,c=mt(i)?i:{type:i};s&&S(Ku(t));const{orient:l,inputType:u}=xb(e,t),{continuousAxisChannelDef:f,continuousAxisChannelDef2:d,continuousAxisChannelDefError:p,continuousAxisChannelDefError2:g,continuousAxis:h}=Qf(e,l,t),{errorBarSpecificAggregate:m,postAggregateCalculates:y,tooltipSummary:b,tooltipTitleWithFieldName:N}=$b(c,f,d,p,g,u,t,n),{[h]:_,[h==="x"?"x2":"y2"]:$,[h==="x"?"xError":"yError"]:P,[h==="x"?"xError2":"yError2"]:F,...L}=r,{bins:H,timeUnits:Y,aggregate:ue,groupby:_e,encoding:E}=Yf(L,n),v=[...ue,...m],O=u!=="raw"?[]:_e,T=xo(b,f,E,N);return{transform:[...(A=a.transform)!=null?A:[],...H,...Y,...v.length===0?[]:[{aggregate:v,groupby:O}],...y],groupby:O,continuousAxisChannelDef:f,continuousAxis:h,encodingWithoutContinuousAxis:E,ticksOrient:l==="vertical"?"horizontal":"vertical",markDef:c,outerSpec:a,tooltipEncoding:T}}function $b(e,t,n,i,r,s,o,a){let c=[],l=[];const u=t.field;let f,d=!1;if(s==="raw"){const p=e.center?e.center:e.extent?e.extent==="iqr"?"median":"mean":a.errorbar.center,g=e.extent?e.extent:p==="mean"?"stderr":"iqr";if(p==="median"!=(g==="iqr")&&S(Pm(p,g,o)),g==="stderr"||g==="stdev")c=[{op:g,field:u,as:"extent_".concat(u)},{op:p,field:u,as:"center_".concat(u)}],l=[{calculate:'datum["center_'.concat(u,'"] + datum["extent_').concat(u,'"]'),as:"upper_".concat(u)},{calculate:'datum["center_'.concat(u,'"] - datum["extent_').concat(u,'"]'),as:"lower_".concat(u)}],f=[{fieldPrefix:"center_",titlePrefix:Zi(p)},{fieldPrefix:"upper_",titlePrefix:qc(p,g,"+")},{fieldPrefix:"lower_",titlePrefix:qc(p,g,"-")}],d=!0;else{let h,m,y;g==="ci"?(h="mean",m="ci0",y="ci1"):(h="median",m="q1",y="q3"),c=[{op:m,field:u,as:"lower_".concat(u)},{op:y,field:u,as:"upper_".concat(u)},{op:h,field:u,as:"center_".concat(u)}],f=[{fieldPrefix:"upper_",titlePrefix:Zn({field:u,aggregate:y,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"lower_",titlePrefix:Zn({field:u,aggregate:m,type:"quantitative"},a,{allowDisabling:!1})},{fieldPrefix:"center_",titlePrefix:Zn({field:u,aggregate:h,type:"quantitative"},a,{allowDisabling:!1})}]}}else{(e.center||e.extent)&&S(Lm(e.center,e.extent)),s==="aggregated-upper-lower"?(f=[],l=[{calculate:'datum["'.concat(n.field,'"]'),as:"upper_".concat(u)},{calculate:'datum["'.concat(u,'"]'),as:"lower_".concat(u)}]):s==="aggregated-error"&&(f=[{fieldPrefix:"",titlePrefix:u}],l=[{calculate:'datum["'.concat(u,'"] + datum["').concat(i.field,'"]'),as:"upper_".concat(u)}],r?l.push({calculate:'datum["'.concat(u,'"] + datum["').concat(r.field,'"]'),as:"lower_".concat(u)}):l.push({calculate:'datum["'.concat(u,'"] - datum["').concat(i.field,'"]'),as:"lower_".concat(u)}));for(const p of l)f.push({fieldPrefix:p.as.substring(0,6),titlePrefix:Cn(Cn(p.calculate,'datum["',""),'"]',"")})}return{postAggregateCalculates:l,errorBarSpecificAggregate:c,tooltipSummary:f,tooltipTitleWithFieldName:d}}function qc(e,t,n){return"".concat(Zi(e)," ").concat(n," ").concat(t)}const Pa="errorband",Ob=["band","borders"],Cb=new hs(Pa,sd);function sd(e,{config:t}){e={...e,encoding:ms(e.encoding,t)};const{transform:n,continuousAxisChannelDef:i,continuousAxis:r,encodingWithoutContinuousAxis:s,markDef:o,outerSpec:a,tooltipEncoding:c}=rd(e,Pa,t),l=o,u=Ra(l,r,i,s,t.errorband),f=e.encoding.x!==void 0&&e.encoding.y!==void 0;let d={type:f?"area":"rect"},p={type:f?"line":"rule"};const g={...l.interpolate?{interpolate:l.interpolate}:{},...l.tension&&l.interpolate?{tension:l.tension}:{}};return f?(d={...d,...g,ariaRoleDescription:"errorband"},p={...p,...g,aria:!1}):l.interpolate?S(zc("interpolate")):l.tension&&S(zc("tension")),{...a,transform:n,layer:[...u({partName:"band",mark:d,positionPrefix:"lower",endPositionPrefix:"upper",extraEncoding:c}),...u({partName:"borders",mark:p,positionPrefix:"lower",extraEncoding:c}),...u({partName:"borders",mark:p,positionPrefix:"upper",extraEncoding:c})]}}const od={};function za(e,t,n){const i=new hs(e,t);od[e]={normalizer:i,parts:n}}function Nb(){return x(od)}za(Pr,td,hb);za(La,id,bb);za(Pa,sd,Ob);const _b=["gradientHorizontalMaxLength","gradientHorizontalMinLength","gradientVerticalMaxLength","gradientVerticalMinLength","unselectedOpacity"],ad={titleAlign:"align",titleAnchor:"anchor",titleAngle:"angle",titleBaseline:"baseline",titleColor:"color",titleFont:"font",titleFontSize:"fontSize",titleFontStyle:"fontStyle",titleFontWeight:"fontWeight",titleLimit:"limit",titleLineHeight:"lineHeight",titleOrient:"orient",titlePadding:"offset"},cd={labelAlign:"align",labelAnchor:"anchor",labelAngle:"angle",labelBaseline:"baseline",labelColor:"color",labelFont:"font",labelFontSize:"fontSize",labelFontStyle:"fontStyle",labelFontWeight:"fontWeight",labelLimit:"limit",labelLineHeight:"lineHeight",labelOrient:"orient",labelPadding:"offset"},Tb=x(ad),Ab=x(cd),Fb={header:1,headerRow:1,headerColumn:1,headerFacet:1},ld=x(Fb),ud=["size","shape","fill","stroke","strokeDash","strokeWidth","opacity"],kb={gradientHorizontalMaxLength:200,gradientHorizontalMinLength:100,gradientVerticalMaxLength:200,gradientVerticalMinLength:64,unselectedOpacity:.35},Ib={aria:1,clipHeight:1,columnPadding:1,columns:1,cornerRadius:1,description:1,direction:1,fillColor:1,format:1,formatType:1,gradientLength:1,gradientOpacity:1,gradientStrokeColor:1,gradientStrokeWidth:1,gradientThickness:1,gridAlign:1,labelAlign:1,labelBaseline:1,labelColor:1,labelFont:1,labelFontSize:1,labelFontStyle:1,labelFontWeight:1,labelLimit:1,labelOffset:1,labelOpacity:1,labelOverlap:1,labelPadding:1,labelSeparation:1,legendX:1,legendY:1,offset:1,orient:1,padding:1,rowPadding:1,strokeColor:1,symbolDash:1,symbolDashOffset:1,symbolFillColor:1,symbolLimit:1,symbolOffset:1,symbolOpacity:1,symbolSize:1,symbolStrokeColor:1,symbolStrokeWidth:1,symbolType:1,tickCount:1,tickMinStep:1,title:1,titleAlign:1,titleAnchor:1,titleBaseline:1,titleColor:1,titleFont:1,titleFontSize:1,titleFontStyle:1,titleFontWeight:1,titleLimit:1,titleLineHeight:1,titleOpacity:1,titleOrient:1,titlePadding:1,type:1,values:1,zindex:1},tt="_vgsid_",Rb={point:{on:"click",fields:[tt],toggle:"event.shiftKey",resolve:"global",clear:"dblclick"},interval:{on:"[mousedown, window:mouseup] > window:mousemove!",encodings:["x","y"],translate:"[mousedown, window:mouseup] > window:mousemove!",zoom:"wheel!",mark:{fill:"#333",fillOpacity:.125,stroke:"white"},resolve:"global",clear:"dblclick"}};function Da(e){return e==="legend"||!!(e!=null&&e.legend)}function Us(e){return Da(e)&&X(e)}function ja(e){return!!(e!=null&&e.select)}function fd(e){const t=[];for(const n of e||[]){if(ja(n))continue;const{expr:i,bind:r,...s}=n;if(r&&i){const o={...s,bind:r,init:i};t.push(o)}else{const o={...s,...i?{update:i}:{},...r?{bind:r}:{}};t.push(o)}}return t}function Lb(e){return ys(e)||Ua(e)||Ma(e)}function Ma(e){return"concat"in e}function ys(e){return"vconcat"in e}function Ua(e){return"hconcat"in e}function dd({step:e,offsetIsDiscrete:t}){var n;return t?(n=e.for)!=null?n:"offset":"position"}function bt(e){return X(e)&&e.step!==void 0}function Xc(e){return e.view||e.width||e.height}const Vc=20,Pb={align:1,bounds:1,center:1,columns:1,spacing:1},zb=x(Pb);function Db(e,t,n){var a,c;const i=n[t],r={},{spacing:s,columns:o}=i;s!==void 0&&(r.spacing=s),o!==void 0&&(us(e)&&!sr(e.facet)||Ma(e))&&(r.columns=o),ys(e)&&(r.columns=1);for(const l of zb)if(e[l]!==void 0)if(l==="spacing"){const u=e[l];r[l]=fe(u)?u:{row:(a=u.row)!=null?a:s,column:(c=u.column)!=null?c:s}}else r[l]=e[l];return r}function So(e,t){var n;return(n=e[t])!=null?n:e[t==="width"?"continuousWidth":"continuousHeight"]}function zr(e,t){const n=Dr(e,t);return bt(n)?n.step:pd}function Dr(e,t){var i;const n=(i=e[t])!=null?i:e[t==="width"?"discreteWidth":"discreteHeight"];return de(n,{step:e.step})}const pd=20,jb={continuousWidth:200,continuousHeight:200,step:pd},Mb={background:"white",padding:5,timeFormat:"%b %d, %Y",countTitle:"Count of Records",view:jb,mark:ky,arc:{},area:{},bar:Ly,circle:{},geoshape:{},image:{},line:{},point:{},rect:Py,rule:{color:"black"},square:{},text:{color:"black"},tick:zy,trail:{},boxplot:{size:14,extent:1.5,box:{},median:{color:"white"},outliers:{},rule:{},ticks:null},errorbar:{center:"mean",rule:!0,ticks:!1},errorband:{band:{opacity:.3},borders:!1},scale:gy,projection:{},legend:kb,header:{titlePadding:10,labelPadding:10},headerColumn:{},headerRow:{},headerFacet:{},selection:Rb,style:{},title:{},facet:{spacing:Vc},concat:{spacing:Vc},normalizedNumberFormat:".0%"},Ot=["#4c78a8","#f58518","#e45756","#72b7b2","#54a24b","#eeca3b","#b279a2","#ff9da6","#9d755d","#bab0ac"],Yc={text:11,guideLabel:10,guideTitle:11,groupTitle:13,groupSubtitle:12},Kc={blue:Ot[0],orange:Ot[1],red:Ot[2],teal:Ot[3],green:Ot[4],yellow:Ot[5],purple:Ot[6],pink:Ot[7],brown:Ot[8],gray0:"#000",gray1:"#111",gray2:"#222",gray3:"#333",gray4:"#444",gray5:"#555",gray6:"#666",gray7:"#777",gray8:"#888",gray9:"#999",gray10:"#aaa",gray11:"#bbb",gray12:"#ccc",gray13:"#ddd",gray14:"#eee",gray15:"#fff"};function Ub(e={}){return{signals:[{name:"color",value:X(e)?{...Kc,...e}:Kc}],mark:{color:{signal:"color.blue"}},rule:{color:{signal:"color.gray0"}},text:{color:{signal:"color.gray0"}},style:{"guide-label":{fill:{signal:"color.gray0"}},"guide-title":{fill:{signal:"color.gray0"}},"group-title":{fill:{signal:"color.gray0"}},"group-subtitle":{fill:{signal:"color.gray0"}},cell:{stroke:{signal:"color.gray8"}}},axis:{domainColor:{signal:"color.gray13"},gridColor:{signal:"color.gray8"},tickColor:{signal:"color.gray13"}},range:{category:[{signal:"color.blue"},{signal:"color.orange"},{signal:"color.red"},{signal:"color.teal"},{signal:"color.green"},{signal:"color.yellow"},{signal:"color.purple"},{signal:"color.pink"},{signal:"color.brown"},{signal:"color.grey8"}]}}}function Bb(e){return{signals:[{name:"fontSize",value:X(e)?{...Yc,...e}:Yc}],text:{fontSize:{signal:"fontSize.text"}},style:{"guide-label":{fontSize:{signal:"fontSize.guideLabel"}},"guide-title":{fontSize:{signal:"fontSize.guideTitle"}},"group-title":{fontSize:{signal:"fontSize.groupTitle"}},"group-subtitle":{fontSize:{signal:"fontSize.groupSubtitle"}}}}}function Wb(e){return{text:{font:e},style:{"guide-label":{font:e},"guide-title":{font:e},"group-title":{font:e},"group-subtitle":{font:e}}}}function gd(e){const t=x(e||{}),n={};for(const i of t){const r=e[i];n[i]=cr(r)?Wu(r):ze(r)}return n}function Gb(e){const t=x(e),n={};for(const i of t)n[i]=gd(e[i]);return n}const Hb=[...Of,...Xf,...ld,"background","padding","legend","lineBreak","scale","style","title","view"];function hd(e={}){const{color:t,font:n,fontSize:i,selection:r,...s}=e,o=qr({},j(Mb),n?Wb(n):{},t?Ub(t):{},i?Bb(i):{},s||{});r&&zo(o,"selection",r,!0);const a=Ae(o,Hb);for(const c of["background","lineBreak","padding"])o[c]&&(a[c]=ze(o[c]));for(const c of Of)o[c]&&(a[c]=Te(o[c]));for(const c of Xf)o[c]&&(a[c]=gd(o[c]));for(const c of ld)o[c]&&(a[c]=Te(o[c]));return o.legend&&(a.legend=Te(o.legend)),o.scale&&(a.scale=Te(o.scale)),o.style&&(a.style=Gb(o.style)),o.title&&(a.title=Te(o.title)),o.view&&(a.view=Te(o.view)),a}const qb=new Set(["view",...Cy]),Xb=["color","fontSize","background","padding","facet","concat","numberFormat","numberFormatType","normalizedNumberFormat","normalizedNumberFormatType","timeFormat","countTitle","header","axisQuantitative","axisTemporal","axisDiscrete","axisPoint","axisXBand","axisXPoint","axisXDiscrete","axisXQuantitative","axisXTemporal","axisYBand","axisYPoint","axisYDiscrete","axisYQuantitative","axisYTemporal","scale","selection","overlay"],Vb={view:["continuousWidth","continuousHeight","discreteWidth","discreteHeight","step"],...Fy};function Yb(e){e=j(e);for(const t of Xb)delete e[t];if(e.axis)for(const t in e.axis)cr(e.axis[t])&&delete e.axis[t];if(e.legend)for(const t of _b)delete e.legend[t];if(e.mark){for(const t of jc)delete e.mark[t];e.mark.tooltip&&X(e.mark.tooltip)&&delete e.mark.tooltip}e.params&&(e.signals=(e.signals||[]).concat(fd(e.params)),delete e.params);for(const t of qb){for(const i of jc)delete e[t][i];const n=Vb[t];if(n)for(const i of n)delete e[t][i];Jb(e,t)}for(const t of Nb())delete e[t];Kb(e);for(const t in e)X(e[t])&&Q(e[t])&&delete e[t];return Q(e)?void 0:e}function Kb(e){const{titleMarkConfig:t,subtitleMarkConfig:n,subtitle:i}=Bu(e.title);Q(t)||(e.style["group-title"]={...e.style["group-title"],...t}),Q(n)||(e.style["group-subtitle"]={...e.style["group-subtitle"],...n}),Q(i)?delete e.title:e.title=i}function Jb(e,t,n,i){const r=i?e[t][i]:e[t];t==="view"&&(n="cell");const s={...r,...e.style[n!=null?n:t]};Q(s)||(e.style[n!=null?n:t]=s),i||delete e[t]}function bs(e){return"layer"in e}function Qb(e){return"repeat"in e}function Zb(e){return!I(e.repeat)&&e.repeat.layer}class Ba{map(t,n){return us(t)?this.mapFacet(t,n):Qb(t)?this.mapRepeat(t,n):Ua(t)?this.mapHConcat(t,n):ys(t)?this.mapVConcat(t,n):Ma(t)?this.mapConcat(t,n):this.mapLayerOrUnit(t,n)}mapLayerOrUnit(t,n){if(bs(t))return this.mapLayer(t,n);if(Mt(t))return this.mapUnit(t,n);throw new Error(ia(t))}mapLayer(t,n){return{...t,layer:t.layer.map(i=>this.mapLayerOrUnit(i,n))}}mapHConcat(t,n){return{...t,hconcat:t.hconcat.map(i=>this.map(i,n))}}mapVConcat(t,n){return{...t,vconcat:t.vconcat.map(i=>this.map(i,n))}}mapConcat(t,n){const{concat:i,...r}=t;return{...r,concat:i.map(s=>this.map(s,n))}}mapFacet(t,n){return{...t,spec:this.map(t.spec,n)}}mapRepeat(t,n){return{...t,spec:this.map(t.spec,n)}}}const ev={zero:1,center:1,normalize:1};function tv(e){return e in ev}const nv=new Set([Ef,os,ss,Ar,cs,va,xa,as,wf,ba]),iv=new Set([os,ss,Ef]);function Hn(e){return w(e)&&li(e)==="quantitative"&&!e.bin}function Jc(e,t,{orient:n,type:i}){const r=t==="x"?"y":"radius",s=t==="x",o=e[t],a=e[r];if(w(o)&&w(a))if(Hn(o)&&Hn(a)){if(o.stack)return t;if(a.stack)return r;const c=w(o)&&!!o.aggregate,l=w(a)&&!!a.aggregate;if(c!==l)return c?t:r;if(s&&["bar","area"].includes(i)){if(n==="vertical")return r;if(n==="horizontal")return t}}else{if(Hn(o))return t;if(Hn(a))return r}else{if(Hn(o))return t;if(Hn(a))return r}}function rv(e){switch(e){case"x":return"y";case"y":return"x";case"theta":return"radius";case"radius":return"theta"}}function md(e,t){var d,p;const n=mt(e)?e:{type:e},i=n.type;if(!nv.has(i))return null;const r=Jc(t,"x",n)||Jc(t,"theta",n);if(!r)return null;const s=t[r],o=w(s)?C(s,{}):void 0,a=rv(r),c=[],l=new Set;if(t[a]){const g=t[a],h=w(g)?C(g,{}):void 0;h&&h!==o&&(c.push(a),l.add(h));const m=a==="x"?"xOffset":"yOffset",y=t[m],b=w(y)?C(y,{}):void 0;b&&b!==o&&(c.push(m),l.add(b))}const u=mh.reduce((g,h)=>{if(h!=="tooltip"&&En(t,h)){const m=t[h];for(const y of le(m)){const b=yt(y);if(b.aggregate)continue;const N=C(b,{});(!N||!l.has(N))&&g.push({channel:h,fieldDef:b})}}return g},[]);let f;return s.stack!==void 0?bi(s.stack)?f=s.stack?"zero":null:f=s.stack:iv.has(i)&&(f="zero"),!f||!tv(f)||Fa(t)&&u.length===0?null:(d=s==null?void 0:s.scale)!=null&&d.type&&((p=s==null?void 0:s.scale)==null?void 0:p.type)!==Fe.LINEAR?(s!=null&&s.stack&&S(km(s.scale.type)),null):M(t[Et(r)])?(s.stack!==void 0&&S(Fm(r)),null):(w(s)&&s.aggregate&&!_h.has(s.aggregate)&&S(Im(s.aggregate)),{groupbyChannels:c,groupbyFields:l,fieldChannel:r,impute:s.impute===null?!1:an(i),stackBy:u,offset:f})}function yd(e,t,n){const i=Te(e),r=K("orient",i,n);if(i.orient=cv(i.type,t,r),r!==void 0&&r!==i.orient&&S(hm(i.orient,r)),i.type==="bar"&&i.orient){const a=K("cornerRadiusEnd",i,n);if(a!==void 0){const c=i.orient==="horizontal"&&t.x2||i.orient==="vertical"&&t.y2?["cornerRadius"]:Ry[i.orient];for(const l of c)i[l]=a;i.cornerRadiusEnd!==void 0&&delete i.cornerRadiusEnd}}return K("opacity",i,n)===void 0&&(i.opacity=ov(i.type,t)),K("cursor",i,n)===void 0&&(i.cursor=sv(i,t,n)),i}function sv(e,t,n){return t.href||e.href||K("href",e,n)?"pointer":e.cursor}function ov(e,t){if(G([cs,ba,va,xa],e)&&!Fa(t))return .7}function av(e,t,{graticule:n}){if(n)return!1;const i=Rt("filled",e,t),r=e.type;return de(i,r!==cs&&r!==as&&r!==Ar)}function cv(e,t,n){switch(e){case cs:case va:case xa:case wf:case $y:case wy:return}const{x:i,y:r,x2:s,y2:o}=t;switch(e){case os:if(w(i)&&(xe(i.bin)||w(r)&&r.aggregate&&!i.aggregate))return"vertical";if(w(r)&&(xe(r.bin)||w(i)&&i.aggregate&&!r.aggregate))return"horizontal";if(o||s){if(n)return n;if(!s)return(w(i)&&i.type===Tn&&!ne(i.bin)||kr(i))&&w(r)&&xe(r.bin)?"horizontal":"vertical";if(!o)return(w(r)&&r.type===Tn&&!ne(r.bin)||kr(r))&&w(i)&&xe(i.bin)?"vertical":"horizontal"}case Ar:if(s&&!(w(i)&&xe(i.bin))&&o&&!(w(r)&&xe(r.bin)))return;case ss:if(o)return w(r)&&xe(r.bin)?"horizontal":"vertical";if(s)return w(i)&&xe(i.bin)?"vertical":"horizontal";if(e===Ar){if(i&&!r)return"vertical";if(r&&!i)return"horizontal"}case as:case ba:{const a=Wc(i),c=Wc(r);if(n)return n;if(a&&!c)return e!=="tick"?"horizontal":"vertical";if(!a&&c)return e!=="tick"?"vertical":"horizontal";if(a&&c)return"vertical";{const l=Ce(i)&&i.type===ai,u=Ce(r)&&r.type===ai;if(l&&!u)return"vertical";if(!l&&u)return"horizontal"}return}}return"vertical"}function lv(e){const{point:t,line:n,...i}=e;return x(i).length>1?i:i.type}function uv(e){for(const t of["line","area","rule","trail"])e[t]&&(e={...e,[t]:Ae(e[t],["point","line"])});return e}function Bs(e,t={},n){return e.point==="transparent"?{opacity:0}:e.point?X(e.point)?e.point:{}:e.point!==void 0?null:t.point||n.shape?X(t.point)?t.point:{}:void 0}function Qc(e,t={}){return e.line?e.line===!0?{}:e.line:e.line!==void 0?null:t.line?t.line===!0?{}:t.line:void 0}class fv{constructor(){this.name="path-overlay"}hasMatchingType(t,n){if(Mt(t)){const{mark:i,encoding:r}=t,s=mt(i)?i:{type:i};switch(s.type){case"line":case"rule":case"trail":return!!Bs(s,n[s.type],r);case"area":return!!Bs(s,n[s.type],r)||!!Qc(s,n[s.type])}}return!1}run(t,n,i){const{config:r}=n,{params:s,projection:o,mark:a,name:c,encoding:l,...u}=t,f=ms(l,r),d=mt(a)?a:{type:a},p=Bs(d,r[d.type],f),g=d.type==="area"&&Qc(d,r[d.type]),h=[{name:c,...s?{params:s}:{},mark:lv({...d.type==="area"&&d.opacity===void 0&&d.fillOpacity===void 0?{opacity:.7}:{},...d}),encoding:Ae(f,["shape"])}],m=md(yd(d,f,r),f);let y=f;if(m){const{fieldChannel:b,offset:N}=m;y={...f,[b]:{...f[b],...N?{stack:N}:{}}}}return y=Ae(y,["y2","x2"]),g&&h.push({...o?{projection:o}:{},mark:{type:"line",...ii(d,["clip","interpolate","tension","tooltip"]),...g},encoding:y}),p&&h.push({...o?{projection:o}:{},mark:{type:"point",opacity:1,filled:!0,...ii(d,["clip","tooltip"]),...p},encoding:y}),i({...u,layer:h},{...n,config:uv(r)})}}function dv(e,t){return t?sr(e)?vd(e,t):bd(e,t):e}function Ws(e,t){return t?vd(e,t):e}function Eo(e,t,n){const i=t[e];if(Vy(i)){if(i.repeat in n)return{...t,[e]:n[i.repeat]};S(Xh(i.repeat));return}return t}function bd(e,t){if(e=Eo("field",e,t),e!==void 0){if(e===null)return null;if(Na(e)&&pt(e.sort)){const n=Eo("field",e.sort,t);e={...e,...n?{sort:n}:{}}}return e}}function Zc(e,t){if(w(e))return bd(e,t);{const n=Eo("datum",e,t);return n!==e&&!n.type&&(n.type="nominal"),n}}function el(e,t){if(M(e)){const n=Zc(e,t);if(n)return n;if(fs(e))return{condition:e.condition}}else{if(or(e)){const n=Zc(e.condition,t);if(n)return{...e,condition:n};{const{condition:i,...r}=e;return r}}return e}}function vd(e,t){const n={};for(const i in e)if(Yn(e,i)){const r=e[i];if(I(r))n[i]=r.map(s=>el(s,t)).filter(s=>s);else{const s=el(r,t);s!==void 0&&(n[i]=s)}}return n}class pv{constructor(){this.name="RuleForRangedLine"}hasMatchingType(t){if(Mt(t)){const{encoding:n,mark:i}=t;if(i==="line"||mt(i)&&i.type==="line")for(const r of gh){const s=zn(r),o=n[s];if(n[r]&&(w(o)&&!xe(o.bin)||$t(o)))return!0}}return!1}run(t,n,i){const{encoding:r,mark:s}=t;return S(gm(!!r.x2,!!r.y2)),i({...t,mark:X(s)?{...s,type:"rule"}:"rule"},n)}}class gv extends Ba{constructor(){super(...arguments),this.nonFacetUnitNormalizers=[mb,vb,Cb,new fv,new pv]}map(t,n){if(Mt(t)){const i=En(t.encoding,Tt),r=En(t.encoding,At),s=En(t.encoding,Yr);if(i||r||s)return this.mapFacetedUnit(t,n)}return super.map(t,n)}mapUnit(t,n){const{parentEncoding:i,parentProjection:r}=n,s=Ws(t.encoding,n.repeater),o={...t,...t.name?{name:[n.repeaterPrefix,t.name].filter(c=>c).join("_")}:{},...s?{encoding:s}:{}};if(i||r)return this.mapUnitWithParentEncodingOrProjection(o,n);const a=this.mapLayerOrUnit.bind(this);for(const c of this.nonFacetUnitNormalizers)if(c.hasMatchingType(o,n.config))return c.run(o,n,a);return o}mapRepeat(t,n){return Zb(t)?this.mapLayerRepeat(t,n):this.mapNonLayerRepeat(t,n)}mapLayerRepeat(t,n){const{repeat:i,spec:r,...s}=t,{row:o,column:a,layer:c}=i,{repeater:l={},repeaterPrefix:u=""}=n;return o||a?this.mapRepeat({...t,repeat:{...o?{row:o}:{},...a?{column:a}:{}},spec:{repeat:{layer:c},spec:r}},n):{...s,layer:c.map(f=>{const d={...l,layer:f},p="".concat((r.name?"".concat(r.name,"_"):"")+u,"child__layer_").concat(se(f)),g=this.mapLayerOrUnit(r,{...n,repeater:d,repeaterPrefix:p});return g.name=p,g})}}mapNonLayerRepeat(t,n){var g;const{repeat:i,spec:r,data:s,...o}=t;!I(i)&&t.columns&&(t=Ae(t,["columns"]),S(Ic("repeat")));const a=[],{repeater:c={},repeaterPrefix:l=""}=n,u=!I(i)&&i.row||[c?c.row:null],f=!I(i)&&i.column||[c?c.column:null],d=I(i)&&i||[c?c.repeat:null];for(const h of d)for(const m of u)for(const y of f){const b={repeat:h,row:m,column:y,layer:c.layer},N=(r.name?"".concat(r.name,"_"):"")+l+"child__"+(I(i)?"".concat(se(h)):(i.row?"row_".concat(se(m)):"")+(i.column?"column_".concat(se(y)):"")),_=this.map(r,{...n,repeater:b,repeaterPrefix:N});_.name=N,a.push(Ae(_,["data"]))}const p=I(i)?t.columns:i.column?i.column.length:1;return{data:(g=r.data)!=null?g:s,align:"all",...o,columns:p,concat:a}}mapFacet(t,n){const{facet:i}=t;return sr(i)&&t.columns&&(t=Ae(t,["columns"]),S(Ic("facet"))),super.mapFacet(t,n)}mapUnitWithParentEncodingOrProjection(t,n){const{encoding:i,projection:r}=t,{parentEncoding:s,parentProjection:o,config:a}=n,c=nl({parentProjection:o,projection:r}),l=tl({parentEncoding:s,encoding:Ws(i,n.repeater)});return this.mapUnit({...t,...c?{projection:c}:{},...l?{encoding:l}:{}},{config:a})}mapFacetedUnit(t,n){const{row:i,column:r,facet:s,...o}=t.encoding,{mark:a,width:c,projection:l,height:u,view:f,params:d,encoding:p,...g}=t,{facetMapping:h,layout:m}=this.getFacetMappingAndLayout({row:i,column:r,facet:s},n),y=Ws(o,n.repeater);return this.mapFacet({...g,...m,facet:h,spec:{...c?{width:c}:{},...u?{height:u}:{},...f?{view:f}:{},...l?{projection:l}:{},mark:a,encoding:y,...d?{params:d}:{}}},n)}getFacetMappingAndLayout(t,n){var o;const{row:i,column:r,facet:s}=t;if(i||r){s&&S(dm([...i?[Tt]:[],...r?[At]:[]]));const a={},c={};for(const l of[Tt,At]){const u=t[l];if(u){const{align:f,center:d,spacing:p,columns:g,...h}=u;a[l]=h;for(const m of["align","center","spacing"])u[m]!==void 0&&((o=c[m])!=null||(c[m]={}),c[m][l]=u[m])}}return{facetMapping:a,layout:c}}else{const{align:a,center:c,spacing:l,columns:u,...f}=s;return{facetMapping:dv(f,n.repeater),layout:{...a?{align:a}:{},...c?{center:c}:{},...l?{spacing:l}:{},...u?{columns:u}:{}}}}}mapLayer(t,{parentEncoding:n,parentProjection:i,...r}){const{encoding:s,projection:o,...a}=t,c={...r,parentEncoding:tl({parentEncoding:n,encoding:s,layer:!0}),parentProjection:nl({parentProjection:i,projection:o})};return super.mapLayer({...a,...t.name?{name:[c.repeaterPrefix,t.name].filter(l=>l).join("_")}:{}},c)}}function tl({parentEncoding:e,encoding:t={},layer:n}){let i={};if(e){const r=new Set([...x(e),...x(t)]);for(const s of r){const o=t[s],a=e[s];if(M(o)){const c={...a,...o};i[s]=c}else or(o)?i[s]={...o,condition:{...a,...o.condition}}:o||o===null?i[s]=o:(n||et(a)||R(a)||M(a)||I(a))&&(i[s]=a)}}else i=t;return!i||Q(i)?void 0:i}function nl(e){const{parentProjection:t,projection:n}=e;return t&&n&&S(Zh({parentProjection:t,projection:n})),n!=null?n:t}function Wa(e){return"filter"in e}function hv(e){return(e==null?void 0:e.stop)!==void 0}function xd(e){return"lookup"in e}function mv(e){return"data"in e}function yv(e){return"param"in e}function bv(e){return"pivot"in e}function vv(e){return"density"in e}function xv(e){return"quantile"in e}function Sv(e){return"regression"in e}function Ev(e){return"loess"in e}function wv(e){return"sample"in e}function $v(e){return"window"in e}function Ov(e){return"joinaggregate"in e}function Cv(e){return"flatten"in e}function Nv(e){return"calculate"in e}function Sd(e){return"bin"in e}function _v(e){return"impute"in e}function Tv(e){return"timeUnit"in e}function Av(e){return"aggregate"in e}function Fv(e){return"stack"in e}function kv(e){return"fold"in e}function Iv(e){return"extent"in e&&!("density"in e)}function Rv(e){return e.map(t=>Wa(t)?{filter:Jn(t.filter,ay)}:t)}class Lv extends Ba{map(t,n){var i,r;return(i=n.emptySelections)!=null||(n.emptySelections={}),(r=n.selectionPredicates)!=null||(n.selectionPredicates={}),t=il(t,n),super.map(t,n)}mapLayerOrUnit(t,n){if(t=il(t,n),t.encoding){const i={};for(const[r,s]of Xt(t.encoding))i[r]=Ed(s,n);t={...t,encoding:i}}return super.mapLayerOrUnit(t,n)}mapUnit(t,n){const{selection:i,...r}=t;return i?{...r,params:Xt(i).map(([s,o])=>{var f;const{init:a,bind:c,empty:l,...u}=o;u.type==="single"?(u.type="point",u.toggle=!1):u.type==="multi"&&(u.type="point"),n.emptySelections[s]=l!=="none";for(const d of Se((f=n.selectionPredicates[s])!=null?f:{}))d.empty=l!=="none";return{name:s,value:a,select:u,bind:c}})}:t}}function il(e,t){const{transform:n,...i}=e;if(n){const r=n.map(s=>{if(Wa(s))return{filter:wo(s,t)};if(Sd(s)&&Dn(s.bin))return{...s,bin:wd(s.bin)};if(xd(s)){const{selection:o,...a}=s.from;return o?{...s,from:{param:o,...a}}:s}return s});return{...i,transform:r}}return e}function Ed(e,t){var i,r;const n=j(e);if(w(n)&&Dn(n.bin)&&(n.bin=wd(n.bin)),Un(n)&&((r=(i=n.scale)==null?void 0:i.domain)!=null&&r.selection)){const{selection:s,...o}=n.scale.domain;n.scale.domain={...o,...s?{param:s}:{}}}if(fs(n))if(I(n.condition))n.condition=n.condition.map(s=>{const{selection:o,param:a,test:c,...l}=s;return a?s:{...l,test:wo(s,t)}});else{const{selection:s,param:o,test:a,...c}=Ed(n.condition,t);n.condition=o?n.condition:{...c,test:wo(n.condition,t)}}return n}function wd(e){const t=e.extent;if(t!=null&&t.selection){const{selection:n,...i}=t;return{...e,extent:{...i,param:n}}}return e}function wo(e,t){const n=i=>Jn(i,r=>{var c,l;var s;const o=(c=t.emptySelections[r])!=null?c:!0,a={param:r,empty:o};return(l=(s=t.selectionPredicates)[r])!=null||(s[r]=[]),t.selectionPredicates[r].push(a),a});return e.selection?n(e.selection):Jn(e.test||e.filter,i=>i.selection?n(i.selection):i)}class $o extends Ba{map(t,n){var r;const i=(r=n.selections)!=null?r:[];if(t.params&&!Mt(t)){const s=[];for(const o of t.params)ja(o)?i.push(o):s.push(o);t.params=s}return n.selections=i,super.map(t,n)}mapUnit(t,n){var o;const i=n.selections;if(!i||!i.length)return t;const r=((o=n.path)!=null?o:[]).concat(t.name),s=[];for(const a of i)if(!a.views||!a.views.length)s.push(a);else for(const c of a.views)(z(c)&&(c===t.name||r.includes(c))||I(c)&&c.map(l=>r.indexOf(l)).every((l,u,f)=>l!==-1&&(u===0||l>f[u-1])))&&s.push(a);return s.length&&(t.params=s),t}}for(const e of["mapFacet","mapRepeat","mapHConcat","mapVConcat","mapLayer"]){const t=$o.prototype[e];$o.prototype[e]=function(n,i){return t.call(this,n,Pv(n,i))}}function Pv(e,t){var n;return e.name?{...t,path:((n=t.path)!=null?n:[]).concat(e.name)}:t}function $d(e,t){t===void 0&&(t=hd(e.config));const n=Mv(e,t),{width:i,height:r}=e,s=Uv(n,{width:i,height:r,autosize:e.autosize},t);return{...n,...s?{autosize:s}:{}}}const zv=new gv,Dv=new Lv,jv=new $o;function Mv(e,t={}){const n={config:t};return jv.map(zv.map(Dv.map(e,n),n),n)}function rl(e){return z(e)?{type:e}:e!=null?e:{}}function Uv(e,t,n){let{width:i,height:r}=t;const s=Mt(e)||bs(e),o={};s?i=="container"&&r=="container"?(o.type="fit",o.contains="padding"):i=="container"?(o.type="fit-x",o.contains="padding"):r=="container"&&(o.type="fit-y",o.contains="padding"):(i=="container"&&(S(Tc("width")),i=void 0),r=="container"&&(S(Tc("height")),r=void 0));const a={type:"pad",...o,...n?rl(n.autosize):{},...rl(e.autosize)};if(a.type==="fit"&&!s&&(S(zh),a.type="pad"),i=="container"&&!(a.type=="fit"||a.type=="fit-x")&&S(Ac("width")),r=="container"&&!(a.type=="fit"||a.type=="fit-y")&&S(Ac("height")),!ft(a,{type:"pad"}))return a}function Bv(e){return e==="fit"||e==="fit-x"||e==="fit-y"}function Wv(e){return e?"fit-".concat(es(e)):"fit"}const Gv=["background","padding"];function sl(e,t){const n={};for(const i of Gv)e&&e[i]!==void 0&&(n[i]=ze(e[i]));return t&&(n.params=e.params),n}class Ut{constructor(t={},n={}){this.explicit=t,this.implicit=n}clone(){return new Ut(j(this.explicit),j(this.implicit))}combine(){return{...this.explicit,...this.implicit}}get(t){return de(this.explicit[t],this.implicit[t])}getWithExplicit(t){return this.explicit[t]!==void 0?{explicit:!0,value:this.explicit[t]}:this.implicit[t]!==void 0?{explicit:!1,value:this.implicit[t]}:{explicit:!1,value:void 0}}setWithExplicit(t,{value:n,explicit:i}){n!==void 0&&this.set(t,n,i)}set(t,n,i){return delete this[i?"implicit":"explicit"][t],this[i?"explicit":"implicit"][t]=n,this}copyKeyFromSplit(t,{explicit:n,implicit:i}){n[t]!==void 0?this.set(t,n[t],!0):i[t]!==void 0&&this.set(t,i[t],!1)}copyKeyFromObject(t,n){n[t]!==void 0&&this.set(t,n[t],!0)}copyAll(t){for(const n of x(t.combine())){const i=t.getWithExplicit(n);this.setWithExplicit(n,i)}}}function ut(e){return{explicit:!0,value:e}}function Pe(e){return{explicit:!1,value:e}}function Od(e){return(t,n,i,r)=>{const s=e(t.value,n.value);return s>0?t:s<0?n:vs(t,n,i,r)}}function vs(e,t,n,i){return e.explicit&&t.explicit&&S($m(n,i,e.value,t.value)),e}function Yt(e,t,n,i,r=vs){return e===void 0||e.value===void 0?t:e.explicit&&!t.explicit?e:t.explicit&&!e.explicit?t:ft(e.value,t.value)?e:r(e,t,n,i)}class Hv extends Ut{constructor(t={},n={},i=!1){super(t,n),this.explicit=t,this.implicit=n,this.parseNothing=i}clone(){const t=super.clone();return t.parseNothing=this.parseNothing,t}}function di(e){return"url"in e}function qi(e){return"values"in e}function Cd(e){return"name"in e&&!di(e)&&!qi(e)&&!Ht(e)}function Ht(e){return e&&(Nd(e)||_d(e)||Ga(e))}function Nd(e){return"sequence"in e}function _d(e){return"sphere"in e}function Ga(e){return"graticule"in e}var ee;(function(e){e[e.Raw=0]="Raw",e[e.Main=1]="Main",e[e.Row=2]="Row",e[e.Column=3]="Column",e[e.Lookup=4]="Lookup"})(ee||(ee={}));function Td(e){const{signals:t,hasLegend:n,index:i,...r}=e;return r.field=Be(r.field),r}function kn(e,t=!0,n=eg){if(I(e)){const i=e.map(r=>kn(r,t,n));return t?"[".concat(i.join(", "),"]"):i}else if(jn(e))return n(t?_n(e):Ym(e));return t?n(te(e)):e}function qv(e,t){var n;for(const i of Se((n=e.component.selection)!=null?n:{})){const r=i.name;let s="".concat(r).concat(Jt,", ").concat(i.resolve==="global"?"true":"{unit: ".concat(wn(e),"}"));for(const o of Ss)o.defined(i)&&(o.signals&&(t=o.signals(e,i,t)),o.modifyExpr&&(s=o.modifyExpr(e,i,s)));t.push({name:r+$x,on:[{events:{signal:i.name+Jt},update:"modify(".concat(B(i.name+In),", ").concat(s,")")}]})}return Ha(t)}function Xv(e,t){if(e.component.selection&&x(e.component.selection).length){const n=B(e.getName("cell"));t.unshift({name:"facet",value:{},on:[{events:vi("mousemove","scope"),update:"isTuple(facet) ? facet : group(".concat(n,").datum")}]})}return Ha(t)}function Vv(e,t){var i;let n=!1;for(const r of Se((i=e.component.selection)!=null?i:{})){const s=r.name,o=B(s+In);if(t.filter(c=>c.name===s).length===0){const c=r.resolve==="global"?"union":r.resolve,l=r.type==="point"?", true, true)":")";t.push({name:r.name,update:"".concat(qd,"(").concat(o,", ").concat(B(c)).concat(l)})}n=!0;for(const c of Ss)c.defined(r)&&c.topLevelSignals&&(t=c.topLevelSignals(e,r,t))}return n&&t.filter(s=>s.name==="unit").length===0&&t.unshift({name:"unit",value:{},on:[{events:"mousemove",update:"isTuple(group()) ? group() : unit"}]}),Ha(t)}function Yv(e,t){var r;const n=[...t],i=wn(e,{escape:!1});for(const s of Se((r=e.component.selection)!=null?r:{})){const o={name:s.name+In};if(s.project.hasSelectionId&&(o.transform=[{type:"collect",sort:{field:tt}}]),s.init){const c=s.project.items.map(Td);o.values=s.project.hasSelectionId?s.init.map(l=>({unit:i,[tt]:kn(l,!1)[0]})):s.init.map(l=>({unit:i,fields:c,values:kn(l,!1)}))}n.filter(c=>c.name===s.name+In).length||n.push(o)}return n}function Ad(e,t){var n;for(const i of Se((n=e.component.selection)!=null?n:{}))for(const r of Ss)r.defined(i)&&r.marks&&(t=r.marks(e,i,t));return t}function Kv(e,t){for(const n of e.children)ce(n)&&(t=Ad(n,t));return t}function Jv(e,t,n,i){const r=Jd(e,t.param,t);return{signal:je(n.get("type"))&&I(i)&&i[0]>i[1]?"isValid(".concat(r,") && reverse(").concat(r,")"):r}}function Ha(e){return e.map(t=>(t.on&&!t.on.length&&delete t.on,t))}class J{constructor(t,n){this.debugName=n,this._children=[],this._parent=null,t&&(this.parent=t)}clone(){throw new Error("Cannot clone node")}get parent(){return this._parent}set parent(t){this._parent=t,t&&t.addChild(this)}get children(){return this._children}numChildren(){return this._children.length}addChild(t,n){if(this._children.includes(t)){S(Kh);return}n!==void 0?this._children.splice(n,0,t):this._children.push(t)}removeChild(t){const n=this._children.indexOf(t);return this._children.splice(n,1),n}remove(){let t=this._parent.removeChild(this);for(const n of this._children)n._parent=this._parent,this._parent.addChild(n,t++)}insertAsParentOf(t){const n=t.parent;n.removeChild(this),this.parent=n,t.parent=this}swapWithParent(){const t=this._parent,n=t.parent;for(const r of this._children)r.parent=t;this._children=[],t.removeChild(this);const i=t.parent.removeChild(t);this._parent=n,n.addChild(this,i),t.parent=this}}class Oe extends J{clone(){const t=new this.constructor;return t.debugName="clone_".concat(this.debugName),t._source=this._source,t._name="clone_".concat(this._name),t.type=this.type,t.refCounts=this.refCounts,t.refCounts[t._name]=0,t}constructor(t,n,i,r){super(t,n),this.type=i,this.refCounts=r,this._source=this._name=n,this.refCounts&&!(this._name in this.refCounts)&&(this.refCounts[this._name]=0)}dependentFields(){return new Set}producedFields(){return new Set}hash(){return this._hash===void 0&&(this._hash="Output ".concat($u())),this._hash}getSource(){return this.refCounts[this._name]++,this._source}isRequired(){return!!this.refCounts[this._name]}setSource(t){this._source=t}}function Gs(e){return e.as!==void 0}function ol(e){return"".concat(e,"_end")}class gt extends J{clone(){return new gt(null,j(this.formula))}constructor(t,n){super(t),this.formula=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s)=>{const{field:o,timeUnit:a}=s;if(a){let c;if(Mn(a)){if(ce(n)){const{mark:l}=n;(Sa(l)||s.bandPosition)&&(c={timeUnit:me(a),field:o})}}else c={as:C(s,{forAs:!0}),field:o,timeUnit:a};c&&(r[W(c)]=c)}return r},{});return Q(i)?null:new gt(t,i)}static makeFromTransform(t,n){const{timeUnit:i,...r}={...n},s=me(i),o={...r,timeUnit:s};return new gt(t,{[W(o)]:o})}merge(t){this.formula={...this.formula};for(const n in t.formula)this.formula[n]||(this.formula[n]=t.formula[n]);for(const n of t.children)t.removeChild(n),n.parent=this;t.remove()}removeFormulas(t){const n={};for(const[i,r]of Xt(this.formula)){const s=Gs(r)?r.as:"".concat(r.field,"_end");t.has(s)||(n[i]=r)}this.formula=n}producedFields(){return new Set(Se(this.formula).map(t=>Gs(t)?t.as:ol(t.field)))}dependentFields(){return new Set(Se(this.formula).map(t=>t.field))}hash(){return"TimeUnit ".concat(W(this.formula))}assemble(){const t=[];for(const n of Se(this.formula))if(Gs(n)){const{field:i,as:r,timeUnit:s}=n,{unit:o,utc:a,...c}=me(s);t.push({field:Be(i),type:"timeunit",...o?{units:rs(o)}:{},...a?{timezone:"utc"}:{},...c,as:[r,"".concat(r,"_end")]})}else if(n){const{field:i,timeUnit:r}=n,s=cf(r==null?void 0:r.unit),{part:o,step:a}=df(s,r.step);t.push({type:"formula",expr:"timeOffset('".concat(o,"', datum['").concat(i,"'], ").concat(a,")"),as:ol(i)})}return t}}const lr="_tuple_fields";class Qv{constructor(...t){this.items=t,this.hasChannel={},this.hasField={},this.hasSelectionId=!1}}const Zv={defined:()=>!0,parse:(e,t,n)=>{var g;const i=t.name,r=(g=t.project)!=null?g:t.project=new Qv,s={},o={},a=new Set,c=(h,m)=>{const y=m==="visual"?h.channel:h.field;let b=se("".concat(i,"_").concat(y));for(let N=1;a.has(b);N++)b=se("".concat(i,"_").concat(y,"_").concat(N));return a.add(b),{[m]:b}},l=t.type,u=e.config.selection[l],f=n.value!==void 0?le(n.value):null;let{fields:d,encodings:p}=X(n.select)?n.select:{};if(!d&&!p&&f){for(const h of f)if(X(h))for(const m of x(h))ph(m)?(p||(p=[])).push(m):l==="interval"?(S(qh),p=u.encodings):(d!=null?d:d=[]).push(m)}!d&&!p&&(p=u.encodings,"fields"in u&&(d=u.fields));for(const h of p!=null?p:[]){const m=e.fieldDef(h);if(m){let y=m.field;if(m.aggregate){S(Dh(h,m.aggregate));continue}else if(!y){S(kc(h));continue}if(m.timeUnit&&!Mn(m.timeUnit)){y=e.vgField(h);const b={timeUnit:m.timeUnit,as:y,field:m.field};o[W(b)]=b}if(!s[y]){const b=l==="interval"&&jt(h)&&je(e.getScaleComponent(h).get("type"))?"R":m.bin?"R-RE":"E",N={field:y,channel:h,type:b,index:r.items.length};N.signals={...c(N,"data"),...c(N,"visual")},r.items.push(s[y]=N),r.hasField[y]=s[y],r.hasSelectionId=r.hasSelectionId||y===tt,Au(h)?(N.geoChannel=h,N.channel=Tu(h),r.hasChannel[N.channel]=s[y]):r.hasChannel[h]=s[y]}}else S(kc(h))}for(const h of d!=null?d:[]){if(r.hasField[h])continue;const m={type:"E",field:h,index:r.items.length};m.signals={...c(m,"data")},r.items.push(m),r.hasField[h]=m,r.hasSelectionId=r.hasSelectionId||h===tt}f&&(t.init=f.map(h=>r.items.map(m=>X(h)?h[m.geoChannel||m.channel]!==void 0?h[m.geoChannel||m.channel]:h[m.field]:h))),Q(o)||(r.timeUnit=new gt(null,o))},signals:(e,t,n)=>{const i=t.name+lr;return n.filter(s=>s.name===i).length>0||t.project.hasSelectionId?n:n.concat({name:i,value:t.project.items.map(Td)})}},Ft={defined:e=>e.type==="interval"&&e.resolve==="global"&&e.bind&&e.bind==="scales",parse:(e,t)=>{const n=t.scales=[];for(const i of t.project.items){const r=i.channel;if(!jt(r))continue;const s=e.getScaleComponent(r),o=s?s.get("type"):void 0;if(!s||!je(o)){S(Uh);continue}s.set("selectionExtent",{param:t.name,field:i.field},!0),n.push(i)}},topLevelSignals:(e,t,n)=>{const i=t.scales.filter(o=>n.filter(a=>a.name===o.signals.data).length===0);if(!e.parent||al(e)||i.length===0)return n;const r=n.filter(o=>o.name===t.name)[0];let s=r.update;if(s.indexOf(qd)>=0)r.update="{".concat(i.map(o=>"".concat(B(Be(o.field)),": ").concat(o.signals.data)).join(", "),"}");else{for(const o of i){const a="".concat(B(Be(o.field)),": ").concat(o.signals.data);s.includes(a)||(s="".concat(s.substring(0,s.length-1),", ").concat(a,"}"))}r.update=s}return n.concat(i.map(o=>({name:o.signals.data})))},signals:(e,t,n)=>{if(e.parent&&!al(e))for(const i of t.scales){const r=n.filter(s=>s.name===i.signals.data)[0];r.push="outer",delete r.value,delete r.update}return n}};function Oo(e,t){const n=B(e.scaleName(t));return"domain(".concat(n,")")}function al(e){return e.parent&&Ni(e.parent)&&!e.parent.parent}const ei="_brush",Fd="_scale_trigger",Ai="geo_interval_init_tick",kd="_init",ex="_center",tx={defined:e=>e.type==="interval",parse:(e,t,n)=>{var r;var i;if(e.hasProjection){const s={...X(n.select)?n.select:{}};s.fields=[tt],s.encodings||(s.encodings=n.value?x(n.value):[st,rt]),n.select={type:"interval",...s}}if(t.translate&&!Ft.defined(t)){const s="!event.item || event.item.mark.name !== ".concat(B(t.name+ei));for(const o of t.events){if(!o.between){S("".concat(o," is not an ordered event stream for interval selections."));continue}const a=le((r=(i=o.between[0]).filter)!=null?r:i.filter=[]);a.indexOf(s)<0&&a.push(s)}}},signals:(e,t,n)=>{const i=t.name,r=i+Jt,s=Se(t.project.hasChannel).filter(a=>a.channel===oe||a.channel===ye),o=t.init?t.init[0]:null;if(n.push(...s.reduce((a,c)=>a.concat(nx(e,t,c,o&&o[c.index])),[])),e.hasProjection){const a=B(e.projectionName()),c=e.projectionName()+ex,{x:l,y:u}=t.project.hasChannel,f=l&&l.signals.visual,d=u&&u.signals.visual,p=l?o&&o[l.index]:"".concat(c,"[0]"),g=u?o&&o[u.index]:"".concat(c,"[1]"),h=$=>e.getSizeSignalRef($).signal,m="["+"[".concat(f?f+"[0]":"0",", ").concat(d?d+"[0]":"0","],")+"[".concat(f?f+"[1]":h("width"),", ")+"".concat(d?d+"[1]":h("height"),"]")+"]";o&&(n.unshift({name:i+kd,init:"[scale(".concat(a,", [").concat(l?p[0]:p,", ").concat(u?g[0]:g,"]), ")+"scale(".concat(a,", [").concat(l?p[1]:p,", ").concat(u?g[1]:g,"])]")}),(!l||!u)&&(n.find(P=>P.name===c)||n.unshift({name:c,update:"invert(".concat(a,", [").concat(h("width"),"/2, ").concat(h("height"),"/2])")})));const y="intersect(".concat(m,", {markname: ").concat(B(e.getName("marks")),"}, unit.mark)"),b="{unit: ".concat(wn(e),"}"),N="vlSelectionTuples(".concat(y,", ").concat(b,")"),_=s.map($=>$.signals.visual);return n.concat({name:r,on:[{events:[..._.length?[{signal:_.join(" || ")}]:[],...o?[{signal:Ai}]:[]],update:N}]})}else{if(!Ft.defined(t)){const l=i+Fd,u=s.map(f=>{const d=f.channel,{data:p,visual:g}=f.signals,h=B(e.scaleName(d)),m=e.getScaleComponent(d).get("type"),y=je(m)?"+":"";return"(!isArray(".concat(p,") || ")+"(".concat(y,"invert(").concat(h,", ").concat(g,")[0] === ").concat(y).concat(p,"[0] && ")+"".concat(y,"invert(").concat(h,", ").concat(g,")[1] === ").concat(y).concat(p,"[1]))")});u.length&&n.push({name:l,value:{},on:[{events:s.map(f=>({scale:e.scaleName(f.channel)})),update:u.join(" && ")+" ? ".concat(l," : {}")}]})}const a=s.map(l=>l.signals.data),c="unit: ".concat(wn(e),", fields: ").concat(i+lr,", values");return n.concat({name:r,...o?{init:"{".concat(c,": ").concat(kn(o),"}")}:{},...a.length?{on:[{events:[{signal:a.join(" || ")}],update:"".concat(a.join(" && ")," ? {").concat(c,": [").concat(a,"]} : null")}]}:{}})}},topLevelSignals:(e,t,n)=>(ce(e)&&e.hasProjection&&t.init&&(n.filter(r=>r.name===Ai).length||n.unshift({name:Ai,value:null,on:[{events:"timer{1}",update:"".concat(Ai," === null ? {} : ").concat(Ai)}]})),n),marks:(e,t,n)=>{const i=t.name,{x:r,y:s}=t.project.hasChannel,o=r==null?void 0:r.signals.visual,a=s==null?void 0:s.signals.visual,c="data(".concat(B(t.name+In),")");if(Ft.defined(t)||!r&&!s)return n;const l={x:r!==void 0?{signal:"".concat(o,"[0]")}:{value:0},y:s!==void 0?{signal:"".concat(a,"[0]")}:{value:0},x2:r!==void 0?{signal:"".concat(o,"[1]")}:{field:{group:"width"}},y2:s!==void 0?{signal:"".concat(a,"[1]")}:{field:{group:"height"}}};if(t.resolve==="global")for(const h of x(l))l[h]=[{test:"".concat(c,".length && ").concat(c,"[0].unit === ").concat(wn(e)),...l[h]},{value:0}];const{fill:u,fillOpacity:f,cursor:d,...p}=t.mark,g=x(p).reduce((h,m)=>(h[m]=[{test:[r!==void 0&&"".concat(o,"[0] !== ").concat(o,"[1]"),s!==void 0&&"".concat(a,"[0] !== ").concat(a,"[1]")].filter(y=>y).join(" && "),value:p[m]},{value:null}],h),{});return[{name:"".concat(i+ei,"_bg"),type:"rect",clip:!0,encode:{enter:{fill:{value:u},fillOpacity:{value:f}},update:l}},...n,{name:i+ei,type:"rect",clip:!0,encode:{enter:{...d?{cursor:{value:d}}:{},fill:{value:"transparent"}},update:{...l,...g}}}]}};function nx(e,t,n,i){const r=!e.hasProjection,s=n.channel,o=n.signals.visual,a=B(r?e.scaleName(s):e.projectionName()),c=d=>"scale(".concat(a,", ").concat(d,")"),l=e.getSizeSignalRef(s===oe?"width":"height").signal,u="".concat(s,"(unit)"),f=t.events.reduce((d,p)=>[...d,{events:p.between[0],update:"[".concat(u,", ").concat(u,"]")},{events:p,update:"[".concat(o,"[0], clamp(").concat(u,", 0, ").concat(l,")]")}],[]);if(r){const d=n.signals.data,p=Ft.defined(t),g=e.getScaleComponent(s),h=g?g.get("type"):void 0,m=i?{init:kn(i,!0,c)}:{value:[]};return f.push({events:{signal:t.name+Fd},update:je(h)?"[".concat(c("".concat(d,"[0]")),", ").concat(c("".concat(d,"[1]")),"]"):"[0, 0]"}),p?[{name:d,on:[]}]:[{name:o,...m,on:f},{name:d,...i?{init:kn(i)}:{},on:[{events:{signal:o},update:"".concat(o,"[0] === ").concat(o,"[1] ? null : invert(").concat(a,", ").concat(o,")")}]}]}else{const d=s===oe?0:1,p=t.name+kd,g=i?{init:"[".concat(p,"[0][").concat(d,"], ").concat(p,"[1][").concat(d,"]]")}:{value:[]};return[{name:o,...g,on:f}]}}const ix={defined:e=>e.type==="point",signals:(e,t,n)=>{var f;const i=t.name,r=i+lr,s=t.project,o="(item().isVoronoi ? datum.datum : datum)",a=Se((f=e.component.selection)!=null?f:{}).reduce((d,p)=>p.type==="interval"?d.concat(p.name+ei):d,[]).map(d=>"indexof(item().mark.name, '".concat(d,"') < 0")).join(" && "),c="datum && item().mark.marktype !== 'group' && indexof(item().mark.role, 'legend') < 0".concat(a?" && ".concat(a):"");let l="unit: ".concat(wn(e),", ");if(t.project.hasSelectionId)l+="".concat(tt,": ").concat(o,"[").concat(B(tt),"]");else{const d=s.items.map(p=>{const g=e.fieldDef(p.channel);return g!=null&&g.bin?"[".concat(o,"[").concat(B(e.vgField(p.channel,{})),"], ")+"".concat(o,"[").concat(B(e.vgField(p.channel,{binSuffix:"end"})),"]]"):"".concat(o,"[").concat(B(p.field),"]")}).join(", ");l+="fields: ".concat(r,", values: [").concat(d,"]")}const u=t.events;return n.concat([{name:i+Jt,on:u?[{events:u,update:"".concat(c," ? {").concat(l,"} : null"),force:!0}]:[]}])}};function wi(e,t,n,i){const r=fs(t)&&t.condition,s=i(t);if(r){const a=le(r).map(c=>{const l=i(c);if(Xy(c)){const{param:u,empty:f}=c;return{test:Kd(e,{param:u,empty:f}),...l}}else return{test:Ur(e,c.test),...l}});return{[n]:[...a,...s!==void 0?[s]:[]]}}else return s!==void 0?{[n]:s}:{}}function qa(e,t="text"){const n=e.encoding[t];return wi(e,n,t,i=>xs(i,e.config))}function xs(e,t,n="datum"){if(e){if(et(e))return re(e.value);if(M(e)){const{format:i,formatType:r}=Rr(e);return Oa({fieldOrDatumDef:e,format:i,formatType:r,expr:n,config:t})}}}function Id(e,t={}){const{encoding:n,markDef:i,config:r,stack:s}=e,o=n.tooltip;if(I(o))return{tooltip:cl({tooltip:o},s,r,t)};{const a=t.reactiveGeom?"datum.datum":"datum";return wi(e,o,"tooltip",c=>{const l=xs(c,r,a);if(l)return l;if(c===null)return;let u=K("tooltip",i,r);if(u===!0&&(u={content:"encoding"}),z(u))return{value:u};if(X(u))return R(u)?u:u.content==="encoding"?cl(n,s,r,t):{signal:a}})}}function Rd(e,t,n,{reactiveGeom:i}={}){const r={...n,...n.tooltipFormat},s={},o=i?"datum.datum":"datum",a=[];function c(u,f){const d=zn(f),p=Ce(u)?u:{...u,type:e[d].type},g=p.title||Ta(p,r),h=le(g).join(", ").replaceAll(/"/g,'\\"');let m;if(be(f)){const y=f==="x"?"x2":"y2",b=yt(e[y]);if(xe(p.bin)&&b){const N=C(p,{expr:o}),_=C(b,{expr:o}),{format:$,formatType:P}=Rr(p);m=rr(N,_,$,P,r),s[y]=!0}}if((be(f)||f===Ge||f===it)&&t&&t.fieldChannel===f&&t.offset==="normalize"){const{format:y,formatType:b}=Rr(p);m=Oa({fieldOrDatumDef:p,format:y,formatType:b,expr:o,config:r,normalizeStack:!0}).signal}m!=null||(m=xs(p,r,o).signal),a.push({channel:f,key:h,value:m})}ka(e,(u,f)=>{w(u)?c(u,f):ds(u)&&c(u.condition,f)});const l={};for(const{channel:u,key:f,value:d}of a)!s[u]&&!l[f]&&(l[f]=d);return l}function cl(e,t,n,{reactiveGeom:i}={}){const r=Rd(e,t,n,{reactiveGeom:i}),s=Xt(r).map(([o,a])=>'"'.concat(o,'": ').concat(a));return s.length>0?{signal:"{".concat(s.join(", "),"}")}:void 0}function rx(e){const{markDef:t,config:n}=e,i=K("aria",t,n);return i===!1?{}:{...i?{aria:i}:{},...sx(e),...ox(e)}}function sx(e){const{mark:t,markDef:n,config:i}=e;if(i.aria===!1)return{};const r=K("ariaRoleDescription",n,i);return r!=null?{ariaRoleDescription:{value:r}}:t in Rh?{}:{ariaRoleDescription:{value:t}}}function ox(e){const{encoding:t,markDef:n,config:i,stack:r}=e,s=t.description;if(s)return wi(e,s,"description",c=>xs(c,e.config));const o=K("description",n,i);if(o!=null)return{description:re(o)};if(i.aria===!1)return{};const a=Rd(t,r,i);if(!Q(a))return{description:{signal:Xt(a).map(([c,l],u)=>'"'.concat(u>0?"; ":"").concat(c,': " + (').concat(l,")")).join(" + ")}}}function he(e,t,n={}){const{markDef:i,encoding:r,config:s}=t,{vgChannel:o}=n;let{defaultRef:a,defaultValue:c}=n;a===void 0&&(c!=null||(c=K(e,i,s,{vgChannel:o,ignoreVgConfig:!0})),c!==void 0&&(a=re(c)));const l=r[e];return wi(t,l,o!=null?o:e,u=>$a({channel:e,channelDef:u,markDef:i,config:s,scaleName:t.scaleName(e),scale:t.getScaleComponent(e),stack:null,defaultRef:a}))}function Ld(e,t={filled:void 0}){var d,p,g,h;const{markDef:n,encoding:i,config:r}=e,{type:s}=n,o=(d=t.filled)!=null?d:K("filled",n,r),a=G(["bar","point","circle","square","geoshape"],s)?"transparent":void 0,c=(g=(p=K(o===!0?"color":void 0,n,r,{vgChannel:"fill"}))!=null?p:r.mark[o===!0&&"color"])!=null?g:a,l=(h=K(o===!1?"color":void 0,n,r,{vgChannel:"stroke"}))!=null?h:r.mark[o===!1&&"color"],u=o?"fill":"stroke",f={...c?{fill:re(c)}:{},...l?{stroke:re(l)}:{}};return n.color&&(o?n.fill:n.stroke)&&S(Qu("property",{fill:"fill"in n,stroke:"stroke"in n})),{...f,...he("color",e,{vgChannel:u,defaultValue:o?c:l}),...he("fill",e,{defaultValue:i.fill?c:void 0}),...he("stroke",e,{defaultValue:i.stroke?l:void 0})}}function ax(e){const{encoding:t,mark:n}=e,i=t.order;return!an(n)&&et(i)?wi(e,i,"zindex",r=>re(r.value)):{}}function pi({channel:e,markDef:t,encoding:n={},model:i,bandPosition:r}){const s="".concat(e,"Offset"),o=t[s],a=n[s];if((s==="xOffset"||s==="yOffset")&&a)return{offsetType:"encoding",offset:$a({channel:s,channelDef:a,markDef:t,config:i==null?void 0:i.config,scaleName:i.scaleName(s),scale:i.getScaleComponent(s),stack:null,defaultRef:re(o),bandPosition:r})};const c=t[s];return c?{offsetType:"visual",offset:c}:{}}function we(e,t,{defaultPos:n,vgChannel:i}){const{encoding:r,markDef:s,config:o,stack:a}=t,c=r[e],l=r[Et(e)],u=t.scaleName(e),f=t.getScaleComponent(e),{offset:d,offsetType:p}=pi({channel:e,markDef:s,encoding:r,model:t,bandPosition:.5}),g=Xa({model:t,defaultPos:n,channel:e,scaleName:u,scale:f}),h=!c&&be(e)&&(r.latitude||r.longitude)?{field:t.getName(e)}:cx({channel:e,channelDef:c,channel2Def:l,markDef:s,config:o,scaleName:u,scale:f,stack:a,offset:d,defaultRef:g,bandPosition:p==="encoding"?0:void 0});return h?{[i||e]:h}:void 0}function cx(e){const{channel:t,channelDef:n,scaleName:i,stack:r,offset:s,markDef:o}=e;if(M(n)&&r&&t===r.fieldChannel){if(w(n)){let a=n.bandPosition;if(a===void 0&&o.type==="text"&&(t==="radius"||t==="theta")&&(a=.5),a!==void 0)return Fr({scaleName:i,fieldOrDatumDef:n,startSuffix:"start",bandPosition:a,offset:s})}return Sn(n,i,{suffix:"end"},{offset:s})}return Ea(e)}function Xa({model:e,defaultPos:t,channel:n,scaleName:i,scale:r}){const{markDef:s,config:o}=e;return()=>{const a=zn(n),c=Vt(n),l=K(n,s,o,{vgChannel:c});if(l!==void 0)return Mi(n,l);switch(t){case"zeroOrMin":case"zeroOrMax":if(i){const u=r.get("type");if(!G([Fe.LOG,Fe.TIME,Fe.UTC],u)){if(r.domainDefinitelyIncludesZero())return{scale:i,value:0}}}if(t==="zeroOrMin")return a==="y"?{field:{group:"height"}}:{value:0};switch(a){case"radius":return{signal:"min(".concat(e.width.signal,",").concat(e.height.signal,")/2")};case"theta":return{signal:"2*PI"};case"x":return{field:{group:"width"}};case"y":return{value:0}}break;case"mid":return{...e[Le(n)],mult:.5}}}}const lx={left:"x",center:"xc",right:"x2"},ux={top:"y",middle:"yc",bottom:"y2"};function Pd(e,t,n,i="middle"){if(e==="radius"||e==="theta")return Vt(e);const r=e==="x"?"align":"baseline",s=K(r,t,n);let o;return R(s)?(S(pm(r)),o=void 0):o=s,e==="x"?lx[o||(i==="top"?"left":"center")]:ux[o||i]}function jr(e,t,{defaultPos:n,defaultPos2:i,range:r}){return r?zd(e,t,{defaultPos:n,defaultPos2:i}):we(e,t,{defaultPos:n})}function zd(e,t,{defaultPos:n,defaultPos2:i}){const{markDef:r,config:s}=t,o=Et(e),a=Le(e),c=fx(t,i,o),l=c[a]?Pd(e,r,s):Vt(e);return{...we(e,t,{defaultPos:n,vgChannel:l}),...c}}function fx(e,t,n){const{encoding:i,mark:r,markDef:s,stack:o,config:a}=e,c=zn(n),l=Le(n),u=Vt(n),f=i[c],d=e.scaleName(c),p=e.getScaleComponent(c),{offset:g}=n in i||n in s?pi({channel:n,markDef:s,encoding:i,model:e}):pi({channel:c,markDef:s,encoding:i,model:e});if(!f&&(n==="x2"||n==="y2")&&(i.latitude||i.longitude)){const m=Le(n),y=e.markDef[m];return y!=null?{[m]:{value:y}}:{[u]:{field:e.getName(n)}}}const h=dx({channel:n,channelDef:f,channel2Def:i[n],markDef:s,config:a,scaleName:d,scale:p,stack:o,offset:g,defaultRef:void 0});return h!==void 0?{[u]:h}:gr(n,s)||gr(n,{[n]:_r(n,s,a.style),[l]:_r(l,s,a.style)})||gr(n,a[r])||gr(n,a.mark)||{[u]:Xa({model:e,defaultPos:t,channel:n,scaleName:d,scale:p})()}}function dx({channel:e,channelDef:t,channel2Def:n,markDef:i,config:r,scaleName:s,scale:o,stack:a,offset:c,defaultRef:l}){return M(t)&&a&&e.charAt(0)===a.fieldChannel.charAt(0)?Sn(t,s,{suffix:"start"},{offset:c}):Ea({channel:e,channelDef:n,scaleName:s,scale:o,stack:a,markDef:i,config:r,offset:c,defaultRef:l})}function gr(e,t){const n=Le(e),i=Vt(e);if(t[i]!==void 0)return{[i]:Mi(e,t[i])};if(t[e]!==void 0)return{[i]:Mi(e,t[e])};if(t[n]){const r=t[n];if(An(r))S(om(n));else return{[n]:Mi(e,r)}}}function Kt(e,t){var m,y;const{config:n,encoding:i,markDef:r}=e,s=r.type,o=Et(t),a=Le(t),c=i[t],l=i[o],u=e.getScaleComponent(t),f=u?u.get("type"):void 0,d=r.orient,p=(y=(m=i[a])!=null?m:i.size)!=null?y:K("size",r,n,{vgChannel:a}),g=Ru(t),h=s==="bar"&&(t==="x"?d==="vertical":d==="horizontal");return w(c)&&(ne(c.bin)||xe(c.bin)||c.timeUnit&&!l)&&!(p&&!An(p))&&!i[g]&&!ve(f)?hx({fieldDef:c,fieldDef2:l,channel:t,model:e}):(M(c)&&ve(f)||h)&&!l?gx(c,t,e):zd(t,e,{defaultPos:"zeroOrMax",defaultPos2:"zeroOrMin"})}function px(e,t,n,i,r,s,o){if(An(r))if(n){const c=n.get("type");if(c==="band"){let l="bandwidth('".concat(t,"')");r.band!==1&&(l="".concat(r.band," * ").concat(l));const u=Rt("minBandSize",{type:o},i);return{signal:u?"max(".concat(Ye(u),", ").concat(l,")"):l}}else r.band!==1&&(S(ym(c)),r=void 0)}else return{mult:r.band,field:{group:e}};else{if(R(r))return r;if(r)return{value:r}}if(n){const c=n.get("range");if(on(c)&&fe(c.step))return{value:c.step-2}}if(!s){const{bandPaddingInner:c,barBandPaddingInner:l,rectBandPaddingInner:u}=i.scale,f=de(c,o==="bar"?l:u);if(R(f))return{signal:"(1 - (".concat(f.signal,")) * ").concat(e)};if(fe(f))return{signal:"".concat(1-f," * ").concat(e)}}return{value:zr(i.view,e)-2}}function gx(e,t,n){const{markDef:i,encoding:r,config:s,stack:o}=n,a=i.orient,c=n.scaleName(t),l=n.getScaleComponent(t),u=Le(t),f=Et(t),d=Ru(t),p=n.scaleName(d),g=n.getScaleComponent(Qo(t)),h=a==="horizontal"&&t==="y"||a==="vertical"&&t==="x";let m;(r.size||i.size)&&(h?m=he("size",n,{vgChannel:u,defaultRef:re(i.size)}):S(Sm(i.type)));const y=!!m,b=Lf({channel:t,fieldDef:e,markDef:i,config:s,scaleType:l==null?void 0:l.get("type"),useVlSizeChannel:h});m=m||{[u]:px(u,p||c,g||l,s,b,!!e,i.type)};const N=(l==null?void 0:l.get("type"))==="band"&&An(b)&&!y?"top":"middle",_=Pd(t,i,s,N),$=_==="xc"||_==="yc",{offset:P,offsetType:F}=pi({channel:t,markDef:i,encoding:r,model:n,bandPosition:$?.5:0}),L=Ea({channel:t,channelDef:e,markDef:i,config:s,scaleName:c,scale:l,stack:o,offset:P,defaultRef:Xa({model:n,defaultPos:"mid",channel:t,scaleName:c,scale:l}),bandPosition:$?F==="encoding"?0:.5:R(b)?{signal:"(1-".concat(b,")/2")}:An(b)?(1-b.band)/2:0});if(u)return{[_]:L,...m};{const H=Vt(f),Y=m[u],ue=P?{...Y,offset:P}:Y;return{[_]:L,[H]:I(L)?[L[0],{...L[1],offset:ue}]:{...L,offset:ue}}}}function ll(e,t,n,i,r,s,o){if(_u(e))return 0;const a=e==="x"||e==="y2",c=a?-t/2:t/2;if(R(n)||R(r)||R(i)||s){const l=Ye(n),u=Ye(r),f=Ye(i),d=Ye(s),p=a?"":"-",g=s?"(".concat(o," < ").concat(d," ? ").concat(p,"0.5 * (").concat(d," - (").concat(o,")) : ").concat(c,")"):c,h=f?"".concat(f," + "):"",m=l?"(".concat(l," ? -1 : 1) * "):"",y=u?"(".concat(u," + ").concat(g,")"):g;return{signal:h+m+y}}else return r=r||0,i+(n?-r-c:+r+c)}function hx({fieldDef:e,fieldDef2:t,channel:n,model:i}){var H,Y,ue;const{config:r,markDef:s,encoding:o}=i,a=i.getScaleComponent(n),c=i.scaleName(n),l=a?a.get("type"):void 0,u=a.get("reverse"),f=Lf({channel:n,fieldDef:e,markDef:s,config:r,scaleType:l}),d=(H=i.component.axes[n])==null?void 0:H[0],p=(Y=d==null?void 0:d.get("translate"))!=null?Y:.5,g=be(n)&&(ue=K("binSpacing",s,r))!=null?ue:0,h=Et(n),m=Vt(n),y=Vt(h),b=Rt("minBandSize",s,r),{offset:N}=pi({channel:n,markDef:s,encoding:o,model:i,bandPosition:0}),{offset:_}=pi({channel:h,markDef:s,encoding:o,model:i,bandPosition:0}),$=By({fieldDef:e,scaleName:c}),P=ll(n,g,u,p,N,b,$),F=ll(h,g,u,p,_!=null?_:N,b,$),L=R(f)?{signal:"(1-".concat(f.signal,")/2")}:An(f)?(1-f.band)/2:.5;if(ne(e.bin)||e.timeUnit)return{[y]:ul({fieldDef:e,scaleName:c,bandPosition:L,offset:F}),[m]:ul({fieldDef:e,scaleName:c,bandPosition:R(L)?{signal:"1-".concat(L.signal)}:1-L,offset:P})};if(xe(e.bin)){const _e=Sn(e,c,{},{offset:F});if(w(t))return{[y]:_e,[m]:Sn(t,c,{},{offset:P})};if(Dn(e.bin)&&e.bin.step)return{[y]:_e,[m]:{signal:'scale("'.concat(c,'", ').concat(C(e,{expr:"datum"})," + ").concat(e.bin.step,")"),offset:P}}}S(tf(h))}function ul({fieldDef:e,scaleName:t,bandPosition:n,offset:i}){return Fr({scaleName:t,fieldOrDatumDef:e,bandPosition:n,offset:i})}const mx=new Set(["aria","width","height"]);function He(e,t){const{fill:n=void 0,stroke:i=void 0}=t.color==="include"?Ld(e):{};return{...yx(e.markDef,t),...fl(e,"fill",n),...fl(e,"stroke",i),...he("opacity",e),...he("fillOpacity",e),...he("strokeOpacity",e),...he("strokeWidth",e),...he("strokeDash",e),...ax(e),...Id(e),...qa(e,"href"),...rx(e)}}function fl(e,t,n){const{config:i,mark:r,markDef:s}=e;if(K("invalid",s,i)==="hide"&&n&&!an(r)){const a=bx(e,{invalid:!0,channels:ts});if(a)return{[t]:[{test:a,value:null},...le(n)]}}return n?{[t]:n}:{}}function yx(e,t){return Ih.reduce((n,i)=>(!mx.has(i)&&e[i]!==void 0&&t[i]!=="ignore"&&(n[i]=re(e[i])),n),{})}function bx(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{const a=e.getScaleComponent(o);if(a){const c=a.get("type"),l=e.vgField(o,{expr:"datum"});l&&je(c)&&(s[l]=!0)}return s},{}),r=x(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>wa(o,t)).join(" ".concat(s," "))}}function Va(e){const{config:t,markDef:n}=e;if(K("invalid",n,t)){const r=vx(e,{channels:wt});if(r)return{defined:{signal:r}}}return{}}function vx(e,{invalid:t=!1,channels:n}){const i=n.reduce((s,o)=>{var c;const a=e.getScaleComponent(o);if(a){const l=a.get("type"),u=e.vgField(o,{expr:"datum",binSuffix:(c=e.stack)!=null&&c.impute?"mid":void 0});u&&je(l)&&(s[u]=!0)}return s},{}),r=x(i);if(r.length>0){const s=t?"||":"&&";return r.map(o=>wa(o,t)).join(" ".concat(s," "))}}function dl(e,t){if(t!==void 0)return{[e]:re(t)}}const Hs="voronoi",Dd={defined:e=>e.type==="point"&&e.nearest,parse:(e,t)=>{if(t.events)for(const n of t.events)n.markname=e.getName(Hs)},marks:(e,t,n)=>{const{x:i,y:r}=t.project.hasChannel,s=e.mark;if(an(s))return S(jh(s)),n;const o={name:e.getName(Hs),type:"path",interactive:!0,from:{data:e.getName("marks")},encode:{update:{fill:{value:"transparent"},strokeWidth:{value:.35},stroke:{value:"transparent"},isVoronoi:{value:!0},...Id(e,{reactiveGeom:!0})}},transform:[{type:"voronoi",x:{expr:i||!r?"datum.datum.x || 0":"0"},y:{expr:r||!i?"datum.datum.y || 0":"0"},size:[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]}]};let a=0,c=!1;return n.forEach((l,u)=>{var d;const f=(d=l.name)!=null?d:"";f===e.component.mark[0].name?a=u:f.indexOf(Hs)>=0&&(c=!0)}),c||n.splice(a+1,0,o),n}},jd={defined:e=>e.type==="point"&&e.resolve==="global"&&e.bind&&e.bind!=="scales"&&!Da(e.bind),parse:(e,t,n)=>Xd(t,n),topLevelSignals:(e,t,n)=>{const i=t.name,r=t.project,s=t.bind,o=t.init&&t.init[0],a=Dd.defined(t)?"(item().isVoronoi ? datum.datum : datum)":"datum";return r.items.forEach((c,l)=>{var d,p;const u=se("".concat(i,"_").concat(c.field));n.filter(g=>g.name===u).length||n.unshift({name:u,...o?{init:kn(o[l])}:{value:null},on:t.events?[{events:t.events,update:"datum && item().mark.marktype !== 'group' ? ".concat(a,"[").concat(B(c.field),"] : null")}]:[],bind:(p=(d=s[c.field])!=null?d:s[c.channel])!=null?p:s})}),n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.filter(l=>l.name===i+Jt)[0],o=i+lr,a=r.items.map(l=>se("".concat(i,"_").concat(l.field))),c=a.map(l=>"".concat(l," !== null")).join(" && ");return a.length&&(s.update="".concat(c," ? {fields: ").concat(o,", values: [").concat(a.join(", "),"]} : null")),delete s.value,delete s.on,n}},Mr="_toggle",Md={defined:e=>e.type==="point"&&!!e.toggle,signals:(e,t,n)=>n.concat({name:t.name+Mr,value:!1,on:[{events:t.events,update:t.toggle}]}),modifyExpr:(e,t)=>{const n=t.name+Jt,i=t.name+Mr;return"".concat(i," ? null : ").concat(n,", ")+(t.resolve==="global"?"".concat(i," ? null : true, "):"".concat(i," ? null : {unit: ").concat(wn(e),"}, "))+"".concat(i," ? ").concat(n," : null")}},xx={defined:e=>e.clear!==void 0&&e.clear!==!1,parse:(e,t)=>{t.clear&&(t.clear=z(t.clear)?vi(t.clear,"view"):t.clear)},topLevelSignals:(e,t,n)=>{if(jd.defined(t))for(const i of t.project.items){const r=n.findIndex(s=>s.name===se("".concat(t.name,"_").concat(i.field)));r!==-1&&n[r].on.push({events:t.clear,update:"null"})}return n},signals:(e,t,n)=>{function i(r,s){r!==-1&&n[r].on&&n[r].on.push({events:t.clear,update:s})}if(t.type==="interval")for(const r of t.project.items){const s=n.findIndex(o=>o.name===r.signals.visual);if(i(s,"[0, 0]"),s===-1){const o=n.findIndex(a=>a.name===r.signals.data);i(o,"null")}}else{let r=n.findIndex(s=>s.name===t.name+Jt);i(r,"null"),Md.defined(t)&&(r=n.findIndex(s=>s.name===t.name+Mr),i(r,"false"))}return n}},Ud={defined:e=>{const t=e.resolve==="global"&&e.bind&&Da(e.bind),n=e.project.items.length===1&&e.project.items[0].field!==tt;return t&&!n&&S(Bh),t&&n},parse:(e,t,n)=>{var o;const i=j(n);if(i.select=z(i.select)?{type:i.select,toggle:t.toggle}:{...i.select,toggle:t.toggle},Xd(t,i),X(n.select)&&(n.select.on||n.select.clear)){const a='event.item && indexof(event.item.mark.role, "legend") < 0';for(const c of t.events)c.filter=le((o=c.filter)!=null?o:[]),c.filter.includes(a)||c.filter.push(a)}const r=Us(t.bind)?t.bind.legend:"click",s=z(r)?vi(r,"view"):le(r);t.bind={legend:{merge:s}}},topLevelSignals:(e,t,n)=>{const i=t.name,r=Us(t.bind)&&t.bind.legend,s=o=>a=>{const c=j(a);return c.markname=o,c};for(const o of t.project.items){if(!o.hasLegend)continue;const a="".concat(se(o.field),"_legend"),c="".concat(i,"_").concat(a);if(n.filter(u=>u.name===c).length===0){const u=r.merge.map(s("".concat(a,"_symbols"))).concat(r.merge.map(s("".concat(a,"_labels")))).concat(r.merge.map(s("".concat(a,"_entries"))));n.unshift({name:c,...t.init?{}:{value:null},on:[{events:u,update:"isDefined(datum.value) ? datum.value : item().items[0].items[0].datum.value",force:!0},{events:r.merge,update:"!event.item || !datum ? null : ".concat(c),force:!0}]})}}return n},signals:(e,t,n)=>{const i=t.name,r=t.project,s=n.find(d=>d.name===i+Jt),o=i+lr,a=r.items.filter(d=>d.hasLegend).map(d=>se("".concat(i,"_").concat(se(d.field),"_legend"))),c=a.map(d=>"".concat(d," !== null")).join(" && "),l="".concat(c," ? {fields: ").concat(o,", values: [").concat(a.join(", "),"]} : null");t.events&&a.length>0?s.on.push({events:a.map(d=>({signal:d})),update:l}):a.length>0&&(s.update=l,delete s.value,delete s.on);const u=n.find(d=>d.name===i+Mr),f=Us(t.bind)&&t.bind.legend;return u&&(t.events?u.on.push({...u.on[0],events:f}):u.on[0].events=f),n}};function Sx(e,t,n){var r,s,o,a;const i=(r=e.fieldDef(t))==null?void 0:r.field;for(const c of Se((s=e.component.selection)!=null?s:{})){const l=(o=c.project.hasField[i])!=null?o:c.project.hasChannel[t];if(l&&Ud.defined(c)){const u=(a=n.get("selections"))!=null?a:[];u.push(c.name),n.set("selections",u,!1),l.hasLegend=!0}}}const Bd="_translate_anchor",Wd="_translate_delta",Ex={defined:e=>e.type==="interval"&&e.translate,signals:(e,t,n)=>{const i=t.name,r=Ft.defined(t),s=i+Bd,{x:o,y:a}=t.project.hasChannel;let c=vi(t.translate,"scope");return r||(c=c.map(l=>(l.between[0].markname=i+ei,l))),n.push({name:s,value:{},on:[{events:c.map(l=>l.between[0]),update:"{x: x(unit), y: y(unit)"+(o!==void 0?", extent_x: ".concat(r?Oo(e,oe):"slice(".concat(o.signals.visual,")")):"")+(a!==void 0?", extent_y: ".concat(r?Oo(e,ye):"slice(".concat(a.signals.visual,")")):"")+"}"}]},{name:i+Wd,value:{},on:[{events:c,update:"{x: ".concat(s,".x - x(unit), y: ").concat(s,".y - y(unit)}")}]}),o!==void 0&&pl(e,t,o,"width",n),a!==void 0&&pl(e,t,a,"height",n),n}};function pl(e,t,n,i,r){var $,P;const s=t.name,o=s+Bd,a=s+Wd,c=n.channel,l=Ft.defined(t),u=r.filter(F=>F.name===n.signals[l?"data":"visual"])[0],f=e.getSizeSignalRef(i).signal,d=e.getScaleComponent(c),p=d&&d.get("type"),g=d&&d.get("reverse"),h=l?c===oe?g?"":"-":g?"-":"":"",m="".concat(o,".extent_").concat(c),y="".concat(h).concat(a,".").concat(c," / ").concat(l?"".concat(f):"span(".concat(m,")")),b=!l||!d?"panLinear":p==="log"?"panLog":p==="symlog"?"panSymlog":p==="pow"?"panPow":"panLinear",N=l?p==="pow"?", ".concat(($=d.get("exponent"))!=null?$:1):p==="symlog"?", ".concat((P=d.get("constant"))!=null?P:1):"":"",_="".concat(b,"(").concat(m,", ").concat(y).concat(N,")");u.on.push({events:{signal:a},update:l?_:"clampRange(".concat(_,", 0, ").concat(f,")")})}const Gd="_zoom_anchor",Hd="_zoom_delta",wx={defined:e=>e.type==="interval"&&e.zoom,signals:(e,t,n)=>{const i=t.name,r=Ft.defined(t),s=i+Hd,{x:o,y:a}=t.project.hasChannel,c=B(e.scaleName(oe)),l=B(e.scaleName(ye));let u=vi(t.zoom,"scope");return r||(u=u.map(f=>(f.markname=i+ei,f))),n.push({name:i+Gd,on:[{events:u,update:r?"{"+[c?"x: invert(".concat(c,", x(unit))"):"",l?"y: invert(".concat(l,", y(unit))"):""].filter(f=>f).join(", ")+"}":"{x: x(unit), y: y(unit)}"}]},{name:s,on:[{events:u,force:!0,update:"pow(1.001, event.deltaY * pow(16, event.deltaMode))"}]}),o!==void 0&&gl(e,t,o,"width",n),a!==void 0&&gl(e,t,a,"height",n),n}};function gl(e,t,n,i,r){var b,N;const s=t.name,o=n.channel,a=Ft.defined(t),c=r.filter(_=>_.name===n.signals[a?"data":"visual"])[0],l=e.getSizeSignalRef(i).signal,u=e.getScaleComponent(o),f=u&&u.get("type"),d=a?Oo(e,o):c.name,p=s+Hd,g="".concat(s).concat(Gd,".").concat(o),h=!a||!u?"zoomLinear":f==="log"?"zoomLog":f==="symlog"?"zoomSymlog":f==="pow"?"zoomPow":"zoomLinear",m=a?f==="pow"?", ".concat((b=u.get("exponent"))!=null?b:1):f==="symlog"?", ".concat((N=u.get("constant"))!=null?N:1):"":"",y="".concat(h,"(").concat(d,", ").concat(g,", ").concat(p).concat(m,")");c.on.push({events:{signal:p},update:a?y:"clampRange(".concat(y,", 0, ").concat(l,")")})}const In="_store",Jt="_tuple",$x="_modify",qd="vlSelectionResolve",Ss=[ix,tx,Zv,Md,jd,Ft,Ud,xx,Ex,wx,Dd];function Ox(e){let t=e.parent;for(;t&&!Ze(t);)t=t.parent;return t}function wn(e,{escape:t}={escape:!0}){let n=t?B(e.name):e.name;const i=Ox(e);if(i){const{facet:r}=i;for(const s of Ue)r[s]&&(n+=" + '__facet_".concat(s,"_' + (facet[").concat(B(i.vgField(s)),"])"))}return n}function Ya(e){var t;return Se((t=e.component.selection)!=null?t:{}).reduce((n,i)=>n||i.project.hasSelectionId,!1)}function Xd(e,t){(z(t.select)||!t.select.on)&&delete e.events,(z(t.select)||!t.select.clear)&&delete e.clear,(z(t.select)||!t.select.toggle)&&delete e.toggle}function Co(e){const t=[];return e.type==="Identifier"?[e.name]:e.type==="Literal"?[e.value]:(e.type==="MemberExpression"&&(t.push(...Co(e.object)),t.push(...Co(e.property))),t)}function Vd(e){return e.object.type==="MemberExpression"?Vd(e.object):e.object.name==="datum"}function Yd(e){const t=tg(e),n=new Set;return t.visit(i=>{i.type==="MemberExpression"&&Vd(i)&&n.add(Co(i).slice(1).join("."))}),n}class $i extends J{clone(){return new $i(null,this.model,j(this.filter))}constructor(t,n,i){super(t),this.model=n,this.filter=i,this.expr=Ur(this.model,this.filter,this),this._dependentFields=Yd(this.expr)}dependentFields(){return this._dependentFields}producedFields(){return new Set}assemble(){return{type:"filter",expr:this.expr}}hash(){return"Filter ".concat(this.expr)}}function Cx(e,t){var r;const n={},i=e.config.selection;if(!t||!t.length)return n;for(const s of t){const o=se(s.name),a=s.select,c=z(a)?a:a.type,l=X(a)?j(a):{type:c},u=i[c];for(const p in u)p==="fields"||p==="encodings"||(p==="mark"&&(l[p]={...u[p],...l[p]}),(l[p]===void 0||l[p]===!0)&&(l[p]=j((r=u[p])!=null?r:l[p])));const f=n[o]={...l,name:o,type:c,init:s.value,bind:s.bind,events:z(l.on)?vi(l.on,"scope"):le(j(l.on))},d=j(s);for(const p of Ss)p.defined(f)&&p.parse&&p.parse(e,f,d)}return n}function Kd(e,t,n,i="datum"){const r=z(t)?t:t.param,s=se(r),o=B(s+In);let a;try{a=e.getSelectionComponent(s,r)}catch(d){return"!!".concat(s)}if(a.project.timeUnit){const d=n!=null?n:e.component.data.raw,p=a.project.timeUnit.clone();d.parent?p.insertAsParentOf(d):d.parent=p}const c=a.project.hasSelectionId?"vlSelectionIdTest(":"vlSelectionTest(",l=a.resolve==="global"?")":", ".concat(B(a.resolve),")"),u="".concat(c).concat(o,", ").concat(i).concat(l),f="length(data(".concat(o,"))");return t.empty===!1?"".concat(f," && ").concat(u):"!".concat(f," || ").concat(u)}function Jd(e,t,n){const i=se(t),r=n.encoding;let s=n.field,o;try{o=e.getSelectionComponent(i,t)}catch(a){return i}if(!r&&!s)s=o.project.items[0].field,o.project.items.length>1&&S('A "field" or "encoding" must be specified when using a selection as a scale domain. '+'Using "field": '.concat(B(s),"."));else if(r&&!s){const a=o.project.items.filter(c=>c.channel===r);!a.length||a.length>1?(s=o.project.items[0].field,S((a.length?"Multiple ":"No ")+"matching ".concat(B(r)," encoding found for selection ").concat(B(n.param),". ")+'Using "field": '.concat(B(s),"."))):s=a[0].field}return"".concat(o.name,"[").concat(B(Be(s)),"]")}function Nx(e,t){var n;for(const[i,r]of Xt((n=e.component.selection)!=null?n:{})){const s=e.getName("lookup_".concat(i));e.component.data.outputNodes[s]=r.materialized=new Oe(new $i(t,e,{param:i}),s,ee.Lookup,e.component.data.outputNodeRefCounts)}}function Ur(e,t,n){return ji(t,i=>z(i)?i:ry(i)?Kd(e,i,n):gf(i))}function _x(e,t){if(e)return I(e)&&!Wt(e)?e.map(n=>Ta(n,t)).join(", "):e}function qs(e,t,n,i){var o,a,c;var r,s;(o=e.encode)!=null||(e.encode={}),(a=(r=e.encode)[t])!=null||(r[t]={}),(c=(s=e.encode[t]).update)!=null||(s.update={}),e.encode[t].update[n]=i}function Pi(e,t,n,i={header:!1}){var f,d;const{disable:r,orient:s,scale:o,labelExpr:a,title:c,zindex:l,...u}=e.combine();if(!r){for(const p in u){const g=ab[p],h=u[p];if(g&&g!==t&&g!=="both")delete u[p];else if(cr(h)){const{condition:m,...y}=h,b=le(m),N=Gc[p];if(N){const{vgProp:_,part:$}=N,P=[...b.map(F=>{const{test:L,...H}=F;return{test:Ur(null,L),...H}}),y];qs(u,$,_,P),delete u[p]}else if(N===null){const _={signal:b.map($=>{const{test:P,...F}=$;return"".concat(Ur(null,P)," ? ").concat(_c(F)," : ")}).join("")+_c(y)};u[p]=_}}else if(R(h)){const m=Gc[p];if(m){const{vgProp:y,part:b}=m;qs(u,b,y,h),delete u[p]}}G(["labelAlign","labelBaseline"],p)&&u[p]===null&&delete u[p]}if(t==="grid"){if(!u.grid)return;if(u.encode){const{grid:p}=u.encode;u.encode={...p?{grid:p}:{}},Q(u.encode)&&delete u.encode}return{scale:o,orient:s,...u,domain:!1,labels:!1,aria:!1,maxExtent:0,minExtent:0,ticks:!1,zindex:de(l,0)}}else{if(!i.header&&e.mainExtracted)return;if(a!==void 0){let g=a;(d=(f=u.encode)==null?void 0:f.labels)!=null&&d.update&&R(u.encode.labels.update.text)&&(g=Cn(a,"datum.label",u.encode.labels.update.text.signal)),qs(u,"labels","text",{signal:g})}if(u.labelAlign===null&&delete u.labelAlign,u.encode){for(const g of Hf)e.hasAxisPart(g)||delete u.encode[g];Q(u.encode)&&delete u.encode}const p=_x(c,n);return{scale:o,orient:s,grid:!1,...p?{title:p}:{},...u,...n.aria===!1?{aria:!1}:{},zindex:de(l,0)}}}}function Qd(e){const{axes:t}=e.component,n=[];for(const i of wt)if(t[i]){for(const r of t[i])if(!r.get("disable")&&!r.get("gridScale")){const s=i==="x"?"height":"width",o=e.getSizeSignalRef(s).signal;s!==o&&n.push({name:s,update:o})}}return n}function Tx(e,t){const{x:n=[],y:i=[]}=e;return[...n.map(r=>Pi(r,"grid",t)),...i.map(r=>Pi(r,"grid",t)),...n.map(r=>Pi(r,"main",t)),...i.map(r=>Pi(r,"main",t))].filter(r=>r)}function hl(e,t,n,i){return Object.assign.apply(null,[{},...e.map(r=>{if(r==="axisOrient"){const s=n==="x"?"bottom":"left",o=t[n==="x"?"axisBottom":"axisLeft"]||{},a=t[n==="x"?"axisTop":"axisRight"]||{},c=new Set([...x(o),...x(a)]),l={};for(const u of c.values())l[u]={signal:"".concat(i.signal,' === "').concat(s,'" ? ').concat(Ye(o[u])," : ").concat(Ye(a[u]))};return l}return t[r]})])}function Ax(e,t,n,i){const r=t==="band"?["axisDiscrete","axisBand"]:t==="point"?["axisDiscrete","axisPoint"]:bf(t)?["axisQuantitative"]:t==="time"||t==="utc"?["axisTemporal"]:[],s=e==="x"?"axisX":"axisY",o=R(n)?"axisOrient":"axis".concat(Zi(n)),a=[...r,...r.map(l=>s+l.substr(4))],c=["axis",o,s];return{vlOnlyAxisConfig:hl(a,i,e,n),vgAxisConfig:hl(c,i,e,n),axisConfigStyle:Fx([...c,...a],i)}}function Fx(e,t){var i;const n=[{}];for(const r of e){let s=(i=t[r])==null?void 0:i.style;if(s){s=le(s);for(const o of s)n.push(t.style[o])}}return Object.assign.apply(null,n)}function No(e,t,n,i={}){var s;const r=Hu(e,n,t);if(r!==void 0)return{configFrom:"style",configValue:r};for(const o of["vlOnlyAxisConfig","vgAxisConfig","axisConfigStyle"])if(((s=i[o])==null?void 0:s[e])!==void 0)return{configFrom:o,configValue:i[o][e]};return{}}const ml={scale:({model:e,channel:t})=>e.scaleName(t),format:({format:e})=>e,formatType:({formatType:e})=>e,grid:({fieldOrDatumDef:e,axis:t,scaleType:n})=>{var i;return(i=t.grid)!=null?i:kx(n,e)},gridScale:({model:e,channel:t})=>Ix(e,t),labelAlign:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelAlign||ep(t,n,i),labelAngle:({labelAngle:e})=>e,labelBaseline:({axis:e,labelAngle:t,orient:n,channel:i})=>e.labelBaseline||Zd(t,n,i),labelFlush:({axis:e,fieldOrDatumDef:t,channel:n})=>{var i;return(i=e.labelFlush)!=null?i:Lx(t.type,n)},labelOverlap:({axis:e,fieldOrDatumDef:t,scaleType:n})=>{var i;return(i=e.labelOverlap)!=null?i:Px(t.type,n,w(t)&&!!t.timeUnit,w(t)?t.sort:void 0)},orient:({orient:e})=>e,tickCount:({channel:e,model:t,axis:n,fieldOrDatumDef:i,scaleType:r})=>{var a;const s=e==="x"?"width":e==="y"?"height":void 0,o=s?t.getSizeSignalRef(s):void 0;return(a=n.tickCount)!=null?a:Dx({fieldOrDatumDef:i,scaleType:r,size:o,values:n.values})},tickMinStep:jx,title:({axis:e,model:t,channel:n})=>{if(e.title!==void 0)return e.title;const i=tp(t,n);if(i!==void 0)return i;const r=t.typedFieldDef(n),s=n==="x"?"x2":"y2",o=t.fieldDef(s);return Xu(r?[Bc(r)]:[],w(o)?[Bc(o)]:[])},values:({axis:e,fieldOrDatumDef:t})=>Mx(e,t),zindex:({axis:e,fieldOrDatumDef:t,mark:n})=>{var i;return(i=e.zindex)!=null?i:Ux(n,t)}};function kx(e,t){return!ve(e)&&w(t)&&!ne(t==null?void 0:t.bin)&&!xe(t==null?void 0:t.bin)}function Ix(e,t){const n=t==="x"?"y":"x";if(e.getScaleComponent(n))return e.scaleName(n)}function Rx(e,t,n,i,r){const s=t==null?void 0:t.labelAngle;if(s!==void 0)return R(s)?s:Hi(s);{const{configValue:o}=No("labelAngle",i,t==null?void 0:t.style,r);return o!==void 0?Hi(o):n===oe&&G([ya,ma],e.type)&&!(w(e)&&e.timeUnit)?270:void 0}}function _o(e){return"(((".concat(e.signal," % 360) + 360) % 360)")}function Zd(e,t,n,i){if(e!==void 0)if(n==="x"){if(R(e)){const r=_o(e),s=R(t)?"(".concat(t.signal,' === "top")'):t==="top";return{signal:"(45 < ".concat(r," && ").concat(r," < 135) || (225 < ").concat(r," && ").concat(r,' < 315) ? "middle" :')+"(".concat(r," <= 45 || 315 <= ").concat(r,") === ").concat(s,' ? "bottom" : "top"')}}if(45<e&&e<135||225<e&&e<315)return"middle";if(R(t)){const r=e<=45||315<=e?"===":"!==";return{signal:"".concat(t.signal," ").concat(r,' "top" ? "bottom" : "top"')}}return(e<=45||315<=e)==(t==="top")?"bottom":"top"}else{if(R(e)){const r=_o(e),s=R(t)?"(".concat(t.signal,' === "left")'):t==="left",o=i?'"middle"':"null";return{signal:"".concat(r," <= 45 || 315 <= ").concat(r," || (135 <= ").concat(r," && ").concat(r," <= 225) ? ").concat(o," : (45 <= ").concat(r," && ").concat(r," <= 135) === ").concat(s,' ? "top" : "bottom"')}}if(e<=45||315<=e||135<=e&&e<=225)return i?"middle":null;if(R(t)){const r=45<=e&&e<=135?"===":"!==";return{signal:"".concat(t.signal," ").concat(r,' "left" ? "top" : "bottom"')}}return(45<=e&&e<=135)==(t==="left")?"top":"bottom"}}function ep(e,t,n){if(e===void 0)return;const i=n==="x",r=i?0:90,s=i?"bottom":"left";if(R(e)){const o=_o(e),a=R(t)?"(".concat(t.signal,' === "').concat(s,'")'):t===s;return{signal:"(".concat(r?"(".concat(o," + 90)"):o," % 180 === 0) ? ").concat(i?null:'"center"'," :")+"(".concat(r," < ").concat(o," && ").concat(o," < ").concat(180+r,") === ").concat(a,' ? "left" : "right"')}}if((e+r)%180===0)return i?null:"center";if(R(t)){const o=r<e&&e<180+r?"===":"!==",a="".concat(t.signal," ").concat(o,' "').concat(s,'"');return{signal:"".concat(a,' ? "left" : "right"')}}return(r<e&&e<180+r)==(t===s)?"left":"right"}function Lx(e,t){if(t==="x"&&G(["quantitative","temporal"],e))return!0}function Px(e,t,n,i){if(n&&!X(i)||e!=="nominal"&&e!=="ordinal")return t==="log"||t==="symlog"?"greedy":!0}function zx(e){return e==="x"?"bottom":"left"}function Dx({fieldOrDatumDef:e,scaleType:t,size:n,values:i}){var r;if(!i&&!ve(t)&&t!=="log"){if(w(e)){if(ne(e.bin))return{signal:"ceil(".concat(n.signal,"/10)")};if(e.timeUnit&&G(["month","hours","day","quarter"],(r=me(e.timeUnit))==null?void 0:r.unit))return}return{signal:"ceil(".concat(n.signal,"/40)")}}}function jx({format:e,fieldOrDatumDef:t}){if(e==="d")return 1;if(w(t)){const{timeUnit:n}=t;if(n){const i=ff(n);if(i)return{signal:i}}}}function tp(e,t){const n=t==="x"?"x2":"y2",i=e.fieldDef(t),r=e.fieldDef(n),s=i?i.title:void 0,o=r?r.title:void 0;if(s&&o)return Vu(s,o);if(s)return s;if(o)return o;if(s!==void 0)return s;if(o!==void 0)return o}function Mx(e,t){const n=e.values;if(I(n))return Gf(t,n);if(R(n))return n}function Ux(e,t){return e==="rect"&&Ir(t)?1:0}class gi extends J{clone(){return new gi(null,j(this.transform))}constructor(t,n){super(t),this.transform=n,this._dependentFields=Yd(this.transform.calculate)}static parseAllForSortIndex(t,n){return n.forEachFieldDef((i,r)=>{if(Un(i)&&If(i.sort)){const{field:s,timeUnit:o}=i,a=i.sort,c=a.map((l,u)=>"".concat(gf({field:s,timeUnit:o,equal:l})," ? ").concat(u," : ")).join("")+a.length;t=new gi(t,{calculate:c,as:hi(i,r,{forAs:!0})})}}),t}producedFields(){return new Set([this.transform.as])}dependentFields(){return this._dependentFields}assemble(){return{type:"formula",expr:this.transform.calculate,as:this.transform.as}}hash(){return"Calculate ".concat(W(this.transform))}}function hi(e,t,n){return C(e,{prefix:t,suffix:"sort_index",...n!=null?n:{}})}function Es(e,t){return G(["top","bottom"],t)?"column":G(["left","right"],t)||e==="row"?"row":"column"}function mi(e,t,n,i){const r=i==="row"?n.headerRow:i==="column"?n.headerColumn:n.headerFacet;return de((t||{})[e],r[e],n.header[e])}function ws(e,t,n,i){const r={};for(const s of e){const o=mi(s,t||{},n,i);o!==void 0&&(r[s]=o)}return r}const Ka=["row","column"],Ja=["header","footer"];function Bx(e,t){const n=e.component.layoutHeaders[t].title,i=e.config?e.config:void 0,r=e.component.layoutHeaders[t].facetFieldDef?e.component.layoutHeaders[t].facetFieldDef:void 0,{titleAnchor:s,titleAngle:o,titleOrient:a}=ws(["titleAnchor","titleAngle","titleOrient"],r.header,i,t),c=Es(t,a),l=Hi(o);return{name:"".concat(t,"-title"),type:"group",role:"".concat(c,"-title"),title:{text:n,...t==="row"?{orient:"left"}:{},style:"guide-title",...ip(l,c),...np(c,l,s),...rp(i,r,t,Tb,ad)}}}function np(e,t,n="middle"){switch(n){case"start":return{align:"left"};case"end":return{align:"right"}}const i=ep(t,e==="row"?"left":"top",e==="row"?"y":"x");return i?{align:i}:{}}function ip(e,t){const n=Zd(e,t==="row"?"left":"top",t==="row"?"y":"x",!0);return n?{baseline:n}:{}}function Wx(e,t){const n=e.component.layoutHeaders[t],i=[];for(const r of Ja)if(n[r])for(const s of n[r]){const o=Hx(e,t,r,n,s);o!=null&&i.push(o)}return i}function Gx(e,t){var i;const{sort:n}=e;return pt(n)?{field:C(n,{expr:"datum"}),order:(i=n.order)!=null?i:"ascending"}:I(n)?{field:hi(e,t,{expr:"datum"}),order:"ascending"}:{field:C(e,{expr:"datum"}),order:n!=null?n:"ascending"}}function To(e,t,n){const{format:i,formatType:r,labelAngle:s,labelAnchor:o,labelOrient:a,labelExpr:c}=ws(["format","formatType","labelAngle","labelAnchor","labelOrient","labelExpr"],e.header,n,t),l=Oa({fieldOrDatumDef:e,format:i,formatType:r,expr:"parent",config:n}).signal,u=Es(t,a);return{text:{signal:c?Cn(Cn(c,"datum.label",l),"datum.value",C(e,{expr:"parent"})):l},...t==="row"?{orient:"left"}:{},style:"guide-label",frame:"group",...ip(s,u),...np(u,s,o),...rp(n,e,t,Ab,cd)}}function Hx(e,t,n,i,r){if(r){let s=null;const{facetFieldDef:o}=i,a=e.config?e.config:void 0;if(o&&r.labels){const{labelOrient:f}=ws(["labelOrient"],o.header,a,t);(t==="row"&&!G(["top","bottom"],f)||t==="column"&&!G(["left","right"],f))&&(s=To(o,t,a))}const c=Ze(e)&&!sr(e.facet),l=r.axes,u=(l==null?void 0:l.length)>0;if(s||u){const f=t==="row"?"height":"width";return{name:e.getName("".concat(t,"_").concat(n)),type:"group",role:"".concat(t,"-").concat(n),...i.facetFieldDef?{from:{data:e.getName("".concat(t,"_domain"))},sort:Gx(o,t)}:{},...u&&c?{from:{data:e.getName("facet_domain_".concat(t))}}:{},...s?{title:s}:{},...r.sizeSignal?{encode:{update:{[f]:r.sizeSignal}}}:{},...u?{axes:l}:{}}}}return null}const qx={column:{start:0,end:1},row:{start:1,end:0}};function Xx(e,t){return qx[t][e]}function Vx(e,t){const n={};for(const i of Ue){const r=e[i];if(r!=null&&r.facetFieldDef){const{titleAnchor:s,titleOrient:o}=ws(["titleAnchor","titleOrient"],r.facetFieldDef.header,t,i),a=Es(i,o),c=Xx(s,a);c!==void 0&&(n[a]=c)}}return Q(n)?void 0:n}function rp(e,t,n,i,r){const s={};for(const o of i){if(!r[o])continue;const a=mi(o,t==null?void 0:t.header,e,n);a!==void 0&&(s[r[o]]=a)}return s}function Qa(e){return[...hr(e,"width"),...hr(e,"height"),...hr(e,"childWidth"),...hr(e,"childHeight")]}function hr(e,t){const n=t==="width"?"x":"y",i=e.component.layoutSize.get(t);if(!i||i==="merged")return[];const r=e.getSizeSignalRef(t).signal;if(i==="step"){const s=e.getScaleComponent(n);if(s){const o=s.get("type"),a=s.get("range");if(ve(o)&&on(a)){const c=e.scaleName(n);return Ze(e.parent)&&e.parent.component.resolve.scale[n]==="independent"?[yl(c,a)]:[yl(c,a),{name:r,update:sp(c,s,"domain('".concat(c,"').length"))}]}}throw new Error("layout size is step although width/height is not step.")}else if(i=="container"){const s=r.endsWith("width"),o=s?"containerSize()[0]":"containerSize()[1]",a=So(e.config.view,s?"width":"height"),c="isFinite(".concat(o,") ? ").concat(o," : ").concat(a);return[{name:r,init:c,on:[{update:c,events:"window:resize"}]}]}else return[{name:r,value:i}]}function yl(e,t){const n="".concat(e,"_step");return R(t.step)?{name:n,update:t.step.signal}:{name:n,value:t.step}}function sp(e,t,n){const i=t.get("type"),r=t.get("padding"),s=de(t.get("paddingOuter"),r);let o=t.get("paddingInner");return o=i==="band"?o!==void 0?o:r:1,"bandspace(".concat(n,", ").concat(Ye(o),", ").concat(Ye(s),") * ").concat(e,"_step")}function op(e){return e==="childWidth"?"width":e==="childHeight"?"height":e}function ap(e,t){return x(e).reduce((n,i)=>{const r=e[i];return{...n,...wi(t,r,i,s=>re(s.value))}},{})}function cp(e,t){if(Ze(t))return e==="theta"?"independent":"shared";if(Ni(t))return"shared";if(sc(t))return be(e)||e==="theta"||e==="radius"?"independent":"shared";throw new Error("invalid model type for resolve")}function Za(e,t){const n=e.scale[t],i=be(t)?"axis":"legend";return n==="independent"?(e[i][t]==="shared"&&S(Cm(t)),"independent"):e[i][t]||"shared"}const Yx={...Ib,disable:1,labelExpr:1,selections:1,opacity:1,shape:1,stroke:1,fill:1,size:1,strokeWidth:1,strokeDash:1,encode:1},lp=x(Yx);class Kx extends Ut{}const bl={symbols:Jx,gradient:Qx,labels:Zx,entries:eS};function Jx(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r,legendType:s}){var m,y,b,N,_,$,P,F;if(s!=="symbol")return;const{markDef:o,encoding:a,config:c,mark:l}=n,u=o.filled&&l!=="trail";let f={...Ph({},n,Ty),...Ld(n,{filled:u})};const d=(m=r.get("symbolOpacity"))!=null?m:c.legend.symbolOpacity,p=(y=r.get("symbolFillColor"))!=null?y:c.legend.symbolFillColor,g=(b=r.get("symbolStrokeColor"))!=null?b:c.legend.symbolStrokeColor,h=d===void 0?(N=up(a.opacity))!=null?N:o.opacity:void 0;if(f.fill){if(i==="fill"||u&&i===Ie)delete f.fill;else if(f.fill.field)p?delete f.fill:(f.fill=re((_=c.legend.symbolBaseFillColor)!=null?_:"black"),f.fillOpacity=re(h!=null?h:1));else if(I(f.fill)){const L=(F=(P=Ao(($=a.fill)!=null?$:a.color))!=null?P:o.fill)!=null?F:u&&o.color;L&&(f.fill=re(L))}}if(f.stroke){if(i==="stroke"||!u&&i===Ie)delete f.stroke;else if(f.stroke.field||g)delete f.stroke;else if(I(f.stroke)){const L=de(Ao(a.stroke||a.color),o.stroke,u?o.color:void 0);L&&(f.stroke={value:L})}}if(i!==Dt){const L=w(t)&&dp(n,r,t);L?f.opacity=[{test:L,...re(h!=null?h:1)},re(c.legend.unselectedOpacity)]:h&&(f.opacity=re(h))}return f={...f,...e},Q(f)?void 0:f}function Qx(e,{model:t,legendType:n,legendCmpt:i}){var u;if(n!=="gradient")return;const{config:r,markDef:s,encoding:o}=t;let a={};const l=((u=i.get("gradientOpacity"))!=null?u:r.legend.gradientOpacity)===void 0?up(o.opacity)||s.opacity:void 0;return l&&(a.opacity=re(l)),a={...a,...e},Q(a)?void 0:a}function Zx(e,{fieldOrDatumDef:t,model:n,channel:i,legendCmpt:r}){const s=n.legend(i)||{},o=n.config,a=w(t)?dp(n,r,t):void 0,c=a?[{test:a,value:1},{value:o.legend.unselectedOpacity}]:void 0,{format:l,formatType:u}=s;let f;Fn(u)?f=Je({fieldOrDatumDef:t,field:"datum.value",format:l,formatType:u,config:o}):l===void 0&&u===void 0&&o.customFormatTypes&&(t.type==="quantitative"&&o.numberFormatType?f=Je({fieldOrDatumDef:t,field:"datum.value",format:o.numberFormat,formatType:o.numberFormatType,config:o}):t.type==="temporal"&&o.timeFormatType&&w(t)&&t.timeUnit===void 0&&(f=Je({fieldOrDatumDef:t,field:"datum.value",format:o.timeFormat,formatType:o.timeFormatType,config:o})));const d={...c?{opacity:c}:{},...f?{text:f}:{},...e};return Q(d)?void 0:d}function eS(e,{legendCmpt:t}){const n=t.get("selections");return n!=null&&n.length?{...e,fill:{value:"transparent"}}:e}function up(e){return fp(e,(t,n)=>Math.max(t,n.value))}function Ao(e){return fp(e,(t,n)=>de(t,n.value))}function fp(e,t){if(Yy(e))return le(e.condition).reduce(t,e.value);if(et(e))return e.value}function dp(e,t,n){const i=t.get("selections");if(!(i!=null&&i.length))return;const r=B(n.field);return i.map(s=>{const o=B(se(s)+In);return"(!length(data(".concat(o,")) || (").concat(s,"[").concat(r,"] && indexof(").concat(s,"[").concat(r,"], datum.value) >= 0))")}).join(" || ")}const vl={direction:({direction:e})=>e,format:({fieldOrDatumDef:e,legend:t,config:n})=>{const{format:i,formatType:r}=t;return Tf(e,e.type,i,r,n,!1)},formatType:({legend:e,fieldOrDatumDef:t,scaleType:n})=>{const{formatType:i}=e;return Af(i,t,n)},gradientLength:e=>{var i,r;const{legend:t,legendConfig:n}=e;return(r=(i=t.gradientLength)!=null?i:n.gradientLength)!=null?r:aS(e)},labelOverlap:({legend:e,legendConfig:t,scaleType:n})=>{var i,r;return(r=(i=e.labelOverlap)!=null?i:t.labelOverlap)!=null?r:cS(n)},symbolType:({legend:e,markDef:t,channel:n,encoding:i})=>{var r;return(r=e.symbolType)!=null?r:nS(t.type,n,i.shape,t.shape)},title:({fieldOrDatumDef:e,config:t})=>Zn(e,t,{allowDisabling:!0}),type:({legendType:e,scaleType:t,channel:n})=>{if(Qn(n)&&Ke(t)){if(e==="gradient")return}else if(e==="symbol")return;return e},values:({fieldOrDatumDef:e,legend:t})=>tS(t,e)};function tS(e,t){const n=e.values;if(I(n))return Gf(t,n);if(R(n))return n}function nS(e,t,n,i){var r;if(t!=="shape"){const s=(r=Ao(n))!=null?r:i;if(s)return s}switch(e){case"bar":case"rect":case"image":case"square":return"square";case"line":case"trail":case"rule":return"stroke";case"arc":case"point":case"circle":case"tick":case"geoshape":case"area":case"text":return"circle"}}function iS(e){const{legend:t}=e;return de(t.type,rS(e))}function rS({channel:e,timeUnit:t,scaleType:n}){if(Qn(e)){if(G(["quarter","month","day"],t))return"symbol";if(Ke(n))return"gradient"}return"symbol"}function sS({legendConfig:e,legendType:t,orient:n,legend:i}){var r,s;return(s=(r=i.direction)!=null?r:e[t?"gradientDirection":"symbolDirection"])!=null?s:oS(n,t)}function oS(e,t){switch(e){case"top":case"bottom":return"horizontal";case"left":case"right":case"none":case void 0:return;default:return t==="gradient"?"horizontal":void 0}}function aS({legendConfig:e,model:t,direction:n,orient:i,scaleType:r}){const{gradientHorizontalMaxLength:s,gradientHorizontalMinLength:o,gradientVerticalMaxLength:a,gradientVerticalMinLength:c}=e;if(Ke(r))return n==="horizontal"?i==="top"||i==="bottom"?xl(t,"width",o,s):o:xl(t,"height",c,a)}function xl(e,t,n,i){const r=e.getSizeSignalRef(t).signal;return{signal:"clamp(".concat(r,", ").concat(n,", ").concat(i,")")}}function cS(e){if(G(["quantile","threshold","log","symlog"],e))return"greedy"}function pp(e){const t=ce(e)?lS(e):pS(e);return e.component.legends=t,t}function lS(e){const{encoding:t}=e,n={};for(const i of[Ie,...ud]){const r=pe(t[i]);!r||!e.getScaleComponent(i)||i===Re&&w(r)&&r.type===Ei||(n[i]=dS(e,i))}return n}function uS(e,t){const n=e.scaleName(t);if(e.mark==="trail"){if(t==="color")return{stroke:n};if(t==="size")return{strokeWidth:n}}return t==="color"?e.markDef.filled?{fill:n}:{stroke:n}:{[t]:n}}function fS(e,t,n,i){switch(t){case"disable":return n!==void 0;case"values":return!!(n!=null&&n.values);case"title":if(t==="title"&&e===(i==null?void 0:i.title))return!0}return e===(n||{})[t]}function dS(e,t){var _,$,P;let n=e.legend(t);const{markDef:i,encoding:r,config:s}=e,o=s.legend,a=new Kx({},uS(e,t));Sx(e,t,a);const c=n!==void 0?!n:o.disable;if(a.set("disable",c,n!==void 0),c)return a;n=n||{};const l=e.getScaleComponent(t).get("type"),u=pe(r[t]),f=w(u)?(_=me(u.timeUnit))==null?void 0:_.unit:void 0,d=n.orient||s.legend.orient||"right",p=iS({legend:n,channel:t,timeUnit:f,scaleType:l}),g=sS({legend:n,legendType:p,orient:d,legendConfig:o}),h={legend:n,channel:t,model:e,markDef:i,encoding:r,fieldOrDatumDef:u,legendConfig:o,config:s,scaleType:l,orient:d,legendType:p,direction:g};for(const F of lp){if(p==="gradient"&&F.startsWith("symbol")||p==="symbol"&&F.startsWith("gradient"))continue;const L=F in vl?vl[F](h):n[F];if(L!==void 0){const H=fS(L,F,n,e.fieldDef(t));(H||s.legend[F]===void 0)&&a.set(F,L,H)}}const m=($=n==null?void 0:n.encoding)!=null?$:{},y=a.get("selections"),b={},N={fieldOrDatumDef:u,model:e,channel:t,legendCmpt:a,legendType:p};for(const F of["labels","legend","title","symbols","gradient","entries"]){const L=ap((P=m[F])!=null?P:{},e),H=F in bl?bl[F](L,N):L;H!==void 0&&!Q(H)&&(b[F]={...y!=null&&y.length&&w(u)?{name:"".concat(se(u.field),"_legend_").concat(F)}:{},...y!=null&&y.length?{interactive:!!y}:{},update:H})}return Q(b)||a.set("encode",b,!!(n!=null&&n.encoding)),a}function pS(e){const{legends:t,resolve:n}=e.component;for(const i of e.children){pp(i);for(const r of x(i.component.legends))n.legend[r]=Za(e.component.resolve,r),n.legend[r]==="shared"&&(t[r]=gp(t[r],i.component.legends[r]),t[r]||(n.legend[r]="independent",delete t[r]))}for(const i of x(t))for(const r of e.children)r.component.legends[i]&&n.legend[i]==="shared"&&delete r.component.legends[i];return t}function gp(e,t){var s,o,a,c;if(!e)return t.clone();const n=e.getWithExplicit("orient"),i=t.getWithExplicit("orient");if(n.explicit&&i.explicit&&n.value!==i.value)return;let r=!1;for(const l of lp){const u=Yt(e.getWithExplicit(l),t.getWithExplicit(l),l,"legend",(f,d)=>{switch(l){case"symbolType":return gS(f,d);case"title":return Yu(f,d);case"type":return r=!0,Pe("symbol")}return vs(f,d,l,"legend")});e.setWithExplicit(l,u)}return r&&((o=(s=e.implicit)==null?void 0:s.encode)!=null&&o.gradient&&Nr(e.implicit,["encode","gradient"]),(c=(a=e.explicit)==null?void 0:a.encode)!=null&&c.gradient&&Nr(e.explicit,["encode","gradient"])),e}function gS(e,t){return t.value==="circle"?t:e}function hS(e,t,n,i){var o,a,c;var r,s;(o=e.encode)!=null||(e.encode={}),(a=(r=e.encode)[t])!=null||(r[t]={}),(c=(s=e.encode[t]).update)!=null||(s.update={}),e.encode[t].update[n]=i}function hp(e){const t=e.component.legends,n={};for(const r of x(t)){const s=e.getScaleComponent(r),o=te(s.get("domains"));if(n[o])for(const a of n[o])gp(a,t[r])||n[o].push(t[r]);else n[o]=[t[r].clone()]}return Se(n).flat().map(r=>mS(r,e.config)).filter(r=>r!==void 0)}function mS(e,t){var o,a,c;const{disable:n,labelExpr:i,selections:r,...s}=e.combine();if(!n){if(t.aria===!1&&s.aria==null&&(s.aria=!1),(o=s.encode)!=null&&o.symbols){const l=s.encode.symbols.update;l.fill&&l.fill.value!=="transparent"&&!l.stroke&&!s.stroke&&(l.stroke={value:"transparent"});for(const u of ud)s[u]&&delete l[u]}if(s.title||delete s.title,i!==void 0){let l=i;(c=(a=s.encode)==null?void 0:a.labels)!=null&&c.update&&R(s.encode.labels.update.text)&&(l=Cn(i,"datum.label",s.encode.labels.update.text.signal)),hS(s,"labels","text",{signal:l})}return s}}function yS(e){return Ni(e)||sc(e)?bS(e):mp(e)}function bS(e){return e.children.reduce((t,n)=>t.concat(n.assembleProjections()),mp(e))}function mp(e){const t=e.component.projection;if(!t||t.merged)return[];const n=t.combine(),{name:i}=n;if(t.data){const r={signal:"[".concat(t.size.map(o=>o.signal).join(", "),"]")},s=t.data.reduce((o,a)=>{const c=R(a)?a.signal:"data('".concat(e.lookupDataSource(a),"')");return G(o,c)||o.push(c),o},[]);if(s.length<=0)throw new Error("Projection's fit didn't find any data sources");return[{name:i,size:r,fit:{signal:s.length>1?"[".concat(s.join(", "),"]"):s[0]},...n}]}else return[{name:i,translate:{signal:"[width / 2, height / 2]"},...n}]}const vS=["type","clipAngle","clipExtent","center","rotate","precision","reflectX","reflectY","coefficient","distance","fraction","lobes","parallel","radius","ratio","spacing","tilt"];class yp extends Ut{constructor(t,n,i,r){super({...n},{name:t}),this.specifiedProjection=n,this.size=i,this.data=r,this.merged=!1}get isFit(){return!!this.data}}function bp(e){e.component.projection=ce(e)?xS(e):wS(e)}function xS(e){var t;if(e.hasProjection){const n=Te(e.specifiedProjection),i=!(n&&(n.scale!=null||n.translate!=null)),r=i?[e.getSizeSignalRef("width"),e.getSizeSignalRef("height")]:void 0,s=i?SS(e):void 0,o=new yp(e.projectionName(!0),{...(t=Te(e.config.projection))!=null?t:{},...n!=null?n:{}},r,s);return o.get("type")||o.set("type","equalEarth",!1),o}}function SS(e){const t=[],{encoding:n}=e;for(const i of[[st,rt],[We,ot]])(pe(n[i[0]])||pe(n[i[1]]))&&t.push({signal:e.getName("geojson_".concat(t.length))});return e.channelHasField(Re)&&e.typedFieldDef(Re).type===Ei&&t.push({signal:e.getName("geojson_".concat(t.length))}),t.length===0&&t.push(e.requestDataName(ee.Main)),t}function ES(e,t){const n=Go(vS,r=>!!(!Yn(e.explicit,r)&&!Yn(t.explicit,r)||Yn(e.explicit,r)&&Yn(t.explicit,r)&&ft(e.get(r),t.get(r))));if(ft(e.size,t.size)){if(n)return e;if(ft(e.explicit,{}))return t;if(ft(t.explicit,{}))return e}return null}function wS(e){if(e.children.length===0)return;let t;for(const i of e.children)bp(i);const n=Go(e.children,i=>{const r=i.component.projection;if(r)if(t){const s=ES(t,r);return s&&(t=s),!!s}else return t=r,!0;else return!0});if(t&&n){const i=e.projectionName(!0),r=new yp(i,t.specifiedProjection,t.size,j(t.data));for(const s of e.children){const o=s.component.projection;o&&(o.isFit&&r.data.push(...s.component.projection.data),s.renameProjection(o.get("name"),i),o.merged=!0)}return r}}function $S(e,t,n,i){var r,s;if(ar(t,n)){const o=ce(e)?(s=(r=e.axis(n))!=null?r:e.legend(n))!=null?s:{}:{},a=C(t,{expr:"datum"}),c=C(t,{expr:"datum",binSuffix:"end"});return{formulaAs:C(t,{binSuffix:"range",forAs:!0}),formula:rr(a,c,o.format,o.formatType,i)}}return{}}function vp(e,t){return"".concat(Uu(e),"_").concat(t)}function OS(e,t){return{signal:e.getName("".concat(t,"_bins")),extentSignal:e.getName("".concat(t,"_extent"))}}function ec(e,t,n){var s;const i=(s=ps(n,void 0))!=null?s:{},r=vp(i,t);return e.getName("".concat(r,"_bins"))}function CS(e){return"as"in e}function Sl(e,t,n){let i,r;CS(e)?i=z(e.as)?[e.as,"".concat(e.as,"_end")]:[e.as[0],e.as[1]]:i=[C(e,{forAs:!0}),C(e,{binSuffix:"end",forAs:!0})];const s={...ps(t,void 0)},o=vp(s,e.field),{signal:a,extentSignal:c}=OS(n,o);if(ns(s.extent)){const u=s.extent;r=Jd(n,u.param,u),delete s.extent}const l={bin:s,field:e.field,as:[i],...a?{signal:a}:{},...c?{extentSignal:c}:{},...r?{span:r}:{}};return{key:o,binComponent:l}}class ht extends J{clone(){return new ht(null,j(this.bins))}constructor(t,n){super(t),this.bins=n}static makeFromEncoding(t,n){const i=n.reduceFieldDef((r,s,o)=>{if(Ce(s)&&ne(s.bin)){const{key:a,binComponent:c}=Sl(s,s.bin,n);r[a]={...c,...r[a],...$S(n,s,o,n.config)}}return r},{});return Q(i)?null:new ht(t,i)}static makeFromTransform(t,n,i){const{key:r,binComponent:s}=Sl(n,n.bin,i);return new ht(t,{[r]:s})}merge(t,n){for(const i of x(t.bins))i in this.bins?(n(t.bins[i].signal,this.bins[i].signal),this.bins[i].as=dt([...this.bins[i].as,...t.bins[i].as],W)):this.bins[i]=t.bins[i];for(const i of t.children)t.removeChild(i),i.parent=this;t.remove()}producedFields(){return new Set(Se(this.bins).map(t=>t.as).flat(2))}dependentFields(){return new Set(Se(this.bins).map(t=>t.field))}hash(){return"Bin ".concat(W(this.bins))}assemble(){return Se(this.bins).flatMap(t=>{const n=[],[i,...r]=t.as,{extent:s,...o}=t.bin,a={type:"bin",field:Be(t.field),as:i,signal:t.signal,...ns(s)?{extent:null}:{extent:s},...t.span?{span:{signal:"span(".concat(t.span,")")}}:{},...o};!s&&t.extentSignal&&(n.push({type:"extent",field:Be(t.field),signal:t.extentSignal}),a.extent={signal:t.extentSignal}),n.push(a);for(const c of r)for(let l=0;l<2;l++)n.push({type:"formula",expr:C({field:i[l]},{expr:"datum"}),as:c[l]});return t.formula&&n.push({type:"formula",expr:t.formula,as:t.formulaAs}),n})}}function NS(e,t,n,i){var s;const r=ce(i)?i.encoding[Et(t)]:void 0;if(Ce(n)&&ce(i)&&Pf(n,r,i.markDef,i.config))e.add(C(n,{})),e.add(C(n,{suffix:"end"})),n.bin&&ar(n,t)&&e.add(C(n,{binSuffix:"range"}));else if(Au(t)){const o=Tu(t);e.add(i.getName(o))}else e.add(C(n));return Un(n)&&yy((s=n.scale)==null?void 0:s.range)&&e.add(n.scale.range.field),e}function _S(e,t){var n;for(const i of x(t)){const r=t[i];for(const s of x(r))i in e?e[i][s]=new Set([...(n=e[i][s])!=null?n:[],...r[s]]):e[i]={[s]:r[s]}}}class Qe extends J{clone(){return new Qe(null,new Set(this.dimensions),j(this.measures))}constructor(t,n,i){super(t),this.dimensions=n,this.measures=i}get groupBy(){return this.dimensions}static makeFromEncoding(t,n){let i=!1;n.forEachFieldDef(o=>{o.aggregate&&(i=!0)});const r={},s=new Set;return!i||(n.forEachFieldDef((o,a)=>{var u,f,d,p;const{aggregate:c,field:l}=o;if(c)if(c==="count")(u=r["*"])!=null||(r["*"]={}),r["*"].count=new Set([C(o,{forAs:!0})]);else{if(It(c)||sn(c)){const g=It(c)?"argmin":"argmax",h=c[g];(f=r[h])!=null||(r[h]={}),r[h][g]=new Set([C({op:g,field:h},{forAs:!0})])}else(d=r[l])!=null||(r[l]={}),r[l][c]=new Set([C(o,{forAs:!0})]);jt(a)&&n.scaleDomain(a)==="unaggregated"&&((p=r[l])!=null||(r[l]={}),r[l].min=new Set([C({field:l,aggregate:"min"},{forAs:!0})]),r[l].max=new Set([C({field:l,aggregate:"max"},{forAs:!0})]))}else NS(s,a,o,n)}),s.size+x(r).length===0)?null:new Qe(t,s,r)}static makeFromTransform(t,n){var s,o,a;const i=new Set,r={};for(const c of n.aggregate){const{op:l,field:u,as:f}=c;l&&(l==="count"?((s=r["*"])!=null||(r["*"]={}),r["*"].count=new Set([f||C(c,{forAs:!0})])):((o=r[u])!=null||(r[u]={}),r[u][l]=new Set([f||C(c,{forAs:!0})])))}for(const c of(a=n.groupby)!=null?a:[])i.add(c);return i.size+x(r).length===0?null:new Qe(t,i,r)}merge(t){return Su(this.dimensions,t.dimensions)?(_S(this.measures,t.measures),!0):(Bm("different dimensions, cannot merge"),!1)}addDimensions(t){t.forEach(this.dimensions.add,this.dimensions)}dependentFields(){return new Set([...this.dimensions,...x(this.measures)])}producedFields(){const t=new Set;for(const n of x(this.measures))for(const i of x(this.measures[n])){const r=this.measures[n][i];r.size===0?t.add("".concat(i,"_").concat(n)):r.forEach(t.add,t)}return t}hash(){return"Aggregate ".concat(W({dimensions:this.dimensions,measures:this.measures}))}assemble(){const t=[],n=[],i=[];for(const s of x(this.measures))for(const o of x(this.measures[s]))for(const a of this.measures[s][o])i.push(a),t.push(o),n.push(s==="*"?null:Be(s));return{type:"aggregate",groupby:[...this.dimensions].map(Be),ops:t,fields:n,as:i}}}class Oi extends J{constructor(t,n,i,r){super(t),this.model=n,this.name=i,this.data=r;for(const s of Ue){const o=n.facet[s];if(o){const{bin:a,sort:c}=o;this[s]={name:n.getName("".concat(s,"_domain")),fields:[C(o),...ne(a)?[C(o,{binSuffix:"end"})]:[]],...pt(c)?{sortField:c}:I(c)?{sortIndexField:hi(o,s)}:{}}}}this.childModel=n.child}hash(){let t="Facet";for(const n of Ue)this[n]&&(t+=" ".concat(n.charAt(0),":").concat(W(this[n])));return t}get fields(){var n;const t=[];for(const i of Ue)(n=this[i])!=null&&n.fields&&t.push(...this[i].fields);return t}dependentFields(){const t=new Set(this.fields);for(const n of Ue)this[n]&&(this[n].sortField&&t.add(this[n].sortField.field),this[n].sortIndexField&&t.add(this[n].sortIndexField));return t}producedFields(){return new Set}getSource(){return this.name}getChildIndependentFieldsWithStep(){const t={};for(const n of wt){const i=this.childModel.component.scales[n];if(i&&!i.merged){const r=i.get("type"),s=i.get("range");if(ve(r)&&on(s)){const o=$s(this.childModel,n),a=rc(o);a?t[n]=a:S(ra(n))}}}return t}assembleRowColumnHeaderData(t,n,i){const r={row:"y",column:"x",facet:void 0}[t],s=[],o=[],a=[];r&&i&&i[r]&&(n?(s.push("distinct_".concat(i[r])),o.push("max")):(s.push(i[r]),o.push("distinct")),a.push("distinct_".concat(i[r])));const{sortField:c,sortIndexField:l}=this[t];if(c){const{op:u=ls,field:f}=c;s.push(f),o.push(u),a.push(C(c,{forAs:!0}))}else l&&(s.push(l),o.push("max"),a.push(l));return{name:this[t].name,source:n!=null?n:this.data,transform:[{type:"aggregate",groupby:this[t].fields,...s.length?{fields:s,ops:o,as:a}:{}}]}}assembleFacetHeaderData(t){var c,l;const{columns:n}=this.model.layout,{layoutHeaders:i}=this.model.component,r=[],s={};for(const u of Ka){for(const f of Ja){const d=(c=i[u]&&i[u][f])!=null?c:[];for(const p of d)if(((l=p.axes)==null?void 0:l.length)>0){s[u]=!0;break}}if(s[u]){const f='length(data("'.concat(this.facet.name,'"))'),d=u==="row"?n?{signal:"ceil(".concat(f," / ").concat(n,")")}:1:n?{signal:"min(".concat(f,", ").concat(n,")")}:{signal:f};r.push({name:"".concat(this.facet.name,"_").concat(u),transform:[{type:"sequence",start:0,stop:d}]})}}const{row:o,column:a}=s;return(o||a)&&r.unshift(this.assembleRowColumnHeaderData("facet",null,t)),r}assemble(){var a,c;const t=[];let n=null;const i=this.getChildIndependentFieldsWithStep(),{column:r,row:s,facet:o}=this;if(r&&s&&(i.x||i.y)){n="cross_".concat(this.column.name,"_").concat(this.row.name);const l=[].concat((a=i.x)!=null?a:[],(c=i.y)!=null?c:[]),u=l.map(()=>"distinct");t.push({name:n,source:this.data,transform:[{type:"aggregate",groupby:this.fields,fields:l,ops:u}]})}for(const l of[At,Tt])this[l]&&t.push(this.assembleRowColumnHeaderData(l,n,i));if(o){const l=this.assembleFacetHeaderData(i);l&&t.push(...l)}return t}}function El(e){return e.startsWith("'")&&e.endsWith("'")||e.startsWith('"')&&e.endsWith('"')?e.slice(1,-1):e}function TS(e,t){const n=Xo(e);if(t==="number")return"toNumber(".concat(n,")");if(t==="boolean")return"toBoolean(".concat(n,")");if(t==="string")return"toString(".concat(n,")");if(t==="date")return"toDate(".concat(n,")");if(t==="flatten")return n;if(t.startsWith("date:")){const i=El(t.slice(5,t.length));return"timeParse(".concat(n,",'").concat(i,"')")}else if(t.startsWith("utc:")){const i=El(t.slice(4,t.length));return"utcParse(".concat(n,",'").concat(i,"')")}else return S(Yh(t)),null}function AS(e){const t={};return $r(e.filter,n=>{var i;if(pf(n)){let r=null;ca(n)?r=ze(n.equal):ua(n)?r=ze(n.lte):la(n)?r=ze(n.lt):fa(n)?r=ze(n.gt):da(n)?r=ze(n.gte):pa(n)?r=n.range[0]:ga(n)&&(r=((i=n.oneOf)!=null?i:n.in)[0]),r&&(jn(r)?t[n.field]="date":fe(r)?t[n.field]="number":z(r)&&(t[n.field]="string")),n.timeUnit&&(t[n.field]="date")}}),t}function FS(e){const t={};function n(i){fi(i)?t[i.field]="date":i.type==="quantitative"&&Nh(i.aggregate)?t[i.field]="number":ri(i.field)>1?i.field in t||(t[i.field]="flatten"):Un(i)&&pt(i.sort)&&ri(i.sort.field)>1&&(i.sort.field in t||(t[i.sort.field]="flatten"))}if((ce(e)||Ze(e))&&e.forEachFieldDef((i,r)=>{if(Ce(i))n(i);else{const s=zn(r),o=e.fieldDef(s);n({...i,type:o.type})}}),ce(e)){const{mark:i,markDef:r,encoding:s}=e;if(an(i)&&!e.encoding.order){const o=r.orient==="horizontal"?"y":"x",a=s[o];w(a)&&a.type==="quantitative"&&!(a.field in t)&&(t[a.field]="number")}}return t}function kS(e){const t={};if(ce(e)&&e.component.selection)for(const n of x(e.component.selection)){const i=e.component.selection[n];for(const r of i.project.items)!r.channel&&ri(r.field)>1&&(t[r.field]="flatten")}return t}class $e extends J{clone(){return new $e(null,j(this._parse))}constructor(t,n){super(t),this._parse=n}hash(){return"Parse ".concat(W(this._parse))}static makeExplicit(t,n,i){var o;let r={};const s=n.data;return!Ht(s)&&((o=s==null?void 0:s.format)!=null&&o.parse)&&(r=s.format.parse),this.makeWithAncestors(t,r,{},i)}static makeWithAncestors(t,n,i,r){for(const a of x(i)){const c=r.getWithExplicit(a);c.value!==void 0&&(c.explicit||c.value===i[a]||c.value==="derived"||i[a]==="flatten"?delete i[a]:S(Rc(a,i[a],c.value)))}for(const a of x(n)){const c=r.get(a);c!==void 0&&(c===n[a]?delete n[a]:S(Rc(a,n[a],c)))}const s=new Ut(n,i);r.copyAll(s);const o={};for(const a of x(s.combine())){const c=s.get(a);c!==null&&(o[a]=c)}return x(o).length===0||r.parseNothing?null:new $e(t,o)}get parse(){return this._parse}merge(t){this._parse={...this._parse,...t.parse},t.remove()}assembleFormatParse(){const t={};for(const n of x(this._parse)){const i=this._parse[n];ri(n)===1&&(t[n]=i)}return t}producedFields(){return new Set(x(this._parse))}dependentFields(){return new Set(x(this._parse))}assembleTransforms(t=!1){return x(this._parse).filter(n=>t?ri(n)>1:!0).map(n=>{const i=TS(n,this._parse[n]);return i?{type:"formula",expr:i,as:Vo(n)}:null}).filter(n=>n!==null)}}class Qt extends J{clone(){return new Qt(null)}constructor(t){super(t)}dependentFields(){return new Set}producedFields(){return new Set([tt])}hash(){return"Identifier"}assemble(){return{type:"identifier",as:tt}}}class ur extends J{clone(){return new ur(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){}hash(){return"Graticule ".concat(W(this.params))}assemble(){return{type:"graticule",...this.params===!0?{}:this.params}}}class fr extends J{clone(){return new fr(null,this.params)}constructor(t,n){super(t),this.params=n}dependentFields(){return new Set}producedFields(){var t;return new Set([(t=this.params.as)!=null?t:"data"])}hash(){return"Hash ".concat(W(this.params))}assemble(){return{type:"sequence",...this.params}}}class Rn extends J{constructor(t){super(null),t!=null||(t={name:"source"});let n;if(Ht(t)||(n=t.format?{...Ae(t.format,["parse"])}:{}),qi(t))this._data={values:t.values};else if(di(t)){if(this._data={url:t.url},!n.type){let i=/(?:\.([^.]+))?$/.exec(t.url)[1];G(["json","csv","tsv","dsv","topojson"],i)||(i="json"),n.type=i}}else _d(t)?this._data={values:[{type:"Sphere"}]}:(Cd(t)||Ht(t))&&(this._data={});this._generator=Ht(t),t.name&&(this._name=t.name),n&&!Q(n)&&(this._data.format=n)}dependentFields(){return new Set}producedFields(){}get data(){return this._data}hasName(){return!!this._name}get isGenerator(){return this._generator}get dataName(){return this._name}set dataName(t){this._name=t}set parent(t){throw new Error("Source nodes have to be roots.")}remove(){throw new Error("Source nodes are roots and cannot be removed.")}hash(){throw new Error("Cannot hash sources")}assemble(){return{name:this._name,...this._data,transform:[]}}}var wl=globalThis&&globalThis.__classPrivateFieldSet||function(e,t,n,i,r){if(i==="m")throw new TypeError("Private method is not writable");if(i==="a"&&!r)throw new TypeError("Private accessor was defined without a setter");if(typeof t=="function"?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return i==="a"?r.call(e,n):r?r.value=n:t.set(e,n),n},IS=globalThis&&globalThis.__classPrivateFieldGet||function(e,t,n,i){if(n==="a"&&!i)throw new TypeError("Private accessor was defined without a getter");if(typeof t=="function"?e!==t||!i:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return n==="m"?i:n==="a"?i.call(e):i?i.value:t.get(e)},zi;function tc(e){return e instanceof Rn||e instanceof ur||e instanceof fr}class nc{constructor(){zi.set(this,void 0),wl(this,zi,!1,"f")}setModified(){wl(this,zi,!0,"f")}get modifiedFlag(){return IS(this,zi,"f")}}zi=new WeakMap;class Bn extends nc{getNodeDepths(t,n,i){i.set(t,n);for(const r of t.children)this.getNodeDepths(r,n+1,i);return i}optimize(t){const i=[...this.getNodeDepths(t,0,new Map).entries()].sort((r,s)=>s[1]-r[1]);for(const r of i)this.run(r[0]);return this.modifiedFlag}}class ic extends nc{optimize(t){this.run(t);for(const n of t.children)this.optimize(n);return this.modifiedFlag}}class RS extends ic{mergeNodes(t,n){const i=n.shift();for(const r of n)t.removeChild(r),r.parent=i,r.remove()}run(t){const n=t.children.map(r=>r.hash()),i={};for(let r=0;r<n.length;r++)i[n[r]]===void 0?i[n[r]]=[t.children[r]]:i[n[r]].push(t.children[r]);for(const r of x(i))i[r].length>1&&(this.setModified(),this.mergeNodes(t,i[r]))}}class LS extends ic{constructor(t){super(),this.requiresSelectionId=t&&Ya(t)}run(t){t instanceof Qt&&(this.requiresSelectionId&&(tc(t.parent)||t.parent instanceof Qe||t.parent instanceof $e)||(this.setModified(),t.remove()))}}class PS extends nc{optimize(t){return this.run(t,new Set),this.modifiedFlag}run(t,n){let i=new Set;t instanceof gt&&(i=t.producedFields(),Ho(i,n)&&(this.setModified(),t.removeFormulas(n),t.producedFields.length===0&&t.remove()));for(const r of t.children)this.run(r,new Set([...n,...i]))}}class zS extends ic{constructor(){super()}run(t){t instanceof Oe&&!t.isRequired()&&(this.setModified(),t.remove())}}class DS extends Bn{run(t){if(!tc(t)&&!(t.numChildren()>1)){for(const n of t.children)if(n instanceof $e)if(t instanceof $e)this.setModified(),t.merge(n);else{if(qo(t.producedFields(),n.dependentFields()))continue;this.setModified(),n.swapWithParent()}}}}class jS extends Bn{run(t){const n=[...t.children],i=t.children.filter(r=>r instanceof $e);if(t.numChildren()>1&&i.length>=1){const r={},s=new Set;for(const o of i){const a=o.parse;for(const c of x(a))c in r?r[c]!==a[c]&&s.add(c):r[c]=a[c]}for(const o of s)delete r[o];if(!Q(r)){this.setModified();const o=new $e(t,r);for(const a of n){if(a instanceof $e)for(const c of x(r))delete a.parse[c];t.removeChild(a),a.parent=o,a instanceof $e&&x(a.parse).length===0&&a.remove()}}}}}class MS extends Bn{run(t){t instanceof Oe||t.numChildren()>0||t instanceof Oi||t instanceof Rn||(this.setModified(),t.remove())}}class US extends Bn{run(t){const n=t.children.filter(r=>r instanceof gt),i=n.pop();for(const r of n)this.setModified(),i.merge(r)}}class BS extends Bn{run(t){const n=t.children.filter(r=>r instanceof Qe),i={};for(const r of n){const s=W(r.groupBy);s in i||(i[s]=[]),i[s].push(r)}for(const r of x(i)){const s=i[r];if(s.length>1){const o=s.pop();for(const a of s)o.merge(a)&&(t.removeChild(a),a.parent=o,a.remove(),this.setModified())}}}}class WS extends Bn{constructor(t){super(),this.model=t}run(t){const n=!(tc(t)||t instanceof $i||t instanceof $e||t instanceof Qt),i=[],r=[];for(const s of t.children)s instanceof ht&&(n&&!qo(t.producedFields(),s.dependentFields())?i.push(s):r.push(s));if(i.length>0){const s=i.pop();for(const o of i)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified(),t instanceof ht?t.merge(s,this.model.renameSignal.bind(this.model)):s.swapWithParent()}if(r.length>1){const s=r.pop();for(const o of r)s.merge(o,this.model.renameSignal.bind(this.model));this.setModified()}}}class GS extends Bn{run(t){const n=[...t.children];if(!On(n,o=>o instanceof Oe)||t.numChildren()<=1)return;const r=[];let s;for(const o of n)if(o instanceof Oe){let a=o;for(;a.numChildren()===1;){const[c]=a.children;if(c instanceof Oe)a=c;else break}r.push(...a.children),s?(t.removeChild(o),o.parent=s.parent,s.parent.removeChild(s),s.parent=a,this.setModified()):s=a}else r.push(o);if(r.length){this.setModified();for(const o of r)o.parent.removeChild(o),o.parent=s}}}class Wn extends J{clone(){return new Wn(null,j(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=dt(this.transform.groupby.concat(t),n=>n)}dependentFields(){const t=new Set;return this.transform.groupby&&this.transform.groupby.forEach(t.add,t),this.transform.joinaggregate.map(n=>n.field).filter(n=>n!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.joinaggregate.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!=null?n:C(t)}hash(){return"JoinAggregateTransform ".concat(W(this.transform))}assemble(){const t=[],n=[],i=[];for(const s of this.transform.joinaggregate)n.push(s.op),i.push(this.getDefaultName(s)),t.push(s.field===void 0?null:s.field);const r=this.transform.groupby;return{type:"joinaggregate",as:i,ops:n,fields:t,...r!==void 0?{groupby:r}:{}}}}function HS(e){return e.stack.stackBy.reduce((t,n)=>{const i=n.fieldDef,r=C(i);return r&&t.push(r),t},[])}function qS(e){return I(e)&&e.every(t=>z(t))&&e.length>1}class kt extends J{clone(){return new kt(null,j(this._stack))}constructor(t,n){super(t),this._stack=n}static makeFromTransform(t,n){const{stack:i,groupby:r,as:s,offset:o="zero"}=n,a=[],c=[];if(n.sort!==void 0)for(const f of n.sort)a.push(f.field),c.push(de(f.order,"ascending"));const l={field:a,order:c};let u;return qS(s)?u=s:z(s)?u=[s,"".concat(s,"_end")]:u=["".concat(n.stack,"_start"),"".concat(n.stack,"_end")],new kt(t,{dimensionFieldDefs:[],stackField:i,groupby:r,offset:o,sort:l,facetby:[],as:u})}static makeFromEncoding(t,n){const i=n.stack,{encoding:r}=n;if(!i)return null;const{groupbyChannels:s,fieldChannel:o,offset:a,impute:c}=i,l=s.map(p=>{const g=r[p];return yt(g)}).filter(p=>!!p),u=HS(n),f=n.encoding.order;let d;if(I(f)||w(f))d=qu(f);else{const p=zf(f)?f.sort:o==="y"?"descending":"ascending";d=u.reduce((g,h)=>(g.field.push(h),g.order.push(p),g),{field:[],order:[]})}return new kt(t,{dimensionFieldDefs:l,stackField:n.vgField(o),facetby:[],stackby:u,sort:d,offset:a,impute:c,as:[n.vgField(o,{suffix:"start",forAs:!0}),n.vgField(o,{suffix:"end",forAs:!0})]})}get stack(){return this._stack}addDimensions(t){this._stack.facetby.push(...t)}dependentFields(){const t=new Set;return t.add(this._stack.stackField),this.getGroupbyFields().forEach(t.add,t),this._stack.facetby.forEach(t.add,t),this._stack.sort.field.forEach(t.add,t),t}producedFields(){return new Set(this._stack.as)}hash(){return"Stack ".concat(W(this._stack))}getGroupbyFields(){const{dimensionFieldDefs:t,impute:n,groupby:i}=this._stack;return t.length>0?t.map(r=>r.bin?n?[C(r,{binSuffix:"mid"})]:[C(r,{}),C(r,{binSuffix:"end"})]:[C(r)]).flat():i!=null?i:[]}assemble(){const t=[],{facetby:n,dimensionFieldDefs:i,stackField:r,stackby:s,sort:o,offset:a,impute:c,as:l}=this._stack;if(c)for(const u of i){const{bandPosition:f=.5,bin:d}=u;if(d){const p=C(u,{expr:"datum"}),g=C(u,{expr:"datum",binSuffix:"end"});t.push({type:"formula",expr:"".concat(f,"*").concat(p,"+").concat(1-f,"*").concat(g),as:C(u,{binSuffix:"mid",forAs:!0})})}t.push({type:"impute",field:r,groupby:[...s,...n],key:C(u,{binSuffix:"mid"}),method:"value",value:0})}return t.push({type:"stack",groupby:[...this.getGroupbyFields(),...n],field:r,sort:o,as:l,offset:a}),t}}class Ci extends J{clone(){return new Ci(null,j(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){this.transform.groupby=dt(this.transform.groupby.concat(t),n=>n)}dependentFields(){var n,i;const t=new Set;return((n=this.transform.groupby)!=null?n:[]).forEach(t.add,t),((i=this.transform.sort)!=null?i:[]).forEach(r=>t.add(r.field)),this.transform.window.map(r=>r.field).filter(r=>r!==void 0).forEach(t.add,t),t}producedFields(){return new Set(this.transform.window.map(this.getDefaultName))}getDefaultName(t){var n;return(n=t.as)!=null?n:C(t)}hash(){return"WindowTransform ".concat(W(this.transform))}assemble(){var f;const t=[],n=[],i=[],r=[];for(const d of this.transform.window)n.push(d.op),i.push(this.getDefaultName(d)),r.push(d.param===void 0?null:d.param),t.push(d.field===void 0?null:d.field);const s=this.transform.frame,o=this.transform.groupby;if(s&&s[0]===null&&s[1]===null&&n.every(d=>na(d)))return{type:"joinaggregate",as:i,ops:n,fields:t,...o!==void 0?{groupby:o}:{}};const a=[],c=[];if(this.transform.sort!==void 0)for(const d of this.transform.sort)a.push(d.field),c.push((f=d.order)!=null?f:"ascending");const l={field:a,order:c},u=this.transform.ignorePeers;return{type:"window",params:r,as:i,ops:n,fields:t,sort:l,...u!==void 0?{ignorePeers:u}:{},...o!==void 0?{groupby:o}:{},...s!==void 0?{frame:s}:{}}}}function XS(e){function t(n){if(!(n instanceof Oi)){const i=n.clone();if(i instanceof Oe){const r=ko+i.getSource();i.setSource(r),e.model.component.data.outputNodes[r]=i}else(i instanceof Qe||i instanceof kt||i instanceof Ci||i instanceof Wn)&&i.addDimensions(e.fields);for(const r of n.children.flatMap(t))r.parent=i;return[i]}return n.children.flatMap(t)}return t}function Fo(e){if(e instanceof Oi)if(e.numChildren()===1&&!(e.children[0]instanceof Oe)){const t=e.children[0];(t instanceof Qe||t instanceof kt||t instanceof Ci||t instanceof Wn)&&t.addDimensions(e.fields),t.swapWithParent(),Fo(e)}else{const t=e.model.component.data.main;xp(t);const n=XS(e),i=e.children.map(n).flat();for(const r of i)r.parent=t}else e.children.map(Fo)}function xp(e){if(e instanceof Oe&&e.type===ee.Main&&e.numChildren()===1){const t=e.children[0];t instanceof Oi||(t.swapWithParent(),xp(e))}}const ko="scale_",mr=5;function Io(e){for(const t of e){for(const n of t.children)if(n.parent!==t)return!1;if(!Io(t.children))return!1}return!0}function qe(e,t){let n=!1;for(const i of t)n=e.optimize(i)||n;return n}function $l(e,t,n){let i=e.sources,r=!1;return r=qe(new zS,i)||r,r=qe(new LS(t),i)||r,i=i.filter(s=>s.numChildren()>0),r=qe(new MS,i)||r,i=i.filter(s=>s.numChildren()>0),n||(r=qe(new DS,i)||r,r=qe(new WS(t),i)||r,r=qe(new PS,i)||r,r=qe(new jS,i)||r,r=qe(new BS,i)||r,r=qe(new US,i)||r,r=qe(new RS,i)||r,r=qe(new GS,i)||r),e.sources=i,r}function VS(e,t){Io(e.sources);let n=0,i=0;for(let r=0;r<mr&&$l(e,t,!0);r++)n++;e.sources.map(Fo);for(let r=0;r<mr&&$l(e,t,!1);r++)i++;Io(e.sources),Math.max(n,i)===mr&&S("Maximum optimization runs(".concat(mr,") reached."))}class ke{constructor(t){Object.defineProperty(this,"signal",{enumerable:!0,get:t})}static fromName(t,n){return new ke(()=>t(n))}}function Sp(e){ce(e)?YS(e):KS(e)}function YS(e){const t=e.component.scales;for(const n of x(t)){const i=QS(e,n);if(t[n].setWithExplicit("domains",i),eE(e,n),e.component.data.isFaceted){let s=e;for(;!Ze(s)&&s.parent;)s=s.parent;if(s.component.resolve.scale[n]==="shared")for(const a of i.value)_t(a)&&(a.data=ko+a.data.replace(ko,""))}}}function KS(e){for(const n of e.children)Sp(n);const t=e.component.scales;for(const n of x(t)){let i,r=null;for(const s of e.children){const o=s.component.scales[n];if(o){i===void 0?i=o.getWithExplicit("domains"):i=Yt(i,o.getWithExplicit("domains"),"domains","scale",Ro);const a=o.get("selectionExtent");r&&a&&r.param!==a.param&&S(Hh),r=a}}t[n].setWithExplicit("domains",i),r&&t[n].set("selectionExtent",r,!0)}}function JS(e,t,n,i){if(e==="unaggregated"){const{valid:r,reason:s}=Ol(t,n);if(!r){S(s);return}}else if(e===void 0&&i.useUnaggregatedDomain){const{valid:r}=Ol(t,n);if(r)return"unaggregated"}return e}function QS(e,t){const n=e.getScaleComponent(t).get("type"),{encoding:i}=e,r=JS(e.scaleDomain(t),e.typedFieldDef(t),n,e.config.scale);return r!==e.scaleDomain(t)&&(e.specifiedScales[t]={...e.specifiedScales[t],domain:r}),t==="x"&&pe(i.x2)?pe(i.x)?Yt(Bt(n,r,e,"x"),Bt(n,r,e,"x2"),"domain","scale",Ro):Bt(n,r,e,"x2"):t==="y"&&pe(i.y2)?pe(i.y)?Yt(Bt(n,r,e,"y"),Bt(n,r,e,"y2"),"domain","scale",Ro):Bt(n,r,e,"y2"):Bt(n,r,e,t)}function ZS(e,t,n){return e.map(i=>{const r=gs(i,{timeUnit:n,type:t});return{signal:"{data: ".concat(r,"}")}})}function Xs(e,t,n){var r;const i=(r=me(n))==null?void 0:r.unit;return t==="temporal"||i?ZS(e,t,i):[e]}function Bt(e,t,n,i){const{encoding:r}=n,s=pe(r[i]),{type:o}=s,a=s.timeUnit;if(my(t)){const f=Bt(e,void 0,n,i),d=Xs(t.unionWith,o,a);return ut([...d,...f.value])}else{if(R(t))return ut([t]);if(t&&t!=="unaggregated"&&!xf(t))return ut(Xs(t,o,a))}const c=n.stack;if(c&&i===c.fieldChannel){if(c.offset==="normalize")return Pe([[0,1]]);const f=n.requestDataName(ee.Main);return Pe([{data:f,field:n.vgField(i,{suffix:"start"})},{data:f,field:n.vgField(i,{suffix:"end"})}])}const l=jt(i)&&w(s)?tE(n,i,e):void 0;if($t(s)){const f=Xs([s.datum],o,a);return Pe(f)}const u=s;if(t==="unaggregated"){const f=n.requestDataName(ee.Main),{field:d}=s;return Pe([{data:f,field:C({field:d,aggregate:"min"})},{data:f,field:C({field:d,aggregate:"max"})}])}else if(ne(u.bin)){if(ve(e))return Pe(e==="bin-ordinal"?[]:[{data:Gi(l)?n.requestDataName(ee.Main):n.requestDataName(ee.Raw),field:n.vgField(i,ar(u,i)?{binSuffix:"range"}:{}),sort:l===!0||!X(l)?{field:n.vgField(i,{}),op:"min"}:l}]);{const{bin:f}=u;if(ne(f)){const d=ec(n,u.field,f);return Pe([new ke(()=>{const p=n.getSignalName(d);return"[".concat(p,".start, ").concat(p,".stop]")})])}else return Pe([{data:n.requestDataName(ee.Main),field:n.vgField(i,{})}])}}else if(u.timeUnit&&G(["time","utc"],e)&&Pf(u,ce(n)?n.encoding[Et(i)]:void 0,n.markDef,n.config)){const f=n.requestDataName(ee.Main);return Pe([{data:f,field:n.vgField(i)},{data:f,field:n.vgField(i,{suffix:"end"})}])}else return Pe(l?[{data:Gi(l)?n.requestDataName(ee.Main):n.requestDataName(ee.Raw),field:n.vgField(i),sort:l}]:[{data:n.requestDataName(ee.Main),field:n.vgField(i)}])}function Vs(e,t){const{op:n,field:i,order:r}=e;return{op:n!=null?n:t?"sum":ls,...i?{field:Be(i)}:{},...r?{order:r}:{}}}function eE(e,t){var a;const n=e.component.scales[t],i=e.specifiedScales[t].domain,r=(a=e.fieldDef(t))==null?void 0:a.bin,s=xf(i)&&i,o=Dn(r)&&ns(r.extent)&&r.extent;(s||o)&&n.set("selectionExtent",s!=null?s:o,!0)}function tE(e,t,n){if(!ve(n))return;const i=e.fieldDef(t),r=i.sort;if(If(r))return{op:"min",field:hi(i,t),order:"ascending"};const{stack:s}=e,o=s?new Set([...s.groupbyFields,...s.stackBy.map(a=>a.fieldDef.field)]):void 0;if(pt(r)){const a=s&&!o.has(r.field);return Vs(r,a)}else if(kf(r)){const{encoding:a,order:c}=r,l=e.fieldDef(a),{aggregate:u,field:f}=l,d=s&&!o.has(f);if(It(u)||sn(u))return Vs({field:C(l),order:c},d);if(na(u)||!u)return Vs({op:u,field:f,order:c},d)}else{if(r==="descending")return{op:"min",field:e.vgField(t),order:"descending"};if(G(["ascending",void 0],r))return!0}}function Ol(e,t){const{aggregate:n,type:i}=e;return n?z(n)&&!Th.has(n)?{valid:!1,reason:vm(n)}:i==="quantitative"&&t==="log"?{valid:!1,reason:xm(e)}:{valid:!0}:{valid:!1,reason:bm(e)}}function Ro(e,t,n,i){return e.explicit&&t.explicit&&S(Om(n,i,e.value,t.value)),{explicit:e.explicit,value:[...e.value,...t.value]}}function nE(e){const t=dt(e.map(o=>{if(_t(o)){const{sort:a,...c}=o;return c}return o}),W),n=dt(e.map(o=>{if(_t(o)){const a=o.sort;return a!==void 0&&!Gi(a)&&("op"in a&&a.op==="count"&&delete a.field,a.order==="ascending"&&delete a.order),a}}).filter(o=>o!==void 0),W);if(t.length===0)return;if(t.length===1){const o=e[0];if(_t(o)&&n.length>0){let a=n[0];if(n.length>1){S(Pc);const c=n.filter(l=>X(l)&&"op"in l&&l.op!=="min");n.every(l=>X(l)&&"op"in l)&&c.length===1?a=c[0]:a=!0}else if(X(a)&&"field"in a){const c=a.field;o.field===c&&(a=a.order?{order:a.order}:!0)}return{...o,sort:a}}return o}const i=dt(n.map(o=>Gi(o)||!("op"in o)||z(o.op)&&o.op in Oh?o:(S(Nm(o)),!0)),W);let r;i.length===1?r=i[0]:i.length>1&&(S(Pc),r=!0);const s=dt(e.map(o=>_t(o)?o.data:null),o=>o);return s.length===1&&s[0]!==null?{data:s[0],fields:t.map(a=>a.field),...r?{sort:r}:{}}:{fields:t,...r?{sort:r}:{}}}function rc(e){if(_t(e)&&z(e.field))return e.field;if(Ah(e)){let t;for(const n of e.fields)if(_t(n)&&z(n.field)){if(!t)t=n.field;else if(t!==n.field)return S(_m),t}return S(Tm),t}else if(Fh(e)){S(Am);const t=e.fields[0];return z(t)?t:void 0}}function $s(e,t){const i=e.component.scales[t].get("domains").map(r=>(_t(r)&&(r.data=e.lookupDataSource(r.data)),r));return nE(i)}function Ep(e){return Ni(e)||sc(e)?e.children.reduce((t,n)=>t.concat(Ep(n)),Cl(e)):Cl(e)}function Cl(e){return x(e.component.scales).reduce((t,n)=>{const i=e.component.scales[n];if(i.merged)return t;const r=i.combine(),{name:s,type:o,selectionExtent:a,domains:c,range:l,reverse:u,...f}=r,d=iE(r.range,s,n,e),p=$s(e,n),g=a?Jv(e,a,i,p):null;return t.push({name:s,type:o,...p?{domain:p}:{},...g?{domainRaw:g}:{},range:d,...u!==void 0?{reverse:u}:{},...f}),t},[])}function iE(e,t,n,i){if(be(n)){if(on(e))return{step:{signal:"".concat(t,"_step")}}}else if(X(e)&&_t(e))return{...e,data:i.lookupDataSource(e.data)};return e}class wp extends Ut{constructor(t,n){super({},{name:t}),this.merged=!1,this.setWithExplicit("type",n)}domainDefinitelyIncludesZero(){return this.get("zero")!==!1?!0:On(this.get("domains"),t=>I(t)&&t.length===2&&t[0]<=0&&t[1]>=0)}}const rE=["range","scheme"];function sE(e){const t=e.component.scales;for(const n of ts){const i=t[n];if(!i)continue;const r=oE(n,e);i.setWithExplicit("range",r)}}function Nl(e,t){const n=e.fieldDef(t);if(n!=null&&n.bin){const{bin:i,field:r}=n,s=Le(t),o=e.getName(s);if(X(i)&&i.binned&&i.step!==void 0)return new ke(()=>{const a=e.scaleName(t),c='(domain("'.concat(a,'")[1] - domain("').concat(a,'")[0]) / ').concat(i.step);return"".concat(e.getSignalName(o)," / (").concat(c,")")});if(ne(i)){const a=ec(e,r,i);return new ke(()=>{const c=e.getSignalName(a),l="(".concat(c,".stop - ").concat(c,".start) / ").concat(c,".step");return"".concat(e.getSignalName(o)," / (").concat(l,")")})}}}function oE(e,t){const n=t.specifiedScales[e],{size:i}=t,s=t.getScaleComponent(e).get("type");for(const f of rE)if(n[f]!==void 0){const d=yo(s,f),p=Sf(e,f);if(!d)S(Zu(s,f,e));else if(p)S(p);else switch(f){case"range":{const g=n.range;if(I(g)){if(be(e))return ut(g.map(h=>{if(h==="width"||h==="height"){const m=t.getName(h),y=t.getSignalName.bind(t);return ke.fromName(y,m)}return h}))}else if(X(g))return ut({data:t.requestDataName(ee.Main),field:g.field,sort:{op:"min",field:t.vgField(e)}});return ut(g)}case"scheme":return ut(aE(n[f]))}}const o=e===oe||e==="xOffset"?"width":"height",a=i[o];if(bt(a)){if(be(e))if(ve(s)){const f=$p(a,t,e);if(f)return ut({step:f})}else S(ef(o));else if(Si(e)){const f=e===Zt?"x":"y";if(t.getScaleComponent(f).get("type")==="band"){const g=Op(a,s);if(g)return ut(g)}}}const{rangeMin:c,rangeMax:l}=n,u=cE(e,t);return(c!==void 0||l!==void 0)&&yo(s,"rangeMin")&&I(u)&&u.length===2?ut([c!=null?c:u[0],l!=null?l:u[1]]):Pe(u)}function aE(e){return hy(e)?{scheme:e.name,...Ae(e,["name"])}:{scheme:e}}function cE(e,t){const{size:n,config:i,mark:r,encoding:s}=t,o=t.getSignalName.bind(t),{type:a}=pe(s[e]),l=t.getScaleComponent(e).get("type"),{domain:u,domainMid:f}=t.specifiedScales[e];switch(e){case oe:case ye:{if(G(["point","band"],l)){const g=Cp(e,n,i.view);if(bt(g))return{step:$p(g,t,e)}}const d=Le(e),p=t.getName(d);return e===ye&&je(l)?[ke.fromName(o,p),0]:[0,ke.fromName(o,p)]}case Zt:case xi:return lE(e,t,l);case zt:{const d=t.component.scales[e].get("zero"),p=Np(r,d,i),g=dE(r,n,t,i);return ci(l)?fE(p,g,uE(l,i,u,e)):[p,g]}case Ge:return[0,Math.PI*2];case Pn:return[0,360];case it:return[0,new ke(()=>{const d=t.getSignalName("width"),p=t.getSignalName("height");return"min(".concat(d,",").concat(p,")/2")})];case nn:return[i.scale.minStrokeWidth,i.scale.maxStrokeWidth];case rn:return[[1,0],[4,2],[2,1],[1,1],[1,2,4,2]];case Re:return"symbol";case Ie:case xt:case St:return l==="ordinal"?a==="nominal"?"category":"ordinal":f!==void 0?"diverging":r==="rect"||r==="geoshape"?"heatmap":"ramp";case Dt:case en:case tn:return[i.scale.minOpacity,i.scale.maxOpacity]}}function $p(e,t,n){var c,l,u,f,d;const{encoding:i}=t,r=t.getScaleComponent(n),s=Qo(n),o=i[s];if(dd({step:e,offsetIsDiscrete:M(o)&&hf(o.type)})==="offset"&&Vf(i,s)){const p=t.getScaleComponent(s),g=t.scaleName(s);let h="domain('".concat(g,"').length");if(p.get("type")==="band"){const y=(l=(c=p.get("paddingInner"))!=null?c:p.get("padding"))!=null?l:0,b=(f=(u=p.get("paddingOuter"))!=null?u:p.get("padding"))!=null?f:0;h="bandspace(".concat(h,", ").concat(y,", ").concat(b,")")}const m=(d=r.get("paddingInner"))!=null?d:r.get("padding");return{signal:"".concat(e.step," * ").concat(h," / (1-").concat(Lh(m),")")}}else return e.step}function Op(e,t){if(dd({step:e,offsetIsDiscrete:ve(t)})==="offset")return{step:e.step}}function lE(e,t,n){const i=e===Zt?"x":"y",s=t.getScaleComponent(i).get("type"),o=t.scaleName(i);if(s==="band"){const a=Cp(i,t.size,t.config.view);if(bt(a)){const c=Op(a,n);if(c)return c}return[0,{signal:"bandwidth('".concat(o,"')")}]}else{const a=t.encoding[i];if(w(a)&&a.timeUnit){const c=ff(a.timeUnit,u=>"scale('".concat(o,"', ").concat(u,")")),l=t.config.scale.bandWithNestedOffsetPaddingInner;if(l){const u=R(l)?"".concat(l.signal,"/2"):"".concat(l/2),f=R(l)?"(1 - ".concat(l.signal,"/2)"):"".concat(1-l/2);return[{signal:"".concat(u," * (").concat(c,")")},{signal:"".concat(f," * (").concat(c,")")}]}return[0,{signal:c}]}return vu("Cannot use ".concat(e," scale if ").concat(i," scale is not discrete."))}}function Cp(e,t,n){const i=e===oe?"width":"height",r=t[i];return r||Dr(n,i)}function uE(e,t,n,i){switch(e){case"quantile":return t.scale.quantileCount;case"quantize":return t.scale.quantizeCount;case"threshold":return n!==void 0&&I(n)?n.length+1:(S(jm(i)),3)}}function fE(e,t,n){const i=()=>{const r=Ye(t),s=Ye(e),o="(".concat(r," - ").concat(s,") / (").concat(n," - 1)");return"sequence(".concat(s,", ").concat(r," + ").concat(o,", ").concat(o,")")};return R(t)?new ke(i):{signal:i()}}function Np(e,t,n){if(t)return R(t)?{signal:"".concat(t.signal," ? 0 : ").concat(Np(e,!1,n))}:0;switch(e){case"bar":case"tick":return n.scale.minBandSize;case"line":case"trail":case"rule":return n.scale.minStrokeWidth;case"text":return n.scale.minFontSize;case"point":case"square":case"circle":return n.scale.minSize}throw new Error(is("size",e))}const _l=.95;function dE(e,t,n,i){const r={x:Nl(n,"x"),y:Nl(n,"y")};switch(e){case"bar":case"tick":{if(i.scale.maxBandSize!==void 0)return i.scale.maxBandSize;const s=Tl(t,r,i.view);return fe(s)?s-1:new ke(()=>"".concat(s.signal," - 1"))}case"line":case"trail":case"rule":return i.scale.maxStrokeWidth;case"text":return i.scale.maxFontSize;case"point":case"square":case"circle":{if(i.scale.maxSize)return i.scale.maxSize;const s=Tl(t,r,i.view);return fe(s)?Math.pow(_l*s,2):new ke(()=>"pow(".concat(_l," * ").concat(s.signal,", 2)"))}}throw new Error(is("size",e))}function Tl(e,t,n){const i=bt(e.width)?e.width.step:zr(n,"width"),r=bt(e.height)?e.height.step:zr(n,"height");return t.x||t.y?new ke(()=>{const s=[t.x?t.x.signal:i,t.y?t.y.signal:r];return"min(".concat(s.join(", "),")")}):Math.min(i,r)}function _p(e,t){ce(e)?pE(e,t):Ap(e,t)}function pE(e,t){const n=e.component.scales,{config:i,encoding:r,markDef:s,specifiedScales:o}=e;for(const a of x(n)){const c=o[a],l=n[a],u=e.getScaleComponent(a),f=pe(r[a]),d=c[t],p=u.get("type"),g=u.get("padding"),h=u.get("paddingInner"),m=yo(p,t),y=Sf(a,t);if(d!==void 0&&(m?y&&S(y):S(Zu(p,t,a))),m&&y===void 0)if(d!==void 0){const b=f.timeUnit,N=f.type;switch(t){case"domainMax":case"domainMin":jn(c[t])||N==="temporal"||b?l.set(t,{signal:gs(c[t],{type:N,timeUnit:b})},!0):l.set(t,c[t],!0);break;default:l.copyKeyFromObject(t,c)}}else{const b=t in Al?Al[t]({model:e,channel:a,fieldOrDatumDef:f,scaleType:p,scalePadding:g,scalePaddingInner:h,domain:c.domain,domainMin:c.domainMin,domainMax:c.domainMax,markDef:s,config:i,hasNestedOffsetScale:vo(r,a),hasSecondaryRangeChannel:!!r[Et(a)]}):i.scale[t];b!==void 0&&l.set(t,b,!1)}}}const Al={bins:({model:e,fieldOrDatumDef:t})=>w(t)?gE(e,t):void 0,interpolate:({channel:e,fieldOrDatumDef:t})=>hE(e,t.type),nice:({scaleType:e,channel:t,domain:n,domainMin:i,domainMax:r,fieldOrDatumDef:s})=>mE(e,t,n,i,r,s),padding:({channel:e,scaleType:t,fieldOrDatumDef:n,markDef:i,config:r})=>yE(e,t,r.scale,n,i,r.bar),paddingInner:({scalePadding:e,channel:t,markDef:n,scaleType:i,config:r,hasNestedOffsetScale:s})=>bE(e,t,n.type,i,r.scale,s),paddingOuter:({scalePadding:e,channel:t,scaleType:n,scalePaddingInner:i,config:r,hasNestedOffsetScale:s})=>vE(e,t,n,i,r.scale,s),reverse:({fieldOrDatumDef:e,scaleType:t,channel:n,config:i})=>{const r=w(e)?e.sort:void 0;return xE(t,r,n,i.scale)},zero:({channel:e,fieldOrDatumDef:t,domain:n,markDef:i,scaleType:r,config:s,hasSecondaryRangeChannel:o})=>SE(e,t,n,i,r,s.scale,o)};function Tp(e){ce(e)?sE(e):Ap(e,"range")}function Ap(e,t){const n=e.component.scales;for(const i of e.children)t==="range"?Tp(i):_p(i,t);for(const i of x(n)){let r;for(const s of e.children){const o=s.component.scales[i];if(o){const a=o.getWithExplicit(t);r=Yt(r,a,t,"scale",Od((c,l)=>{switch(t){case"range":return c.step&&l.step?c.step-l.step:0}return 0}))}}n[i].setWithExplicit(t,r)}}function gE(e,t){const n=t.bin;if(ne(n)){const i=ec(e,t.field,n);return new ke(()=>e.getSignalName(i))}else if(xe(n)&&Dn(n)&&n.step!==void 0)return{step:n.step}}function hE(e,t){if(G([Ie,xt,St],e)&&t!=="nominal")return"hcl"}function mE(e,t,n,i,r,s){var o;if(!((o=yt(s))!=null&&o.bin||I(n)||r!=null||i!=null||G([Fe.TIME,Fe.UTC],e)))return be(t)?!0:void 0}function yE(e,t,n,i,r,s){if(be(e)){if(Ke(t)){if(n.continuousPadding!==void 0)return n.continuousPadding;const{type:o,orient:a}=r;if(o==="bar"&&!(w(i)&&(i.bin||i.timeUnit))&&(a==="vertical"&&e==="x"||a==="horizontal"&&e==="y"))return s.continuousBandSize}if(t===Fe.POINT)return n.pointPadding}}function bE(e,t,n,i,r,s=!1){if(e===void 0){if(be(t)){const{bandPaddingInner:o,barBandPaddingInner:a,rectBandPaddingInner:c,bandWithNestedOffsetPaddingInner:l}=r;return s?l:de(o,n==="bar"?a:c)}else if(Si(t)&&i===Fe.BAND)return r.offsetBandPaddingInner}}function vE(e,t,n,i,r,s=!1){if(e===void 0){if(be(t)){const{bandPaddingOuter:o,bandWithNestedOffsetPaddingOuter:a}=r;if(s)return a;if(n===Fe.BAND)return de(o,R(i)?{signal:"".concat(i.signal,"/2")}:i/2)}else if(Si(t)){if(n===Fe.POINT)return .5;if(n===Fe.BAND)return r.offsetBandPaddingOuter}}}function xE(e,t,n,i){if(n==="x"&&i.xReverse!==void 0)return je(e)&&t==="descending"?R(i.xReverse)?{signal:"!".concat(i.xReverse.signal)}:!i.xReverse:i.xReverse;if(je(e)&&t==="descending")return!0}function SE(e,t,n,i,r,s,o){if(!!n&&n!=="unaggregated"&&je(r)){if(I(n)){const c=n[0],l=n[n.length-1];if(c<=0&&l>=0)return!0}return!1}if(e==="size"&&t.type==="quantitative"&&!ci(r))return!0;if(!(w(t)&&t.bin)&&G([...wt,...yh],e)){const{orient:c,type:l}=i;return G(["bar","area","line","trail"],l)&&(c==="horizontal"&&e==="y"||c==="vertical"&&e==="x")?!1:G(["bar","area"],l)&&!o?!0:s==null?void 0:s.zero}return!1}function EE(e,t,n,i,r=!1){const s=wE(t,n,i,r),{type:o}=e;return jt(t)?o!==void 0?Ey(t,o)?w(n)&&!Sy(o,n.type)?(S(wm(o,s)),s):o:(S(Em(t,o,s)),s):s:null}function wE(e,t,n,i){var r;switch(t.type){case"nominal":case"ordinal":{if(Qn(e)||js(e)==="discrete")return e==="shape"&&t.type==="ordinal"&&S(Ms(e,"ordinal")),"ordinal";if(be(e)||Si(e)){if(G(["rect","bar","image","rule"],n.type)||i)return"band"}else if(n.type==="arc"&&e in ta)return"band";const s=n[Le(e)];return An(s)||ui(t)&&((r=t.axis)!=null&&r.tickBand)?"band":"point"}case"temporal":return Qn(e)?"time":js(e)==="discrete"?(S(Ms(e,"temporal")),"ordinal"):w(t)&&t.timeUnit&&me(t.timeUnit).utc?"utc":"time";case"quantitative":return Qn(e)?w(t)&&ne(t.bin)?"bin-ordinal":"linear":js(e)==="discrete"?(S(Ms(e,"quantitative")),"ordinal"):"linear";case"geojson":return}throw new Error(Ju(t.type))}function $E(e,{ignoreRange:t}={}){Fp(e),Sp(e);for(const n of xy)_p(e,n);t||Tp(e)}function Fp(e){ce(e)?e.component.scales=OE(e):e.component.scales=NE(e)}function OE(e){const{encoding:t,mark:n,markDef:i}=e,r={};for(const s of ts){const o=pe(t[s]);if(o&&n===$f&&s===Re&&o.type===Ei)continue;let a=o&&o.scale;if(Si(s)){const c=Lu(s);if(!vo(t,c)){a&&S(cm(s));continue}}if(o&&a!==null&&a!==!1){a!=null||(a={});const c=vo(t,s),l=EE(a,s,o,i,c);r[s]=new wp(e.scaleName("".concat(s),!0),{value:l,explicit:a.type===l})}}return r}const CE=Od((e,t)=>Dc(e)-Dc(t));function NE(e){var s;var t;const n=e.component.scales={},i={},r=e.component.resolve;for(const o of e.children){Fp(o);for(const a of x(o.component.scales))if((s=(t=r.scale)[a])!=null||(t[a]=cp(a,e)),r.scale[a]==="shared"){const c=i[a],l=o.component.scales[a].getWithExplicit("type");c?uy(c.value,l.value)?i[a]=Yt(c,l,"type","scale",CE):(r.scale[a]="independent",delete i[a]):i[a]=l}}for(const o of x(i)){const a=e.scaleName(o,!0),c=i[o];n[o]=new wp(a,c);for(const l of e.children){const u=l.component.scales[o];u&&(l.renameScale(u.get("name"),a),u.merged=!0)}}return n}class Ys{constructor(){this.nameMap={}}rename(t,n){this.nameMap[t]=n}has(t){return this.nameMap[t]!==void 0}get(t){for(;this.nameMap[t]&&t!==this.nameMap[t];)t=this.nameMap[t];return t}}function ce(e){return(e==null?void 0:e.type)==="unit"}function Ze(e){return(e==null?void 0:e.type)==="facet"}function sc(e){return(e==null?void 0:e.type)==="concat"}function Ni(e){return(e==null?void 0:e.type)==="layer"}class oc{constructor(t,n,i,r,s,o,a){var c,l;this.type=n,this.parent=i,this.config=s,this.correctDataNames=u=>{var f,d,p;return(f=u.from)!=null&&f.data&&(u.from.data=this.lookupDataSource(u.from.data)),(p=(d=u.from)==null?void 0:d.facet)!=null&&p.data&&(u.from.facet.data=this.lookupDataSource(u.from.facet.data)),u},this.parent=i,this.config=s,this.view=Te(a),this.name=(c=t.name)!=null?c:r,this.title=Wt(t.title)?{text:t.title}:t.title?Te(t.title):void 0,this.scaleNameMap=i?i.scaleNameMap:new Ys,this.projectionNameMap=i?i.projectionNameMap:new Ys,this.signalNameMap=i?i.signalNameMap:new Ys,this.data=t.data,this.description=t.description,this.transforms=Rv((l=t.transform)!=null?l:[]),this.layout=n==="layer"||n==="unit"?{}:Db(t,n,s),this.component={data:{sources:i?i.component.data.sources:[],outputNodes:i?i.component.data.outputNodes:{},outputNodeRefCounts:i?i.component.data.outputNodeRefCounts:{},isFaceted:us(t)||(i==null?void 0:i.component.data.isFaceted)&&t.data===void 0},layoutSize:new Ut,layoutHeaders:{row:{},column:{},facet:{}},mark:null,resolve:{scale:{},axis:{},legend:{},...o?j(o):{}},selection:null,scales:null,projection:null,axes:{},legends:{}}}get width(){return this.getSizeSignalRef("width")}get height(){return this.getSizeSignalRef("height")}parse(){this.parseScale(),this.parseLayoutSize(),this.renameTopLevelLayoutSizeSignal(),this.parseSelections(),this.parseProjection(),this.parseData(),this.parseAxesAndHeaders(),this.parseLegends(),this.parseMarkGroup()}parseScale(){$E(this)}parseProjection(){bp(this)}renameTopLevelLayoutSizeSignal(){this.getName("width")!=="width"&&this.renameSignal(this.getName("width"),"width"),this.getName("height")!=="height"&&this.renameSignal(this.getName("height"),"height")}parseLegends(){pp(this)}assembleEncodeFromView(t){const{style:n,...i}=t,r={};for(const s of x(i)){const o=i[s];o!==void 0&&(r[s]=re(o))}return r}assembleGroupEncodeEntry(t){let n={};return this.view&&(n=this.assembleEncodeFromView(this.view)),!t&&(this.description&&(n.description=re(this.description)),this.type==="unit"||this.type==="layer")?{width:this.getSizeSignalRef("width"),height:this.getSizeSignalRef("height"),...n!=null?n:{}}:Q(n)?void 0:n}assembleLayout(){if(!this.layout)return;const{spacing:t,...n}=this.layout,{component:i,config:r}=this,s=Vx(i.layoutHeaders,r);return{padding:t,...this.assembleDefaultLayout(),...n,...s?{titleBand:s}:{}}}assembleDefaultLayout(){return{}}assembleHeaderMarks(){const{layoutHeaders:t}=this.component;let n=[];for(const i of Ue)t[i].title&&n.push(Bx(this,i));for(const i of Ka)n=n.concat(Wx(this,i));return n}assembleAxes(){return Tx(this.component.axes,this.config)}assembleLegends(){return hp(this)}assembleProjections(){return yS(this)}assembleTitle(){var r,s,o;const{encoding:t,...n}=(r=this.title)!=null?r:{},i={...Bu(this.config.title).nonMarkTitleProperties,...n,...t?{encode:{update:t}}:{}};if(i.text)return G(["unit","layer"],this.type)?G(["middle",void 0],i.anchor)&&((s=i.frame)!=null||(i.frame="group")):(o=i.anchor)!=null||(i.anchor="start"),Q(i)?void 0:i}assembleGroup(t=[]){const n={};t=t.concat(this.assembleSignals()),t.length>0&&(n.signals=t);const i=this.assembleLayout();i&&(n.layout=i),n.marks=[].concat(this.assembleHeaderMarks(),this.assembleMarks());const r=!this.parent||Ze(this.parent)?Ep(this):[];r.length>0&&(n.scales=r);const s=this.assembleAxes();s.length>0&&(n.axes=s);const o=this.assembleLegends();return o.length>0&&(n.legends=o),n}getName(t){return se((this.name?"".concat(this.name,"_"):"")+t)}getDataName(t){return this.getName(ee[t].toLowerCase())}requestDataName(t){const n=this.getDataName(t),i=this.component.data.outputNodeRefCounts;return i[n]=(i[n]||0)+1,n}getSizeSignalRef(t){if(Ze(this.parent)){const n=op(t),i=es(n),r=this.component.scales[i];if(r&&!r.merged){const s=r.get("type"),o=r.get("range");if(ve(s)&&on(o)){const a=r.get("name"),c=$s(this,i),l=rc(c);if(l){const u=C({aggregate:"distinct",field:l},{expr:"datum"});return{signal:sp(a,r,u)}}else return S(ra(i)),null}}}return{signal:this.signalNameMap.get(this.getName(t))}}lookupDataSource(t){const n=this.component.data.outputNodes[t];return n?n.getSource():t}getSignalName(t){return this.signalNameMap.get(t)}renameSignal(t,n){this.signalNameMap.rename(t,n)}renameScale(t,n){this.scaleNameMap.rename(t,n)}renameProjection(t,n){this.projectionNameMap.rename(t,n)}scaleName(t,n){if(n)return this.getName(t);if(ku(t)&&jt(t)&&this.component.scales[t]||this.scaleNameMap.has(this.getName(t)))return this.scaleNameMap.get(this.getName(t))}projectionName(t){if(t)return this.getName("projection");if(this.component.projection&&!this.component.projection.merged||this.projectionNameMap.has(this.getName("projection")))return this.projectionNameMap.get(this.getName("projection"))}getScaleComponent(t){if(!this.component.scales)throw new Error("getScaleComponent cannot be called before parseScale(). Make sure you have called parseScale or use parseUnitModelWithScale().");const n=this.component.scales[t];return n&&!n.merged?n:this.parent?this.parent.getScaleComponent(t):void 0}getSelectionComponent(t,n){let i=this.component.selection[t];if(!i&&this.parent&&(i=this.parent.getSelectionComponent(t,n)),!i)throw new Error(Mh(n));return i}hasAxisOrientSignalRef(){var t,n;return((t=this.component.axes.x)==null?void 0:t.some(i=>i.hasOrientSignalRef()))||((n=this.component.axes.y)==null?void 0:n.some(i=>i.hasOrientSignalRef()))}}class kp extends oc{vgField(t,n={}){const i=this.fieldDef(t);if(i)return C(i,n)}reduceFieldDef(t,n){return pb(this.getMapping(),(i,r,s)=>{const o=yt(r);return o?t(i,o,s):i},n)}forEachFieldDef(t,n){ka(this.getMapping(),(i,r)=>{const s=yt(i);s&&t(s,r)},n)}}class Os extends J{clone(){return new Os(null,j(this.transform))}constructor(t,n){var r,s,o;super(t),this.transform=n,this.transform=j(n);const i=(r=this.transform.as)!=null?r:[void 0,void 0];this.transform.as=[(s=i[0])!=null?s:"value",(o=i[1])!=null?o:"density"],n.groupby&&n.minsteps==null&&n.maxsteps==null&&n.steps==null&&(this.transform.steps=200)}dependentFields(){var t;return new Set([this.transform.density,...(t=this.transform.groupby)!=null?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"DensityTransform ".concat(W(this.transform))}assemble(){const{density:t,...n}=this.transform;return{type:"kde",field:t,...n}}}class Cs extends J{clone(){return new Cs(null,j(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=j(n)}dependentFields(){return new Set([this.transform.extent])}producedFields(){return new Set([])}hash(){return"ExtentTransform ".concat(W(this.transform))}assemble(){const{extent:t,param:n}=this.transform;return{type:"extent",field:t,signal:n}}}class Xi extends J{clone(){return new Xi(null,{...this.filter})}constructor(t,n){super(t),this.filter=n}static make(t,n){const{config:i,mark:r,markDef:s}=n;if(K("invalid",s,i)!=="filter")return null;const a=n.reduceFieldDef((c,l,u)=>{const f=jt(u)&&n.getScaleComponent(u);if(f){const d=f.get("type");je(d)&&l.aggregate!=="count"&&!an(r)&&(c[l.field]=l)}return c},{});return x(a).length?new Xi(t,a):null}dependentFields(){return new Set(x(this.filter))}producedFields(){return new Set}hash(){return"FilterInvalid ".concat(W(this.filter))}assemble(){const t=x(this.filter).reduce((n,i)=>{const r=this.filter[i],s=C(r,{expr:"datum"});return r!==null&&(r.type==="temporal"?n.push("(isDate(".concat(s,") || (isValid(").concat(s,") && isFinite(+").concat(s,")))")):r.type==="quantitative"&&(n.push("isValid(".concat(s,")")),n.push("isFinite(+".concat(s,")")))),n},[]);return t.length>0?{type:"filter",expr:t.join(" && ")}:null}}class Ns extends J{clone(){return new Ns(this.parent,j(this.transform))}constructor(t,n){super(t),this.transform=n,this.transform=j(n);const{flatten:i,as:r=[]}=this.transform;this.transform.as=i.map((s,o)=>{var a;return(a=r[o])!=null?a:s})}dependentFields(){return new Set(this.transform.flatten)}producedFields(){return new Set(this.transform.as)}hash(){return"FlattenTransform ".concat(W(this.transform))}assemble(){const{flatten:t,as:n}=this.transform;return{type:"flatten",fields:t,as:n}}}class _s extends J{clone(){return new _s(null,j(this.transform))}constructor(t,n){var r,s,o;super(t),this.transform=n,this.transform=j(n);const i=(r=this.transform.as)!=null?r:[void 0,void 0];this.transform.as=[(s=i[0])!=null?s:"key",(o=i[1])!=null?o:"value"]}dependentFields(){return new Set(this.transform.fold)}producedFields(){return new Set(this.transform.as)}hash(){return"FoldTransform ".concat(W(this.transform))}assemble(){const{fold:t,as:n}=this.transform;return{type:"fold",fields:t,as:n}}}class ti extends J{clone(){return new ti(null,j(this.fields),this.geojson,this.signal)}static parseAll(t,n){if(n.component.projection&&!n.component.projection.isFit)return t;let i=0;for(const r of[[st,rt],[We,ot]]){const s=r.map(o=>{const a=pe(n.encoding[o]);return w(a)?a.field:$t(a)?{expr:"".concat(a.datum)}:et(a)?{expr:"".concat(a.value)}:void 0});(s[0]||s[1])&&(t=new ti(t,s,null,n.getName("geojson_".concat(i++))))}if(n.channelHasField(Re)){const r=n.typedFieldDef(Re);r.type===Ei&&(t=new ti(t,null,r.field,n.getName("geojson_".concat(i++))))}return t}constructor(t,n,i,r){super(t),this.fields=n,this.geojson=i,this.signal=r}dependentFields(){var n;const t=((n=this.fields)!=null?n:[]).filter(z);return new Set([...this.geojson?[this.geojson]:[],...t])}producedFields(){return new Set}hash(){return"GeoJSON ".concat(this.geojson," ").concat(this.signal," ").concat(W(this.fields))}assemble(){return[...this.geojson?[{type:"filter",expr:'isValid(datum["'.concat(this.geojson,'"])')}]:[],{type:"geojson",...this.fields?{fields:this.fields}:{},...this.geojson?{geojson:this.geojson}:{},signal:this.signal}]}}class Vi extends J{clone(){return new Vi(null,this.projection,j(this.fields),j(this.as))}constructor(t,n,i,r){super(t),this.projection=n,this.fields=i,this.as=r}static parseAll(t,n){if(!n.projectionName())return t;for(const i of[[st,rt],[We,ot]]){const r=i.map(o=>{const a=pe(n.encoding[o]);return w(a)?a.field:$t(a)?{expr:"".concat(a.datum)}:et(a)?{expr:"".concat(a.value)}:void 0}),s=i[0]===We?"2":"";(r[0]||r[1])&&(t=new Vi(t,n.projectionName(),r,[n.getName("x".concat(s)),n.getName("y".concat(s))]))}return t}dependentFields(){return new Set(this.fields.filter(z))}producedFields(){return new Set(this.as)}hash(){return"Geopoint ".concat(this.projection," ").concat(W(this.fields)," ").concat(W(this.as))}assemble(){return{type:"geopoint",projection:this.projection,fields:this.fields,as:this.as}}}class $n extends J{clone(){return new $n(null,j(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){var t;return new Set([this.transform.impute,this.transform.key,...(t=this.transform.groupby)!=null?t:[]])}producedFields(){return new Set([this.transform.impute])}processSequence(t){const{start:n=0,stop:i,step:r}=t,s=[n,i,...r?[r]:[]].join(",");return{signal:"sequence(".concat(s,")")}}static makeFromTransform(t,n){return new $n(t,n)}static makeFromEncoding(t,n){const i=n.encoding,r=i.x,s=i.y;if(w(r)&&w(s)){const o=r.impute?r:s.impute?s:void 0;if(o===void 0)return;const a=r.impute?s:s.impute?r:void 0,{method:c,value:l,frame:u,keyvals:f}=o.impute,d=Kf(n.mark,i);return new $n(t,{impute:o.field,key:a.field,...c?{method:c}:{},...l!==void 0?{value:l}:{},...u?{frame:u}:{},...f!==void 0?{keyvals:f}:{},...d.length?{groupby:d}:{}})}return null}hash(){return"Impute ".concat(W(this.transform))}assemble(){const{impute:t,key:n,keyvals:i,method:r,groupby:s,value:o,frame:a=[null,null]}=this.transform,c={type:"impute",field:t,key:n,...i?{keyvals:hv(i)?this.processSequence(i):i}:{},method:"value",...s?{groupby:s}:{},value:!r||r==="value"?o:null};if(r&&r!=="value"){const l={type:"window",as:["imputed_".concat(t,"_value")],ops:[r],fields:[t],frame:a,ignorePeers:!1,...s?{groupby:s}:{}},u={type:"formula",expr:"datum.".concat(t," === null ? datum.imputed_").concat(t,"_value : datum.").concat(t),as:t};return[c,l,u]}else return[c]}}class Ts extends J{clone(){return new Ts(null,j(this.transform))}constructor(t,n){var r,s,o;super(t),this.transform=n,this.transform=j(n);const i=(r=this.transform.as)!=null?r:[void 0,void 0];this.transform.as=[(s=i[0])!=null?s:n.on,(o=i[1])!=null?o:n.loess]}dependentFields(){var t;return new Set([this.transform.loess,this.transform.on,...(t=this.transform.groupby)!=null?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"LoessTransform ".concat(W(this.transform))}assemble(){const{loess:t,on:n,...i}=this.transform;return{type:"loess",x:n,y:t,...i}}}class Yi extends J{clone(){return new Yi(null,j(this.transform),this.secondary)}constructor(t,n,i){super(t),this.transform=n,this.secondary=i}static make(t,n,i,r){const s=n.component.data.sources,{from:o}=i;let a=null;if(mv(o)){let c=Lp(o.data,s);c||(c=new Rn(o.data),s.push(c));const l=n.getName("lookup_".concat(r));a=new Oe(c,l,ee.Lookup,n.component.data.outputNodeRefCounts),n.component.data.outputNodes[l]=a}else if(yv(o)){const c=o.param;i={as:c,...i};let l;try{l=n.getSelectionComponent(se(c),c)}catch(u){throw new Error(Wh(c))}if(a=l.materialized,!a)throw new Error(Gh(c))}return new Yi(t,i,a.getSource())}dependentFields(){return new Set([this.transform.lookup])}producedFields(){return new Set(this.transform.as?le(this.transform.as):this.transform.from.fields)}hash(){return"Lookup ".concat(W({transform:this.transform,secondary:this.secondary}))}assemble(){let t;if(this.transform.from.fields)t={values:this.transform.from.fields,...this.transform.as?{as:le(this.transform.as)}:{}};else{let n=this.transform.as;z(n)||(S(Qh),n="_lookup"),t={as:[n]}}return{type:"lookup",from:this.secondary,key:this.transform.from.key,fields:[this.transform.lookup],...t,...this.transform.default?{default:this.transform.default}:{}}}}class As extends J{clone(){return new As(null,j(this.transform))}constructor(t,n){var r,s,o;super(t),this.transform=n,this.transform=j(n);const i=(r=this.transform.as)!=null?r:[void 0,void 0];this.transform.as=[(s=i[0])!=null?s:"prob",(o=i[1])!=null?o:"value"]}dependentFields(){var t;return new Set([this.transform.quantile,...(t=this.transform.groupby)!=null?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"QuantileTransform ".concat(W(this.transform))}assemble(){const{quantile:t,...n}=this.transform;return{type:"quantile",field:t,...n}}}class Fs extends J{clone(){return new Fs(null,j(this.transform))}constructor(t,n){var r,s,o;super(t),this.transform=n,this.transform=j(n);const i=(r=this.transform.as)!=null?r:[void 0,void 0];this.transform.as=[(s=i[0])!=null?s:n.on,(o=i[1])!=null?o:n.regression]}dependentFields(){var t;return new Set([this.transform.regression,this.transform.on,...(t=this.transform.groupby)!=null?t:[]])}producedFields(){return new Set(this.transform.as)}hash(){return"RegressionTransform ".concat(W(this.transform))}assemble(){const{regression:t,on:n,...i}=this.transform;return{type:"regression",x:n,y:t,...i}}}class ks extends J{clone(){return new ks(null,j(this.transform))}constructor(t,n){super(t),this.transform=n}addDimensions(t){var n;this.transform.groupby=dt(((n=this.transform.groupby)!=null?n:[]).concat(t),i=>i)}producedFields(){}dependentFields(){var t;return new Set([this.transform.pivot,this.transform.value,...(t=this.transform.groupby)!=null?t:[]])}hash(){return"PivotTransform ".concat(W(this.transform))}assemble(){const{pivot:t,value:n,groupby:i,limit:r,op:s}=this.transform;return{type:"pivot",field:t,value:n,...r!==void 0?{limit:r}:{},...s!==void 0?{op:s}:{},...i!==void 0?{groupby:i}:{}}}}class Is extends J{clone(){return new Is(null,j(this.transform))}constructor(t,n){super(t),this.transform=n}dependentFields(){return new Set}producedFields(){return new Set}hash(){return"SampleTransform ".concat(W(this.transform))}assemble(){return{type:"sample",size:this.transform.sample}}}function Ip(e){let t=0;function n(i,r){var s;if(i instanceof Rn&&!i.isGenerator&&!di(i.data)&&(e.push(r),r={name:null,source:r.name,transform:[]}),i instanceof $e&&(i.parent instanceof Rn&&!r.source?(r.format={...(s=r.format)!=null?s:{},parse:i.assembleFormatParse()},r.transform.push(...i.assembleTransforms(!0))):r.transform.push(...i.assembleTransforms())),i instanceof Oi){r.name||(r.name="data_".concat(t++)),!r.source||r.transform.length>0?(e.push(r),i.data=r.name):i.data=r.source,e.push(...i.assemble());return}switch((i instanceof ur||i instanceof fr||i instanceof Xi||i instanceof $i||i instanceof gi||i instanceof Vi||i instanceof Qe||i instanceof Yi||i instanceof Ci||i instanceof Wn||i instanceof _s||i instanceof Ns||i instanceof Os||i instanceof Ts||i instanceof As||i instanceof Fs||i instanceof Qt||i instanceof Is||i instanceof ks||i instanceof Cs)&&r.transform.push(i.assemble()),(i instanceof ht||i instanceof gt||i instanceof $n||i instanceof kt||i instanceof ti)&&r.transform.push(...i.assemble()),i instanceof Oe&&(r.source&&r.transform.length===0?i.setSource(r.source):i.parent instanceof Oe?i.setSource(r.name):(r.name||(r.name="data_".concat(t++)),i.setSource(r.name),i.numChildren()===1&&(e.push(r),r={name:null,source:r.name,transform:[]}))),i.numChildren()){case 0:i instanceof Oe&&(!r.source||r.transform.length>0)&&e.push(r);break;case 1:n(i.children[0],r);break;default:{r.name||(r.name="data_".concat(t++));let o=r.name;!r.source||r.transform.length>0?e.push(r):o=r.source;for(const a of i.children)n(a,{name:null,source:o,transform:[]});break}}}return n}function _E(e){const t=[],n=Ip(t);for(const i of e.children)n(i,{source:e.name,name:null,transform:[]});return t}function TE(e,t){var o,a;const n=[],i=Ip(n);let r=0;for(const c of e.sources){c.hasName()||(c.dataName="source_".concat(r++));const l=c.assemble();i(c,l)}for(const c of n)c.transform.length===0&&delete c.transform;let s=0;for(const[c,l]of n.entries())((o=l.transform)!=null?o:[]).length===0&&!l.source&&n.splice(s++,0,n.splice(c,1)[0]);for(const c of n)for(const l of(a=c.transform)!=null?a:[])l.type==="lookup"&&(l.from=e.outputNodes[l.from].getSource());for(const c of n)c.name in t&&(c.values=t[c.name]);return n}function AE(e){return e==="top"||e==="left"||R(e)?"header":"footer"}function FE(e){for(const t of Ue)kE(e,t);Fl(e,"x"),Fl(e,"y")}function kE(e,t){var o;const{facet:n,config:i,child:r,component:s}=e;if(e.channelHasField(t)){const a=n[t],c=mi("title",null,i,t);let l=Zn(a,i,{allowDisabling:!0,includeDefault:c===void 0||!!c});r.component.layoutHeaders[t].title&&(l=I(l)?l.join(", "):l,l+=" / ".concat(r.component.layoutHeaders[t].title),r.component.layoutHeaders[t].title=null);const u=mi("labelOrient",a.header,i,t),f=a.header!==null?de((o=a.header)==null?void 0:o.labels,i.header.labels,!0):!1,d=G(["bottom","right"],u)?"footer":"header";s.layoutHeaders[t]={title:a.header!==null?l:null,facetFieldDef:a,[d]:t==="facet"?[]:[Rp(e,t,f)]}}}function Rp(e,t,n){const i=t==="row"?"height":"width";return{labels:n,sizeSignal:e.child.component.layoutSize.get(i)?e.child.getSizeSignalRef(i):void 0,axes:[]}}function Fl(e,t){var i;const{child:n}=e;if(n.component.axes[t]){const{layoutHeaders:r,resolve:s}=e.component;if(s.axis[t]=Za(s,t),s.axis[t]==="shared"){const o=t==="x"?"column":"row",a=r[o];for(const c of n.component.axes[t]){const l=AE(c.get("orient"));(i=a[l])!=null||(a[l]=[Rp(e,o,!1)]);const u=Pi(c,"main",e.config,{header:!0});u&&a[l][0].axes.push(u),c.mainExtracted=!0}}}}function IE(e){ac(e),Br(e,"width"),Br(e,"height")}function RE(e){ac(e);const t=e.layout.columns===1?"width":"childWidth",n=e.layout.columns===void 0?"height":"childHeight";Br(e,t),Br(e,n)}function ac(e){for(const t of e.children)t.parseLayoutSize()}function Br(e,t){var a;const n=op(t),i=es(n),r=e.component.resolve,s=e.component.layoutSize;let o;for(const c of e.children){const l=c.component.layoutSize.getWithExplicit(n),u=(a=r.scale[i])!=null?a:cp(i,e);if(u==="independent"&&l.value==="step"){o=void 0;break}if(o){if(u==="independent"&&o.value!==l.value){o=void 0;break}o=Yt(o,l,n,"")}else o=l}if(o){for(const c of e.children)e.renameSignal(c.getName(n),e.getName(t)),c.component.layoutSize.set(n,"merged",!1);s.setWithExplicit(t,o)}else s.setWithExplicit(t,{explicit:!1,value:void 0})}function LE(e){const{size:t,component:n}=e;for(const i of wt){const r=Le(i);if(t[r]){const s=t[r];n.layoutSize.set(r,bt(s)?"step":s,!0)}else{const s=PE(e,r);n.layoutSize.set(r,s,!1)}}}function PE(e,t){const n=t==="width"?"x":"y",i=e.config,r=e.getScaleComponent(n);if(r){const s=r.get("type"),o=r.get("range");if(ve(s)){const a=Dr(i.view,t);return on(o)||bt(a)?"step":a}else return So(i.view,t)}else{if(e.hasProjection||e.mark==="arc")return So(i.view,t);{const s=Dr(i.view,t);return bt(s)?s.step:s}}}function Lo(e,t,n){return C(t,{suffix:"by_".concat(C(e)),...n!=null?n:{}})}class Ui extends kp{constructor(t,n,i,r){super(t,"facet",n,i,r,t.resolve),this.child=dc(t.spec,this,this.getName("child"),void 0,r),this.children=[this.child],this.facet=this.initFacet(t.facet)}initFacet(t){if(!sr(t))return{facet:this.initFacetFieldDef(t,"facet")};const n=x(t),i={};for(const r of n){if(![Tt,At].includes(r)){S(is(r,"facet"));break}const s=t[r];if(s.field===void 0){S(ho(s,r));break}i[r]=this.initFacetFieldDef(s,r)}return i}initFacetFieldDef(t,n){const i=Aa(t,n);return i.header?i.header=Te(i.header):i.header===null&&(i.header=null),i}channelHasField(t){return!!this.facet[t]}fieldDef(t){return this.facet[t]}parseData(){this.component.data=Rs(this),this.child.parseData()}parseLayoutSize(){ac(this)}parseSelections(){this.child.parseSelections(),this.component.selection=this.child.component.selection}parseMarkGroup(){this.child.parseMarkGroup()}parseAxesAndHeaders(){this.child.parseAxesAndHeaders(),FE(this)}assembleSelectionTopLevelSignals(t){return this.child.assembleSelectionTopLevelSignals(t)}assembleSignals(){return this.child.assembleSignals(),[]}assembleSelectionData(t){return this.child.assembleSelectionData(t)}getHeaderLayoutMixins(){var n,i,r;const t={};for(const s of Ue)for(const o of Ja){const a=this.component.layoutHeaders[s],c=a[o],{facetFieldDef:l}=a;if(l){const u=mi("titleOrient",l.header,this.config,s);if(["right","bottom"].includes(u)){const f=Es(s,u);(n=t.titleAnchor)!=null||(t.titleAnchor={}),t.titleAnchor[f]="end"}}if(c!=null&&c[0]){const u=s==="row"?"height":"width",f=o==="header"?"headerBand":"footerBand";s!=="facet"&&!this.child.component.layoutSize.get(u)&&((i=t[f])!=null||(t[f]={}),t[f][s]=.5),a.title&&((r=t.offset)!=null||(t.offset={}),t.offset[s==="row"?"rowTitle":"columnTitle"]=10)}}return t}assembleDefaultLayout(){const{column:t,row:n}=this.facet,i=t?this.columnDistinctSignal():n?1:void 0;let r="all";return(!n&&this.component.resolve.scale.x==="independent"||!t&&this.component.resolve.scale.y==="independent")&&(r="none"),{...this.getHeaderLayoutMixins(),...i?{columns:i}:{},bounds:"full",align:r}}assembleLayoutSignals(){return this.child.assembleLayoutSignals()}columnDistinctSignal(){if(!(this.parent&&this.parent instanceof Ui)){const t=this.getName("column_domain");return{signal:"length(data('".concat(t,"'))")}}}assembleGroupStyle(){}assembleGroup(t){return this.parent&&this.parent instanceof Ui?{...this.channelHasField("column")?{encode:{update:{columns:{field:C(this.facet.column,{prefix:"distinct"})}}}}:{},...super.assembleGroup(t)}:super.assembleGroup(t)}getCardinalityAggregateForChild(){const t=[],n=[],i=[];if(this.child instanceof Ui){if(this.child.channelHasField("column")){const r=C(this.child.facet.column);t.push(r),n.push("distinct"),i.push("distinct_".concat(r))}}else for(const r of wt){const s=this.child.component.scales[r];if(s&&!s.merged){const o=s.get("type"),a=s.get("range");if(ve(o)&&on(a)){const c=$s(this.child,r),l=rc(c);l?(t.push(l),n.push("distinct"),i.push("distinct_".concat(l))):S(ra(r))}}}return{fields:t,ops:n,as:i}}assembleFacet(){const{name:t,data:n}=this.component.data.facetRoot,{row:i,column:r}=this.facet,{fields:s,ops:o,as:a}=this.getCardinalityAggregateForChild(),c=[];for(const u of Ue){const f=this.facet[u];if(f){c.push(C(f));const{bin:d,sort:p}=f;if(ne(d)&&c.push(C(f,{binSuffix:"end"})),pt(p)){const{field:g,op:h=ls}=p,m=Lo(f,p);i&&r?(s.push(m),o.push("max"),a.push(m)):(s.push(g),o.push(h),a.push(m))}else if(I(p)){const g=hi(f,u);s.push(g),o.push("max"),a.push(g)}}}const l=!!i&&!!r;return{name:t,data:n,groupby:c,...l||s.length>0?{aggregate:{...l?{cross:l}:{},...s.length?{fields:s,ops:o,as:a}:{}}}:{}}}facetSortFields(t){const{facet:n}=this,i=n[t];return i?pt(i.sort)?[Lo(i,i.sort,{expr:"datum"})]:I(i.sort)?[hi(i,t,{expr:"datum"})]:[C(i,{expr:"datum"})]:[]}facetSortOrder(t){const{facet:n}=this,i=n[t];if(i){const{sort:r}=i;return[(pt(r)?r.order:!I(r)&&r)||"ascending"]}return[]}assembleLabelTitle(){var r;const{facet:t,config:n}=this;if(t.facet)return To(t.facet,"facet",n);const i={row:["top","bottom"],column:["left","right"]};for(const s of Ka)if(t[s]){const o=mi("labelOrient",(r=t[s])==null?void 0:r.header,n,s);if(i[s].includes(o))return To(t[s],s,n)}}assembleMarks(){const{child:t}=this,n=this.component.data.facetRoot,i=_E(n),r=t.assembleGroupEncodeEntry(!1),s=this.assembleLabelTitle()||t.assembleTitle(),o=t.assembleGroupStyle();return[{name:this.getName("cell"),type:"group",...s?{title:s}:{},...o?{style:o}:{},from:{facet:this.assembleFacet()},sort:{field:Ue.map(c=>this.facetSortFields(c)).flat(),order:Ue.map(c=>this.facetSortOrder(c)).flat()},...i.length>0?{data:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup(Xv(this,[]))}]}getMapping(){return this.facet}}function zE(e,t){const{row:n,column:i}=t;if(n&&i){let r=null;for(const s of[n,i])if(pt(s.sort)){const{field:o,op:a=ls}=s.sort;e=r=new Wn(e,{joinaggregate:[{op:a,field:o,as:Lo(s,s.sort,{forAs:!0})}],groupby:[C(s)]})}return r}return null}function Lp(e,t){var n,i,r,s;for(const o of t){const a=o.data;if(e.name&&o.hasName()&&e.name!==o.dataName)continue;const c=(n=e.format)==null?void 0:n.mesh,l=(i=a.format)==null?void 0:i.feature;if(c&&l)continue;const u=(r=e.format)==null?void 0:r.feature;if((u||l)&&u!==l)continue;const f=(s=a.format)==null?void 0:s.mesh;if(!((c||f)&&c!==f)){if(qi(e)&&qi(a)){if(ft(e.values,a.values))return o}else if(di(e)&&di(a)){if(e.url===a.url)return o}else if(Cd(e)&&e.name===o.dataName)return o}}return null}function DE(e,t){if(e.data||!e.parent){if(e.data===null){const i=new Rn({values:[]});return t.push(i),i}const n=Lp(e.data,t);if(n)return Ht(e.data)||(n.data.format=xu({},e.data.format,n.data.format)),!n.hasName()&&e.data.name&&(n.dataName=e.data.name),n;{const i=new Rn(e.data);return t.push(i),i}}else return e.parent.component.data.facetRoot?e.parent.component.data.facetRoot:e.parent.component.data.main}function jE(e,t,n){var r,s;let i=0;for(const o of t.transforms){let a,c;if(Nv(o))c=e=new gi(e,o),a="derived";else if(Wa(o)){const l=AS(o);c=e=(r=$e.makeWithAncestors(e,{},l,n))!=null?r:e,e=new $i(e,t,o.filter)}else if(Sd(o))c=e=ht.makeFromTransform(e,o,t),a="number";else if(Tv(o))a="date",n.getWithExplicit(o.field).value===void 0&&(e=new $e(e,{[o.field]:a}),n.set(o.field,a,!1)),c=e=gt.makeFromTransform(e,o);else if(Av(o))c=e=Qe.makeFromTransform(e,o),a="number",Ya(t)&&(e=new Qt(e));else if(xd(o))c=e=Yi.make(e,t,o,i++),a="derived";else if($v(o))c=e=new Ci(e,o),a="number";else if(Ov(o))c=e=new Wn(e,o),a="number";else if(Fv(o))c=e=kt.makeFromTransform(e,o),a="derived";else if(kv(o))c=e=new _s(e,o),a="derived";else if(Iv(o))c=e=new Cs(e,o),a="derived";else if(Cv(o))c=e=new Ns(e,o),a="derived";else if(bv(o))c=e=new ks(e,o),a="derived";else if(wv(o))e=new Is(e,o);else if(_v(o))c=e=$n.makeFromTransform(e,o),a="derived";else if(vv(o))c=e=new Os(e,o),a="derived";else if(xv(o))c=e=new As(e,o),a="derived";else if(Sv(o))c=e=new Fs(e,o),a="derived";else if(Ev(o))c=e=new Ts(e,o),a="derived";else{S(Jh(o));continue}if(c&&a!==void 0)for(const l of(s=c.producedFields())!=null?s:[])n.set(l,a,!1)}return e}function Rs(e){var h,m,y,b,N,_,$,P,F,L;let t=DE(e,e.component.data.sources);const{outputNodes:n,outputNodeRefCounts:i}=e.component.data,r=e.data,o=!(r&&(Ht(r)||di(r)||qi(r)))&&e.parent?e.parent.component.data.ancestorParse.clone():new Hv;Ht(r)?(Nd(r)?t=new fr(t,r.sequence):Ga(r)&&(t=new ur(t,r.graticule)),o.parseNothing=!0):((h=r==null?void 0:r.format)==null?void 0:h.parse)===null&&(o.parseNothing=!0),t=(m=$e.makeExplicit(t,e,o))!=null?m:t,t=new Qt(t);const a=e.parent&&Ni(e.parent);(ce(e)||Ze(e))&&a&&(t=(y=ht.makeFromEncoding(t,e))!=null?y:t),e.transforms.length>0&&(t=jE(t,e,o));const c=kS(e),l=FS(e);t=(b=$e.makeWithAncestors(t,{},{...c,...l},o))!=null?b:t,ce(e)&&(t=ti.parseAll(t,e),t=Vi.parseAll(t,e)),(ce(e)||Ze(e))&&(a||(t=(N=ht.makeFromEncoding(t,e))!=null?N:t),t=(_=gt.makeFromEncoding(t,e))!=null?_:t,t=gi.parseAllForSortIndex(t,e));const u=e.getDataName(ee.Raw),f=new Oe(t,u,ee.Raw,i);if(n[u]=f,t=f,ce(e)){const H=Qe.makeFromEncoding(t,e);H&&(t=H,Ya(e)&&(t=new Qt(t))),t=($=$n.makeFromEncoding(t,e))!=null?$:t,t=(P=kt.makeFromEncoding(t,e))!=null?P:t}ce(e)&&(t=(F=Xi.make(t,e))!=null?F:t);const d=e.getDataName(ee.Main),p=new Oe(t,d,ee.Main,i);n[d]=p,t=p,ce(e)&&Nx(e,p);let g=null;if(Ze(e)){const H=e.getName("facet");t=(L=zE(t,e.facet))!=null?L:t,g=new Oi(t,e,H,p.getSource()),n[H]=g}return{...e.component.data,outputNodes:n,outputNodeRefCounts:i,raw:f,main:p,facetRoot:g,ancestorParse:o}}class ME extends oc{constructor(t,n,i,r){var s,o,a,c;super(t,"concat",n,i,r,t.resolve),(((o=(s=t.resolve)==null?void 0:s.axis)==null?void 0:o.x)==="shared"||((c=(a=t.resolve)==null?void 0:a.axis)==null?void 0:c.y)==="shared")&&S(Vh),this.children=this.getChildren(t).map((l,u)=>dc(l,this,this.getName("concat_".concat(u)),void 0,r))}parseData(){this.component.data=Rs(this);for(const t of this.children)t.parseData()}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of x(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){for(const t of this.children)t.parseAxesAndHeaders()}getChildren(t){return ys(t)?t.vconcat:Ua(t)?t.hconcat:t.concat}parseLayoutSize(){RE(this)}parseAxisGroup(){return null}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.forEach(t=>t.assembleSignals()),[]}assembleLayoutSignals(){const t=Qa(this);for(const n of this.children)t.push(...n.assembleLayoutSignals());return t}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleMarks(){return this.children.map(t=>{const n=t.assembleTitle(),i=t.assembleGroupStyle(),r=t.assembleGroupEncodeEntry(!1);return{type:"group",name:t.getName("group"),...n?{title:n}:{},...i?{style:i}:{},...r?{encode:{update:r}}:{},...t.assembleGroup()}})}assembleGroupStyle(){}assembleDefaultLayout(){const t=this.layout.columns;return{...t!=null?{columns:t}:{},bounds:"full",align:"each"}}}function UE(e){return e===!1||e===null}const BE={disable:1,gridScale:1,scale:1,...qf,labelExpr:1,encode:1},Pp=x(BE);class cc extends Ut{constructor(t={},n={},i=!1){super(),this.explicit=t,this.implicit=n,this.mainExtracted=i}clone(){return new cc(j(this.explicit),j(this.implicit),this.mainExtracted)}hasAxisPart(t){return t==="axis"?!0:t==="grid"||t==="title"?!!this.get(t):!UE(this.get(t))}hasOrientSignalRef(){return R(this.explicit.orient)}}function WE(e,t,n){var l;const{encoding:i,config:r}=e,s=(l=pe(i[t]))!=null?l:pe(i[Et(t)]),o=e.axis(t)||{},{format:a,formatType:c}=o;if(Fn(c))return{text:Je({fieldOrDatumDef:s,field:"datum.value",format:a,formatType:c,config:r}),...n};if(a===void 0&&c===void 0&&r.customFormatTypes){if(li(s)==="quantitative"){if(ui(s)&&s.stack==="normalize"&&r.normalizedNumberFormatType)return{text:Je({fieldOrDatumDef:s,field:"datum.value",format:r.normalizedNumberFormat,formatType:r.normalizedNumberFormatType,config:r}),...n};if(r.numberFormatType)return{text:Je({fieldOrDatumDef:s,field:"datum.value",format:r.numberFormat,formatType:r.numberFormatType,config:r}),...n}}if(li(s)==="temporal"&&r.timeFormatType&&w(s)&&!s.timeUnit)return{text:Je({fieldOrDatumDef:s,field:"datum.value",format:r.timeFormat,formatType:r.timeFormatType,config:r}),...n}}return n}function GE(e){return wt.reduce((t,n)=>(e.component.scales[n]&&(t[n]=[JE(n,e)]),t),{})}const HE={bottom:"top",top:"bottom",left:"right",right:"left"};function qE(e){var r;const{axes:t,resolve:n}=e.component,i={top:0,bottom:0,right:0,left:0};for(const s of e.children){s.parseAxesAndHeaders();for(const o of x(s.component.axes))n.axis[o]=Za(e.component.resolve,o),n.axis[o]==="shared"&&(t[o]=XE(t[o],s.component.axes[o]),t[o]||(n.axis[o]="independent",delete t[o]))}for(const s of wt){for(const o of e.children)if(o.component.axes[s]){if(n.axis[s]==="independent"){t[s]=((r=t[s])!=null?r:[]).concat(o.component.axes[s]);for(const a of o.component.axes[s]){const{value:c,explicit:l}=a.getWithExplicit("orient");if(!R(c)){if(i[c]>0&&!l){const u=HE[c];i[c]>i[u]&&a.set("orient",u,!1)}i[c]++}}}delete o.component.axes[s]}if(n.axis[s]==="independent"&&t[s]&&t[s].length>1)for(const[o,a]of(t[s]||[]).entries())o>0&&a.get("grid")&&!a.explicit.grid&&(a.implicit.grid=!1)}}function XE(e,t){if(e){if(e.length!==t.length)return;const n=e.length;for(let i=0;i<n;i++){const r=e[i],s=t[i];if(!!r!=!!s)return;if(r&&s){const o=r.getWithExplicit("orient"),a=s.getWithExplicit("orient");if(o.explicit&&a.explicit&&o.value!==a.value)return;e[i]=VE(r,s)}}}else return t.map(n=>n.clone());return e}function VE(e,t){for(const n of Pp){const i=Yt(e.getWithExplicit(n),t.getWithExplicit(n),n,"axis",(r,s)=>{switch(n){case"title":return Yu(r,s);case"gridScale":return{explicit:r.explicit,value:de(r.value,s.value)}}return vs(r,s,n,"axis")});e.setWithExplicit(n,i)}return e}function YE(e,t,n,i,r){if(t==="disable")return n!==void 0;switch(n=n||{},t){case"titleAngle":case"labelAngle":return e===(R(n.labelAngle)?n.labelAngle:Hi(n.labelAngle));case"values":return!!n.values;case"encode":return!!n.encoding||!!n.labelAngle;case"title":if(e===tp(i,r))return!0}return e===n[t]}const KE=new Set(["grid","translate","format","formatType","orient","labelExpr","tickCount","position","tickMinStep"]);function JE(e,t){var y,b,N;let n=t.axis(e);const i=new cc,r=pe(t.encoding[e]),{mark:s,config:o}=t,a=(n==null?void 0:n.orient)||((y=o[e==="x"?"axisX":"axisY"])==null?void 0:y.orient)||((b=o.axis)==null?void 0:b.orient)||zx(e),c=t.getScaleComponent(e).get("type"),l=Ax(e,c,a,t.config),u=n!==void 0?!n:No("disable",o.style,n==null?void 0:n.style,l).configValue;if(i.set("disable",u,n!==void 0),u)return i;n=n||{};const f=Rx(r,n,e,o.style,l),d=Af(n.formatType,r,c),p=Tf(r,r.type,n.format,n.formatType,o,!0),g={fieldOrDatumDef:r,axis:n,channel:e,model:t,scaleType:c,orient:a,labelAngle:f,format:p,formatType:d,mark:s,config:o};for(const _ of Pp){const $=_ in ml?ml[_](g):Hc(_)?n[_]:void 0,P=$!==void 0,F=YE($,_,n,t,e);if(P&&F)i.set(_,$,F);else{const{configValue:L=void 0,configFrom:H=void 0}=Hc(_)&&_!=="values"?No(_,o.style,n.style,l):{},Y=L!==void 0;P&&!Y?i.set(_,$,F):(H!=="vgAxisConfig"||KE.has(_)&&Y||cr(L)||R(L))&&i.set(_,L,!1)}}const h=(N=n.encoding)!=null?N:{},m=Hf.reduce((_,$)=>{var L;if(!i.hasAxisPart($))return _;const P=ap((L=h[$])!=null?L:{},t),F=$==="labels"?WE(t,e,P):P;return F!==void 0&&!Q(F)&&(_[$]={update:F}),_},{});return Q(m)||i.set("encode",m,!!n.encoding||n.labelAngle!==void 0),i}function QE({encoding:e,size:t}){for(const n of wt){const i=Le(n);bt(t[i])&&Gt(e[n])&&(delete t[i],S(ef(i)))}return t}const ZE={vgMark:"arc",encodeEntry:e=>({...He(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...Kt(e,"radius"),...Kt(e,"theta")})},ew={vgMark:"area",encodeEntry:e=>({...He(e,{align:"ignore",baseline:"ignore",color:"include",orient:"include",size:"ignore",theta:"ignore"}),...jr("x",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="horizontal"}),...jr("y",e,{defaultPos:"zeroOrMin",defaultPos2:"zeroOrMin",range:e.markDef.orient==="vertical"}),...Va(e)})},tw={vgMark:"rect",encodeEntry:e=>({...He(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Kt(e,"x"),...Kt(e,"y")})},nw={vgMark:"shape",encodeEntry:e=>({...He(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"})}),postEncodingTransform:e=>{const{encoding:t}=e,n=t.shape;return[{type:"geoshape",projection:e.projectionName(),...n&&w(n)&&n.type===Ei?{field:C(n,{expr:"datum"})}:{}}]}},iw={vgMark:"image",encodeEntry:e=>({...He(e,{align:"ignore",baseline:"ignore",color:"ignore",orient:"ignore",size:"ignore",theta:"ignore"}),...Kt(e,"x"),...Kt(e,"y"),...qa(e,"url")})},rw={vgMark:"line",encodeEntry:e=>({...He(e,{align:"ignore",baseline:"ignore",color:"include",size:"ignore",orient:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...he("size",e,{vgChannel:"strokeWidth"}),...Va(e)})},sw={vgMark:"trail",encodeEntry:e=>({...He(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...he("size",e),...Va(e)})};function lc(e,t){const{config:n}=e;return{...He(e,{align:"ignore",baseline:"ignore",color:"include",size:"include",orient:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...he("size",e),...he("angle",e),...ow(e,n,t)}}function ow(e,t,n){return n?{shape:{value:n}}:he("shape",e)}const aw={vgMark:"symbol",encodeEntry:e=>lc(e)},cw={vgMark:"symbol",encodeEntry:e=>lc(e,"circle")},lw={vgMark:"symbol",encodeEntry:e=>lc(e,"square")},uw={vgMark:"rect",encodeEntry:e=>({...He(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...Kt(e,"x"),...Kt(e,"y")})},fw={vgMark:"rule",encodeEntry:e=>{const{markDef:t}=e,n=t.orient;return!e.encoding.x&&!e.encoding.y&&!e.encoding.latitude&&!e.encoding.longitude?{}:{...He(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...jr("x",e,{defaultPos:n==="horizontal"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="vertical"}),...jr("y",e,{defaultPos:n==="vertical"?"zeroOrMax":"mid",defaultPos2:"zeroOrMin",range:n!=="horizontal"}),...he("size",e,{vgChannel:"strokeWidth"})}}},dw={vgMark:"text",encodeEntry:e=>{const{config:t,encoding:n}=e;return{...He(e,{align:"include",baseline:"include",color:"include",size:"ignore",orient:"ignore",theta:"include"}),...we("x",e,{defaultPos:"mid"}),...we("y",e,{defaultPos:"mid"}),...qa(e),...he("size",e,{vgChannel:"fontSize"}),...he("angle",e),...dl("align",pw(e.markDef,n,t)),...dl("baseline",gw(e.markDef,n,t)),...we("radius",e,{defaultPos:null}),...we("theta",e,{defaultPos:null})}}};function pw(e,t,n){if(K("align",e,n)===void 0)return"center"}function gw(e,t,n){if(K("baseline",e,n)===void 0)return"middle"}const hw={vgMark:"rect",encodeEntry:e=>{const{config:t,markDef:n}=e,i=n.orient,r=i==="horizontal"?"width":"height",s=i==="horizontal"?"height":"width";return{...He(e,{align:"ignore",baseline:"ignore",color:"include",orient:"ignore",size:"ignore",theta:"ignore"}),...we("x",e,{defaultPos:"mid",vgChannel:"xc"}),...we("y",e,{defaultPos:"mid",vgChannel:"yc"}),...he("size",e,{defaultValue:mw(e),vgChannel:r}),[s]:re(K("thickness",n,t))}}};function mw(e){var a;const{config:t,markDef:n}=e,{orient:i}=n,r=i==="horizontal"?"width":"height",s=e.getScaleComponent(i==="horizontal"?"x":"y"),o=(a=K("size",n,t,{vgChannel:r}))!=null?a:t.tick.bandSize;if(o!==void 0)return o;{const c=s?s.get("range"):void 0;return c&&on(c)&&fe(c.step)?c.step*3/4:zr(t.view,r)*3/4}}const yr={arc:ZE,area:ew,bar:tw,circle:cw,geoshape:nw,image:iw,line:rw,point:aw,rect:uw,rule:fw,square:lw,text:dw,tick:hw,trail:sw};function yw(e){if(G([as,ss,Oy],e.mark)){const t=Kf(e.mark,e.encoding);if(t.length>0)return bw(e,t)}else if(e.mark===os){const t=go.some(n=>K(n,e.markDef,e.config));if(e.stack&&!e.fieldDef("size")&&t)return vw(e)}return uc(e)}const kl="faceted_path_";function bw(e,t){return[{name:e.getName("pathgroup"),type:"group",from:{facet:{name:kl+e.requestDataName(ee.Main),data:e.requestDataName(ee.Main),groupby:t}},encode:{update:{width:{field:{group:"width"}},height:{field:{group:"height"}}}},marks:uc(e,{fromPrefix:kl})}]}const Il="stack_group_";function vw(e){var l;const[t]=uc(e,{fromPrefix:Il}),n=e.scaleName(e.stack.fieldChannel),i=(u={})=>e.vgField(e.stack.fieldChannel,u),r=(u,f)=>{const d=[i({prefix:"min",suffix:"start",expr:f}),i({prefix:"max",suffix:"start",expr:f}),i({prefix:"min",suffix:"end",expr:f}),i({prefix:"max",suffix:"end",expr:f})];return"".concat(u,"(").concat(d.map(p=>"scale('".concat(n,"',").concat(p,")")).join(","),")")};let s,o;e.stack.fieldChannel==="x"?(s={...ii(t.encode.update,["y","yc","y2","height",...go]),x:{signal:r("min","datum")},x2:{signal:r("max","datum")},clip:{value:!0}},o={x:{field:{group:"x"},mult:-1},height:{field:{group:"height"}}},t.encode.update={...Ae(t.encode.update,["y","yc","y2"]),height:{field:{group:"height"}}}):(s={...ii(t.encode.update,["x","xc","x2","width"]),y:{signal:r("min","datum")},y2:{signal:r("max","datum")},clip:{value:!0}},o={y:{field:{group:"y"},mult:-1},width:{field:{group:"width"}}},t.encode.update={...Ae(t.encode.update,["x","xc","x2"]),width:{field:{group:"width"}}});for(const u of go){const f=Rt(u,e.markDef,e.config);t.encode.update[u]?(s[u]=t.encode.update[u],delete t.encode.update[u]):f&&(s[u]=re(f)),f&&(t.encode.update[u]={value:0})}const a=[];if(((l=e.stack.groupbyChannels)==null?void 0:l.length)>0)for(const u of e.stack.groupbyChannels){const f=e.fieldDef(u),d=C(f);d&&a.push(d),(f!=null&&f.bin||f!=null&&f.timeUnit)&&a.push(C(f,{binSuffix:"end"}))}return s=["stroke","strokeWidth","strokeJoin","strokeCap","strokeDash","strokeDashOffset","strokeMiterLimit","strokeOpacity"].reduce((u,f)=>{if(t.encode.update[f])return{...u,[f]:t.encode.update[f]};{const d=Rt(f,e.markDef,e.config);return d!==void 0?{...u,[f]:re(d)}:u}},s),s.stroke&&(s.strokeForeground={value:!0},s.strokeOffset={value:0}),[{type:"group",from:{facet:{data:e.requestDataName(ee.Main),name:Il+e.requestDataName(ee.Main),groupby:a,aggregate:{fields:[i({suffix:"start"}),i({suffix:"start"}),i({suffix:"end"}),i({suffix:"end"})],ops:["min","max","min","max"]}}},encode:{update:s},marks:[{type:"group",encode:{update:o},marks:[t]}]}]}function xw(e){var a;const{encoding:t,stack:n,mark:i,markDef:r,config:s}=e,o=t.order;if(!(!I(o)&&et(o)&&fo(o.value)||!o&&fo(K("order",r,s)))){if((I(o)||w(o))&&!n)return qu(o,{expr:"datum"});if(an(i)){const c=r.orient==="horizontal"?"y":"x",l=t[c];if(w(l)){const u=l.sort;if(I(u))return{field:C(l,{prefix:c,suffix:"sort_index",expr:"datum"})};if(pt(u))return{field:C({aggregate:Fa(e.encoding)?u.op:void 0,field:u.field},{expr:"datum"})};if(kf(u)){const f=e.fieldDef(u.encoding);return{field:C(f,{expr:"datum"}),order:u.order}}else return u===null?void 0:{field:C(l,{binSuffix:(a=e.stack)!=null&&a.impute?"mid":void 0,expr:"datum"})}}return}}}function uc(e,t={fromPrefix:""}){const{mark:n,markDef:i,encoding:r,config:s}=e,o=de(i.clip,Sw(e),Ew(e)),a=Gu(i),c=r.key,l=xw(e),u=ww(e),f=K("aria",i,s),d=yr[n].postEncodingTransform?yr[n].postEncodingTransform(e):null;return[{name:e.getName("marks"),type:yr[n].vgMark,...o?{clip:!0}:{},...a?{style:a}:{},...c?{key:c.field}:{},...l?{sort:l}:{},...u||{},...f===!1?{aria:f}:{},from:{data:t.fromPrefix+e.requestDataName(ee.Main)},encode:{update:yr[n].encodeEntry(e)},...d?{transform:d}:{}}]}function Sw(e){const t=e.getScaleComponent("x"),n=e.getScaleComponent("y");return t!=null&&t.get("selectionExtent")||n!=null&&n.get("selectionExtent")?!0:void 0}function Ew(e){const t=e.component.projection;return t&&!t.isFit?!0:void 0}function ww(e){if(!e.component.selection)return null;const t=x(e.component.selection).length;let n=t,i=e.parent;for(;i&&n===0;)n=x(i.component.selection).length,i=i.parent;return n?{interactive:t>0||e.mark==="geoshape"||!!e.encoding.tooltip}:null}class zp extends kp{constructor(t,n,i,r={},s){var l;super(t,"unit",n,i,s,void 0,Xc(t)?t.view:void 0),this.specifiedScales={},this.specifiedAxes={},this.specifiedLegends={},this.specifiedProjection={},this.selection=[],this.children=[];const o=mt(t.mark)?{...t.mark}:{type:t.mark},a=o.type;o.filled===void 0&&(o.filled=av(o,s,{graticule:t.data&&Ga(t.data)}));const c=this.encoding=fb(t.encoding||{},a,o.filled,s);this.markDef=yd(o,c,s),this.size=QE({encoding:c,size:Xc(t)?{...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}}:r}),this.stack=md(this.markDef,c),this.specifiedScales=this.initScales(a,c),this.specifiedAxes=this.initAxes(c),this.specifiedLegends=this.initLegends(c),this.specifiedProjection=t.projection,this.selection=((l=t.params)!=null?l:[]).filter(u=>ja(u))}get hasProjection(){const{encoding:t}=this,n=this.mark===$f,i=t&&lh.some(r=>M(t[r]));return n||i}scaleDomain(t){const n=this.specifiedScales[t];return n?n.domain:void 0}axis(t){return this.specifiedAxes[t]}legend(t){return this.specifiedLegends[t]}initScales(t,n){return ts.reduce((i,r)=>{var o;const s=pe(n[r]);return s&&(i[r]=this.initScale((o=s.scale)!=null?o:{})),i},{})}initScale(t){const{domain:n,range:i}=t,r=Te(t);return I(n)&&(r.domain=n.map(ze)),I(i)&&(r.range=i.map(ze)),r}initAxes(t){return wt.reduce((n,i)=>{const r=t[i];if(M(r)||i===oe&&M(t.x2)||i===ye&&M(t.y2)){const s=M(r)?r.axis:void 0;n[i]=s&&this.initAxis({...s})}return n},{})}initAxis(t){const n=x(t),i={};for(const r of n){const s=t[r];i[r]=cr(s)?Wu(s):ze(s)}return i}initLegends(t){return bh.reduce((n,i)=>{const r=pe(t[i]);if(r&&xh(i)){const s=r.legend;n[i]=s&&Te(s)}return n},{})}parseData(){this.component.data=Rs(this)}parseLayoutSize(){LE(this)}parseSelections(){this.component.selection=Cx(this,this.selection)}parseMarkGroup(){this.component.mark=yw(this)}parseAxesAndHeaders(){this.component.axes=GE(this)}assembleSelectionTopLevelSignals(t){return Vv(this,t)}assembleSignals(){return[...Qd(this),...qv(this,[])]}assembleSelectionData(t){return Yv(this,t)}assembleLayout(){return null}assembleLayoutSignals(){return Qa(this)}assembleMarks(){var n;let t=(n=this.component.mark)!=null?n:[];return(!this.parent||!Ni(this.parent))&&(t=Ad(this,t)),t.map(this.correctDataNames)}assembleGroupStyle(){const{style:t}=this.view||{};return t!==void 0?t:this.encoding.x||this.encoding.y?"cell":"view"}getMapping(){return this.encoding}get mark(){return this.markDef.type}channelHasField(t){return En(this.encoding,t)}fieldDef(t){const n=this.encoding[t];return yt(n)}typedFieldDef(t){const n=this.fieldDef(t);return Ce(n)?n:null}}class fc extends oc{constructor(t,n,i,r,s){super(t,"layer",n,i,s,t.resolve,t.view);const o={...r,...t.width?{width:t.width}:{},...t.height?{height:t.height}:{}};this.children=t.layer.map((a,c)=>{if(bs(a))return new fc(a,this,this.getName("layer_".concat(c)),o,s);if(Mt(a))return new zp(a,this,this.getName("layer_".concat(c)),o,s);throw new Error(ia(a))})}parseData(){this.component.data=Rs(this);for(const t of this.children)t.parseData()}parseLayoutSize(){IE(this)}parseSelections(){this.component.selection={};for(const t of this.children){t.parseSelections();for(const n of x(t.component.selection))this.component.selection[n]=t.component.selection[n]}}parseMarkGroup(){for(const t of this.children)t.parseMarkGroup()}parseAxesAndHeaders(){qE(this)}assembleSelectionTopLevelSignals(t){return this.children.reduce((n,i)=>i.assembleSelectionTopLevelSignals(n),t)}assembleSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleSignals()),Qd(this))}assembleLayoutSignals(){return this.children.reduce((t,n)=>t.concat(n.assembleLayoutSignals()),Qa(this))}assembleSelectionData(t){return this.children.reduce((n,i)=>i.assembleSelectionData(n),t)}assembleGroupStyle(){const t=new Set;for(const i of this.children)for(const r of le(i.assembleGroupStyle()))t.add(r);const n=Array.from(t);return n.length>1?n:n.length===1?n[0]:void 0}assembleTitle(){let t=super.assembleTitle();if(t)return t;for(const n of this.children)if(t=n.assembleTitle(),t)return t}assembleLayout(){return null}assembleMarks(){return Kv(this,this.children.flatMap(t=>t.assembleMarks()))}assembleLegends(){return this.children.reduce((t,n)=>t.concat(n.assembleLegends()),hp(this))}}function dc(e,t,n,i,r){if(us(e))return new Ui(e,t,n,r);if(bs(e))return new fc(e,t,n,i,r);if(Mt(e))return new zp(e,t,n,i,r);if(Lb(e))return new ME(e,t,n,r);throw new Error(ia(e))}function $w(e,t={}){t.logger&&Mm(t.logger),t.fieldTitle&&Bf(t.fieldTitle);try{const n=hd(qr(t.config,e.config)),i=$d(e,n),r=dc(i,null,"",void 0,n);return r.parse(),VS(r.component.data,r),{spec:Cw(r,Ow(e,i.autosize,n,r),e.datasets,e.usermeta),normalized:i}}finally{t.logger&&Um(),t.fieldTitle&&nb()}}function Ow(e,t,n,i){const r=i.component.layoutSize.get("width"),s=i.component.layoutSize.get("height");if(t===void 0?(t={type:"pad"},i.hasAxisOrientSignalRef()&&(t.resize=!0)):z(t)&&(t={type:t}),r&&s&&Bv(t.type)){if(r==="step"&&s==="step")S(Fc()),t.type="pad";else if(r==="step"||s==="step"){const o=r==="step"?"width":"height";S(Fc(es(o)));const a=o==="width"?"height":"width";t.type=Wv(a)}}return{...x(t).length===1&&t.type?t.type==="pad"?{}:{autosize:t.type}:{autosize:t},...sl(n,!1),...sl(e,!0)}}function Cw(e,t,n={},i){const r=e.config?Yb(e.config):void 0,s=[].concat(e.assembleSelectionData([]),TE(e.component.data,n)),o=e.assembleProjections(),a=e.assembleTitle(),c=e.assembleGroupStyle(),l=e.assembleGroupEncodeEntry(!0);let u=e.assembleLayoutSignals();u=u.filter(p=>(p.name==="width"||p.name==="height")&&p.value!==void 0?(t[p.name]=+p.value,!1):!0);const{params:f,...d}=t;return{$schema:"https://vega.github.io/schema/vega/v5.json",...e.description?{description:e.description}:{},...d,...a?{title:a}:{},...c?{style:c}:{},...l?{encode:{update:l}}:{},data:s,...o.length>0?{projections:o}:{},...e.assembleGroup([...u,...e.assembleSelectionTopLevelSignals([]),...fd(f)]),...r?{config:r}:{},...i?{usermeta:i}:{}}}const Nw=Qg.version,_w=Object.freeze(Object.defineProperty({__proto__:null,accessPathDepth:ri,accessPathWithDatum:Xo,compile:$w,contains:G,deepEqual:ft,deleteNestedProperty:Nr,duplicate:j,entries:Xt,every:Go,fieldIntersection:qo,flatAccessWithDatum:Eu,getFirstDefined:de,hasIntersection:Ho,hash:W,internalField:Ou,isBoolean:Gi,isEmpty:Q,isEqual:sh,isInternalField:Cu,isNullOrFalse:fo,isNumeric:Vr,keys:x,logicalExpr:ji,mergeDeep:xu,never:vu,normalize:$d,normalizeAngle:Hi,omit:Ae,pick:ii,prefixGenerator:po,removePathFromField:Vo,replaceAll:Cn,replacePathInField:Be,resetIdCounter:ah,setEqual:Su,some:On,stringify:te,titleCase:Zi,unique:dt,uniqueId:$u,vals:Se,varName:se,version:Nw},Symbol.toStringTag,{value:"Module"}));function Dp(e){const[t,n]=/schema\/([\w-]+)\/([\w\.\-]+)\.json$/g.exec(e).slice(1,3);return{library:t,version:n}}var Tw="vega-themes",Aw="2.14.0",Fw="Themes for stylized Vega and Vega-Lite visualizations.",kw=["vega","vega-lite","themes","style"],Iw="BSD-3-Clause",Rw={name:"UW Interactive Data Lab",url:"https://idl.cs.washington.edu"},Lw=[{name:"Emily Gu",url:"https://github.com/emilygu"},{name:"Arvind Satyanarayan",url:"http://arvindsatya.com"},{name:"Jeffrey Heer",url:"https://idl.cs.washington.edu"},{name:"Dominik Moritz",url:"https://www.domoritz.de"}],Pw="build/vega-themes.js",zw="build/vega-themes.module.js",Dw="build/vega-themes.min.js",jw="build/vega-themes.min.js",Mw="build/vega-themes.module.d.ts",Uw={type:"git",url:"https://github.com/vega/vega-themes.git"},Bw=["src","build"],Ww={prebuild:"yarn clean",build:"rollup -c",clean:"rimraf build && rimraf examples/build","copy:data":"rsync -r node_modules/vega-datasets/data/* examples/data","copy:build":"rsync -r build/* examples/build","deploy:gh":"yarn build && mkdir -p examples/build && rsync -r build/* examples/build && gh-pages -d examples",preversion:"yarn lint",serve:"browser-sync start -s -f build examples --serveStatic examples",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",format:"eslint . --fix",lint:"eslint .",release:"release-it"},Gw={"@babel/core":"^7.22.9","@babel/plugin-proposal-async-generator-functions":"^7.20.7","@babel/plugin-proposal-json-strings":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-proposal-optional-catch-binding":"^7.18.6","@babel/plugin-transform-runtime":"^7.22.9","@babel/preset-env":"^7.22.9","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.1.0","@rollup/plugin-terser":"^0.4.3","@typescript-eslint/eslint-plugin":"^6.0.0","@typescript-eslint/parser":"^6.0.0","browser-sync":"^2.29.3",concurrently:"^8.2.0",eslint:"^8.45.0","eslint-config-prettier":"^8.8.0","eslint-plugin-prettier":"^5.0.0","gh-pages":"^5.0.0",prettier:"^3.0.0","release-it":"^16.1.0",rollup:"^3.26.2","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",typescript:"^5.1.6",vega:"^5.25.0","vega-lite":"^5.9.3"},Hw={vega:"*","vega-lite":"*"},qw={},Xw={name:Tw,version:Aw,description:Fw,keywords:kw,license:Iw,author:Rw,contributors:Lw,main:Pw,module:zw,unpkg:Dw,jsdelivr:jw,types:Mw,repository:Uw,files:Bw,scripts:Ww,devDependencies:Gw,peerDependencies:Hw,dependencies:qw};const qn="#fff",Rl="#888",Vw={background:"#333",view:{stroke:Rl},title:{color:qn,subtitleColor:qn},style:{"guide-label":{fill:qn},"guide-title":{fill:qn}},axis:{domainColor:qn,gridColor:Rl,tickColor:qn}},un="#4572a7",Yw={background:"#fff",arc:{fill:un},area:{fill:un},line:{stroke:un,strokeWidth:2},path:{stroke:un},rect:{fill:un},shape:{stroke:un},symbol:{fill:un,strokeWidth:1.5,size:50},axis:{bandPosition:.5,grid:!0,gridColor:"#000000",gridOpacity:1,gridWidth:.5,labelPadding:10,tickSize:5,tickWidth:.5},axisBand:{grid:!1,tickExtra:!0},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:50,symbolType:"square"},range:{category:["#4572a7","#aa4643","#8aa453","#71598e","#4598ae","#d98445","#94aace","#d09393","#b9cc98","#a99cbc"]}},fn="#30a2da",Ks="#cbcbcb",Kw="#999",Jw="#333",Ll="#f0f0f0",Pl="#333",Qw={arc:{fill:fn},area:{fill:fn},axis:{domainColor:Ks,grid:!0,gridColor:Ks,gridWidth:1,labelColor:Kw,labelFontSize:10,titleColor:Jw,tickColor:Ks,tickSize:10,titleFontSize:14,titlePadding:10,labelPadding:4},axisBand:{grid:!1},background:Ll,group:{fill:Ll},legend:{labelColor:Pl,labelFontSize:11,padding:1,symbolSize:30,symbolType:"square",titleColor:Pl,titleFontSize:14,titlePadding:10},line:{stroke:fn,strokeWidth:2},path:{stroke:fn,strokeWidth:.5},rect:{fill:fn},range:{category:["#30a2da","#fc4f30","#e5ae38","#6d904f","#8b8b8b","#b96db8","#ff9e27","#56cc60","#52d2ca","#52689e","#545454","#9fe4f8"],diverging:["#cc0020","#e77866","#f6e7e1","#d6e8ed","#91bfd9","#1d78b5"],heatmap:["#d6e8ed","#cee0e5","#91bfd9","#549cc6","#1d78b5"]},point:{filled:!0,shape:"circle"},shape:{stroke:fn},bar:{binSpacing:2,fill:fn,stroke:null},title:{anchor:"start",fontSize:24,fontWeight:600,offset:20}},dn="#000",Zw={group:{fill:"#e5e5e5"},arc:{fill:dn},area:{fill:dn},line:{stroke:dn},path:{stroke:dn},rect:{fill:dn},shape:{stroke:dn},symbol:{fill:dn,size:40},axis:{domain:!1,grid:!0,gridColor:"#FFFFFF",gridOpacity:1,labelColor:"#7F7F7F",labelPadding:4,tickColor:"#7F7F7F",tickSize:5.67,titleFontSize:16,titleFontWeight:"normal"},legend:{labelBaseline:"middle",labelFontSize:11,symbolSize:40},range:{category:["#000000","#7F7F7F","#1A1A1A","#999999","#333333","#B0B0B0","#4D4D4D","#C9C9C9","#666666","#DCDCDC"]}},e$=22,t$="normal",zl="Benton Gothic, sans-serif",Dl=11.5,n$="normal",pn="#82c6df",Js="Benton Gothic Bold, sans-serif",jl="normal",Ml=13,Fi={"category-6":["#ec8431","#829eb1","#c89d29","#3580b1","#adc839","#ab7fb4"],"fire-7":["#fbf2c7","#f9e39c","#f8d36e","#f4bb6a","#e68a4f","#d15a40","#ab4232"],"fireandice-6":["#e68a4f","#f4bb6a","#f9e39c","#dadfe2","#a6b7c6","#849eae"],"ice-7":["#edefee","#dadfe2","#c4ccd2","#a6b7c6","#849eae","#607785","#47525d"]},i$={background:"#ffffff",title:{anchor:"start",color:"#000000",font:Js,fontSize:e$,fontWeight:t$},arc:{fill:pn},area:{fill:pn},line:{stroke:pn,strokeWidth:2},path:{stroke:pn},rect:{fill:pn},shape:{stroke:pn},symbol:{fill:pn,size:30},axis:{labelFont:zl,labelFontSize:Dl,labelFontWeight:n$,titleFont:Js,titleFontSize:Ml,titleFontWeight:jl},axisX:{labelAngle:0,labelPadding:4,tickSize:3},axisY:{labelBaseline:"middle",maxExtent:45,minExtent:45,tickSize:2,titleAlign:"left",titleAngle:0,titleX:-45,titleY:-11},legend:{labelFont:zl,labelFontSize:Dl,symbolType:"square",titleFont:Js,titleFontSize:Ml,titleFontWeight:jl},range:{category:Fi["category-6"],diverging:Fi["fireandice-6"],heatmap:Fi["fire-7"],ordinal:Fi["fire-7"],ramp:Fi["fire-7"]}},gn="#ab5787",br="#979797",r$={background:"#f9f9f9",arc:{fill:gn},area:{fill:gn},line:{stroke:gn},path:{stroke:gn},rect:{fill:gn},shape:{stroke:gn},symbol:{fill:gn,size:30},axis:{domainColor:br,domainWidth:.5,gridWidth:.2,labelColor:br,tickColor:br,tickWidth:.2,titleColor:br},axisBand:{grid:!1},axisX:{grid:!0,tickSize:10},axisY:{domain:!1,grid:!0,tickSize:0},legend:{labelFontSize:11,padding:1,symbolSize:30,symbolType:"square"},range:{category:["#ab5787","#51b2e5","#703c5c","#168dd9","#d190b6","#00609f","#d365ba","#154866","#666666","#c4c4c4"]}},hn="#3e5c69",s$={background:"#fff",arc:{fill:hn},area:{fill:hn},line:{stroke:hn},path:{stroke:hn},rect:{fill:hn},shape:{stroke:hn},symbol:{fill:hn},axis:{domainWidth:.5,grid:!0,labelPadding:2,tickSize:5,tickWidth:.5,titleFontWeight:"normal"},axisBand:{grid:!1},axisX:{gridWidth:.2},axisY:{gridDash:[3],gridWidth:.4},legend:{labelFontSize:11,padding:1,symbolType:"square"},range:{category:["#3e5c69","#6793a6","#182429","#0570b0","#3690c0","#74a9cf","#a6bddb","#e2ddf2"]}},Me="#1696d2",Ul="#000000",o$="#FFFFFF",vr="Lato",Qs="Lato",a$="Lato",c$="#DEDDDD",l$=18,ki={"main-colors":["#1696d2","#d2d2d2","#000000","#fdbf11","#ec008b","#55b748","#5c5859","#db2b27"],"shades-blue":["#CFE8F3","#A2D4EC","#73BFE2","#46ABDB","#1696D2","#12719E","#0A4C6A","#062635"],"shades-gray":["#F5F5F5","#ECECEC","#E3E3E3","#DCDBDB","#D2D2D2","#9D9D9D","#696969","#353535"],"shades-yellow":["#FFF2CF","#FCE39E","#FDD870","#FCCB41","#FDBF11","#E88E2D","#CA5800","#843215"],"shades-magenta":["#F5CBDF","#EB99C2","#E46AA7","#E54096","#EC008B","#AF1F6B","#761548","#351123"],"shades-green":["#DCEDD9","#BCDEB4","#98CF90","#78C26D","#55B748","#408941","#2C5C2D","#1A2E19"],"shades-black":["#D5D5D4","#ADABAC","#848081","#5C5859","#332D2F","#262223","#1A1717","#0E0C0D"],"shades-red":["#F8D5D4","#F1AAA9","#E9807D","#E25552","#DB2B27","#A4201D","#6E1614","#370B0A"],"one-group":["#1696d2","#000000"],"two-groups-cat-1":["#1696d2","#000000"],"two-groups-cat-2":["#1696d2","#fdbf11"],"two-groups-cat-3":["#1696d2","#db2b27"],"two-groups-seq":["#a2d4ec","#1696d2"],"three-groups-cat":["#1696d2","#fdbf11","#000000"],"three-groups-seq":["#a2d4ec","#1696d2","#0a4c6a"],"four-groups-cat-1":["#000000","#d2d2d2","#fdbf11","#1696d2"],"four-groups-cat-2":["#1696d2","#ec0008b","#fdbf11","#5c5859"],"four-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a"],"five-groups-cat-1":["#1696d2","#fdbf11","#d2d2d2","#ec008b","#000000"],"five-groups-cat-2":["#1696d2","#0a4c6a","#d2d2d2","#fdbf11","#332d2f"],"five-groups-seq":["#cfe8f3","#73bf42","#1696d2","#0a4c6a","#000000"],"six-groups-cat-1":["#1696d2","#ec008b","#fdbf11","#000000","#d2d2d2","#55b748"],"six-groups-cat-2":["#1696d2","#d2d2d2","#ec008b","#fdbf11","#332d2f","#0a4c6a"],"six-groups-seq":["#cfe8f3","#a2d4ec","#73bfe2","#46abdb","#1696d2","#12719e"],"diverging-colors":["#ca5800","#fdbf11","#fdd870","#fff2cf","#cfe8f3","#73bfe2","#1696d2","#0a4c6a"]},u$={background:o$,title:{anchor:"start",fontSize:l$,font:vr},axisX:{domain:!0,domainColor:Ul,domainWidth:1,grid:!1,labelFontSize:12,labelFont:Qs,labelAngle:0,tickColor:Ul,tickSize:5,titleFontSize:12,titlePadding:10,titleFont:vr},axisY:{domain:!1,domainWidth:1,grid:!0,gridColor:c$,gridWidth:1,labelFontSize:12,labelFont:Qs,labelPadding:8,ticks:!1,titleFontSize:12,titlePadding:10,titleFont:vr,titleAngle:0,titleY:-10,titleX:18},legend:{labelFontSize:12,labelFont:Qs,symbolSize:100,titleFontSize:12,titlePadding:10,titleFont:vr,orient:"right",offset:10},view:{stroke:"transparent"},range:{category:ki["six-groups-cat-1"],diverging:ki["diverging-colors"],heatmap:ki["diverging-colors"],ordinal:ki["six-groups-seq"],ramp:ki["shades-blue"]},area:{fill:Me},rect:{fill:Me},line:{color:Me,stroke:Me,strokeWidth:5},trail:{color:Me,stroke:Me,strokeWidth:0,size:1},path:{stroke:Me,strokeWidth:.5},point:{filled:!0},text:{font:a$,color:Me,fontSize:11,align:"center",fontWeight:400,size:11},style:{bar:{fill:Me,stroke:null}},arc:{fill:Me},shape:{stroke:Me},symbol:{fill:Me,size:30}},mn="#3366CC",Bl="#ccc",xr="Arial, sans-serif",f$={arc:{fill:mn},area:{fill:mn},path:{stroke:mn},rect:{fill:mn},shape:{stroke:mn},symbol:{stroke:mn},circle:{fill:mn},background:"#fff",padding:{top:10,right:10,bottom:10,left:10},style:{"guide-label":{font:xr,fontSize:12},"guide-title":{font:xr,fontSize:12},"group-title":{font:xr,fontSize:12}},title:{font:xr,fontSize:14,fontWeight:"bold",dy:-3,anchor:"start"},axis:{gridColor:Bl,tickColor:Bl,domain:!1,grid:!0},range:{category:["#4285F4","#DB4437","#F4B400","#0F9D58","#AB47BC","#00ACC1","#FF7043","#9E9D24","#5C6BC0","#F06292","#00796B","#C2185B"],heatmap:["#c6dafc","#5e97f6","#2a56c6"]}},pc=e=>e*(1/3+1),Wl=pc(9),Gl=pc(10),Hl=pc(12),Ii="Segoe UI",ql="wf_standard-font, helvetica, arial, sans-serif",Xl="#252423",Ri="#605E5C",Vl="transparent",d$="#C8C6C4",Xe="#118DFF",p$="#12239E",g$="#E66C37",h$="#6B007B",m$="#E044A7",y$="#744EC2",b$="#D9B300",v$="#D64550",jp=Xe,Mp="#DEEFFF",Yl=[Mp,jp],x$=[Mp,"#c7e4ff","#b0d9ff","#9aceff","#83c3ff","#6cb9ff","#55aeff","#3fa3ff","#2898ff",jp],S$={view:{stroke:Vl},background:Vl,font:Ii,header:{titleFont:ql,titleFontSize:Hl,titleColor:Xl,labelFont:Ii,labelFontSize:Gl,labelColor:Ri},axis:{ticks:!1,grid:!1,domain:!1,labelColor:Ri,labelFontSize:Wl,titleFont:ql,titleColor:Xl,titleFontSize:Hl,titleFontWeight:"normal"},axisQuantitative:{tickCount:3,grid:!0,gridColor:d$,gridDash:[1,5],labelFlush:!1},axisBand:{tickExtra:!0},axisX:{labelPadding:5},axisY:{labelPadding:10},bar:{fill:Xe},line:{stroke:Xe,strokeWidth:3,strokeCap:"round",strokeJoin:"round"},text:{font:Ii,fontSize:Wl,fill:Ri},arc:{fill:Xe},area:{fill:Xe,line:!0,opacity:.6},path:{stroke:Xe},rect:{fill:Xe},point:{fill:Xe,filled:!0,size:75},shape:{stroke:Xe},symbol:{fill:Xe,strokeWidth:1.5,size:50},legend:{titleFont:Ii,titleFontWeight:"bold",titleColor:Ri,labelFont:Ii,labelFontSize:Gl,labelColor:Ri,symbolType:"circle",symbolSize:75},range:{category:[Xe,p$,g$,h$,m$,y$,b$,v$],diverging:Yl,heatmap:Yl,ordinal:x$}},Zs='IBM Plex Sans,system-ui,-apple-system,BlinkMacSystemFont,".sfnstext-regular",sans-serif',Kl=400,E$=["#8a3ffc","#33b1ff","#007d79","#ff7eb6","#fa4d56","#fff1f1","#6fdc8c","#4589ff","#d12771","#d2a106","#08bdba","#bae6ff","#ba4e00","#d4bbff"],w$=["#6929c4","#1192e8","#005d5d","#9f1853","#fa4d56","#570408","#198038","#002d9c","#ee538b","#b28600","#009d9a","#012749","#8a3800","#a56eff"];function Ls({type:e,background:t}){const n=e==="dark"?"#161616":"#ffffff",i=e==="dark"?"#f4f4f4":"#161616",r=e==="dark"?E$:w$,s=e==="dark"?"#d4bbff":"#6929c4";return{background:t,arc:{fill:s},area:{fill:s},path:{stroke:s},rect:{fill:s},shape:{stroke:s},symbol:{stroke:s},circle:{fill:s},view:{fill:n,stroke:n},group:{fill:n},title:{color:i,anchor:"start",dy:-15,fontSize:16,font:Zs,fontWeight:600},axis:{labelColor:i,labelFontSize:12,grid:!0,gridColor:"#525252",titleColor:i,labelAngle:0},style:{"guide-label":{font:Zs,fill:i,fontWeight:Kl},"guide-title":{font:Zs,fill:i,fontWeight:Kl}},range:{category:r,diverging:["#750e13","#a2191f","#da1e28","#fa4d56","#ff8389","#ffb3b8","#ffd7d9","#fff1f1","#e5f6ff","#bae6ff","#82cfff","#33b1ff","#1192e8","#0072c3","#00539a","#003a6d"],heatmap:["#f6f2ff","#e8daff","#d4bbff","#be95ff","#a56eff","#8a3ffc","#6929c4","#491d8b","#31135e","#1c0f30"]}}}const $$=Ls({type:"light",background:"#ffffff"}),O$=Ls({type:"light",background:"#f4f4f4"}),C$=Ls({type:"dark",background:"#262626"}),N$=Ls({type:"dark",background:"#161616"}),_$=Xw.version,T$=Object.freeze(Object.defineProperty({__proto__:null,carbong10:O$,carbong100:N$,carbong90:C$,carbonwhite:$$,dark:Vw,excel:Yw,fivethirtyeight:Qw,ggplot2:Zw,googlecharts:f$,latimes:i$,powerbi:S$,quartz:r$,urbaninstitute:u$,version:_$,vox:s$},Symbol.toStringTag,{value:"Module"}));function Ki(e){"@babel/helpers - typeof";return Ki=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ki(e)}function A$(e,t){if(Ki(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t||"default");if(Ki(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function F$(e){var t=A$(e,"string");return Ki(t)==="symbol"?t:String(t)}function k$(e,t,n){return t=F$(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I$(e,t){if(e==null)return{};var n={},i=Object.keys(e),r,s;for(s=0;s<i.length;s++)r=i[s],!(t.indexOf(r)>=0)&&(n[r]=e[r]);return n}function R$(e,t){if(e==null)return{};var n=I$(e,t),i,r;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)i=s[r],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}const L$=["title","image"];function P$(e,t,n){if(I(e))return"[".concat(e.map(i=>t(z(i)?i:Jl(i,n))).join(", "),"]");if(X(e)){let i="";const r=e,{title:s,image:o}=r,a=R$(r,L$);s&&(i+="<h2>".concat(t(s),"</h2>")),o&&(i+='<img src="'.concat(t(o),'">'));const c=Object.keys(a);if(c.length>0){i+="<table>";for(const l of c){let u=a[l];u!==void 0&&(X(u)&&(u=Jl(u,n)),i+='<tr><td class="key">'.concat(t(l),':</td><td class="value">').concat(t(u),"</td></tr>"))}i+="</table>"}return i||"{}"}return t(e)}function z$(e){const t=[];return function(n,i){if(typeof i!="object"||i===null)return i;const r=t.indexOf(this)+1;return t.length=r,t.length>e?"[Object]":t.indexOf(i)>=0?"[Circular]":(t.push(i),i)}}function Jl(e,t){return JSON.stringify(e,z$(t))}var D$="#vg-tooltip-element {\n  visibility: hidden;\n  padding: 8px;\n  position: fixed;\n  z-index: 1000;\n  font-family: sans-serif;\n  font-size: 11px;\n  border-radius: 3px;\n  box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);\n  /* The default theme is the light theme. */\n  background-color: rgba(255, 255, 255, 0.95);\n  border: 1px solid #d9d9d9;\n  color: black;\n}\n#vg-tooltip-element.visible {\n  visibility: visible;\n}\n#vg-tooltip-element h2 {\n  margin-top: 0;\n  margin-bottom: 10px;\n  font-size: 13px;\n}\n#vg-tooltip-element table {\n  border-spacing: 0;\n}\n#vg-tooltip-element table tr {\n  border: none;\n}\n#vg-tooltip-element table tr td {\n  overflow: hidden;\n  text-overflow: ellipsis;\n  padding-top: 2px;\n  padding-bottom: 2px;\n}\n#vg-tooltip-element table tr td.key {\n  color: #808080;\n  max-width: 150px;\n  text-align: right;\n  padding-right: 4px;\n}\n#vg-tooltip-element table tr td.value {\n  display: block;\n  max-width: 300px;\n  max-height: 7em;\n  text-align: left;\n}\n#vg-tooltip-element.dark-theme {\n  background-color: rgba(32, 32, 32, 0.9);\n  border: 1px solid #f5f5f5;\n  color: white;\n}\n#vg-tooltip-element.dark-theme td.key {\n  color: #bfbfbf;\n}\n";const Up="vg-tooltip-element",j$={offsetX:10,offsetY:10,id:Up,styleId:"vega-tooltip-style",theme:"light",disableDefaultStyle:!1,sanitize:M$,maxDepth:2,formatTooltip:P$};function M$(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;")}function U$(e){if(!/^[A-Za-z]+[-:.\w]*$/.test(e))throw new Error("Invalid HTML ID");return D$.toString().replace(Up,e)}function B$(e,t,n,i){let r=e.clientX+n;r+t.width>window.innerWidth&&(r=+e.clientX-n-t.width);let s=e.clientY+i;return s+t.height>window.innerHeight&&(s=+e.clientY-i-t.height),{x:r,y:s}}function Ql(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function Zl(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ql(Object(n),!0).forEach(function(i){k$(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ql(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}class W${constructor(t){this.options=Zl(Zl({},j$),t);const n=this.options.id;if(this.el=null,this.call=this.tooltipHandler.bind(this),!this.options.disableDefaultStyle&&!document.getElementById(this.options.styleId)){const i=document.createElement("style");i.setAttribute("id",this.options.styleId),i.innerHTML=U$(n);const r=document.head;r.childNodes.length>0?r.insertBefore(i,r.childNodes[0]):r.appendChild(i)}}tooltipHandler(t,n,i,r){var a;if(this.el=document.getElementById(this.options.id),this.el||(this.el=document.createElement("div"),this.el.setAttribute("id",this.options.id),this.el.classList.add("vg-tooltip"),((a=document.fullscreenElement)!=null?a:document.body).appendChild(this.el)),r==null||r===""){this.el.classList.remove("visible","".concat(this.options.theme,"-theme"));return}this.el.innerHTML=this.options.formatTooltip(r,this.options.sanitize,this.options.maxDepth),this.el.classList.add("visible","".concat(this.options.theme,"-theme"));const{x:s,y:o}=B$(n,this.el.getBoundingClientRect(),this.options.offsetX,this.options.offsetY);this.el.style.top="".concat(o,"px"),this.el.style.left="".concat(s,"px")}}function Ji(e){"@babel/helpers - typeof";return Ji=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(t){return typeof t}:function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ji(e)}function G$(e,t){if(Ji(e)!=="object"||e===null)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var i=n.call(e,t||"default");if(Ji(i)!=="object")return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function H$(e){var t=G$(e,"string");return Ji(t)==="symbol"?t:String(t)}function q$(e,t,n){return t=H$(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function X$(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var eo,eu;function V$(){return eu||(eu=1,eo=function(e){e.prototype[Symbol.iterator]=function*(){for(let t=this.head;t;t=t.next)yield t.value}}),eo}var Y$=V;V.Node=Ln;V.create=V;function V(e){var t=this;if(t instanceof V||(t=new V),t.tail=null,t.head=null,t.length=0,e&&typeof e.forEach=="function")e.forEach(function(r){t.push(r)});else if(arguments.length>0)for(var n=0,i=arguments.length;n<i;n++)t.push(arguments[n]);return t}V.prototype.removeNode=function(e){if(e.list!==this)throw new Error("removing node which does not belong to this list");var t=e.next,n=e.prev;return t&&(t.prev=n),n&&(n.next=t),e===this.head&&(this.head=t),e===this.tail&&(this.tail=n),e.list.length--,e.next=null,e.prev=null,e.list=null,t};V.prototype.unshiftNode=function(e){if(e!==this.head){e.list&&e.list.removeNode(e);var t=this.head;e.list=this,e.next=t,t&&(t.prev=e),this.head=e,this.tail||(this.tail=e),this.length++}};V.prototype.pushNode=function(e){if(e!==this.tail){e.list&&e.list.removeNode(e);var t=this.tail;e.list=this,e.prev=t,t&&(t.next=e),this.tail=e,this.head||(this.head=e),this.length++}};V.prototype.push=function(){for(var e=0,t=arguments.length;e<t;e++)J$(this,arguments[e]);return this.length};V.prototype.unshift=function(){for(var e=0,t=arguments.length;e<t;e++)Q$(this,arguments[e]);return this.length};V.prototype.pop=function(){if(this.tail){var e=this.tail.value;return this.tail=this.tail.prev,this.tail?this.tail.next=null:this.head=null,this.length--,e}};V.prototype.shift=function(){if(this.head){var e=this.head.value;return this.head=this.head.next,this.head?this.head.prev=null:this.tail=null,this.length--,e}};V.prototype.forEach=function(e,t){t=t||this;for(var n=this.head,i=0;n!==null;i++)e.call(t,n.value,i,this),n=n.next};V.prototype.forEachReverse=function(e,t){t=t||this;for(var n=this.tail,i=this.length-1;n!==null;i--)e.call(t,n.value,i,this),n=n.prev};V.prototype.get=function(e){for(var t=0,n=this.head;n!==null&&t<e;t++)n=n.next;if(t===e&&n!==null)return n.value};V.prototype.getReverse=function(e){for(var t=0,n=this.tail;n!==null&&t<e;t++)n=n.prev;if(t===e&&n!==null)return n.value};V.prototype.map=function(e,t){t=t||this;for(var n=new V,i=this.head;i!==null;)n.push(e.call(t,i.value,this)),i=i.next;return n};V.prototype.mapReverse=function(e,t){t=t||this;for(var n=new V,i=this.tail;i!==null;)n.push(e.call(t,i.value,this)),i=i.prev;return n};V.prototype.reduce=function(e,t){var n,i=this.head;if(arguments.length>1)n=t;else if(this.head)i=this.head.next,n=this.head.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=0;i!==null;r++)n=e(n,i.value,r),i=i.next;return n};V.prototype.reduceReverse=function(e,t){var n,i=this.tail;if(arguments.length>1)n=t;else if(this.tail)i=this.tail.prev,n=this.tail.value;else throw new TypeError("Reduce of empty list with no initial value");for(var r=this.length-1;i!==null;r--)n=e(n,i.value,r),i=i.prev;return n};V.prototype.toArray=function(){for(var e=new Array(this.length),t=0,n=this.head;n!==null;t++)e[t]=n.value,n=n.next;return e};V.prototype.toArrayReverse=function(){for(var e=new Array(this.length),t=0,n=this.tail;n!==null;t++)e[t]=n.value,n=n.prev;return e};V.prototype.slice=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new V;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(;r!==null&&i<t;i++,r=r.next)n.push(r.value);return n};V.prototype.sliceReverse=function(e,t){t=t||this.length,t<0&&(t+=this.length),e=e||0,e<0&&(e+=this.length);var n=new V;if(t<e||t<0)return n;e<0&&(e=0),t>this.length&&(t=this.length);for(var i=this.length,r=this.tail;r!==null&&i>t;i--)r=r.prev;for(;r!==null&&i>e;i--,r=r.prev)n.push(r.value);return n};V.prototype.splice=function(e,t,...n){e>this.length&&(e=this.length-1),e<0&&(e=this.length+e);for(var i=0,r=this.head;r!==null&&i<e;i++)r=r.next;for(var s=[],i=0;r&&i<t;i++)s.push(r.value),r=this.removeNode(r);r===null&&(r=this.tail),r!==this.head&&r!==this.tail&&(r=r.prev);for(var i=0;i<n.length;i++)r=K$(this,r,n[i]);return s};V.prototype.reverse=function(){for(var e=this.head,t=this.tail,n=e;n!==null;n=n.prev){var i=n.prev;n.prev=n.next,n.next=i}return this.head=t,this.tail=e,this};function K$(e,t,n){var i=t===e.head?new Ln(n,null,t,e):new Ln(n,t,t.next,e);return i.next===null&&(e.tail=i),i.prev===null&&(e.head=i),e.length++,i}function J$(e,t){e.tail=new Ln(t,e.tail,null,e),e.head||(e.head=e.tail),e.length++}function Q$(e,t){e.head=new Ln(t,null,e.head,e),e.tail||(e.tail=e.head),e.length++}function Ln(e,t,n,i){if(!(this instanceof Ln))return new Ln(e,t,n,i);this.list=i,this.value=e,t?(t.next=this,this.prev=t):this.prev=null,n?(n.prev=this,this.next=n):this.next=null}try{V$()(V)}catch(e){}const Z$=Y$,bn=Symbol("max"),Nt=Symbol("length"),Xn=Symbol("lengthCalculator"),Bi=Symbol("allowStale"),vn=Symbol("maxAge"),Ct=Symbol("dispose"),tu=Symbol("noDisposeOnSet"),ge=Symbol("lruList"),Ve=Symbol("cache"),Bp=Symbol("updateAgeOnGet"),to=()=>1;class e1{constructor(t){if(typeof t=="number"&&(t={max:t}),t||(t={}),t.max&&(typeof t.max!="number"||t.max<0))throw new TypeError("max must be a non-negative number");this[bn]=t.max||1/0;const n=t.length||to;if(this[Xn]=typeof n!="function"?to:n,this[Bi]=t.stale||!1,t.maxAge&&typeof t.maxAge!="number")throw new TypeError("maxAge must be a number");this[vn]=t.maxAge||0,this[Ct]=t.dispose,this[tu]=t.noDisposeOnSet||!1,this[Bp]=t.updateAgeOnGet||!1,this.reset()}set max(t){if(typeof t!="number"||t<0)throw new TypeError("max must be a non-negative number");this[bn]=t||1/0,Li(this)}get max(){return this[bn]}set allowStale(t){this[Bi]=!!t}get allowStale(){return this[Bi]}set maxAge(t){if(typeof t!="number")throw new TypeError("maxAge must be a non-negative number");this[vn]=t,Li(this)}get maxAge(){return this[vn]}set lengthCalculator(t){typeof t!="function"&&(t=to),t!==this[Xn]&&(this[Xn]=t,this[Nt]=0,this[ge].forEach(n=>{n.length=this[Xn](n.value,n.key),this[Nt]+=n.length})),Li(this)}get lengthCalculator(){return this[Xn]}get length(){return this[Nt]}get itemCount(){return this[ge].length}rforEach(t,n){n=n||this;for(let i=this[ge].tail;i!==null;){const r=i.prev;nu(this,t,i,n),i=r}}forEach(t,n){n=n||this;for(let i=this[ge].head;i!==null;){const r=i.next;nu(this,t,i,n),i=r}}keys(){return this[ge].toArray().map(t=>t.key)}values(){return this[ge].toArray().map(t=>t.value)}reset(){this[Ct]&&this[ge]&&this[ge].length&&this[ge].forEach(t=>this[Ct](t.key,t.value)),this[Ve]=new Map,this[ge]=new Z$,this[Nt]=0}dump(){return this[ge].map(t=>Wr(this,t)?!1:{k:t.key,v:t.value,e:t.now+(t.maxAge||0)}).toArray().filter(t=>t)}dumpLru(){return this[ge]}set(t,n,i){if(i=i||this[vn],i&&typeof i!="number")throw new TypeError("maxAge must be a number");const r=i?Date.now():0,s=this[Xn](n,t);if(this[Ve].has(t)){if(s>this[bn])return ni(this,this[Ve].get(t)),!1;const c=this[Ve].get(t).value;return this[Ct]&&(this[tu]||this[Ct](t,c.value)),c.now=r,c.maxAge=i,c.value=n,this[Nt]+=s-c.length,c.length=s,this.get(t),Li(this),!0}const o=new t1(t,n,s,r,i);return o.length>this[bn]?(this[Ct]&&this[Ct](t,n),!1):(this[Nt]+=o.length,this[ge].unshift(o),this[Ve].set(t,this[ge].head),Li(this),!0)}has(t){if(!this[Ve].has(t))return!1;const n=this[Ve].get(t).value;return!Wr(this,n)}get(t){return no(this,t,!0)}peek(t){return no(this,t,!1)}pop(){const t=this[ge].tail;return t?(ni(this,t),t.value):null}del(t){ni(this,this[Ve].get(t))}load(t){this.reset();const n=Date.now();for(let i=t.length-1;i>=0;i--){const r=t[i],s=r.e||0;if(s===0)this.set(r.k,r.v);else{const o=s-n;o>0&&this.set(r.k,r.v,o)}}}prune(){this[Ve].forEach((t,n)=>no(this,n,!1))}}const no=(e,t,n)=>{const i=e[Ve].get(t);if(i){const r=i.value;if(Wr(e,r)){if(ni(e,i),!e[Bi])return}else n&&(e[Bp]&&(i.value.now=Date.now()),e[ge].unshiftNode(i));return r.value}},Wr=(e,t)=>{if(!t||!t.maxAge&&!e[vn])return!1;const n=Date.now()-t.now;return t.maxAge?n>t.maxAge:e[vn]&&n>e[vn]},Li=e=>{if(e[Nt]>e[bn])for(let t=e[ge].tail;e[Nt]>e[bn]&&t!==null;){const n=t.prev;ni(e,t),t=n}},ni=(e,t)=>{if(t){const n=t.value;e[Ct]&&e[Ct](n.key,n.value),e[Nt]-=n.length,e[Ve].delete(n.key),e[ge].removeNode(t)}};class t1{constructor(t,n,i,r,s){this.key=t,this.value=n,this.length=i,this.now=r,this.maxAge=s||0}}const nu=(e,t,n,i)=>{let r=n.value;Wr(e,r)&&(ni(e,n),e[Bi]||(r=void 0)),r&&t.call(i,r.value,r.key,e)};var n1=e1;const i1=Object.freeze({loose:!0}),r1=Object.freeze({}),s1=e=>e?typeof e!="object"?i1:e:r1;var gc=s1,Po={exports:{}};const o1="2.0.0",Wp=256,a1=Number.MAX_SAFE_INTEGER||9007199254740991,c1=16,l1=Wp-6,u1=["major","premajor","minor","preminor","patch","prepatch","prerelease"];var hc={MAX_LENGTH:Wp,MAX_SAFE_COMPONENT_LENGTH:c1,MAX_SAFE_BUILD_LENGTH:l1,MAX_SAFE_INTEGER:a1,RELEASE_TYPES:u1,SEMVER_SPEC_VERSION:o1,FLAG_INCLUDE_PRERELEASE:1,FLAG_LOOSE:2};const f1=typeof process=="object"&&process.env&&{}.NODE_DEBUG&&/\bsemver\b/i.test({}.NODE_DEBUG)?(...e)=>console.error("SEMVER",...e):()=>{};var Ps=f1;(function(e,t){const{MAX_SAFE_COMPONENT_LENGTH:n,MAX_SAFE_BUILD_LENGTH:i,MAX_LENGTH:r}=hc,s=Ps;t=e.exports={};const o=t.re=[],a=t.safeRe=[],c=t.src=[],l=t.t={};let u=0;const f="[a-zA-Z0-9-]",d=[["\\s",1],["\\d",r],[f,i]],p=h=>{for(const[m,y]of d)h=h.split("".concat(m,"*")).join("".concat(m,"{0,").concat(y,"}")).split("".concat(m,"+")).join("".concat(m,"{1,").concat(y,"}"));return h},g=(h,m,y)=>{const b=p(m),N=u++;s(h,N,m),l[h]=N,c[N]=m,o[N]=new RegExp(m,y?"g":void 0),a[N]=new RegExp(b,y?"g":void 0)};g("NUMERICIDENTIFIER","0|[1-9]\\d*"),g("NUMERICIDENTIFIERLOOSE","\\d+"),g("NONNUMERICIDENTIFIER","\\d*[a-zA-Z-]".concat(f,"*")),g("MAINVERSION","(".concat(c[l.NUMERICIDENTIFIER],")\\.")+"(".concat(c[l.NUMERICIDENTIFIER],")\\.")+"(".concat(c[l.NUMERICIDENTIFIER],")")),g("MAINVERSIONLOOSE","(".concat(c[l.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(c[l.NUMERICIDENTIFIERLOOSE],")\\.")+"(".concat(c[l.NUMERICIDENTIFIERLOOSE],")")),g("PRERELEASEIDENTIFIER","(?:".concat(c[l.NUMERICIDENTIFIER],"|").concat(c[l.NONNUMERICIDENTIFIER],")")),g("PRERELEASEIDENTIFIERLOOSE","(?:".concat(c[l.NUMERICIDENTIFIERLOOSE],"|").concat(c[l.NONNUMERICIDENTIFIER],")")),g("PRERELEASE","(?:-(".concat(c[l.PRERELEASEIDENTIFIER],"(?:\\.").concat(c[l.PRERELEASEIDENTIFIER],")*))")),g("PRERELEASELOOSE","(?:-?(".concat(c[l.PRERELEASEIDENTIFIERLOOSE],"(?:\\.").concat(c[l.PRERELEASEIDENTIFIERLOOSE],")*))")),g("BUILDIDENTIFIER","".concat(f,"+")),g("BUILD","(?:\\+(".concat(c[l.BUILDIDENTIFIER],"(?:\\.").concat(c[l.BUILDIDENTIFIER],")*))")),g("FULLPLAIN","v?".concat(c[l.MAINVERSION]).concat(c[l.PRERELEASE],"?").concat(c[l.BUILD],"?")),g("FULL","^".concat(c[l.FULLPLAIN],"$")),g("LOOSEPLAIN","[v=\\s]*".concat(c[l.MAINVERSIONLOOSE]).concat(c[l.PRERELEASELOOSE],"?").concat(c[l.BUILD],"?")),g("LOOSE","^".concat(c[l.LOOSEPLAIN],"$")),g("GTLT","((?:<|>)?=?)"),g("XRANGEIDENTIFIERLOOSE","".concat(c[l.NUMERICIDENTIFIERLOOSE],"|x|X|\\*")),g("XRANGEIDENTIFIER","".concat(c[l.NUMERICIDENTIFIER],"|x|X|\\*")),g("XRANGEPLAIN","[v=\\s]*(".concat(c[l.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(c[l.XRANGEIDENTIFIER],")")+"(?:\\.(".concat(c[l.XRANGEIDENTIFIER],")")+"(?:".concat(c[l.PRERELEASE],")?").concat(c[l.BUILD],"?")+")?)?"),g("XRANGEPLAINLOOSE","[v=\\s]*(".concat(c[l.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(c[l.XRANGEIDENTIFIERLOOSE],")")+"(?:\\.(".concat(c[l.XRANGEIDENTIFIERLOOSE],")")+"(?:".concat(c[l.PRERELEASELOOSE],")?").concat(c[l.BUILD],"?")+")?)?"),g("XRANGE","^".concat(c[l.GTLT],"\\s*").concat(c[l.XRANGEPLAIN],"$")),g("XRANGELOOSE","^".concat(c[l.GTLT],"\\s*").concat(c[l.XRANGEPLAINLOOSE],"$")),g("COERCE","(^|[^\\d])(\\d{1,".concat(n,"})")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:\\.(\\d{1,".concat(n,"}))?")+"(?:$|[^\\d])"),g("COERCERTL",c[l.COERCE],!0),g("LONETILDE","(?:~>?)"),g("TILDETRIM","(\\s*)".concat(c[l.LONETILDE],"\\s+"),!0),t.tildeTrimReplace="$1~",g("TILDE","^".concat(c[l.LONETILDE]).concat(c[l.XRANGEPLAIN],"$")),g("TILDELOOSE","^".concat(c[l.LONETILDE]).concat(c[l.XRANGEPLAINLOOSE],"$")),g("LONECARET","(?:\\^)"),g("CARETTRIM","(\\s*)".concat(c[l.LONECARET],"\\s+"),!0),t.caretTrimReplace="$1^",g("CARET","^".concat(c[l.LONECARET]).concat(c[l.XRANGEPLAIN],"$")),g("CARETLOOSE","^".concat(c[l.LONECARET]).concat(c[l.XRANGEPLAINLOOSE],"$")),g("COMPARATORLOOSE","^".concat(c[l.GTLT],"\\s*(").concat(c[l.LOOSEPLAIN],")$|^$")),g("COMPARATOR","^".concat(c[l.GTLT],"\\s*(").concat(c[l.FULLPLAIN],")$|^$")),g("COMPARATORTRIM","(\\s*)".concat(c[l.GTLT],"\\s*(").concat(c[l.LOOSEPLAIN],"|").concat(c[l.XRANGEPLAIN],")"),!0),t.comparatorTrimReplace="$1$2$3",g("HYPHENRANGE","^\\s*(".concat(c[l.XRANGEPLAIN],")")+"\\s+-\\s+"+"(".concat(c[l.XRANGEPLAIN],")")+"\\s*$"),g("HYPHENRANGELOOSE","^\\s*(".concat(c[l.XRANGEPLAINLOOSE],")")+"\\s+-\\s+"+"(".concat(c[l.XRANGEPLAINLOOSE],")")+"\\s*$"),g("STAR","(<|>)?=?\\s*\\*"),g("GTE0","^\\s*>=\\s*0\\.0\\.0\\s*$"),g("GTE0PRE","^\\s*>=\\s*0\\.0\\.0-0\\s*$")})(Po,Po.exports);var mc=Po.exports;const iu=/^[0-9]+$/,Gp=(e,t)=>{const n=iu.test(e),i=iu.test(t);return n&&i&&(e=+e,t=+t),e===t?0:n&&!i?-1:i&&!n?1:e<t?-1:1},d1=(e,t)=>Gp(t,e);var p1={compareIdentifiers:Gp,rcompareIdentifiers:d1};const Sr=Ps,{MAX_LENGTH:ru,MAX_SAFE_INTEGER:Er}=hc,{safeRe:su,t:ou}=mc,g1=gc,{compareIdentifiers:Vn}=p1;let h1=class ct{constructor(t,n){if(n=g1(n),t instanceof ct){if(t.loose===!!n.loose&&t.includePrerelease===!!n.includePrerelease)return t;t=t.version}else if(typeof t!="string")throw new TypeError('Invalid version. Must be a string. Got type "'.concat(typeof t,'".'));if(t.length>ru)throw new TypeError("version is longer than ".concat(ru," characters"));Sr("SemVer",t,n),this.options=n,this.loose=!!n.loose,this.includePrerelease=!!n.includePrerelease;const i=t.trim().match(n.loose?su[ou.LOOSE]:su[ou.FULL]);if(!i)throw new TypeError("Invalid Version: ".concat(t));if(this.raw=t,this.major=+i[1],this.minor=+i[2],this.patch=+i[3],this.major>Er||this.major<0)throw new TypeError("Invalid major version");if(this.minor>Er||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>Er||this.patch<0)throw new TypeError("Invalid patch version");i[4]?this.prerelease=i[4].split(".").map(r=>{if(/^[0-9]+$/.test(r)){const s=+r;if(s>=0&&s<Er)return s}return r}):this.prerelease=[],this.build=i[5]?i[5].split("."):[],this.format()}format(){return this.version="".concat(this.major,".").concat(this.minor,".").concat(this.patch),this.prerelease.length&&(this.version+="-".concat(this.prerelease.join("."))),this.version}toString(){return this.version}compare(t){if(Sr("SemVer.compare",this.version,this.options,t),!(t instanceof ct)){if(typeof t=="string"&&t===this.version)return 0;t=new ct(t,this.options)}return t.version===this.version?0:this.compareMain(t)||this.comparePre(t)}compareMain(t){return t instanceof ct||(t=new ct(t,this.options)),Vn(this.major,t.major)||Vn(this.minor,t.minor)||Vn(this.patch,t.patch)}comparePre(t){if(t instanceof ct||(t=new ct(t,this.options)),this.prerelease.length&&!t.prerelease.length)return-1;if(!this.prerelease.length&&t.prerelease.length)return 1;if(!this.prerelease.length&&!t.prerelease.length)return 0;let n=0;do{const i=this.prerelease[n],r=t.prerelease[n];if(Sr("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return Vn(i,r)}while(++n)}compareBuild(t){t instanceof ct||(t=new ct(t,this.options));let n=0;do{const i=this.build[n],r=t.build[n];if(Sr("prerelease compare",n,i,r),i===void 0&&r===void 0)return 0;if(r===void 0)return 1;if(i===void 0)return-1;if(i===r)continue;return Vn(i,r)}while(++n)}inc(t,n,i){switch(t){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",n,i);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",n,i);break;case"prepatch":this.prerelease.length=0,this.inc("patch",n,i),this.inc("pre",n,i);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",n,i),this.inc("pre",n,i);break;case"major":(this.minor!==0||this.patch!==0||this.prerelease.length===0)&&this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":(this.patch!==0||this.prerelease.length===0)&&this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":{const r=Number(i)?1:0;if(!n&&i===!1)throw new Error("invalid increment argument: identifier is empty");if(this.prerelease.length===0)this.prerelease=[r];else{let s=this.prerelease.length;for(;--s>=0;)typeof this.prerelease[s]=="number"&&(this.prerelease[s]++,s=-2);if(s===-1){if(n===this.prerelease.join(".")&&i===!1)throw new Error("invalid increment argument: identifier already exists");this.prerelease.push(r)}}if(n){let s=[n,r];i===!1&&(s=[n]),Vn(this.prerelease[0],n)===0?isNaN(this.prerelease[1])&&(this.prerelease=s):this.prerelease=s}break}default:throw new Error("invalid increment argument: ".concat(t))}return this.raw=this.format(),this.build.length&&(this.raw+="+".concat(this.build.join("."))),this}};var yc=h1;const au=yc,m1=(e,t,n)=>new au(e,n).compare(new au(t,n));var _i=m1;const y1=_i,b1=(e,t,n)=>y1(e,t,n)===0;var v1=b1;const x1=_i,S1=(e,t,n)=>x1(e,t,n)!==0;var E1=S1;const w1=_i,$1=(e,t,n)=>w1(e,t,n)>0;var O1=$1;const C1=_i,N1=(e,t,n)=>C1(e,t,n)>=0;var _1=N1;const T1=_i,A1=(e,t,n)=>T1(e,t,n)<0;var F1=A1;const k1=_i,I1=(e,t,n)=>k1(e,t,n)<=0;var R1=I1;const L1=v1,P1=E1,z1=O1,D1=_1,j1=F1,M1=R1,U1=(e,t,n,i)=>{switch(t){case"===":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e===n;case"!==":return typeof e=="object"&&(e=e.version),typeof n=="object"&&(n=n.version),e!==n;case"":case"=":case"==":return L1(e,n,i);case"!=":return P1(e,n,i);case">":return z1(e,n,i);case">=":return D1(e,n,i);case"<":return j1(e,n,i);case"<=":return M1(e,n,i);default:throw new TypeError("Invalid operator: ".concat(t))}};var B1=U1,io,cu;function W1(){if(cu)return io;cu=1;const e=Symbol("SemVer ANY");class t{static get ANY(){return e}constructor(u,f){if(f=n(f),u instanceof t){if(u.loose===!!f.loose)return u;u=u.value}u=u.trim().split(/\s+/).join(" "),o("comparator",u,f),this.options=f,this.loose=!!f.loose,this.parse(u),this.semver===e?this.value="":this.value=this.operator+this.semver.version,o("comp",this)}parse(u){const f=this.options.loose?i[r.COMPARATORLOOSE]:i[r.COMPARATOR],d=u.match(f);if(!d)throw new TypeError("Invalid comparator: ".concat(u));this.operator=d[1]!==void 0?d[1]:"",this.operator==="="&&(this.operator=""),d[2]?this.semver=new a(d[2],this.options.loose):this.semver=e}toString(){return this.value}test(u){if(o("Comparator.test",u,this.options.loose),this.semver===e||u===e)return!0;if(typeof u=="string")try{u=new a(u,this.options)}catch(f){return!1}return s(u,this.operator,this.semver,this.options)}intersects(u,f){if(!(u instanceof t))throw new TypeError("a Comparator is required");return this.operator===""?this.value===""?!0:new c(u.value,f).test(this.value):u.operator===""?u.value===""?!0:new c(this.value,f).test(u.semver):(f=n(f),f.includePrerelease&&(this.value==="<0.0.0-0"||u.value==="<0.0.0-0")||!f.includePrerelease&&(this.value.startsWith("<0.0.0")||u.value.startsWith("<0.0.0"))?!1:!!(this.operator.startsWith(">")&&u.operator.startsWith(">")||this.operator.startsWith("<")&&u.operator.startsWith("<")||this.semver.version===u.semver.version&&this.operator.includes("=")&&u.operator.includes("=")||s(this.semver,"<",u.semver,f)&&this.operator.startsWith(">")&&u.operator.startsWith("<")||s(this.semver,">",u.semver,f)&&this.operator.startsWith("<")&&u.operator.startsWith(">")))}}io=t;const n=gc,{safeRe:i,t:r}=mc,s=B1,o=Ps,a=yc,c=Hp();return io}var ro,lu;function Hp(){if(lu)return ro;lu=1;class e{constructor(v,O){if(O=i(O),v instanceof e)return v.loose===!!O.loose&&v.includePrerelease===!!O.includePrerelease?v:new e(v.raw,O);if(v instanceof r)return this.raw=v.value,this.set=[[v]],this.format(),this;if(this.options=O,this.loose=!!O.loose,this.includePrerelease=!!O.includePrerelease,this.raw=v.trim().split(/\s+/).join(" "),this.set=this.raw.split("||").map(T=>this.parseRange(T.trim())).filter(T=>T.length),!this.set.length)throw new TypeError("Invalid SemVer Range: ".concat(this.raw));if(this.set.length>1){const T=this.set[0];if(this.set=this.set.filter(A=>!g(A[0])),this.set.length===0)this.set=[T];else if(this.set.length>1){for(const A of this.set)if(A.length===1&&h(A[0])){this.set=[A];break}}}this.format()}format(){return this.range=this.set.map(v=>v.join(" ").trim()).join("||").trim(),this.range}toString(){return this.range}parseRange(v){const T=((this.options.includePrerelease&&d)|(this.options.loose&&p))+":"+v,A=n.get(T);if(A)return A;const k=this.options.loose,D=k?a[c.HYPHENRANGELOOSE]:a[c.HYPHENRANGE];v=v.replace(D,ue(this.options.includePrerelease)),s("hyphen replace",v),v=v.replace(a[c.COMPARATORTRIM],l),s("comparator trim",v),v=v.replace(a[c.TILDETRIM],u),s("tilde trim",v),v=v.replace(a[c.CARETTRIM],f),s("caret trim",v);let q=v.split(" ").map(ie=>y(ie,this.options)).join(" ").split(/\s+/).map(ie=>Y(ie,this.options));k&&(q=q.filter(ie=>(s("loose invalid filter",ie,this.options),!!ie.match(a[c.COMPARATORLOOSE])))),s("range list",q);const U=new Map,Z=q.map(ie=>new r(ie,this.options));for(const ie of Z){if(g(ie))return[ie];U.set(ie.value,ie)}U.size>1&&U.has("")&&U.delete("");const Ee=[...U.values()];return n.set(T,Ee),Ee}intersects(v,O){if(!(v instanceof e))throw new TypeError("a Range is required");return this.set.some(T=>m(T,O)&&v.set.some(A=>m(A,O)&&T.every(k=>A.every(D=>k.intersects(D,O)))))}test(v){if(!v)return!1;if(typeof v=="string")try{v=new o(v,this.options)}catch(O){return!1}for(let O=0;O<this.set.length;O++)if(_e(this.set[O],v,this.options))return!0;return!1}}ro=e;const t=n1,n=new t({max:1e3}),i=gc,r=W1(),s=Ps,o=yc,{safeRe:a,t:c,comparatorTrimReplace:l,tildeTrimReplace:u,caretTrimReplace:f}=mc,{FLAG_INCLUDE_PRERELEASE:d,FLAG_LOOSE:p}=hc,g=E=>E.value==="<0.0.0-0",h=E=>E.value==="",m=(E,v)=>{let O=!0;const T=E.slice();let A=T.pop();for(;O&&T.length;)O=T.every(k=>A.intersects(k,v)),A=T.pop();return O},y=(E,v)=>(s("comp",E,v),E=$(E,v),s("caret",E),E=N(E,v),s("tildes",E),E=F(E,v),s("xrange",E),E=H(E,v),s("stars",E),E),b=E=>!E||E.toLowerCase()==="x"||E==="*",N=(E,v)=>E.trim().split(/\s+/).map(O=>_(O,v)).join(" "),_=(E,v)=>{const O=v.loose?a[c.TILDELOOSE]:a[c.TILDE];return E.replace(O,(T,A,k,D,q)=>{s("tilde",E,T,A,k,D,q);let U;return b(A)?U="":b(k)?U=">=".concat(A,".0.0 <").concat(+A+1,".0.0-0"):b(D)?U=">=".concat(A,".").concat(k,".0 <").concat(A,".").concat(+k+1,".0-0"):q?(s("replaceTilde pr",q),U=">=".concat(A,".").concat(k,".").concat(D,"-").concat(q," <").concat(A,".").concat(+k+1,".0-0")):U=">=".concat(A,".").concat(k,".").concat(D," <").concat(A,".").concat(+k+1,".0-0"),s("tilde return",U),U})},$=(E,v)=>E.trim().split(/\s+/).map(O=>P(O,v)).join(" "),P=(E,v)=>{s("caret",E,v);const O=v.loose?a[c.CARETLOOSE]:a[c.CARET],T=v.includePrerelease?"-0":"";return E.replace(O,(A,k,D,q,U)=>{s("caret",E,A,k,D,q,U);let Z;return b(k)?Z="":b(D)?Z=">=".concat(k,".0.0").concat(T," <").concat(+k+1,".0.0-0"):b(q)?k==="0"?Z=">=".concat(k,".").concat(D,".0").concat(T," <").concat(k,".").concat(+D+1,".0-0"):Z=">=".concat(k,".").concat(D,".0").concat(T," <").concat(+k+1,".0.0-0"):U?(s("replaceCaret pr",U),k==="0"?D==="0"?Z=">=".concat(k,".").concat(D,".").concat(q,"-").concat(U," <").concat(k,".").concat(D,".").concat(+q+1,"-0"):Z=">=".concat(k,".").concat(D,".").concat(q,"-").concat(U," <").concat(k,".").concat(+D+1,".0-0"):Z=">=".concat(k,".").concat(D,".").concat(q,"-").concat(U," <").concat(+k+1,".0.0-0")):(s("no pr"),k==="0"?D==="0"?Z=">=".concat(k,".").concat(D,".").concat(q).concat(T," <").concat(k,".").concat(D,".").concat(+q+1,"-0"):Z=">=".concat(k,".").concat(D,".").concat(q).concat(T," <").concat(k,".").concat(+D+1,".0-0"):Z=">=".concat(k,".").concat(D,".").concat(q," <").concat(+k+1,".0.0-0")),s("caret return",Z),Z})},F=(E,v)=>(s("replaceXRanges",E,v),E.split(/\s+/).map(O=>L(O,v)).join(" ")),L=(E,v)=>{E=E.trim();const O=v.loose?a[c.XRANGELOOSE]:a[c.XRANGE];return E.replace(O,(T,A,k,D,q,U)=>{s("xRange",E,T,A,k,D,q,U);const Z=b(k),Ee=Z||b(D),ie=Ee||b(q),cn=ie;return A==="="&&cn&&(A=""),U=v.includePrerelease?"-0":"",Z?A===">"||A==="<"?T="<0.0.0-0":T="*":A&&cn?(Ee&&(D=0),q=0,A===">"?(A=">=",Ee?(k=+k+1,D=0,q=0):(D=+D+1,q=0)):A==="<="&&(A="<",Ee?k=+k+1:D=+D+1),A==="<"&&(U="-0"),T="".concat(A+k,".").concat(D,".").concat(q).concat(U)):Ee?T=">=".concat(k,".0.0").concat(U," <").concat(+k+1,".0.0-0"):ie&&(T=">=".concat(k,".").concat(D,".0").concat(U," <").concat(k,".").concat(+D+1,".0-0")),s("xRange return",T),T})},H=(E,v)=>(s("replaceStars",E,v),E.trim().replace(a[c.STAR],"")),Y=(E,v)=>(s("replaceGTE0",E,v),E.trim().replace(a[v.includePrerelease?c.GTE0PRE:c.GTE0],"")),ue=E=>(v,O,T,A,k,D,q,U,Z,Ee,ie,cn,zs)=>(b(T)?O="":b(A)?O=">=".concat(T,".0.0").concat(E?"-0":""):b(k)?O=">=".concat(T,".").concat(A,".0").concat(E?"-0":""):D?O=">=".concat(O):O=">=".concat(O).concat(E?"-0":""),b(Z)?U="":b(Ee)?U="<".concat(+Z+1,".0.0-0"):b(ie)?U="<".concat(Z,".").concat(+Ee+1,".0-0"):cn?U="<=".concat(Z,".").concat(Ee,".").concat(ie,"-").concat(cn):E?U="<".concat(Z,".").concat(Ee,".").concat(+ie+1,"-0"):U="<=".concat(U),"".concat(O," ").concat(U).trim()),_e=(E,v,O)=>{for(let T=0;T<E.length;T++)if(!E[T].test(v))return!1;if(v.prerelease.length&&!O.includePrerelease){for(let T=0;T<E.length;T++)if(s(E[T].semver),E[T].semver!==r.ANY&&E[T].semver.prerelease.length>0){const A=E[T].semver;if(A.major===v.major&&A.minor===v.minor&&A.patch===v.patch)return!0}return!1}return!0};return ro}const G1=Hp(),H1=(e,t,n)=>{try{t=new G1(t,n)}catch(i){return!1}return t.test(e)};var q1=H1,qp=X$(q1);function X1(e,t,n){const i=e.open(t),r=1e4,s=250,{origin:o}=new URL(t);let a=~~(r/s);function c(u){u.source===i&&(a=0,e.removeEventListener("message",c,!1))}e.addEventListener("message",c,!1);function l(){a<=0||(i.postMessage(n,o),setTimeout(l,s),a-=1)}setTimeout(l,s)}var V1='.vega-embed {\n  position: relative;\n  display: inline-block;\n  box-sizing: border-box;\n}\n.vega-embed.has-actions {\n  padding-right: 38px;\n}\n.vega-embed details:not([open]) > :not(summary) {\n  display: none !important;\n}\n.vega-embed summary {\n  list-style: none;\n  position: absolute;\n  top: 0;\n  right: 0;\n  padding: 6px;\n  z-index: 1000;\n  background: white;\n  box-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);\n  color: #1b1e23;\n  border: 1px solid #aaa;\n  border-radius: 999px;\n  opacity: 0.2;\n  transition: opacity 0.4s ease-in;\n  cursor: pointer;\n  line-height: 0px;\n}\n.vega-embed summary::-webkit-details-marker {\n  display: none;\n}\n.vega-embed summary:active {\n  box-shadow: #aaa 0px 0px 0px 1px inset;\n}\n.vega-embed summary svg {\n  width: 14px;\n  height: 14px;\n}\n.vega-embed details[open] summary {\n  opacity: 0.7;\n}\n.vega-embed:hover summary, .vega-embed:focus-within summary {\n  opacity: 1 !important;\n  transition: opacity 0.2s ease;\n}\n.vega-embed .vega-actions {\n  position: absolute;\n  z-index: 1001;\n  top: 35px;\n  right: -9px;\n  display: flex;\n  flex-direction: column;\n  padding-bottom: 8px;\n  padding-top: 8px;\n  border-radius: 4px;\n  box-shadow: 0 2px 8px 0 rgba(0, 0, 0, 0.2);\n  border: 1px solid #d9d9d9;\n  background: white;\n  animation-duration: 0.15s;\n  animation-name: scale-in;\n  animation-timing-function: cubic-bezier(0.2, 0, 0.13, 1.5);\n  text-align: left;\n}\n.vega-embed .vega-actions a {\n  padding: 8px 16px;\n  font-family: sans-serif;\n  font-size: 14px;\n  font-weight: 600;\n  white-space: nowrap;\n  color: #434a56;\n  text-decoration: none;\n}\n.vega-embed .vega-actions a:hover, .vega-embed .vega-actions a:focus {\n  background-color: #f7f7f9;\n  color: black;\n}\n.vega-embed .vega-actions::before, .vega-embed .vega-actions::after {\n  content: "";\n  display: inline-block;\n  position: absolute;\n}\n.vega-embed .vega-actions::before {\n  left: auto;\n  right: 14px;\n  top: -16px;\n  border: 8px solid rgba(0, 0, 0, 0);\n  border-bottom-color: #d9d9d9;\n}\n.vega-embed .vega-actions::after {\n  left: auto;\n  right: 15px;\n  top: -14px;\n  border: 7px solid rgba(0, 0, 0, 0);\n  border-bottom-color: #fff;\n}\n.vega-embed .chart-wrapper.fit-x {\n  width: 100%;\n}\n.vega-embed .chart-wrapper.fit-y {\n  height: 100%;\n}\n\n.vega-embed-wrapper {\n  max-width: 100%;\n  overflow: auto;\n  padding-right: 14px;\n}\n\n@keyframes scale-in {\n  from {\n    opacity: 0;\n    transform: scale(0.6);\n  }\n  to {\n    opacity: 1;\n    transform: scale(1);\n  }\n}\n';function Xp(e,...t){for(const n of t)Y1(e,n);return e}function Y1(e,t){for(const n of Object.keys(t))zo(e,n,t[n],!0)}var K1="vega-embed",J1="6.22.2",Q1="Publish Vega visualizations as embedded web components.",Z1=["vega","data","visualization","component","embed"],e0={type:"git",url:"http://github.com/vega/vega-embed.git"},t0={name:"UW Interactive Data Lab",url:"http://idl.cs.washington.edu"},n0=[{name:"Dominik Moritz",url:"https://www.domoritz.de"}],i0={url:"https://github.com/vega/vega-embed/issues"},r0="https://github.com/vega/vega-embed#readme",s0="BSD-3-Clause",o0="build/vega-embed.js",a0="build/vega-embed.module.js",c0="build/vega-embed.min.js",l0="build/vega-embed.min.js",u0="build/vega-embed.module.d.ts",f0=["src","build","patches"],d0={"@babel/core":"^7.22.9","@babel/plugin-proposal-async-generator-functions":"^7.20.7","@babel/plugin-proposal-json-strings":"^7.18.6","@babel/plugin-proposal-object-rest-spread":"^7.20.7","@babel/plugin-proposal-optional-catch-binding":"^7.18.6","@babel/plugin-transform-runtime":"^7.22.9","@babel/preset-env":"^7.22.9","@babel/preset-typescript":"^7.22.5","@release-it/conventional-changelog":"^7.0.0","@rollup/plugin-commonjs":"25.0.3","@rollup/plugin-json":"^6.0.0","@rollup/plugin-node-resolve":"^15.1.0","@rollup/plugin-terser":"^0.4.3","@types/semver":"^7.5.0","@typescript-eslint/eslint-plugin":"^6.2.0","@typescript-eslint/parser":"^6.2.0","browser-sync":"^2.29.3",concurrently:"^8.2.0","del-cli":"^5.0.0",eslint:"^8.46.0","eslint-config-prettier":"^8.9.0","eslint-plugin-jest":"^27.2.3","eslint-plugin-prettier":"^5.0.0",jest:"^29.6.2","jest-canvas-mock":"^2.5.2","jest-environment-jsdom":"^29.6.2","patch-package":"^8.0.0","postinstall-postinstall":"^2.1.0",prettier:"^3.0.0","release-it":"^16.1.3",rollup:"3.27.0","rollup-plugin-bundle-size":"^1.0.3","rollup-plugin-ts":"^3.2.0",sass:"^1.64.1",typescript:"^5.1.6",vega:"^5.22.1","vega-lite":"^5.2.0"},p0={vega:"^5.21.0","vega-lite":"*"},g0={"fast-json-patch":"^3.1.1","json-stringify-pretty-compact":"^3.0.0",semver:"^7.5.4",tslib:"^2.6.1","vega-interpreter":"^1.0.5","vega-schema-url-parser":"^2.2.0","vega-themes":"^2.14.0","vega-tooltip":"^0.32.0"},h0=["yallist"],m0={prebuild:"yarn clean && yarn build:style",build:"rollup -c","build:style":"./build-style.sh",clean:"del-cli build src/style.ts",prepublishOnly:"yarn clean && yarn build",preversion:"yarn lint && yarn test",serve:"browser-sync start --directory -s -f build *.html",start:"yarn build && concurrently --kill-others -n Server,Rollup 'yarn serve' 'rollup -c -w'",pretest:"yarn build:style",test:"jest","test:inspect":"node --inspect-brk ./node_modules/.bin/jest --runInBand",prettierbase:"prettier '*.{css,scss,html}'",format:"eslint . --fix && yarn prettierbase --write",lint:"eslint . && yarn prettierbase --check",release:"release-it"},y0={name:K1,version:J1,description:Q1,keywords:Z1,repository:e0,author:t0,contributors:n0,bugs:i0,homepage:r0,license:s0,main:o0,module:a0,unpkg:c0,jsdelivr:l0,types:u0,files:f0,devDependencies:d0,peerDependencies:p0,dependencies:g0,bundledDependencies:h0,scripts:m0};function uu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,i)}return n}function qt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uu(Object(n),!0).forEach(function(i){q$(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uu(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}const gO=y0.version,lt=ng;let Qi=_w;const wr=typeof window<"u"?window:void 0;var gu;Qi===void 0&&((gu=wr==null?void 0:wr.vl)!=null&&gu.compile)&&(Qi=wr.vl);const b0={export:{svg:!0,png:!0},source:!0,compiled:!0,editor:!0},v0={CLICK_TO_VIEW_ACTIONS:"Click to view actions",COMPILED_ACTION:"View Compiled Vega",EDITOR_ACTION:"Open in Vega Editor",PNG_ACTION:"Save as PNG",SOURCE_ACTION:"View Source",SVG_ACTION:"Save as SVG"},Di={vega:"Vega","vega-lite":"Vega-Lite"},Gr={vega:lt.version,"vega-lite":Qi?Qi.version:"not available"},x0={vega:e=>e,"vega-lite":(e,t)=>Qi.compile(e,{config:t}).spec},S0='\n<svg viewBox="0 0 16 16" fill="currentColor" stroke="none" stroke-width="1" stroke-linecap="round" stroke-linejoin="round">\n  <circle r="2" cy="8" cx="2"></circle>\n  <circle r="2" cy="8" cx="8"></circle>\n  <circle r="2" cy="8" cx="14"></circle>\n</svg>',E0="chart-wrapper";function w0(e){return typeof e=="function"}function fu(e,t,n,i){const r="<html><head>".concat(t,'</head><body><pre><code class="json">'),s="</code></pre>".concat(n,"</body></html>"),o=window.open("");o.document.write(r+e+s),o.document.title="".concat(Di[i]," JSON Source")}function $0(e,t){var n;if(e.$schema){const i=Dp(e.$schema);t&&t!==i.library&&console.warn("The given visualization spec is written in ".concat(Di[i.library],", but mode argument sets ").concat((n=Di[t])!=null?n:t,"."));const r=i.library;return qp(Gr[r],"^".concat(i.version.slice(1)))||console.warn("The input spec uses ".concat(Di[r]," ").concat(i.version,", but the current version of ").concat(Di[r]," is v").concat(Gr[r],".")),r}return"mark"in e||"encoding"in e||"layer"in e||"hconcat"in e||"vconcat"in e||"facet"in e||"repeat"in e?"vega-lite":"marks"in e||"signals"in e||"scales"in e||"axes"in e?"vega":t!=null?t:"vega"}function O0(e){return!!(e&&"load"in e)}function du(e){return O0(e)?e:lt.loader(e)}function C0(e){var n,i;const t=(i=(n=e.usermeta)==null?void 0:n.embedOptions)!=null?i:{};return z(t.defaultStyle)&&(t.defaultStyle=!1),t}async function hO(e,t,n={}){var u,f,d;let i,r;z(t)?(r=du(n.loader),i=JSON.parse(await r.load(t))):i=t;const s=C0(i),o=s.loader;(!r||o)&&(r=du((u=n.loader)!=null?u:o));const a=await pu(s,r),c=await pu(n,r),l=qt(qt({},Xp(c,a)),{},{config:qr((f=c.config)!=null?f:{},(d=a.config)!=null?d:{})});return await _0(e,i,l,r)}async function pu(e,t){var r;const n=z(e.config)?JSON.parse(await t.load(e.config)):(r=e.config)!=null?r:{},i=z(e.patch)?JSON.parse(await t.load(e.patch)):e.patch;return qt(qt(qt({},e),i?{patch:i}:{}),n?{config:n}:{})}function N0(e){var n;const t=e.getRootNode?e.getRootNode():document;return t instanceof ShadowRoot?{root:t,rootContainer:t}:{root:document,rootContainer:(n=document.head)!=null?n:document.body}}async function _0(e,t,n={},i){var $,P,F,L,H,Y,ue,_e;const r=n.theme?qr(T$[n.theme],($=n.config)!=null?$:{}):n.config,s=bi(n.actions)?n.actions:Xp({},b0,(P=n.actions)!=null?P:{}),o=qt(qt({},v0),n.i18n),a=(F=n.renderer)!=null?F:"canvas",c=(L=n.logLevel)!=null?L:lt.Warn,l=(H=n.downloadFileName)!=null?H:"visualization",u=typeof e=="string"?document.querySelector(e):e;if(!u)throw new Error("".concat(e," does not exist"));if(n.defaultStyle!==!1){const E="vega-embed-style",{root:v,rootContainer:O}=N0(u);if(!v.getElementById(E)){const T=document.createElement("style");T.id=E,T.innerHTML=n.defaultStyle===void 0||n.defaultStyle===!0?V1.toString():n.defaultStyle,O.appendChild(T)}}const f=$0(t,n.mode);let d=x0[f](t,r);if(f==="vega-lite"&&d.$schema){const E=Dp(d.$schema);qp(Gr.vega,"^".concat(E.version.slice(1)))||console.warn("The compiled spec uses Vega ".concat(E.version,", but current version is v").concat(Gr.vega,"."))}u.classList.add("vega-embed"),s&&u.classList.add("has-actions"),u.innerHTML="";let p=u;if(s){const E=document.createElement("div");E.classList.add(E0),u.appendChild(E),p=E}const g=n.patch;if(g&&(d=g instanceof Function?g(d):Xr(d,g,!0,!1).newDocument),n.formatLocale&&lt.formatLocale(n.formatLocale),n.timeFormatLocale&&lt.timeFormatLocale(n.timeFormatLocale),n.expressionFunctions)for(const E in n.expressionFunctions){const v=n.expressionFunctions[E];"fn"in v?lt.expressionFunction(E,v.fn,v.visitor):v instanceof Function&&lt.expressionFunction(E,v)}const{ast:h}=n,m=lt.parse(d,f==="vega-lite"?{}:r,{ast:h}),y=new(n.viewClass||lt.View)(m,qt({loader:i,logLevel:c,renderer:a},h?{expr:(ue=(Y=lt.expressionInterpreter)!=null?Y:n.expr)!=null?ue:Tg}:{}));if(y.addSignalListener("autosize",(E,v)=>{const{type:O}=v;O=="fit-x"?(p.classList.add("fit-x"),p.classList.remove("fit-y")):O=="fit-y"?(p.classList.remove("fit-x"),p.classList.add("fit-y")):O=="fit"?p.classList.add("fit-x","fit-y"):p.classList.remove("fit-x","fit-y")}),n.tooltip!==!1){const E=w0(n.tooltip)?n.tooltip:new W$(n.tooltip===!0?{}:n.tooltip).call;y.tooltip(E)}let{hover:b}=n;if(b===void 0&&(b=f==="vega"),b){const{hoverSet:E,updateSet:v}=typeof b=="boolean"?{}:b;y.hover(E,v)}n&&(n.width!=null&&y.width(n.width),n.height!=null&&y.height(n.height),n.padding!=null&&y.padding(n.padding)),await y.initialize(p,n.bind).runAsync();let N;if(s!==!1){let E=u;if(n.defaultStyle!==!1){const O=document.createElement("details");O.title=o.CLICK_TO_VIEW_ACTIONS,u.append(O),E=O;const T=document.createElement("summary");T.innerHTML=S0,O.append(T),N=A=>{O.contains(A.target)||O.removeAttribute("open")},document.addEventListener("click",N)}const v=document.createElement("div");if(E.append(v),v.classList.add("vega-actions"),s===!0||s.export!==!1){for(const O of["svg","png"])if(s===!0||s.export===!0||s.export[O]){const T=o["".concat(O.toUpperCase(),"_ACTION")],A=document.createElement("a"),k=X(n.scaleFactor)?n.scaleFactor[O]:n.scaleFactor;A.text=T,A.href="#",A.target="_blank",A.download="".concat(l,".").concat(O),A.addEventListener("mousedown",async function(D){D.preventDefault();const q=await y.toImageURL(O,k);this.href=q}),v.append(A)}}if(s===!0||s.source!==!1){const O=document.createElement("a");O.text=o.SOURCE_ACTION,O.href="#",O.addEventListener("click",function(T){var A,k;fu(Ds(t),(A=n.sourceHeader)!=null?A:"",(k=n.sourceFooter)!=null?k:"",f),T.preventDefault()}),v.append(O)}if(f==="vega-lite"&&(s===!0||s.compiled!==!1)){const O=document.createElement("a");O.text=o.COMPILED_ACTION,O.href="#",O.addEventListener("click",function(T){var A,k;fu(Ds(d),(A=n.sourceHeader)!=null?A:"",(k=n.sourceFooter)!=null?k:"","vega"),T.preventDefault()}),v.append(O)}if(s===!0||s.editor!==!1){const O=(_e=n.editorUrl)!=null?_e:"https://vega.github.io/editor/",T=document.createElement("a");T.text=o.EDITOR_ACTION,T.href="#",T.addEventListener("click",function(A){X1(window,O,{config:r,mode:f,renderer:a,spec:Ds(t)}),A.preventDefault()}),v.append(T)}}function _(){N&&document.removeEventListener("click",N),y.finalize()}return{view:y,spec:t,vgSpec:d,finalize:_,embedOptions:n}}export{b0 as DEFAULT_ACTIONS,hO as default,$0 as guessMode,lt as vega,Qi as vegaLite,gO as version};
